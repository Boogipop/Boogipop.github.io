<!DOCTYPE html>
<html lang="zh-CN">
    <head prefix="og: https://ogp.me/ns#">
  <meta charset="utf-8">
  <meta name="referrer" content="no-referrer" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>Docker学习 - Boogiepop Doesn&#39;t Laugh</title>
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    <link rel='manifest' href='/manifest.json'>
  

  
  
  
  <meta property="og:title" content="Docker学习 - Boogiepop Doesn&#39;t Laugh" />
  
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="http://boogipop.com/2023/03/02/Docker%20Learning/index.html" />
  
  <meta property="og:image" content="/favicon.png" />
  
  <meta property="og:article:published_time" content="2023-03-02T10:21:12.000Z" />
  
  <meta property="og:article:author" content="Boogipop" />
  
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
<link rel="stylesheet" href="/css/giscus.css">

  
  
<link rel="stylesheet" href="/css/rainbow-banner.css">

  
  
  
<link rel="stylesheet" href="/css/toc.css">

  
  
    
<link rel="stylesheet" href="/css/giscus.css">

  
  
  
  
<link rel="stylesheet" href="/css/post.css">

  
  
  
  
  

  
<meta name="generator" content="Hexo 6.3.0"></head>
    <body
        data-color-scheme="auto"
        data-uppercase-categories="true"
        
        data-rainbow-banner="true"
        data-rainbow-banner-shown="auto"
        data-rainbow-banner-month="6"
        data-rainbow-banner-colors="#e50000,#ff8d00,#ffee00,#008121,#004cff,#760188"
        
        data-config-root="/"
        
        data-toc="true"
        data-toc-max-depth="2"
        
        
    >
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">Blog</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">Home</a>
            
            
            <a class="nav-item" href="/archives">Archives</a>
            
            
            
            <a class="nav-item" href="/friends">Friends</a>
            
            
            
            <a class="nav-item" href="/about">About</a>
            
            
            
            <a class="nav-item" href="/categories">Categories</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/MrWillCom" target="_blank" aria-label="GitHub">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-codepen nav-item-icon" href="https://codepen.io/mrwillcom" target="_blank" aria-label="CodePen">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-patreon nav-item-icon" href="https://www.patreon.com/MrWillCom" target="_blank" aria-label="Patreon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-mastodon nav-item-icon" href="https://noc.social/@MrWillCom" target="_blank" aria-label="Mastodon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-discord nav-item-icon" href="https://discord.gg/UKuFDjcfY8" target="_blank" aria-label="Discord">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-search nav-item-icon" href="/search" target="_blank" aria-label="Search">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        
<article class="post">
    <div class="meta">
        
        <div class="categories text-uppercase">
        
            <a href="/categories/Development/">Development</a>
        
        </div>
        

        
        <div class="date" id="date">
            <span>March</span>
            <span>2,</span>
            <span>2023</span>
        </div>
        

        <h2 class="title">Docker学习</h2>
    </div>

    <div class="divider"></div>

    <div class="content">
        <h1 id="0X1-简介"><a href="#0X1-简介" class="headerlink" title="0X1 简介"></a>0X1 简介</h1><h2 id="0X1-1-Why-docker"><a href="#0X1-1-Why-docker" class="headerlink" title="0X1.1 Why docker?"></a>0X1.1 Why docker?</h2><p>在开发和运维部署的流程中，可能存在开发和运维的环境配置不相同的情况<br>导致我们的SRC源代码run不起来而产生矛盾<br>而docker的出现很好的解决了这一问题，docker可以把整个环境打包形成一个镜像文件，原封不动的照搬过来，这样就100%不会有冲突</p>
<h2 id="0X1-2-docker设计理念"><a href="#0X1-2-docker设计理念" class="headerlink" title="0X1.2 docker设计理念"></a>0X1.2 docker设计理念</h2><p>Docker是go语言的开源项目，docker可以做到‘一次镜像，处处运行’的效果。<br>是解决了<strong>运行环境和配置问题</strong>的<strong>软件容器</strong><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663085702732-7609132c-ddb4-4963-8562-d830c0bcf26e.png#averageHue=%23ebeae5&clientId=u6472420f-63b0-4&from=paste&height=614&id=ud28f4fb7&name=image.png&originHeight=768&originWidth=1782&originalType=binary&ratio=1&rotation=0&showTitle=false&size=777692&status=done&style=none&taskId=uaa8436a2-6e71-42fa-85d8-81fe87a7245&title=&width=1425.6" alt="image.png"></p>
<h2 id="0X1-3-传统虚拟机和docker的对比"><a href="#0X1-3-传统虚拟机和docker的对比" class="headerlink" title="0X1.3 传统虚拟机和docker的对比"></a>0X1.3 传统虚拟机和docker的对比</h2><ul>
<li>The shortcomings of VM</li>
</ul>
<p>资源占用多，步骤多，启动慢</p>
<ul>
<li>The advantages of docker container</li>
</ul>
<p>可以复用，启动快速，占用内存少<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663086668968-25334eca-cfbd-4289-9b9a-4745416e1d89.png#averageHue=%23e5e3de&clientId=u0e5a7a1b-1fdb-4&from=paste&height=404&id=uec476bfa&name=image.png&originHeight=505&originWidth=1720&originalType=binary&ratio=1&rotation=0&showTitle=false&size=632948&status=done&style=none&taskId=uaa184596-a224-407b-9418-99a65d93cd4&title=&width=1376" alt="image.png"></p>
<h2 id="0X1-4-docker的构成"><a href="#0X1-4-docker的构成" class="headerlink" title="0X1.4 docker的构成"></a>0X1.4 docker的构成</h2><p>镜像，容器，仓库是构成docker的三大部分</p>
<ul>
<li>镜像</li>
</ul>
<p>可以理解为类与对象，new classs()<br>类就相当于镜像文件</p>
<ul>
<li><p>容器</p>
<p>   镜像创造出来的容器，一个对象可以创造很多个容器</p>
</li>
</ul>
<p>类与对象中，实例对象就相当于容器</p>
<ul>
<li>仓库</li>
</ul>
<p>集中存放镜像文件的地方<br>类似于：<br>github仓库，存放各种git项目的地方<br>docker公司提供的官方registry被称为docker hub，存放各种镜像模板的地方<br>仓库分为<strong>私有仓库</strong>和<strong>公开仓库，</strong>dockerhub是最大的公开仓库<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663171053833-cd52efb5-a1df-4142-801c-a3f14ae8a210.png#averageHue=%23f8fbf8&clientId=u48bd00ba-599c-4&from=paste&height=572&id=u84bce022&name=image.png&originHeight=715&originWidth=1363&originalType=binary&ratio=1&rotation=0&showTitle=false&size=209699&status=done&style=none&taskId=u96a90992-476e-40a6-9e04-04e0b478146&title=&width=1090.4" alt="image.png"></p>
<h2 id="0X1-5-Install-docker"><a href="#0X1-5-Install-docker" class="headerlink" title="0X1.5 Install docker"></a>0X1.5 Install docker</h2><p>真是出省啊，为什么每次kali虚拟机就会出现一大堆B毛病我草！！！！！<br>永远不要用deb包去安装，会变得不幸，想安装好就老老实实的看这里：![7%Y<del>IJXOM]01DK}H5OE7925.jpg](<a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/jpeg/32634994/1663300754775-ed741ec0-7941-4b4d-8ced-65016b8ee664.jpeg#averageHue=%23a9aaa6&amp;clientId=u15e908d6-7be0-4&amp;from=paste&amp;height=208&amp;id=ue9ad9b76&amp;name=7%25Y">https://cdn.nlark.com/yuque/0/2022/jpeg/32634994/1663300754775-ed741ec0-7941-4b4d-8ced-65016b8ee664.jpeg#averageHue=%23a9aaa6&amp;clientId=u15e908d6-7be0-4&amp;from=paste&amp;height=208&amp;id=ue9ad9b76&amp;name=7%25Y</a></del>IJXOM%5D01DK%7DH5OE7925.jpg&amp;originHeight&#x3D;260&amp;originWidth&#x3D;278&amp;originalType&#x3D;binary&amp;ratio&#x3D;1&amp;rotation&#x3D;0&amp;showTitle&#x3D;false&amp;size&#x3D;17832&amp;status&#x3D;done&amp;style&#x3D;none&amp;taskId&#x3D;u1ccd1f29-9a65-4209-a584-37ebdeafb93&amp;title&#x3D;&amp;width&#x3D;222.4)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#新重写sources.list中内容，一个个字母删除太久了</span></span><br><span class="line"><span class="keyword">echo</span> &gt; /etc/apt/sources.<span class="keyword">list</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#进入sources.lis重新编辑apt源</span></span><br><span class="line">vim /etc/apt/sources.<span class="keyword">list</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#直接CV大法写入下面的apt源</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#其他apt源</span><br><span class="line">#此处，笔者仅添加中科达和阿里的，其他注释掉</span><br><span class="line"></span><br><span class="line">#中科大</span><br><span class="line">deb http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</span><br><span class="line">deb-src http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</span><br><span class="line"></span><br><span class="line">#阿里云</span><br><span class="line">deb http://mirrors.aliyun.com/kali kali-rolling main non-free contrib</span><br><span class="line">deb-src http://mirrors.aliyun.com/kali kali-rolling main non-free contrib</span><br><span class="line"></span><br><span class="line">#清华大学</span><br><span class="line">#deb http://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free</span><br><span class="line">#deb-src https://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free</span><br><span class="line"></span><br><span class="line">#浙大</span><br><span class="line">#deb http://mirrors.zju.edu.cn/kali kali-rolling main contrib non-free</span><br><span class="line">#deb-src http://mirrors.zju.edu.cn/kali kali-rolling main contrib non-free</span><br><span class="line"></span><br><span class="line">#东软大学</span><br><span class="line">#deb http://mirrors.neusoft.edu.cn/kali kali-rolling/main non-free contribp.kali.org/kali kali-rolling main non-free contrib</span><br><span class="line"></span><br><span class="line">#重庆大学</span><br><span class="line">#deb http://http.kali.org/kali kali-rolling main non-free contrib</span><br><span class="line">#deb-src http://http.kali.org/kali kali-rolling main non-free contrib</span><br></pre></td></tr></table></figure>
<p>更新系统工具：<br><code>apt-get update &amp;&amp; apt-get upgrade &amp;&amp; apt-get dist-upgrade</code><br>清除缓存：<br><code>apt-get clean</code></p>
<p>采用apt安装docker：<br>为什么采用apt安装？因为之后采用apt源安装Docker的其他组件时，新组件与已安装的Docker容器最为匹配。<br><code>apt-get install docker docker-compose</code><br> 或<br><code>apt-get install docker.io</code></p>
<p>检测docker是否安装成功：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#启动docker服务</span><br><span class="line">service docker start</span><br><span class="line"> </span><br><span class="line">#列出docker现有镜像</span><br><span class="line">docker images</span><br><span class="line"> </span><br><span class="line">#运行hello-world镜像</span><br><span class="line">#但apt安装的docker没带有hello-world默认镜像呀，所以下面的命令不成功，它会帮你拉去该镜像下来</span><br><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663198634946-d2050fa1-a71b-4a4f-b45c-da83f9b12905.png#averageHue=%2326282f&clientId=u48bd00ba-599c-4&from=paste&height=109&id=u19b15383&name=image.png&originHeight=136&originWidth=623&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29816&status=done&style=none&taskId=ub544f638-4187-4b2f-b8c4-d113bd0adef&title=&width=498.4" alt="image.png"></p>
<p>妈的这上面的步骤一步也别乱，真的<img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663198699250-7a5fa997-3fa9-4b1e-971a-1a605c2169dc.png#averageHue=%23635a4f&clientId=u48bd00ba-599c-4&from=paste&height=38&id=u41a32998&name=18DA447A.png&originHeight=48&originWidth=48&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4297&status=done&style=none&taskId=u25c36239-a3fc-4ba8-8852-73e6ef2ae1f&title=&width=38.4" alt="18DA447A.png"></p>
<h2 id="0X1-6-docker镜像加速器配置"><a href="#0X1-6-docker镜像加速器配置" class="headerlink" title="0X1.6 docker镜像加速器配置"></a>0X1.6 docker镜像加速器配置</h2><p>配置镜像加速器：<br>先去阿里云注册一个账号，点击镜像工具：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663205399236-fd03e42a-7a5f-42e0-bfe4-07db46da07ab.png#averageHue=%23e4c497&clientId=u48bd00ba-599c-4&from=paste&height=651&id=u0b9ad371&name=image.png&originHeight=814&originWidth=1710&originalType=binary&ratio=1&rotation=0&showTitle=false&size=80325&status=done&style=none&taskId=u2a57b92c-556b-4121-86d5-33b4b7f1b9a&title=&width=1368" alt="image.png"><br>将这段代码在命令行运行</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://hedsl5yh.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p>sudo systemctl daemon-reload<br>sudo systemctl restart docker<br>这样就完成了镜像加速的配置<br>运行完后，输入<code>docker info</code><br>如果有这一段信息就说明成功了：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663205367693-a876e312-726f-4010-8e16-da1657868c7f.png#averageHue=%232a2c32&clientId=u48bd00ba-599c-4&from=paste&height=121&id=uca74415a&name=image.png&originHeight=151&originWidth=415&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16482&status=done&style=none&taskId=u28f01726-8b59-4459-95de-f5f2f36bc36&title=&width=332" alt="image.png"><br>划掉的部分就是阿里云里的地址</p>
<p>最后再设置一个开机自启<code>systemctl enable docker</code>这样每次开机就不需要手动开启了</p>
<h1 id="1X1-Docker-命令"><a href="#1X1-Docker-命令" class="headerlink" title="1X1 Docker 命令"></a>1X1 Docker 命令</h1><h2 id="1X1-1-启动类"><a href="#1X1-1-启动类" class="headerlink" title="1X1.1 启动类"></a>1X1.1 启动类</h2><p>启动docker：<code>systemctl start docker</code><br>停止docker：<code>systemctl stop docker</code><br>重启docker： <code>systemctl restart docker</code><br>查看docker状态：<code>systemctl status docker</code><br>开机自启动：<code>system enable docker</code><br>查看docker概要信息：<code>docker info</code><br>查看docker帮助文档：<code>docker --help</code><br>查看docker命令帮助文档：<code>docker 具体命令 --help</code></p>
<h2 id="1X1-2-镜像命令"><a href="#1X1-2-镜像命令" class="headerlink" title="1X1.2 镜像命令"></a>1X1.2 镜像命令</h2><ul>
<li>列出本地主机上的镜像文件：<code>docker images</code></li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663243077646-2b447fd4-8964-4531-b379-5c1673231c13.png#averageHue=%232b2d35&clientId=u7d4fd585-dc0c-4&from=paste&height=70&id=u19e4c1c0&name=image.png&originHeight=87&originWidth=526&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20257&status=done&style=none&taskId=ucf798746-eb56-45ad-a50f-74a7dc5062b&title=&width=420.8" alt="image.png"><br>REPOSITORY:表示镜像的仓库源<br>TAG：镜像的标签版本号<br>IMAGE ID：镜像ID<br>CREATED:创建时间<br>SIZE：内存大小<br>[OPTION]：<br>-a:列出本地所有镜像（包括历史镜像层）<br>-q：只显示镜像id</p>
<ul>
<li>查找某个镜像：<code>docker search 镜像</code>:</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663243505381-864664b7-4d33-40f7-acce-36f4a9addb78.png#averageHue=%232b2d33&clientId=u7d4fd585-dc0c-4&from=paste&height=174&id=u10c3369b&name=image.png&originHeight=217&originWidth=607&originalType=binary&ratio=1&rotation=0&showTitle=false&size=53808&status=done&style=none&taskId=u81344b4b-3188-4ccb-9882-41cc3b4ece3&title=&width=485.6" alt="image.png"><br>在远程库里找镜像<br>NAME:名称<br>DESCRIPTION：说明<br>STARS：点赞数<br>OFFICIAL：是否为官方的<br>AUTOMATED：是否为自动构建的<br>NAME中的前缀就是作者的名字，包名<br>[OPTION]：<br>–limit：只列出N个镜像，默认25个<br><code>docker search --limit 5 redis</code></p>
<ul>
<li>拉取镜像：<code>docker pull 镜像</code></li>
</ul>
<p>其中镜像的名称有2套写法：<br><code>docker pull 镜像名字:latest</code>下载最新版<br><code>docker pull 镜像名字</code>下载指定版本<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663250692158-bfb1ef9b-6fb4-4d85-8aed-4324de12793b.png#averageHue=%2331343b&clientId=u7d4fd585-dc0c-4&from=paste&height=168&id=u58cdf382&name=image.png&originHeight=210&originWidth=407&originalType=binary&ratio=1&rotation=0&showTitle=false&size=46312&status=done&style=none&taskId=u820df4a2-abae-4de3-a1dc-61385b4767b&title=&width=325.6" alt="image.png"></p>
<ul>
<li>查看镜像&#x2F;容器&#x2F;数据卷所占的空间</li>
</ul>
<p><code>docker system df </code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663251058327-31e90e26-bb65-430b-bdf2-e2f965b917e6.png#averageHue=%23292c34&clientId=u7d4fd585-dc0c-4&from=paste&height=118&id=u0a632bc8&name=image.png&originHeight=148&originWidth=602&originalType=binary&ratio=1&rotation=0&showTitle=false&size=36203&status=done&style=none&taskId=u72ec50b7-4f96-49f0-88a2-22c4ea3fdb4&title=&width=481.6" alt="image.png"></p>
<ul>
<li><p>删除某个镜像</p>
<p>  <code>docker rmi xxxx</code><br>  <code>docker rmi -f $(docker images -aq)</code>：删除全部</p>
</li>
</ul>
<p>[OPTION]:<br>-f 强制删除</p>
<h2 id="1X1-3-Ubuntu-容器例子"><a href="#1X1-3-Ubuntu-容器例子" class="headerlink" title="1X1.3 Ubuntu 容器例子"></a>1X1.3 Ubuntu 容器例子</h2><p>首先先拉一个ubuntu的镜像：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663253333924-b0459fa6-c2ad-4aab-a614-e60c4e14fbf2.png#averageHue=%23414b57&clientId=u7d4fd585-dc0c-4&from=paste&height=185&id=u862d7dd1&name=image.png&originHeight=231&originWidth=781&originalType=binary&ratio=1&rotation=0&showTitle=false&size=67229&status=done&style=none&taskId=u4ab7a23b-a1cc-411d-a65c-ed747182d4f&title=&width=624.8" alt="image.png"></p>
<h3 id="1X1-3-1-生成容器"><a href="#1X1-3-1-生成容器" class="headerlink" title="1X1.3.1 生成容器"></a>1X1.3.1 生成容器</h3><p><code>docker run [option]IMAGE[command][arg]</code><br>[OPTION]:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663253609753-a944d615-d674-4940-85f2-e4aed75c13ac.png#averageHue=%23fbf9f8&clientId=u7d4fd585-dc0c-4&from=paste&height=423&id=u415a663a&name=image.png&originHeight=529&originWidth=1402&originalType=binary&ratio=1&rotation=0&showTitle=false&size=328744&status=done&style=none&taskId=uce1d3190-d6ac-4246-af30-2c1e7bcd127&title=&width=1121.6" alt="image.png"><br><code>docker run -it ubuntu /bin/bash</code>:<br>以交互模式启动一个Ubuntu容器，在容器内执行&#x2F;bin&#x2F;bash命令，也就是shell命令<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663254421884-2fd3f0fa-29b5-4dc6-99d9-a19daeab5de9.png#averageHue=%23272d38&clientId=u7d4fd585-dc0c-4&from=paste&height=98&id=ua78866a5&name=image.png&originHeight=123&originWidth=665&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29732&status=done&style=none&taskId=u2307b887-0e01-48fa-be7b-ace52458254&title=&width=532" alt="image.png"></p>
<p><code>docker ps[OPTION]</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663254593399-367a94f4-9ce6-4e13-99cb-4e58b00c77ec.png#averageHue=%2321232b&clientId=u7d4fd585-dc0c-4&from=paste&height=91&id=u88347a55&name=image.png&originHeight=114&originWidth=675&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24661&status=done&style=none&taskId=u8f79b8eb-5eca-42e8-9d81-028b6bef02b&title=&width=540" alt="image.png"></p>
<p><code>docker run -it --name=kino ubuntu bash</code>:<br>以交互模式启动一个名称是kino的Ubuntu容器，在容器内执行&#x2F;bin&#x2F;bash命令<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663254794978-ea0e2a13-f895-43d3-a17a-891dca938641.png#averageHue=%231f2229&clientId=u7d4fd585-dc0c-4&from=paste&height=57&id=u528af4bf&name=image.png&originHeight=71&originWidth=491&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13345&status=done&style=none&taskId=u105f8e7d-f8f3-4b6e-ada3-8b7c7cec473&title=&width=392.8" alt="image.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663254816504-5c386a27-b59d-4bd5-9df9-8692fdf42efa.png#averageHue=%2322242c&clientId=u7d4fd585-dc0c-4&from=paste&height=133&id=uc15f8626&name=image.png&originHeight=166&originWidth=658&originalType=binary&ratio=1&rotation=0&showTitle=false&size=43998&status=done&style=none&taskId=u5cf97fc7-214e-4600-a239-8f484ea45bf&title=&width=526.4" alt="image.png"></p>
<h3 id="1X1-3-2-退出容器"><a href="#1X1-3-2-退出容器" class="headerlink" title="1X1.3.2 退出容器"></a>1X1.3.2 退出容器</h3><p><code>exit</code>或者<code>CTRL+D</code>：run进容器，exit退出，容器停止<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663300159447-db7c2871-55e4-48f3-abf3-fea5d22db11f.png#averageHue=%2324272e&clientId=u15e908d6-7be0-4&from=paste&height=178&id=u12af6d23&name=image.png&originHeight=222&originWidth=725&originalType=binary&ratio=1&rotation=0&showTitle=false&size=43778&status=done&style=none&taskId=u3d06d2d1-7186-4764-b7d0-b293bd58039&title=&width=580" alt="image.png"><br><code>ctrl+p+q</code>：run进容器，但是容器不停止<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663300145472-bac386b0-0051-4811-aeb5-34d3555adaeb.png#averageHue=%2324272e&clientId=u15e908d6-7be0-4&from=paste&height=258&id=u3403c4e2&name=image.png&originHeight=322&originWidth=884&originalType=binary&ratio=1&rotation=0&showTitle=false&size=82282&status=done&style=none&taskId=u35a6057c-4e44-4851-a1ab-3506f3b8a9f&title=&width=707.2" alt="image.png"></p>
<h3 id="1X1-3-3-进入停止的容器和启动着的容器"><a href="#1X1-3-3-进入停止的容器和启动着的容器" class="headerlink" title="1X1.3.3 进入停止的容器和启动着的容器"></a>1X1.3.3 进入停止的容器和启动着的容器</h3><p>如果我们是ctrl+p+q退出的，我们想要再次进入只需要<br><code>docker attach 容器ID或者名字</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663300363205-a523ef76-2205-4796-bb75-bd31d51b4d6d.png#averageHue=%2325282f&clientId=u15e908d6-7be0-4&from=paste&height=91&id=ud0e47ad1&name=image.png&originHeight=114&originWidth=524&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22272&status=done&style=none&taskId=u7bdd8ca9-3da6-4c2f-945a-e0a35876bf3&title=&width=419.2" alt="image.png"><br>如果我们是exit或者ctrl+d退出的：<br><code>docker strat 容器ID或者名字</code>再运行<br><code>docker attach 容器ID或者名字</code>即可<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663300314223-0742f3d1-c704-4e86-a3e8-2fe54bc093d8.png#averageHue=%2323262d&clientId=u15e908d6-7be0-4&from=paste&height=131&id=u99a8d5ef&name=image.png&originHeight=164&originWidth=703&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29304&status=done&style=none&taskId=u433d7708-9823-4859-b7ec-0b2a07927b3&title=&width=562.4" alt="image.png"><br>还有一种方法，更加细，可以指定模式：<br><code>docker exec 选项 容器 指令</code>：如<br><code>docker exec -it kino /bin/bash</code>这样就可以重新进入容器<br>attach和exec的区别：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663307759476-9ace4e8f-e69d-4b3d-b661-354dbb44b296.png#averageHue=%23f0f0f0&clientId=u15e908d6-7be0-4&from=paste&height=105&id=ud0483b4e&name=image.png&originHeight=131&originWidth=661&originalType=binary&ratio=1&rotation=0&showTitle=false&size=52096&status=done&style=none&taskId=uf1b2a853-9382-4079-985c-78ddb122e8e&title=&width=528.8" alt="image.png"></p>
<h3 id="1X1-3-4-重启，停止，强制停止，删除容器"><a href="#1X1-3-4-重启，停止，强制停止，删除容器" class="headerlink" title="1X1.3.4 重启，停止，强制停止，删除容器"></a>1X1.3.4 重启，停止，强制停止，删除容器</h3><p>重启容器：<code>docker restart 容器ID/name</code><br>停止容器：<code>docker stop 容器ID/name</code><br>强制停止容器：<code>docker kill 容器id/name</code></p>
<p>删除<strong>已停止</strong>的容器：<br><code>docker rm 容器ID/name</code>，docker rmi是删除镜像，别搞混了<br><code>docker rm -f 容器</code>：强制删除<br>一次性删除多个容器：<br><code>docker rm -f $(docker ps -aq)</code>或者<br><code>docker ps -aq|xargs docker rm</code>,xargs做题时见到过</p>
<h3 id="1X1-3-5-重要指令"><a href="#1X1-3-5-重要指令" class="headerlink" title="1X1.3.5 重要指令"></a>1X1.3.5 重要指令</h3><p><code>docker run -d</code>:后台跑一个容器，如果跑的是Ubuntu就不会成功，准确的说是一旦启动就会停止，因为Ubuntu是一个操作系统不是一个后台程序</p>
<p>以redis来演示前后台区别：</p>
<ul>
<li>前台交互式运行：</li>
</ul>
<p><code>docker run -it --name=boogipop redis</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663301425376-51741f20-212e-4de6-916a-0f48f4d74314.png#averageHue=%2326282e&clientId=u15e908d6-7be0-4&from=paste&height=445&id=u1fa6f183&name=image.png&originHeight=556&originWidth=1131&originalType=binary&ratio=1&rotation=0&showTitle=false&size=173057&status=done&style=none&taskId=u09da01a9-6225-46b6-a0e6-cc3c099627d&title=&width=904.8" alt="image.png"><br>这样子启动的话一旦ctrl+c不小心退出了就没了：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663301519042-3d1d666c-4a79-4c60-9e8f-72cff86447c1.png#averageHue=%2326282f&clientId=u15e908d6-7be0-4&from=paste&height=444&id=u6ee3ebac&name=image.png&originHeight=555&originWidth=1139&originalType=binary&ratio=1&rotation=0&showTitle=false&size=172400&status=done&style=none&taskId=u24d7be71-f7d5-42d5-a7d0-91477ce738a&title=&width=911.2" alt="image.png">可以看到的redis已经停止运行了</p>
<ul>
<li>后台模式</li>
</ul>
<p><code>docker run -d --name=boogipop redis</code>：后台启动，也就是守护式启动<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663301600561-e2f6fc7b-8ae7-468a-b46f-df784b8b1ff8.png#averageHue=%23282a31&clientId=u15e908d6-7be0-4&from=paste&height=182&id=u2fdfccb3&name=image.png&originHeight=228&originWidth=892&originalType=binary&ratio=1&rotation=0&showTitle=false&size=55918&status=done&style=none&taskId=ube89666e-a676-4dab-8390-f30c42cf3a9&title=&width=713.6" alt="image.png"></p>
<p>查看容器日志：<code>docker logs 容器</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663301976444-bd83d488-819a-4de3-9f57-5ae305d3e4b3.png#averageHue=%232c2e34&clientId=u15e908d6-7be0-4&from=paste&height=200&id=u33074443&name=image.png&originHeight=250&originWidth=1097&originalType=binary&ratio=1&rotation=0&showTitle=false&size=108788&status=done&style=none&taskId=u2e694f47-21ec-465f-9b36-5a103abefbd&title=&width=877.6" alt="image.png"></p>
<p>查看容器内进程：<code>docker top 容器</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663307069098-3899a795-d625-4cfa-95c0-e89bfde46eb4.png#averageHue=%2325272e&clientId=u15e908d6-7be0-4&from=paste&height=95&id=u79112c27&name=image.png&originHeight=119&originWidth=1139&originalType=binary&ratio=1&rotation=0&showTitle=false&size=26340&status=done&style=none&taskId=u563b7e26-3859-4b84-83e9-46c8ce3a918&title=&width=911.2" alt="image.png"></p>
<p>查看容器运行细节：<code>docker inspect 容器</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663307214913-68a97a1c-a530-46d0-9404-64153ed729de.png#averageHue=%23272a30&clientId=u15e908d6-7be0-4&from=paste&height=443&id=uc0438719&name=image.png&originHeight=554&originWidth=1095&originalType=binary&ratio=1&rotation=0&showTitle=false&size=174418&status=done&style=none&taskId=uf054e56b-2457-44c1-a55e-fb4a8074073&title=&width=876" alt="image.png"><br>呈现出来的是一种docker的形式</p>
<p>从容器内拷贝文件到主机中：<code>docker cp 容器ID:容器内路径 目标主机路径</code><br>如把Ubuntu的tmp目录下的1.txt复制到主机的&#x2F;opt下：<br><code>docker cp kino:/tmp/1.txt /opt</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663308736119-113d00ae-cd07-4836-99f3-6bd99285b225.png#averageHue=%2322272e&clientId=u15e908d6-7be0-4&from=paste&height=245&id=u8144a99b&name=image.png&originHeight=306&originWidth=1054&originalType=binary&ratio=1&rotation=0&showTitle=false&size=105287&status=done&style=none&taskId=u013b0e15-a2ec-4667-9681-837c5a21202&title=&width=843.2" alt="image.png"></p>
<p>导入和导出容器：<br><code>export</code>：导出容器的内容流作为一个tar归档文件【对应<code>import</code>命令】<br><code>import</code>：从tar包中的内容创建一个新文件系统，再导入为镜像【对应<code>export</code>】<br>如,把我的Ubuntu导出：<br><code>docker export kino &gt; /opt/ubuntu.tar</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663308983756-bfe91eb7-8176-4437-8f23-a9c3303d8603.png#averageHue=%2323272f&clientId=u15e908d6-7be0-4&from=paste&height=178&id=ua14b36bc&name=image.png&originHeight=222&originWidth=1087&originalType=binary&ratio=1&rotation=0&showTitle=false&size=82398&status=done&style=none&taskId=ua951a625-6feb-4678-a656-87d5afe7a62&title=&width=869.6" alt="image.png"></p>
<p>再删除我们docker的Ubuntu容器，然后导入：<br><code>cat 文件名.tar|docker import- 镜像用户/镜像名：版本号</code><br><code>cat /opt/ubuntu.tar|docker import - boogipop/ubuntu:latest</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663309380299-0b46da6d-b954-49f7-a6bc-a4275aaee2ca.png#averageHue=%232b2d33&clientId=u15e908d6-7be0-4&from=paste&height=198&id=u22dfa579&name=image.png&originHeight=248&originWidth=644&originalType=binary&ratio=1&rotation=0&showTitle=false&size=60136&status=done&style=none&taskId=ua6e6dc21-6e41-4d6a-bb23-2f0a123ff10&title=&width=515.2" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663309466808-01dc853d-c234-4875-9a54-9f923b70e87c.png#averageHue=%232a2c33&clientId=u15e908d6-7be0-4&from=paste&height=100&id=u5bd933eb&name=image.png&originHeight=125&originWidth=523&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22288&status=done&style=none&taskId=u7faf530a-0620-42c6-99e7-8f9d4f21f34&title=&width=418.4" alt="image.png"><br>可以看到文件还在里面</p>
<h1 id="2X1-镜像层的观念"><a href="#2X1-镜像层的观念" class="headerlink" title="2X1 镜像层的观念"></a>2X1 镜像层的观念</h1><p>镜像分层概念<br>以pull指令为例，在下载的过程中docker的镜像好像是一层层的下载：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663309907902-df3f9786-0a97-4bb1-a600-b9eb2177af44.png#averageHue=%23f6f6f6&clientId=u15e908d6-7be0-4&from=paste&height=479&id=uad37486c&name=image.png&originHeight=599&originWidth=1311&originalType=binary&ratio=1&rotation=0&showTitle=false&size=235754&status=done&style=none&taskId=uf26d623d-3c39-4d3e-96d1-93c17f76b57&title=&width=1048.8" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663310064614-16e94f65-5b30-48e8-867a-9b84833f31d9.png#averageHue=%23e0dcd6&clientId=u15e908d6-7be0-4&from=paste&height=134&id=u62f81138&name=image.png&originHeight=168&originWidth=1726&originalType=binary&ratio=1&rotation=0&showTitle=false&size=345049&status=done&style=none&taskId=u37502fa5-52a6-414a-859d-4c0503701f7&title=&width=1380.8" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663310316622-8666f0a3-e240-4c96-9113-708122d84d9f.png#averageHue=%23ddd4cd&clientId=u15e908d6-7be0-4&from=paste&height=322&id=u096fb82b&name=image.png&originHeight=402&originWidth=1729&originalType=binary&ratio=1&rotation=0&showTitle=false&size=564844&status=done&style=none&taskId=ua8b5b4b4-3869-479a-a786-cb42f9d9c8d&title=&width=1383.2" alt="image.png"></p>
<h1 id="3X1-Commit-命令"><a href="#3X1-Commit-命令" class="headerlink" title="3X1 Commit 命令"></a>3X1 Commit 命令</h1><p>先进入Ubuntu容器中运行<code>apt-get update</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663311504626-ab25d307-e0ec-4312-824e-fa3c1bcc3c01.png#averageHue=%232b2d33&clientId=u15e908d6-7be0-4&from=paste&height=127&id=u82a1ed3a&name=image.png&originHeight=159&originWidth=1174&originalType=binary&ratio=1&rotation=0&showTitle=false&size=49534&status=done&style=none&taskId=u1f54dda5-c907-4c33-8618-bb1450c0604&title=&width=939.2" alt="image.png"><br>再安装vim,<code>apt-get -y install vim</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663311706580-c3367c21-e65a-475a-94cf-bd67ffa8b662.png#averageHue=%232e3237&clientId=u15e908d6-7be0-4&from=paste&height=103&id=u24d335dc&name=image.png&originHeight=129&originWidth=593&originalType=binary&ratio=1&rotation=0&showTitle=false&size=36297&status=done&style=none&taskId=u85f967f0-87a8-4c8d-b9cc-8300943eae3&title=&width=474.4" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663312081495-67564c5f-caa8-4f5d-ac31-069f4b6d23d0.png#averageHue=%232e3138&clientId=u15e908d6-7be0-4&from=paste&height=131&id=udf614294&name=image.png&originHeight=164&originWidth=526&originalType=binary&ratio=1&rotation=0&showTitle=false&size=41373&status=done&style=none&taskId=u8bbfdaa7-a3f9-4d8f-98cd-fed916aa23e&title=&width=420.8" alt="image.png"><br>这样就可以使用vim指令了</p>
<h2 id="3X1-1-Commit制作镜像"><a href="#3X1-1-Commit制作镜像" class="headerlink" title="3X1.1 Commit制作镜像"></a>3X1.1 Commit制作镜像</h2><p><code>docker commit</code>:提交容器副本使之成为一个新镜像<br><code>docker commit -m=&quot;需要提交的信息&quot; -a=&quot;作者&quot; 容器ID 要创建的目标镜像名:[标签名]</code><br><code>docker commit -m=&quot;add vim ok&quot; -a=&quot;yyl&quot; kino myubuntu</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663312264813-e25cb597-7c9e-4baa-bf3d-cb37a7a78ee9.png#averageHue=%23282e35&clientId=u15e908d6-7be0-4&from=paste&height=78&id=u087333b4&name=image.png&originHeight=97&originWidth=655&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22186&status=done&style=none&taskId=u717143ec-1674-4fef-9113-e93a0ea9918&title=&width=524" alt="image.png"><br>随后可以再images中看到我们的myubnutu<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663312295716-3cd6aa72-addb-4a96-9598-d717767966e4.png#averageHue=%2332343a&clientId=u15e908d6-7be0-4&from=paste&height=115&id=u33b51979&name=image.png&originHeight=144&originWidth=672&originalType=binary&ratio=1&rotation=0&showTitle=false&size=40803&status=done&style=none&taskId=u4819f25a-2522-4a5c-87f6-26a647a3edf&title=&width=537.6" alt="image.png"></p>
<h2 id="3X1-2-image上传阿里云"><a href="#3X1-2-image上传阿里云" class="headerlink" title="3X1.2 image上传阿里云"></a>3X1.2 image上传阿里云</h2><p>阿里云创建命名空间：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663414830325-4a508575-ec15-4c01-bdfe-642b0c46855d.png#averageHue=%23fdfcfc&clientId=ue693e88a-0a16-4&from=paste&height=242&id=uf46e5963&name=image.png&originHeight=303&originWidth=1912&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23732&status=done&style=none&taskId=u27279fe9-af31-4def-bd7c-82c4ee42db2&title=&width=1529.6" alt="image.png"><br>在镜像仓库中创建一个新仓库：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663414917981-4e5c2322-73ea-4bcc-a8c8-d4222f0c3496.png#averageHue=%23fcfcfb&clientId=ue693e88a-0a16-4&from=paste&height=282&id=u7684d5e6&name=image.png&originHeight=352&originWidth=1891&originalType=binary&ratio=1&rotation=0&showTitle=false&size=45266&status=done&style=none&taskId=u79279c6b-4798-4699-b051-ecbb63c5772&title=&width=1512.8" alt="image.png"><br>这里有很多命令我们直接复制就可以：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663414945733-d4531e3b-11b3-4743-8b3b-d91079c5762f.png#averageHue=%23f4f1ca&clientId=ue693e88a-0a16-4&from=paste&height=728&id=uaa872e58&name=image.png&originHeight=910&originWidth=1682&originalType=binary&ratio=1&rotation=0&showTitle=false&size=96084&status=done&style=none&taskId=u21a38f75-7539-4358-8459-ae6c8526430&title=&width=1345.6" alt="image.png"><br>将本地镜像推送至阿里云：<br><code>docker login --username=b0ogipopregistry.cn-hangzhou.aliyuncs.com</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663415563049-fc324a39-9648-49f0-b03c-36b394af66cf.png#averageHue=%232b2e34&clientId=ue693e88a-0a16-4&from=paste&height=118&id=u2792cb33&name=image.png&originHeight=148&originWidth=646&originalType=binary&ratio=1&rotation=0&showTitle=false&size=47255&status=done&style=none&taskId=ue350d9bd-f6bd-4689-90d3-d86215535dc&title=&width=516.8" alt="image.png"><br>这里的登入密码在个人实例-&gt;访问凭证设置</p>
<p><code>docker tag [ImageId] registry.cn-hangzhou.aliyuncs.com/imaginator/myubuntu:[镜像版本号]</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663415694773-8d60632a-55d3-4174-8474-35004dbdead3.png#averageHue=%232c2e35&clientId=ue693e88a-0a16-4&from=paste&height=222&id=u4ad4e62f&name=image.png&originHeight=277&originWidth=678&originalType=binary&ratio=1&rotation=0&showTitle=false&size=70760&status=done&style=none&taskId=uffebd9e4-a29e-4f6e-a0ac-7ba00a8876f&title=&width=542.4" alt="image.png"><br><code>docker push registry.cn-hangzhou.aliyuncs.com/imaginator/myubuntu:[镜像版本号]</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663415723824-1d3b5778-8208-4485-a912-31caaa153137.png#averageHue=%232d2f36&clientId=ue693e88a-0a16-4&from=paste&height=157&id=u77f11ba3&name=image.png&originHeight=196&originWidth=672&originalType=binary&ratio=1&rotation=0&showTitle=false&size=43232&status=done&style=none&taskId=u3359454d-4b05-4461-aa35-72ae61d1b48&title=&width=537.6" alt="image.png"><br>这样就发布到了阿里云上面</p>
<p>从registry里拉取镜像：<br><code>docker pull registry.cn-hangzhou.aliyuncs.com/imaginator/myubuntu:[镜像版本号]</code></p>
<h2 id="3X1-3-docker私有库"><a href="#3X1-3-docker私有库" class="headerlink" title="3X1.3 docker私有库"></a>3X1.3 docker私有库</h2><p>首先先下载registry：<br><code>docker pull registry</code>：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663416839872-71812c6b-53a4-40aa-ad39-4e831f628a52.png#averageHue=%232b2d33&clientId=ue693e88a-0a16-4&from=paste&height=190&id=u4c16297f&name=image.png&originHeight=237&originWidth=637&originalType=binary&ratio=1&rotation=0&showTitle=false&size=61173&status=done&style=none&taskId=uae10b506-c6ba-4389-9db3-c44257e2b9c&title=&width=509.6" alt="image.png"></p>
<p>运行私有库registry相当于本地有个私有docker hub</p>
<p><code>docker run -d -p 5000:5000 -v /b0ogipop/myregistry/:/tmp/registry --privileged=true registry</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663419996502-a1daffa3-3946-4dd5-86ff-83dc0f0b9f5d.png#averageHue=%232c2d34&clientId=u0688b66f-528a-4&from=paste&height=168&id=u226fbc98&name=image.png&originHeight=210&originWidth=642&originalType=binary&ratio=1&rotation=0&showTitle=false&size=52348&status=done&style=none&taskId=uf595a2e2-142d-424b-8657-4a3df85fd80&title=&width=513.6" alt="image.png"></p>
<p>进入我们安装了vim的Ubuntu容器：<br>先<code>apt-get update</code><br>在<code>apt-get install net-tools</code><br>安装完后就可以使用ifconfig命令<br>再commit打包：<code>docker commit -m=&quot;add net ok&quot; -a=&quot;yyl&quot; kino myubuntu:2.0</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663421135767-fb2e028d-7e06-4343-8fdd-0ce648bc1136.png#averageHue=%232a2c33&clientId=u0688b66f-528a-4&from=paste&height=127&id=u9f8304dd&name=image.png&originHeight=159&originWidth=681&originalType=binary&ratio=1&rotation=0&showTitle=false&size=42242&status=done&style=none&taskId=u2d0a2829-cacd-4e0a-9262-d158aa14387&title=&width=544.8" alt="image.png"></p>
<p>curl验证私服上有什么镜像：<br><code>curl -XGET http://117.21.100.128:5000/v2/_catalog</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663421453609-087ddef4-e19f-49fe-be39-5b7d88b328c6.png#averageHue=%232b2d35&clientId=u0688b66f-528a-4&from=paste&height=51&id=u98ca2d02&name=image.png&originHeight=64&originWidth=457&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11568&status=done&style=none&taskId=uc16c0159-defc-4cae-9e02-dda1d1affa5&title=&width=365.6" alt="image.png"><br>发现没有</p>
<p>将tag改为符合标准的：<br><code>docker tag 镜像:tag Host:port/repository:tag</code><br><code>docker tag myubuntu:2.0 117.21.100.128:5000/myubuntu:2.0</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663421615161-53dd48d9-1a5f-422f-9243-38b71ce73b3d.png#averageHue=%23282b32&clientId=u0688b66f-528a-4&from=paste&height=69&id=u62410679&name=image.png&originHeight=86&originWidth=645&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24276&status=done&style=none&taskId=u8342fdd9-f8d1-478a-9202-227a3ed2e18&title=&width=516" alt="image.png"></p>
<p>修改配置文件使之支持http：<br><code>cat /etc/docker/daemon.json</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663421762005-3ab80ff9-6a08-45a1-9e92-c2a1950f2c12.png#averageHue=%23f8f4f3&clientId=u0688b66f-528a-4&from=paste&height=598&id=u8f973092&name=image.png&originHeight=747&originWidth=1508&originalType=binary&ratio=1&rotation=0&showTitle=false&size=521031&status=done&style=none&taskId=uf7e929bb-f50f-45a2-8fd5-4ecd4bc67e9&title=&width=1206.4" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663421900944-c54e8a8e-4136-47d7-a758-9f790f46bc21.png#averageHue=%23202229&clientId=u0688b66f-528a-4&from=paste&height=108&id=ue3117ccf&name=image.png&originHeight=135&originWidth=538&originalType=binary&ratio=1&rotation=0&showTitle=false&size=27910&status=done&style=none&taskId=u58944013-8de4-4e64-bc81-530602cab8e&title=&width=430.4" alt="image.png"><br>docker默认不允许http方式推送镜像，通过配置选项来取消这个限制</p>
<p>推送我们的镜像到本地私服库：<br><code>docker push 镜像名</code><br><code>docker push 117.21.100.128:5000/myubuntu:2.0</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663422203472-073945ca-2811-4ba4-a1cd-8fbdd5c66e75.png#averageHue=%23292c33&clientId=u0688b66f-528a-4&from=paste&height=151&id=ue74a1fa6&name=image.png&originHeight=189&originWidth=651&originalType=binary&ratio=1&rotation=0&showTitle=false&size=54811&status=done&style=none&taskId=u3478a2ed-dee8-4b0a-aa8a-7552391d881&title=&width=520.8" alt="image.png"></p>
<p>curl验证私服库有什么镜像：<br><code>curl -XGET http://117.21.100.128:5000/v2/_catalog</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663422242443-c284c84a-2f0e-45a6-9119-96d626549079.png#averageHue=%23292b32&clientId=u0688b66f-528a-4&from=paste&height=81&id=u3f1f0b34&name=image.png&originHeight=101&originWidth=481&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17010&status=done&style=none&taskId=ubec67e74-33eb-4641-aee6-599e58a36ad&title=&width=384.8" alt="image.png"><br>上传成功</p>
<p>pull到本地运行：<br><code>docker pull 117.21.100.128:5000/myubuntu:2.0</code></p>
<h1 id="4X1-容器卷"><a href="#4X1-容器卷" class="headerlink" title="4X1 容器卷"></a>4X1 容器卷</h1><p>一个坑：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663422617481-fd69d310-0dc9-41bc-b6ef-8b8f8c87b1fb.png#averageHue=%23f9f7f7&clientId=u0688b66f-528a-4&from=paste&height=178&id=ue60ea038&name=image.png&originHeight=223&originWidth=988&originalType=binary&ratio=1&rotation=0&showTitle=false&size=156503&status=done&style=none&taskId=u7a97f14a-4c06-4cc2-b45e-a3b2710f14d&title=&width=790.4" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663422836112-1fc2c64d-57ca-46ea-afd9-ff96cf504797.png#averageHue=%23dedcd6&clientId=u0688b66f-528a-4&from=paste&height=80&id=uaac77231&name=image.png&originHeight=100&originWidth=717&originalType=binary&ratio=1&rotation=0&showTitle=false&size=56429&status=done&style=none&taskId=u6db6c3c7-07d4-4d68-b8d9-1623d28d909&title=&width=573.6" alt="image.png"><br>冒号左边的是宿主机的文件地址，右边的是容器地址<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663422982615-015aca10-407b-4478-9134-27f418fb5a97.png#averageHue=%23f1f1f1&clientId=u0688b66f-528a-4&from=paste&height=278&id=u76f6330b&name=image.png&originHeight=347&originWidth=596&originalType=binary&ratio=1&rotation=0&showTitle=false&size=59992&status=done&style=none&taskId=u43bf2e5c-d95c-4ba4-92b2-4cb871fec66&title=&width=476.8" alt="image.png"></p>
<p>是什么：<br>容器数据在主机的备份文件<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663423046096-fafa1b69-a905-4b2f-a4f1-6422396c0b25.png#averageHue=%23f2f1f1&clientId=u0688b66f-528a-4&from=paste&height=86&id=uff1af269&name=image.png&originHeight=108&originWidth=1007&originalType=binary&ratio=1&rotation=0&showTitle=false&size=92595&status=done&style=none&taskId=u04e4488c-7d34-4dbe-b447-a005b55cfa6&title=&width=805.6" alt="image.png"></p>
<p>运行一个带有容器卷储存功能的容器：<br><code>docker run -it --privileged=true -v 宿主机绝对路径:容器内目录 镜像名</code></p>
<h2 id="4X1-1-容器卷和主机互通互联"><a href="#4X1-1-容器卷和主机互通互联" class="headerlink" title="4X1.1 容器卷和主机互通互联"></a>4X1.1 容器卷和主机互通互联</h2><p><code>docker run -it --privleged=true -v /tmp/myhostdata:/tmp/myhostdata myubuntu /bin/bash</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663424079084-a15e6f67-5c71-4108-809c-a5b9a0c96213.png#averageHue=%232b2d34&clientId=u0688b66f-528a-4&from=paste&height=81&id=u597ddfde&name=image.png&originHeight=101&originWidth=677&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16682&status=done&style=none&taskId=u967e364e-65bd-4c6f-b3c9-7ca2ce608cb&title=&width=541.6" alt="image.png"><br>在docker容器里的&#x2F;tmp&#x2F;myhostdata写上一个1.txt：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663424268500-1e8ed00f-545a-4c72-8b27-62227abf7fe6.png#averageHue=%2333353c&clientId=u0688b66f-528a-4&from=paste&height=71&id=u096caea5&name=image.png&originHeight=89&originWidth=412&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17931&status=done&style=none&taskId=uc65cb906-6045-414c-a10a-bdbc3b50e1b&title=&width=329.6" alt="image.png"><br>退出容器去主机的&#x2F;tmp&#x2F;myhostdata去看看<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663424298567-bb79ff2e-3f20-4719-bb0e-f3f616810959.png#averageHue=%23272931&clientId=u0688b66f-528a-4&from=paste&height=50&id=u1326ba6a&name=image.png&originHeight=62&originWidth=348&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8196&status=done&style=none&taskId=u95439258-c458-48d8-be0f-804a004597e&title=&width=278.4" alt="image.png"><br>看到没，实时同步加载文件，互相同步<br>主机写的文件容器内也会有，容器内写的主机也会有，互通互联</p>
<p>查看数据卷是否挂载成功：<br><code>docker inspect 容器ID</code>，这里查看刚刚建的容器<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663424538514-902399b4-71f1-4e12-af2f-393ed9901466.png#averageHue=%23292a31&clientId=u0688b66f-528a-4&from=paste&height=146&id=u24d264b3&name=image.png&originHeight=182&originWidth=419&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18375&status=done&style=none&taskId=udfe29f26-7aba-4017-ba10-bcd900020b9&title=&width=335.2" alt="image.png"><br>这里看到有挂载，成功了</p>
<p>当我们的容器停止时，在主机内&#x2F;tmp&#x2F;myhostdata里面写入文件，在start容器，发现依旧同步过去了</p>
<h2 id="4X1-2-容器卷ro和rw读写规则"><a href="#4X1-2-容器卷ro和rw读写规则" class="headerlink" title="4X1.2 容器卷ro和rw读写规则"></a>4X1.2 容器卷ro和rw读写规则</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663504175189-cf41a7f5-5e68-447c-9353-c50146601053.png#averageHue=%23f7f4f4&clientId=u5de77522-7129-4&from=paste&height=254&id=u3e7b5381&name=image.png&originHeight=317&originWidth=842&originalType=binary&ratio=1&rotation=0&showTitle=false&size=134117&status=done&style=none&taskId=uc018ae00-3443-4965-af0a-001a2f826b6&title=&width=673.6" alt="image.png"><br>只需要加一个：ro就可以实现只读权限<br>这时候容器内只可以读</p>
<h2 id="4X1-3-容器卷之间的继承"><a href="#4X1-3-容器卷之间的继承" class="headerlink" title="4X1.3 容器卷之间的继承"></a>4X1.3 容器卷之间的继承</h2><p><code>docker run -it --privileged=true --volumes-from 父类 --name u2 ubuntu</code><br>继承父类容器卷<br>上面的-v全名就是-volumes</p>
<h1 id="5X1-docker上安装软件说明"><a href="#5X1-docker上安装软件说明" class="headerlink" title="5X1 docker上安装软件说明"></a>5X1 docker上安装软件说明</h1><p>总体步骤：搜索-&gt;拉取-&gt;查看-&gt;启动镜像-&gt;停止容器-&gt;移除容器</p>
<h2 id="5X1-1-安装tomcat"><a href="#5X1-1-安装tomcat" class="headerlink" title="5X1.1 安装tomcat"></a>5X1.1 安装tomcat</h2><p><code>docker search tomcat</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663505417038-e6dbc6d0-1ebf-45c8-8134-c2dc6e36c358.png#averageHue=%2325282f&clientId=u5de77522-7129-4&from=paste&height=166&id=u6339e963&name=image.png&originHeight=207&originWidth=536&originalType=binary&ratio=1&rotation=0&showTitle=false&size=59832&status=done&style=none&taskId=u07f1c4d9-3571-42f5-a504-119c40fa7af&title=&width=428.8" alt="image.png"><br><code>docker pull tomcat</code>，默认不加版本号安装最新版<br><code>docker images</code><br>即可安装成功</p>
<p><code>docker run -it --name=tomacat1 -p 8080:8080 tomcat</code><br>-p:指定端口映射<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663505535483-1cae88ec-77a4-465e-97c0-8187d3559800.png#averageHue=%232e3137&clientId=u5de77522-7129-4&from=paste&height=206&id=uedfb3b25&name=image.png&originHeight=258&originWidth=590&originalType=binary&ratio=1&rotation=0&showTitle=false&size=87102&status=done&style=none&taskId=udedec8bb-2edc-43b8-9d79-a94c9e302cc&title=&width=472" alt="image.png"><br>-P：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663505580876-062252bd-7eb8-4785-be48-35989644c02d.png#averageHue=%23edeae9&clientId=u5de77522-7129-4&from=paste&height=241&id=ufa2f2623&name=image.png&originHeight=301&originWidth=1002&originalType=binary&ratio=1&rotation=0&showTitle=false&size=135062&status=done&style=none&taskId=u69134f21-5b5e-4c54-8f99-f6c3fe82f27&title=&width=801.6" alt="image.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663505962594-b179a7a9-2074-4a7b-8117-e71a9de3dc1b.png#averageHue=%2332343a&clientId=u5de77522-7129-4&from=paste&height=38&id=ua33c023f&name=image.png&originHeight=48&originWidth=476&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16971&status=done&style=none&taskId=u38268a1d-5f41-4dc5-9498-ac9b85a243f&title=&width=380.8" alt="image.png"><br>在tomcat的虚拟终端可以看到，webapps文件夹下什么都没有，所以我们访问不到tomcat服务器</p>
<p><code>rm -r webapps</code>删掉webapps</p>
<p>真正的内容在webapps.dist里，我们把他重命名一下<br>这是最新版的tomcat的毛病<img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663506052898-b3811bfa-5569-41a5-8e5b-70bb6b8c31ab.png#averageHue=%2322242c&clientId=u5de77522-7129-4&from=paste&height=40&id=N2VVj&name=image.png&originHeight=50&originWidth=582&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14261&status=done&style=none&taskId=u10040877-e966-4e6a-ab4e-a0c71070bc2&title=&width=465.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663506100962-2231c2bd-033b-4e67-9f4b-89f57bc1ca66.png#averageHue=%23f2ecc4&clientId=u5de77522-7129-4&from=paste&height=714&id=ud56b485e&name=image.png&originHeight=892&originWidth=1681&originalType=binary&ratio=1&rotation=0&showTitle=false&size=232904&status=done&style=none&taskId=u2456cc17-a08c-45bb-9d20-10baa48f21e&title=&width=1344.8" alt="image.png"><br>出来了tomcat</p>
<h2 id="5X1-2-安装MYSQL"><a href="#5X1-2-安装MYSQL" class="headerlink" title="5X1.2 安装MYSQL"></a>5X1.2 安装MYSQL</h2><p><code>docker pull mysql:5.7</code><br>安装一个mysql5.7</p>
<p>如何启动一个mysql容器：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663506714130-e75fdeec-4064-4070-b568-27d32907d0aa.png#averageHue=%23f7f7f8&clientId=u5de77522-7129-4&from=paste&height=251&id=ub4941a05&name=image.png&originHeight=314&originWidth=1208&originalType=binary&ratio=1&rotation=0&showTitle=false&size=34754&status=done&style=none&taskId=u6641d825-96fc-43ad-b924-3097a9047f7&title=&width=966.4" alt="image.png"><br><code>docker run --name 容器名字 -e MYSQL_ROOT_PASSWORD=ROOT密码 -d mysql:版本号</code><br>-e是环境的意思<br><code>docker run --name mysql1 -e -p 3306:3306 MYSQL_ROOT_PASSWORD=root -d mysql:5.7</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663506929275-b50d62a4-7e91-455e-b71c-80a08365f55e.png#averageHue=%2325272f&clientId=u5de77522-7129-4&from=paste&height=128&id=u81574280&name=image.png&originHeight=160&originWidth=647&originalType=binary&ratio=1&rotation=0&showTitle=false&size=55592&status=done&style=none&taskId=u0eedba3d-ef35-42ed-869d-cb0781381e3&title=&width=517.6" alt="image.png"><br>运行成功</p>
<p>假如你linux主机有mysql启动，那docker里的3306端口就会被占用</p>
<p><code>docker exec -it mysql1 /bin/bash</code><br>进入容器<br><code>mysql -uroot -p</code>:<br>登入mysql<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663507110082-6179967e-7df0-4909-8dd9-d708e984f3a8.png#averageHue=%2325292f&clientId=u5de77522-7129-4&from=paste&height=229&id=u0b3ee17b&name=image.png&originHeight=286&originWidth=733&originalType=binary&ratio=1&rotation=0&showTitle=false&size=67377&status=done&style=none&taskId=u18e7fea3-15dd-4025-82a4-0554117bda2&title=&width=586.4" alt="image.png">成功登入mysql<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663507138846-beda925e-85dc-4514-95b9-d20a6037ec99.png#averageHue=%2324272e&clientId=u5de77522-7129-4&from=paste&height=155&id=u0ec2ccaa&name=image.png&originHeight=194&originWidth=352&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17686&status=done&style=none&taskId=ud5fdba70-90c4-4e0f-b885-203efe466fe&title=&width=281.6" alt="image.png"><br>可以执行指令</p>
<p>建一个库再建一个表：<br><code>create database db1;</code><br>创建数据库db1<br><code>create table t1(id int,name varchar(20));</code><br>在数据库建立表t1<br><code>insert into t1 values(1,&#39;kino&#39;);</code><br>往表里插入数据<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663507408305-42209ec0-0d3b-41e8-a969-aa6ec1d79ff9.png#averageHue=%2324272d&clientId=u5de77522-7129-4&from=paste&height=349&id=ue7ebdf77&name=image.png&originHeight=436&originWidth=536&originalType=binary&ratio=1&rotation=0&showTitle=false&size=76780&status=done&style=none&taskId=u07a851dc-15a3-44fc-99e5-661e6ef56d5&title=&width=428.8" alt="image.png"><br>用SQLYOG连接：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663507899221-9d042550-84c7-44b8-85f9-4fe4154688f7.png#averageHue=%23fbfafa&clientId=u5de77522-7129-4&from=paste&height=662&id=uc76eca0c&name=image.png&originHeight=828&originWidth=1741&originalType=binary&ratio=1&rotation=0&showTitle=false&size=154973&status=done&style=none&taskId=u802a16e7-0186-4ec0-bf38-8b4ccb88ce3&title=&width=1392.8" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663508133721-bf9d896e-9ce8-4503-b039-31bd9f2942b0.png#averageHue=%23fdfdfd&clientId=u5de77522-7129-4&from=paste&height=494&id=u5f796cbd&name=image.png&originHeight=618&originWidth=933&originalType=binary&ratio=1&rotation=0&showTitle=false&size=68660&status=done&style=none&taskId=ue1f0a493-1d19-4efc-a253-71cdb05bb44&title=&width=746.4" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663508170830-4390c431-a69d-463e-9ac9-9abe7e7e20af.png#averageHue=%23fcfbfb&clientId=u5de77522-7129-4&from=paste&height=644&id=ufc9b28f0&name=image.png&originHeight=805&originWidth=1508&originalType=binary&ratio=1&rotation=0&showTitle=false&size=138251&status=done&style=none&taskId=ube9df664-3560-48ea-99ae-c4c5cec5273&title=&width=1206.4" alt="image.png"></p>
<h2 id="5X1-3-MYSQL2-高级版）"><a href="#5X1-3-MYSQL2-高级版）" class="headerlink" title="5X1.3 MYSQL2(高级版）"></a>5X1.3 MYSQL2(高级版）</h2><p><code>docker run -d -p 3306:3306 --privileged=true -v /boogipop/mysql/log:/var/log/mysql -v /boogipop/mysql/data:/var/lib/mysql -v /boogipop/mysql/conf:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=root --name mysql mysql:5.7</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663577259167-bf43a100-a2b8-42d6-ac3f-911f2b4e5a9b.png#averageHue=%232b2e34&clientId=u4250f4b4-51e9-4&from=paste&height=210&id=u01cb62f5&name=image.png&originHeight=263&originWidth=630&originalType=binary&ratio=1&rotation=0&showTitle=false&size=70414&status=done&style=none&taskId=ue2bb1b99-a587-4a61-b4a6-e7a85be521b&title=&width=504" alt="image.png"></p>
<p>修改配置文件：<br><code>cd /boogipop/mysql/conf</code><br>新建一个文件<code>my.cnf</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">default_character_set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line">collation_server=utf8_general_ci</span><br><span class="line">character_set_server=utf8</span><br></pre></td></tr></table></figure>
<p>这就解决中文乱码</p>
<h2 id="5X1-4-安装redis"><a href="#5X1-4-安装redis" class="headerlink" title="5X1.4 安装redis"></a>5X1.4 安装redis</h2><p><code>docker pull redis</code><br><code>mkdir -p /app/redis</code><br><code>cp /myredis/redis.conf/app/redis/</code><br>把宿主机的redis配置文件复制一份过来<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663579372313-76b59623-1798-4775-be82-864c26ec4b14.png#averageHue=%23f6c7bf&clientId=u4250f4b4-51e9-4&from=paste&height=397&id=u3b4971f0&name=image.png&originHeight=496&originWidth=1102&originalType=binary&ratio=1&rotation=0&showTitle=false&size=347666&status=done&style=none&taskId=u5ad9b062-b8ff-48b5-9333-a876bb0b0ac&title=&width=881.6" alt="image.png"><br><code>docker run -p 6379:6379 --name myr3 --privileged=true -v /app/redis/redis.conf:/etc/redis/redis.conf -v /app/redis/data:/data -d redis redis server /etc/redis/redis.conf</code><br>运行一个带可以和主机交互的容器卷的容器<br><code>docker exec -it myr3 /bin/bash</code></p>
<p><code>redis-cli</code><br><code>set k1 v1</code><br><code>get k1</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663580758792-75b3d99f-7398-4704-82f7-e02753c7dda9.png#averageHue=%232a2c33&clientId=u9580771d-f1da-4&from=paste&height=155&id=ube76eb9d&name=image.png&originHeight=194&originWidth=373&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32013&status=done&style=none&taskId=uf66ff33b-2519-4609-be25-53d3496a709&title=&width=298.4" alt="image.png"></p>
<h1 id="6X1-Redis-Mysql–docker"><a href="#6X1-Redis-Mysql–docker" class="headerlink" title="6X1 Redis+Mysql–docker"></a>6X1 Redis+Mysql–docker</h1><h2 id="6X1-1-MYSQL主从复制docker版"><a href="#6X1-1-MYSQL主从复制docker版" class="headerlink" title="6X1.1 MYSQL主从复制docker版"></a>6X1.1 MYSQL主从复制docker版</h2><p><code>docker run -d -p 3307:3306 --privileged=true -v /boogipop/mysql/log:/var/log/mysql -v /boogipop/mysql/data:/var/lib/mysql -v /boogipop/mysql/conf:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=root --name mysql mysql:5.7</code><br>先run一个主机<br>配置主机的配置conf：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line"><span class="comment">## 设置server_id，同一局域网中需要唯一</span></span><br><span class="line"></span><br><span class="line">server_id=<span class="number">101</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">## 指定不需要同步的数据库名称</span></span><br><span class="line"></span><br><span class="line">binlog-ignore-db=mysql  </span><br><span class="line"></span><br><span class="line"><span class="comment">## 开启二进制日志功能</span></span><br><span class="line"></span><br><span class="line">log-bin=mall-mysql-bin  </span><br><span class="line"></span><br><span class="line"><span class="comment">## 设置二进制日志使用内存大小（事务）</span></span><br><span class="line"></span><br><span class="line">binlog_cache_size=<span class="number">1</span>M  </span><br><span class="line"></span><br><span class="line"><span class="comment">## 设置使用的二进制日志格式（mixed,statement,row）</span></span><br><span class="line"></span><br><span class="line">binlog_format=<span class="keyword">mixed</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment">## 二进制日志过期清理时间。默认值为0，表示不自动清理。</span></span><br><span class="line"></span><br><span class="line">expire_logs_days=<span class="number">7</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></span><br><span class="line"></span><br><span class="line">slave_skip_errors=<span class="number">1062</span></span><br></pre></td></tr></table></figure>
<p><code>CREATE USER &#39;slvae&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;</code><br><code>GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &#39;slave&#39;@&#39;%&#39;;</code><br>创建一个slave用户，并赋予权限</p>
<p><code>docker run -d -p 3308:3306 --privileged=true -v /mysql-slave/mysql/log:/var/log/mysql -v /mysql-slave/mysql/data:/var/lib/mysql -v /mysql-slave/mysql/conf:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=root --name mysql-slave mysql:5.7</code><br>创建从服务器<br>配置从服务器的conf文件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line"><span class="comment">## 设置server_id，同一局域网中需要唯一</span></span><br><span class="line"></span><br><span class="line">server_id=<span class="number">102</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 指定不需要同步的数据库名称</span></span><br><span class="line"></span><br><span class="line">binlog-ignore-db=mysql  </span><br><span class="line"></span><br><span class="line"><span class="comment">## 开启二进制日志功能，以备Slave作为其它数据库实例的Master时使用</span></span><br><span class="line"></span><br><span class="line">log-bin=mall-mysql-slave1-bin  </span><br><span class="line"></span><br><span class="line"><span class="comment">## 设置二进制日志使用内存大小（事务）</span></span><br><span class="line"></span><br><span class="line">binlog_cache_size=<span class="number">1</span>M  </span><br><span class="line"></span><br><span class="line"><span class="comment">## 设置使用的二进制日志格式（mixed,statement,row）</span></span><br><span class="line"></span><br><span class="line">binlog_format=<span class="keyword">mixed</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment">## 二进制日志过期清理时间。默认值为0，表示不自动清理。</span></span><br><span class="line"></span><br><span class="line">expire_logs_days=<span class="number">7</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></span><br><span class="line"></span><br><span class="line">slave_skip_errors=<span class="number">1062</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment">## relay_log配置中继日志</span></span><br><span class="line"></span><br><span class="line">relay_log=mall-mysql-relay-bin  </span><br><span class="line"></span><br><span class="line"><span class="comment">## log_slave_updates表示slave将复制事件写进自己的二进制日志</span></span><br><span class="line"></span><br><span class="line">log_slave_updates=<span class="number">1</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment">## slave设置为只读（具有super权限的用户除外）</span></span><br><span class="line"></span><br><span class="line">read_only=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>重启slave和mysql容器实例：<br><code>docker restart mysql</code><br><code>docker restart mysql-slave</code></p>
<p>在主服务器查看主从状态：<br><code>show master status;</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663583839834-9fdfac80-7bfe-498f-9042-f44e62e0908a.png#averageHue=%2327292f&clientId=u9580771d-f1da-4&from=paste&height=222&id=ud5dba943&name=image.png&originHeight=277&originWidth=725&originalType=binary&ratio=1&rotation=0&showTitle=false&size=49411&status=done&style=none&taskId=u85c6f889-158d-4a93-99a4-2b7adf52552&title=&width=580" alt="image.png"><br>再进入从服务器：<br><code>docker exec -it mysql-slave /bin/bash</code><br>主从赋值参数说明：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">master_host：主数据库的IP地址；</span><br><span class="line"></span><br><span class="line">master_port：主数据库的运行端口；</span><br><span class="line"></span><br><span class="line">master_user：在主数据库创建的用于同步数据的用户账号；</span><br><span class="line"></span><br><span class="line">master_password：在主数据库创建的用于同步数据的用户密码；</span><br><span class="line"></span><br><span class="line">master_log_file：指定从数据库要复制数据的日志文件，通过查看主数据的状态，获取File参数；</span><br><span class="line"></span><br><span class="line">master_log_pos：指定从数据库从哪个位置开始复制数据，通过查看主数据的状态，获取Position参数；</span><br><span class="line"></span><br><span class="line">master_connect_retry：连接失败重试的时间间隔，单位为秒。</span><br></pre></td></tr></table></figure>
<p>所以我们输入<code>change master to master_host=&#39;117.21.100.128&#39;,master_user=&#39;slave&#39;,master_password=&#39;123456&#39;,master_port=3307,master_log_file=&#39;mall-mysql-bin.000001&#39;,master_log_pos=154,master_connect_retry=30;</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663586572271-40649fc0-7f64-4702-a881-5aa02220cf9a.png#averageHue=%2332333a&clientId=uc0ef6a1d-5c91-4&from=paste&height=62&id=u237749cd&name=image.png&originHeight=78&originWidth=733&originalType=binary&ratio=1&rotation=0&showTitle=false&size=21069&status=done&style=none&taskId=u86e23355-ee24-415e-9117-6a857a0b988&title=&width=586.4" alt="image.png"></p>
<p>在从服务器中查看主从同步状态：<br><code>show slave status \G;</code><br>-G是以竖着的方式列出</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663586643347-dcefb959-89e8-4fe6-8354-ebd41e7e3d59.png#averageHue=%232b2e33&clientId=uc0ef6a1d-5c91-4&from=paste&height=98&id=u3471eaef&name=image.png&originHeight=122&originWidth=424&originalType=binary&ratio=1&rotation=0&showTitle=false&size=21970&status=done&style=none&taskId=ub1a503fb-3487-4b51-a9f9-5f2ad729f5d&title=&width=339.2" alt="image.png"><br>这里两个NO说明还未开始</p>
<p>在从数据库中开启主从状态：<br><code>start slave;</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663586687293-6764a84a-b3de-4f0c-af76-d3129bde2ebc.png#averageHue=%232b2c33&clientId=uc0ef6a1d-5c91-4&from=paste&height=48&id=udc5d088f&name=image.png&originHeight=60&originWidth=383&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8053&status=done&style=none&taskId=u957a621f-6e67-4d7c-b22d-d3f1f3a732b&title=&width=306.4" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663586750587-51b8adc6-7444-4f87-a923-d16f47468355.png#averageHue=%23313239&clientId=uc0ef6a1d-5c91-4&from=paste&height=52&id=ue5b0ece7&name=image.png&originHeight=65&originWidth=353&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7095&status=done&style=none&taskId=u507c5ada-9891-4da4-bd20-563cdbedabf&title=&width=282.4" alt="image.png"><br>可以发现已经开起来了</p>
<p>主从服务测试：<br>接下来主服务器建立数据表<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663586947984-d1f23bc6-c33b-485e-b7fe-e7b03c472dde.png#averageHue=%23272b31&clientId=u7070fdc4-f4ff-4&from=paste&height=289&id=u47e48fcd&name=image.png&originHeight=361&originWidth=477&originalType=binary&ratio=1&rotation=0&showTitle=false&size=105633&status=done&style=none&taskId=ub44da461-fff6-4a02-86d4-f1458d9916c&title=&width=381.6" alt="image.png"><br>从服务器查看：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663587033194-d38cc488-fc8d-4b63-a7d7-32da197c2be2.png#averageHue=%2324262d&clientId=u7070fdc4-f4ff-4&from=paste&height=246&id=u8b953c32&name=image.png&originHeight=307&originWidth=557&originalType=binary&ratio=1&rotation=0&showTitle=false&size=54907&status=done&style=none&taskId=u0d3c6cc9-90a6-4718-98cd-aee2e158ede&title=&width=445.6" alt="image.png"><br>显示出来了，说明成功</p>
<h2 id="6X1-2-分布式存储之哈希取余算法"><a href="#6X1-2-分布式存储之哈希取余算法" class="headerlink" title="6X1.2 分布式存储之哈希取余算法"></a>6X1.2 分布式存储之哈希取余算法</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663587877019-51692930-1f4e-468f-98fa-d98d9535f261.png#averageHue=%23e0ded8&clientId=u7070fdc4-f4ff-4&from=paste&height=250&id=ucef82685&name=image.png&originHeight=313&originWidth=1807&originalType=binary&ratio=1&rotation=0&showTitle=false&size=412283&status=done&style=none&taskId=u1778d7e4-fe01-47bb-9e28-5a0c3165f48&title=&width=1445.6" alt="image.png"><br>能干嘛：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663588074274-caa8483a-364e-4896-af0f-e393d8f05d12.png#averageHue=%23f2f2f1&clientId=u7070fdc4-f4ff-4&from=paste&height=222&id=u09c1f62d&name=image.png&originHeight=278&originWidth=1495&originalType=binary&ratio=1&rotation=0&showTitle=false&size=169007&status=done&style=none&taskId=u26ea584a-8916-459a-97b0-e54452f1b18&title=&width=1196" alt="image.png"><br>三大步骤：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663588084313-f3ab04da-c181-4bf3-a528-61875a9bc61d.png#averageHue=%23f4f4f3&clientId=u7070fdc4-f4ff-4&from=paste&height=306&id=uf42b9019&name=image.png&originHeight=383&originWidth=833&originalType=binary&ratio=1&rotation=0&showTitle=false&size=129056&status=done&style=none&taskId=u0d7460cf-ad16-44f5-b3b6-8e4b3a2b57e&title=&width=666.4" alt="image.png"><br>一致性哈希环：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663588866831-bbdb6fd6-d3f1-4aad-a9ec-81d6edc4fa96.png#averageHue=%23eae8e2&clientId=u7070fdc4-f4ff-4&from=paste&height=581&id=u0189c5e3&name=image.png&originHeight=726&originWidth=1820&originalType=binary&ratio=1&rotation=0&showTitle=false&size=677218&status=done&style=none&taskId=u83e0825d-2d28-4d13-8128-88208b82065&title=&width=1456" alt="image.png"><br>节点映射：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663588943860-628b9014-c949-44f6-99ca-abfb8fdf5c29.png#averageHue=%23fafaf9&clientId=u7070fdc4-f4ff-4&from=paste&height=584&id=u9c6f73a4&name=image.png&originHeight=730&originWidth=1750&originalType=binary&ratio=1&rotation=0&showTitle=false&size=351280&status=done&style=none&taskId=u7fcf438c-2dbf-4772-a0e1-4a3ff965321&title=&width=1400" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663588953942-e9f1f5c9-580e-4bc7-995d-0335cc4a2bd8.png#averageHue=%23f0ece7&clientId=u7070fdc4-f4ff-4&from=paste&height=604&id=uef8fb14b&name=image.png&originHeight=755&originWidth=1760&originalType=binary&ratio=1&rotation=0&showTitle=false&size=549142&status=done&style=none&taskId=u74d69bed-fb12-4661-81f9-026b2878cf0&title=&width=1408" alt="image.png"><br>优点：<br>容错性<img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663588975418-8ff60dc3-a3bb-4a39-8a51-2962b13b7cee.png#averageHue=%23f3eee9&clientId=u7070fdc4-f4ff-4&from=paste&height=595&id=u2beac95a&name=image.png&originHeight=744&originWidth=1786&originalType=binary&ratio=1&rotation=0&showTitle=false&size=511468&status=done&style=none&taskId=u3b0424b4-b6e6-417f-af43-47d036f2f61&title=&width=1428.8" alt="image.png"><br>拓展性<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663588997132-27c467ac-ce8a-41a6-a372-32875aa4789b.png#averageHue=%23faf8f7&clientId=u7070fdc4-f4ff-4&from=paste&height=563&id=ued42aba7&name=image.png&originHeight=704&originWidth=1775&originalType=binary&ratio=1&rotation=0&showTitle=false&size=401351&status=done&style=none&taskId=u7b87f3c7-94f7-4833-8d9c-8223ef3ab6e&title=&width=1420" alt="image.png"></p>
<p>缺点：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663589014333-00865ef7-aaa8-48bb-b42c-05607da4d681.png#averageHue=%23fbfaf9&clientId=u7070fdc4-f4ff-4&from=paste&height=589&id=u982f5311&name=image.png&originHeight=736&originWidth=1723&originalType=binary&ratio=1&rotation=0&showTitle=false&size=303545&status=done&style=none&taskId=u6bbd765e-c634-4bd8-8353-3c9a50f51ed&title=&width=1378.4" alt="image.png"></p>
<h2 id="6X1-3-分布式储存之哈希槽算法"><a href="#6X1-3-分布式储存之哈希槽算法" class="headerlink" title="6X1.3 分布式储存之哈希槽算法"></a>6X1.3 分布式储存之哈希槽算法</h2><p>为什么用16384个槽：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663669576292-d8420ad7-1af2-44cb-85ff-bd17f1b4f807.png#averageHue=%23e3e1db&clientId=u8fd8a2ee-5875-4&from=paste&height=481&id=ubc700423&name=image.png&originHeight=601&originWidth=1833&originalType=binary&ratio=1&rotation=0&showTitle=false&size=769204&status=done&style=none&taskId=uff21bc0c-1285-4a98-b464-22c4a756c29&title=&width=1466.4" alt="image.png"><br>是什么：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663669881947-c9c96755-5133-442b-b037-9ba722bd5f09.png#averageHue=%23f6f4f1&clientId=u8fd8a2ee-5875-4&from=paste&height=562&id=ub634aafc&name=image.png&originHeight=703&originWidth=1787&originalType=binary&ratio=1&rotation=0&showTitle=false&size=727909&status=done&style=none&taskId=u8973dbc5-9876-4e7e-9e0c-07b05f4e829&title=&width=1429.6" alt="image.png"></p>
<h2 id="6X1-4-3主3从redis集群配置"><a href="#6X1-4-3主3从redis集群配置" class="headerlink" title="6X1.4 3主3从redis集群配置"></a>6X1.4 3主3从redis集群配置</h2><p>关闭防火墙+启动docker服务：<br><code>systemctl stop firewalld</code><br><code>systemctl start docker</code></p>
<p>新建6个redis容器实例：<br><code>docker run -d --name redis-node-1 --net host --privileged=true -v /data/redis/share/redis-node-1:/data redis --cluster-enabled yes --appendonly yes --port 6381</code><br><code>docker run -d --name redis-node-2 --net host --privileged=true -v /data/redis/share/redis-node-2:/data redis --cluster-enabled yes --appendonly yes --port 6382</code><br><code>docker run -d --name redis-node-3 --net host --privileged=true -v /data/redis/share/redis-node-3:/data redis --cluster-enabled yes --appendonly yes --port 6383</code><br><code>docker run -d --name redis-node-4 --net host --privileged=true -v /data/redis/share/redis-node-4:/data redis --cluster-enabled yes --appendonly yes --port 6384</code><br><code>docker run -d --name redis-node-5 --net host --privileged=true -v /data/redis/share/redis-node-5:/data redis --cluster-enabled yes --appendonly yes --port 6385</code><br><code>docker run -d --name redis-node-6 --net host --privileged=true -v /data/redis/share/redis-node-6:/data redis --cluster-enabled yes --appendonly yes --port 6386</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663678838133-53333e89-1fa7-4f52-8ea9-6949ab3a0e0c.png#averageHue=%23292c32&clientId=uc1c7193d-55a9-4&from=paste&height=293&id=u01cb73a7&name=image.png&originHeight=366&originWidth=654&originalType=binary&ratio=1&rotation=0&showTitle=false&size=85816&status=done&style=none&taskId=ub567b39c-8b22-40f0-a5ec-b4d3184b9c4&title=&width=523.2" alt="image.png"><br>一口气直接嗦，创建6台容器实例</p>
<blockquote>
<p>–net host:使用宿主机的IP和端口，默认<br>–privilege&#x3D;true：获取宿主机root用户权限<br>-v &#x2F;data&#x2F;redis&#x2F;share&#x2F;redis-node-1:&#x2F;data：容器卷，宿主机地址：docker内部地址<br>–cluster-enabled yes：开启redis集群<br>–appendonly yes：开启持久化<br>–port 6386：redis端口</p>
</blockquote>
<p>进入redis-node-1并且为6台机器构建集群关系：<br>进入容器<br><code>docker exec -it redis-node-1 /bin/bash</code><br>构建集群<br><code>redis-cli --cluster create 117.21.100.128:6381 117.21.100.128:6382 117.21.100.128:6383 117.21.100.128:6384 117.21.100.128:6385 117.21.100.128:6386 --cluster-replicas 1</code><br>–cluster-replicas:表示为每个master创建一个slave节点<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663679313367-ff27c707-e3b3-483e-bc91-5bfcc2fc740b.png#averageHue=%232f3137&clientId=uc1c7193d-55a9-4&from=paste&height=385&id=u2f99a75e&name=image.png&originHeight=481&originWidth=671&originalType=binary&ratio=1&rotation=0&showTitle=false&size=165056&status=done&style=none&taskId=ufb953091-fc07-497e-9364-6862cd6ad15&title=&width=536.8" alt="image.png"><br>performing hash slots allocation on 6 nodes:表示创建哈希槽<br>下面有3台主服务器的槽点位置0-5460,5461-10922,10923-16383<br>接下来按照提示输入yes即可<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663679549273-2549f722-b04c-43d1-bce4-c9d650cd239d.png#averageHue=%232f3137&clientId=uc1c7193d-55a9-4&from=paste&height=303&id=u56a70487&name=image.png&originHeight=379&originWidth=671&originalType=binary&ratio=1&rotation=0&showTitle=false&size=121154&status=done&style=none&taskId=u888df274-3ecf-4691-ae36-5c08303a241&title=&width=536.8" alt="image.png"><br>6381,6382,6383是三台主机<br>6384,6385,6386是三台从机</p>
<p>以6381为切入点，查看节点状态：<br><code>redis-cli -p 6381</code><br><code>cluster info</code>查看集群状态<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663679708828-82b0ec25-8594-47ae-b4fd-b11403ca81f8.png#averageHue=%23282a31&clientId=uc1c7193d-55a9-4&from=paste&height=357&id=u11192888&name=image.png&originHeight=446&originWidth=673&originalType=binary&ratio=1&rotation=0&showTitle=false&size=110751&status=done&style=none&taskId=u37df0181-3ab3-4a27-a0da-dd48750aac3&title=&width=538.4" alt="image.png"><br><code>cluster nodes</code>查看主从服务器<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663679776931-3bbf2c6f-ec72-4741-a6d3-7d05bca23b11.png#averageHue=%2335373e&clientId=uc1c7193d-55a9-4&from=paste&height=114&id=u02694b4e&name=image.png&originHeight=142&originWidth=1185&originalType=binary&ratio=1&rotation=0&showTitle=false&size=77769&status=done&style=none&taskId=u11763b00-4b89-4719-9524-32ada3b5794&title=&width=948" alt="image.png"><br>根据这里可以看到，配对方式是，6381-6386,6382-6384,6383-6385<br>主从关系是随机分配</p>
<h3 id="6x1-4-1主从容错切换迁移案例前戏"><a href="#6x1-4-1主从容错切换迁移案例前戏" class="headerlink" title="6x1.4.1主从容错切换迁移案例前戏"></a>6x1.4.1主从容错切换迁移案例前戏</h3><p><code>docker exec -it redis-node-1 /bin/bash</code><br><code>redis-cli -p 6381</code><br>进入6381端口的redis<br>给k1赋值v1，发现报错：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663680556447-8bbcccf2-eed5-4375-898a-a0c5cb046b03.png#averageHue=%232e3237&clientId=uc1c7193d-55a9-4&from=paste&height=41&id=uab9f348d&name=image.png&originHeight=51&originWidth=391&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13203&status=done&style=none&taskId=u54488339-d781-4841-af4d-4f91653aa37&title=&width=312.8" alt="image.png"><br>因为这个数据的槽位超过了6381的所在槽位<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663680696636-b7450861-32af-4a51-b63b-ef1bf246ae5b.png#averageHue=%23f3ede6&clientId=uc1c7193d-55a9-4&from=paste&height=466&id=u33fb9855&name=image.png&originHeight=582&originWidth=853&originalType=binary&ratio=1&rotation=0&showTitle=false&size=322690&status=done&style=none&taskId=uba387975-5338-4fc2-ad6e-59a3a87c8a8&title=&width=682.4" alt="image.png"><br>我们<code>set k2 v2</code>就可以：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663680676035-5c9dd648-09e2-48d1-acc1-4f1ec1c6a4d8.png#averageHue=%232e3135&clientId=uc1c7193d-55a9-4&from=paste&height=30&id=uaf301702&name=image.png&originHeight=37&originWidth=286&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7238&status=done&style=none&taskId=u11da19be-1d6e-456d-a4db-d2e332e89a0&title=&width=228.8" alt="image.png"><br>所以我们要以集群的方式去连接redis：<br><code>redis-cli -p 6381 -c</code><br>c就是cluster集群<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663680796825-021b6f49-6007-4215-8fd7-747ed306098c.png#averageHue=%232b2d33&clientId=uc1c7193d-55a9-4&from=paste&height=59&id=ua9e60695&name=image.png&originHeight=74&originWidth=556&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18784&status=done&style=none&taskId=u76856ceb-c217-4fc5-b2fc-5e614a14c68&title=&width=444.8" alt="image.png"><br>这次的数据就可以储存进去了,redirected就说明存到了别的槽位，12706就是槽位</p>
<p>查看集群信息：<br><code>redis-cli --cluster check 117.21.100.128:6381</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663681165000-480c5e8a-7e18-4a14-a020-02b7d9fce2d8.png#averageHue=%23303238&clientId=uc1c7193d-55a9-4&from=paste&height=279&id=u626fdacf&name=image.png&originHeight=349&originWidth=609&originalType=binary&ratio=1&rotation=0&showTitle=false&size=113128&status=done&style=none&taskId=uf1d07473-4f58-44a4-8853-e4f79523a86&title=&width=487.2" alt="image.png"></p>
<h3 id="6x1-4-2主从容错切换迁移"><a href="#6x1-4-2主从容错切换迁移" class="headerlink" title="6x1.4.2主从容错切换迁移"></a>6x1.4.2主从容错切换迁移</h3><p>先停掉一台redis<br><code>docker stop redis-node-1</code><br>再进入redis2<br><code>docker exec -it redis-node-2 /bin/bash</code><br><code>redis-cli -p 6382 -c</code><br>再输入<code>cluster nodes</code>查看主从关系<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663750647319-57ecd101-7e46-49db-b7e9-864dadafb6a2.png#averageHue=%23415a5a&clientId=u96b883cb-996c-4&from=paste&height=182&id=u8156219b&name=image.png&originHeight=228&originWidth=845&originalType=binary&ratio=1&rotation=0&showTitle=false&size=118352&status=done&style=none&taskId=u7f4abefc-70e6-4e6c-93f0-ffb0fc05bb2&title=&width=676" alt="image.png"><br>可以看到6381以前和6386配队的<br>现在6386自己成了主机<br><code>docker start redis-node-1</code><br>再次启动一号机，6381再一次变为6386的master</p>
<h3 id="6X1-4-3-主从扩容"><a href="#6X1-4-3-主从扩容" class="headerlink" title="6X1.4.3 主从扩容"></a>6X1.4.3 主从扩容</h3><p><code>docker run -d --name redis-node-7 --net host --privileged=true -v /data/redis/share/redis-node-7:/data redis --cluster-enabled yes --appendonly yes --port 6387</code><br><code>docker run -d --name redis-node-8 --net host --privileged=true -v /data/redis/share/redis-node-8:/data redis --cluster-enabled yes --appendonly yes --port 6388</code><br>创建2个端口分别是87.88的<br>将6387加入到6381节点中：<br><code>redis-cli --cluster add-node 117.21.100.128:6387 117.21.100.128:6381</code><br>检查一次集群：<br><code>redis-cli --cluster check 117.21.100.128:6381</code><br> <img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663752770147-231775c4-e332-4580-a8be-6ccbd1ddc785.png#averageHue=%232d2f36&clientId=u96b883cb-996c-4&from=paste&height=334&id=u28fb6518&name=image.png&originHeight=417&originWidth=660&originalType=binary&ratio=1&rotation=0&showTitle=false&size=92864&status=done&style=none&taskId=uc1365956-ee89-4b96-9120-0584d7a3943&title=&width=528" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663752840210-74fe2919-ce4b-45ab-b69a-6ca7d6419cb4.png#averageHue=%232f3036&clientId=u96b883cb-996c-4&from=paste&height=22&id=u0b1c09be&name=image.png&originHeight=27&originWidth=603&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6978&status=done&style=none&taskId=udef4f4a7-b9d1-4105-a7a8-e491a784563&title=&width=482.4" alt="image.png"><br>表示6387暂时没有槽位</p>
<p>重新分配槽号：<br><code>redis-cli --cluster reshard 117.21.100.128:6381</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663752997670-f5a341c9-9c97-4d9e-b2ba-3e7fa1823abf.png#averageHue=%232b3238&clientId=u96b883cb-996c-4&from=paste&height=51&id=ue2aa3bcf&name=image.png&originHeight=64&originWidth=533&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13889&status=done&style=none&taskId=u5cbabff5-4a0b-4ebf-b2b0-850a54283cb&title=&width=426.4" alt="image.png"><br>输入4096，也就是16384&#x2F;4<br>表示四台机器平分<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663753050323-c35b75fb-2863-4f3a-8f00-9f93d0d6cb7d.png#averageHue=%232f3138&clientId=u96b883cb-996c-4&from=paste&height=35&id=u32c46685&name=image.png&originHeight=44&originWidth=539&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9050&status=done&style=none&taskId=u8f3a26b4-69cc-447e-9fce-5d8eb183769&title=&width=431.2" alt="image.png"><br>输入我们的6387的ID：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663753093470-93b97a91-f102-4716-9c3e-2db6cf9637ee.png#averageHue=%232f3138&clientId=u96b883cb-996c-4&from=paste&height=102&id=u820fca98&name=image.png&originHeight=128&originWidth=657&originalType=binary&ratio=1&rotation=0&showTitle=false&size=27270&status=done&style=none&taskId=u5caf0dbb-f01a-4169-b052-6d951421ff3&title=&width=525.6" alt="image.png"><br>接着输入all，yes</p>
<p>再第二次检测集群：<br><code>redis-cli --cluster check 117.21.100.128:6381</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663753169550-9b3a14ec-8571-40f1-9aaf-608c5a4c40ba.png#averageHue=%232f3339&clientId=u96b883cb-996c-4&from=paste&height=98&id=ueef98656&name=image.png&originHeight=122&originWidth=613&originalType=binary&ratio=1&rotation=0&showTitle=false&size=33011&status=done&style=none&taskId=u5c3781bd-09b9-409f-b4cf-9db2aa4f440&title=&width=490.4" alt="image.png"><br>分配成功</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663753254809-75f04250-1734-465b-a42f-1f55bca3308e.png#averageHue=%23383a40&clientId=u96b883cb-996c-4&from=paste&height=30&id=u68f422ee&name=image.png&originHeight=38&originWidth=535&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10252&status=done&style=none&taskId=u89f6eb3a-a060-49a4-9b20-4b15e7dede9&title=&width=428" alt="image.png"><br>这个6387是从之前三个槽位都分了一点过来<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663753716643-1c6c3c62-01db-4239-8811-464956ea55ec.png#averageHue=%23dddad5&clientId=u96b883cb-996c-4&from=paste&height=82&id=u4bfde752&name=image.png&originHeight=103&originWidth=1700&originalType=binary&ratio=1&rotation=0&showTitle=false&size=136290&status=done&style=none&taskId=u9604219f-8626-4a09-b298-9644881a3c5&title=&width=1360" alt="image.png"><br>把6388加入6387从属：<br><code>redis-cli --cluster add-node 117.21.100.128:6388 117.21.100.128:6387 --cluster-slave --cluster-master-id e47664b9814bd0ecf7de8ce648c65fbf44710702</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663754196356-b5a0f3fc-8168-4f09-abff-f7fb50d5ef0b.png#averageHue=%232a2c33&clientId=u96b883cb-996c-4&from=paste&height=137&id=ud2d1d5c3&name=image.png&originHeight=171&originWidth=657&originalType=binary&ratio=1&rotation=0&showTitle=false&size=34753&status=done&style=none&taskId=u72a4438a-0167-4d4e-926f-01ca6fdf693&title=&width=525.6" alt="image.png"><br>成功加入</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663754271826-e90f653d-8845-4c1b-b7e1-c938b7cb93d8.png#averageHue=%2332343a&clientId=u96b883cb-996c-4&from=paste&height=334&id=uc0201493&name=image.png&originHeight=417&originWidth=539&originalType=binary&ratio=1&rotation=0&showTitle=false&size=92936&status=done&style=none&taskId=ucad145d8-7f90-490d-9c09-1ba2f616312&title=&width=431.2" alt="image.png"><br>4主4从</p>
<h3 id="6X1-4-4-主从缩容"><a href="#6X1-4-4-主从缩容" class="headerlink" title="6X1.4.4 主从缩容"></a>6X1.4.4 主从缩容</h3><p>删除一下6388端口机<br><code>redis-cli --cluster del-node 117.21.100.128:6388 b500976f6a91e61d448f45d8ace8f36d7bf83192</code><br>后面一串是check中的节点ID<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663755345051-acd8ee8c-3914-433f-9b5b-783d0bd0c1ef.png#averageHue=%23303239&clientId=u96b883cb-996c-4&from=paste&height=74&id=ufa4ce849&name=image.png&originHeight=92&originWidth=687&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19817&status=done&style=none&taskId=u840bc2a9-4f40-4b3d-9aa4-504bb4d5bcb&title=&width=549.6" alt="image.png"></p>
<p>将6387槽号清空，重新分配给6382：<br>重新分配槽号<br><code>redis-cli --cluster reshard 117.21.100.128:6381</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663756333283-3e954dc0-bbe0-4685-a420-509b7119bfdd.png#averageHue=%232e3137&clientId=u96b883cb-996c-4&from=paste&height=150&id=u57539191&name=image.png&originHeight=187&originWidth=605&originalType=binary&ratio=1&rotation=0&showTitle=false&size=45556&status=done&style=none&taskId=u3d5ceb3b-8b0d-4d4e-bd77-73595de27d1&title=&width=484" alt="image.png"><br>先填6382的ID,再填6387的ID,6382接受，6387给槽位<br>在输入yes<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663756416918-54a00439-c12a-4e57-bfe4-0f388728efe6.png#averageHue=%23303238&clientId=u96b883cb-996c-4&from=paste&height=303&id=u55647852&name=image.png&originHeight=379&originWidth=615&originalType=binary&ratio=1&rotation=0&showTitle=false&size=86486&status=done&style=none&taskId=u0d70c460-fd23-4e73-96d8-3416ade242e&title=&width=492" alt="image.png"><br>6382接受了槽位<br>6387的槽位空了<br>再删除6387的节点<br><code>redis-cli --cluster del-node 117.21.100.128:6388 e47664b9814bd0ecf7de8ce648c65fbf44710702</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663756555498-21a2eb70-e300-441b-80e5-fae96228e9a8.png#averageHue=%232b2d33&clientId=u96b883cb-996c-4&from=paste&height=101&id=u0be84707&name=image.png&originHeight=126&originWidth=719&originalType=binary&ratio=1&rotation=0&showTitle=false&size=26626&status=done&style=none&taskId=uf769fe0a-2192-4872-b0a7-e93daf8ee60&title=&width=575.2" alt="image.png"></p>
<h1 id="7X1-Dockerfile"><a href="#7X1-Dockerfile" class="headerlink" title="7X1 Dockerfile"></a>7X1 Dockerfile</h1><h2 id="7X1-1-什么是dockerfile"><a href="#7X1-1-什么是dockerfile" class="headerlink" title="7X1.1 什么是dockerfile"></a>7X1.1 什么是dockerfile</h2><p>dockerfile是用来构建docker镜像的文本文件，是由一条条构建镜像所需指令和参数构成的脚本<br>相当于我们写什么PHP啊，shell脚本这样的</p>
<p>编写三部曲：dockerfile编写脚本&gt;&gt;docker build命令构建镜像&gt;&gt;docker run实现运行容器</p>
<p>dockerfile基础知识：</p>
<ul>
<li>每条保留指令都必须为大写字母且后面要跟至少一个参数</li>
<li>指令按照从上往下顺序进行</li>
<li>#表示注释</li>
<li>每条指令都会创建一个新的镜像层并对镜像进行提交</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663827563745-b3a2a19d-9025-4afd-85d3-9267d02470cc.png#averageHue=%23f6f6f6&clientId=ua538f9d1-eb5d-4&from=paste&height=250&id=ued4837a0&name=image.png&originHeight=313&originWidth=1615&originalType=binary&ratio=1&rotation=0&showTitle=false&size=177676&status=done&style=none&taskId=uc89dbdbf-5341-4517-b944-eef389db192&title=&width=1292" alt="image.png"></p>
<h2 id="7X1-2-Dockerfile保留字节简介"><a href="#7X1-2-Dockerfile保留字节简介" class="headerlink" title="7X1.2 Dockerfile保留字节简介"></a>7X1.2 Dockerfile保留字节简介</h2><ul>
<li>FROM:基础镜像，当前新镜像是基于哪个镜像的，指定一个已经存在的镜像作为模板，第一条必须是FROM</li>
<li>MAINTAINER：镜像维护者的姓名和邮箱地址</li>
<li>RUN：镜像构建时需要运行的命令</li>
</ul>
<p>有两种格式，shell和exec格式，run在docker build时运行</p>
<ul>
<li>EXPOSE：当前容器对外暴露的端口</li>
<li>WORKDIR：指定在创建容器后，终端默认登入的工作目录，落脚点</li>
<li>USER：镜像以什么用户去执行，如root</li>
<li>ENV:设置环境变量</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663829098561-54fcb922-0a12-48d3-8f1d-ed2b4d6d36af.png#averageHue=%23fbfbfb&clientId=ua538f9d1-eb5d-4&from=paste&height=136&id=ub2c02f41&name=image.png&originHeight=170&originWidth=814&originalType=binary&ratio=1&rotation=0&showTitle=false&size=68572&status=done&style=none&taskId=u656daeca-349c-4a12-b423-18e9c68d9be&title=&width=651.2" alt="image.png"></p>
<ul>
<li>VOLUME：容器卷</li>
<li>ADD：将宿主机目录下的文件拷贝进镜像且会自动处理URL和解压tar压缩包</li>
<li>CMD：指定容器启动后要干的事情</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663829899001-e3e6ed44-8430-4522-9cb4-841c8be30846.png#averageHue=%23fafafa&clientId=ua538f9d1-eb5d-4&from=paste&height=263&id=ueaa4a383&name=image.png&originHeight=329&originWidth=1051&originalType=binary&ratio=1&rotation=0&showTitle=false&size=150561&status=done&style=none&taskId=u69017d06-f795-4108-ad21-9cddfcaf307&title=&width=840.8" alt="image.png"><br>dockerfile可以有多个CMD指令，但是只有最后一个会生效,CMD会被docker run后的参数替代</p>
<ul>
<li>ENTRYPOINT：</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663830276729-52a90074-a851-45ea-a4e5-9e2a9041c2f6.png#averageHue=%23f7f6f6&clientId=ua538f9d1-eb5d-4&from=paste&height=584&id=udf5e981b&name=image.png&originHeight=730&originWidth=1725&originalType=binary&ratio=1&rotation=0&showTitle=false&size=509978&status=done&style=none&taskId=u5c813c5f-3b9a-4ee3-84ee-11babeaa648&title=&width=1380" alt="image.png"></p>
<h2 id="7X1-3-Dockerfile-centos案例"><a href="#7X1-3-Dockerfile-centos案例" class="headerlink" title="7X1.3 Dockerfile-centos案例"></a>7X1.3 Dockerfile-centos案例</h2><p><code>docker pull centos</code><br>先pull个centos下来<br>首先下载下来的centos系统是无法运行vim，ifconfig，java-version指令的</p>
<p>需求：具备vim，ifconfig，jdk8<br>准备一个jdk8的包，然后在目录下新建dockerfile文件<br><code>vim Dockerfile </code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">FROM centos:<span class="number">7</span></span><br><span class="line"><span class="comment">#新版centos8会对yum报错，引用centos7</span></span><br><span class="line">MAINTAINER zzyy&lt;zzyybs@<span class="number">126.</span>com&gt;</span><br><span class="line"> </span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"> </span><br><span class="line"><span class="comment">#安装vim编辑器</span></span><br><span class="line">RUN yum -y install vim</span><br><span class="line"><span class="comment">#安装ifconfig命令查看网络IP</span></span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"><span class="comment">#安装java8及lib库</span></span><br><span class="line">RUN yum -y install glibc.i686</span><br><span class="line">RUN mkdir /usr/local/java</span><br><span class="line"><span class="comment">#ADD 是相对路径jar,把jdk-8u191-linux-x64.tar.gz添加到容器中,安装包必须要和Dockerfile文件在同一位置</span></span><br><span class="line">ADD jdk-8u191-linux-x64.tar.gz /usr/local/java/</span><br><span class="line"><span class="comment">#配置java环境变量</span></span><br><span class="line">ENV JAVA_HOME /usr/local/java/jdk1<span class="number">.8</span><span class="number">.0_191</span></span><br><span class="line">ENV JRE_HOME $JAVA_HOME/jre</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH</span><br><span class="line">ENV PATH $JAVA_HOME/<span class="built_in">bin</span>:$PATH</span><br><span class="line"> </span><br><span class="line">EXPOSE <span class="number">80</span></span><br><span class="line"> </span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo <span class="string">&quot;success--------------ok&quot;</span></span><br><span class="line">CMD /<span class="built_in">bin</span>/bash</span><br></pre></td></tr></table></figure>
<p>在当前目录<code>docker build -t centosjava8:1.5 .</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663832308966-1cf41eb9-a3c2-42e9-8608-e5328ef4100f.png#averageHue=%2322242b&clientId=ua538f9d1-eb5d-4&from=paste&height=360&id=uf317b4ac&name=image.png&originHeight=450&originWidth=669&originalType=binary&ratio=1&rotation=0&showTitle=false&size=90400&status=done&style=none&taskId=ue647faf1-254a-401c-8e65-a29ba314922&title=&width=535.2" alt="image.png"><br>成功安装执行dockerfile<br>之后docker images后可以看到搭建的镜像：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663832350364-35b9fbb3-f985-405b-8ca3-5c05401993a9.png#averageHue=%2321252c&clientId=ua538f9d1-eb5d-4&from=paste&height=49&id=u13a87e82&name=image.png&originHeight=61&originWidth=672&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11845&status=done&style=none&taskId=u50195b1b-40ed-4e52-87dc-26a04115378&title=&width=537.6" alt="image.png"><br>再接着run一个实例容器检查一下指令是否安装：<br>docker run -it –name&#x3D;centos-1 centosjava8:1.5 &#x2F;bin&#x2F;bash<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663832426375-36492495-fea1-4ce1-9f0c-267af25f240f.png#averageHue=%2325272e&clientId=ua538f9d1-eb5d-4&from=paste&height=296&id=u204b4eab&name=image.png&originHeight=370&originWidth=650&originalType=binary&ratio=1&rotation=0&showTitle=false&size=80841&status=done&style=none&taskId=u01615b6b-90b4-44dd-ba8b-fee1ad7a8e1&title=&width=520" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663832433999-cd76fc83-be7b-47c8-89e4-05513d9ad6a6.png#averageHue=%231b1e25&clientId=ua538f9d1-eb5d-4&from=paste&height=373&id=u9e9be476&name=image.png&originHeight=466&originWidth=656&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32990&status=done&style=none&taskId=ubf4083ca-c1ce-49e3-a153-21392b84b3c&title=&width=524.8" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663832444514-95e144c7-91da-4af8-87cc-318b675688a4.png#averageHue=%2326282f&clientId=ua538f9d1-eb5d-4&from=paste&height=82&id=u46ea17c5&name=image.png&originHeight=102&originWidth=619&originalType=binary&ratio=1&rotation=0&showTitle=false&size=21173&status=done&style=none&taskId=u0208b85f-24b7-46b3-a99c-5c813756232&title=&width=495.2" alt="image.png"><br>全部安装完毕</p>
<p>虚悬镜像：<br>容器构建或者删除时候，出现了错误，就会出现虚悬镜像：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663832919996-7ea70bd8-e29e-44e5-a1aa-c897b6066ec1.png#averageHue=%2320232a&clientId=ua538f9d1-eb5d-4&from=paste&height=95&id=u5b999d50&name=image.png&originHeight=119&originWidth=641&originalType=binary&ratio=1&rotation=0&showTitle=false&size=21506&status=done&style=none&taskId=u218266c5-b7c9-4825-8267-8f8be37be43&title=&width=512.8" alt="image.png"><br>两个都是none，虚悬镜像应该删除<br>查找虚悬镜像：<br><code>docker image ls -f dangling=true</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663832985427-42d2a11c-353c-44c8-b2d5-c0efda315e3f.png#averageHue=%2322252c&clientId=ua538f9d1-eb5d-4&from=paste&height=63&id=uadbc3c31&name=image.png&originHeight=79&originWidth=727&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14131&status=done&style=none&taskId=u6934c917-4071-45e6-be3b-6acd744cda2&title=&width=581.6" alt="image.png"><br><code>docker image prune</code><br>或者<code>docker rmi -f id</code>也可以删除</p>
<h1 id="8X1-Docker-network"><a href="#8X1-Docker-network" class="headerlink" title="8X1 Docker network"></a>8X1 Docker network</h1><h2 id="8X1-1-network常用指令"><a href="#8X1-1-network常用指令" class="headerlink" title="8X1.1 network常用指令"></a>8X1.1 network常用指令</h2><p>首先输入在我们启动docker后运行指令<code>ifconfig</code>后回出现个docker0的虚拟网桥：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663936753128-d4bb45b5-ff6f-4e62-9284-e021466ae25e.png#averageHue=%232d3339&clientId=uedeaa30e-b027-4&from=paste&height=150&id=ud3a49fe1&name=image.png&originHeight=188&originWidth=600&originalType=binary&ratio=1&rotation=0&showTitle=false&size=63839&status=done&style=none&taskId=u67718c2a-efb6-486a-85b0-857b264b463&title=&width=480" alt="image.png"><br>docker就是通过这个虚拟网桥来和宿主机交流<br><code>docker network ls</code>：查看docker网络模式<br><code>docker network create 网络名字</code>：创建一个网络<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663937016373-d4daefc2-a2cd-40a8-9837-4d50f1d767a9.png#averageHue=%232b2e35&clientId=uedeaa30e-b027-4&from=paste&height=175&id=u1b5585cb&name=image.png&originHeight=219&originWidth=510&originalType=binary&ratio=1&rotation=0&showTitle=false&size=58441&status=done&style=none&taskId=u55df44e7-2266-4894-aeb6-59995e5b4fa&title=&width=408" alt="image.png"><br><code>docker network inspect 网络名字</code>：查看网络配置</p>
<h2 id="8X1-2-docker-network能干嘛"><a href="#8X1-2-docker-network能干嘛" class="headerlink" title="8X1.2 docker-network能干嘛"></a>8X1.2 docker-network能干嘛</h2><p>容器间的互联和通信以及端口映射<br>容器IP变动时可以通过服务名直接网络通信</p>
<h2 id="8X1-3-网络类型"><a href="#8X1-3-网络类型" class="headerlink" title="8X1.3 网络类型"></a>8X1.3 网络类型</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663937406428-5fdd6d4e-ddb0-4210-961c-316e18f7326e.png#averageHue=%23f6f5f5&clientId=uedeaa30e-b027-4&from=paste&height=334&id=u913e6fda&name=image.png&originHeight=418&originWidth=889&originalType=binary&ratio=1&rotation=0&showTitle=false&size=121400&status=done&style=none&taskId=u0a7b77d0-06eb-4522-b96b-27d9778b144&title=&width=711.2" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663937557984-61f021e5-4229-4be7-bf07-f6405a6c55ce.png#averageHue=%23f5f5f5&clientId=uedeaa30e-b027-4&from=paste&height=194&id=u93e73b9e&name=image.png&originHeight=242&originWidth=976&originalType=binary&ratio=1&rotation=0&showTitle=false&size=106636&status=done&style=none&taskId=u4fcea123-ddca-4a3d-bd01-e88b2a61ae6&title=&width=780.8" alt="image.png"></p>
<h2 id="8X1-4-docker底层ip和容器映射变动"><a href="#8X1-4-docker底层ip和容器映射变动" class="headerlink" title="8X1.4 docker底层ip和容器映射变动"></a>8X1.4 docker底层ip和容器映射变动</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663937895628-fa48f97b-f1eb-4109-9aa9-526cb098c4db.png#averageHue=%23f7f6f5&clientId=uedeaa30e-b027-4&from=paste&height=494&id=ue4844af0&name=image.png&originHeight=618&originWidth=1460&originalType=binary&ratio=1&rotation=0&showTitle=false&size=306254&status=done&style=none&taskId=u3a475ed8-669e-4078-abeb-bea5a1f30ef&title=&width=1168" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663937911016-8350ec1b-7a53-4984-84ca-e392987c1fcc.png#averageHue=%23f9f6f6&clientId=uedeaa30e-b027-4&from=paste&height=562&id=u9dffc43c&name=image.png&originHeight=703&originWidth=1347&originalType=binary&ratio=1&rotation=0&showTitle=false&size=419215&status=done&style=none&taskId=u6d50a4e3-bdda-4a61-97b2-94e0a0ed8b6&title=&width=1077.6" alt="image.png"><br>这说明这个ip是会变动的</p>

    </div>

    
    <div class="about">
        <h1>About this Post</h1>
        <div class="details">
            <p>This post is written by Boogipop, licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a>.</p>
        </div>
        
        <p class="tags">
            
            <i class="icon"></i>
            <a href="/tags/开发/" class="tag">#开发</a>
        </p>
        
    </div>
    

    <div class="container post-prev-next">
        
        <a href="/2023/03/02/Nginx/" class="next">
            <div>
                <div class="text">
                    <p class="label">Next</p>
                    <h3 class="title">Nginx</h3>
                </div>
            </div>
        </a>
        
        
        <a href="/2023/03/02/CTFSHOW-PHP/" class="prev">
            <div>
                <div class="text">
                    <p class="label">Previous</p>
                    <h3 class="title">CTFSHOW-PHP</>
                </div>
            </div>
        </a>
        
    </div>

    
        
        
        <script src="https://giscus.app/client.js" data-repo="Boogipop/Boogipop.github.io" data-repo-id="R_kgDOIFi78g" data-category="Announcements" data-category-id="DIC_kwDOIFi78s4Cav9f" data-mapping="pathname" data-strict="1" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" crossorigin="anonymous" async></script>
        
    
</article>

        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h2 class="title">Blog</h2>
                
                <a href="/" class="item">Blog</a>
                
                <a href="/archives" class="item">Archives</a>
                
                <a href="/tags" class="item">Tags</a>
                
                <a href="/categories" class="item">Categories</a>
                
                <a href="/search" class="item">Search</a>
                
                <a href="/friends" class="item">Friends</a>
                
                <a href="/about" class="item">About</a>
                
                <a href="/atom.xml" class="item">RSS</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Projects</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/rsa-cli" class="item">RSA CLI</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/hexo-theme-cupertino" class="item">Hexo Theme Cupertino</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/a-calendar" class="item">A Calendar</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/auto-mirroring-bucket" class="item">Auto Mirroring Bucket</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Me</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom" class="item">GitHub</a>
                
                <a target="_blank" rel="noopener" href="https://codepen.io/mrwillcom" class="item">CodePen</a>
                
                <a target="_blank" rel="noopener" href="https://www.patreon.com/MrWillCom" class="item">Patreon</a>
                
                <a target="_blank" rel="noopener" href="https://noc.social/@MrWillCom" class="item">Mastodon</a>
                
                <a target="_blank" rel="noopener" href="https://discord.gg/UKuFDjcfY8" class="item">Discord</a>
                
                <a href="mailto:mr.will.com@outlook.com" class="item">Email</a>
                
            </div>
            
        </div>
        <span>&copy; 2025 Boogipop<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> </span>
        
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
    </div>
</footer>


        
<script src="/js/main.js"></script>

        
        
        

        
        <script src="https://unpkg.com/scrollreveal"></script>
		
        <script>
            window.addEventListener('load', () => {
                ScrollReveal({ delay: 250, reset: true, easing: 'cubic-bezier(0, 0, 0, 1)' })
                ScrollReveal().reveal('.post-list-item .cover-img img')
                ScrollReveal().reveal('.post-list-item, .card, .content p img, .content .block-large img', { distance: '60px', origin: 'bottom', duration: 800 })
            })
        </script>
        
    </body>
</html>