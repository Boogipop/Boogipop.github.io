<!DOCTYPE html>
<html lang="zh-CN">
    <head prefix="og: https://ogp.me/ns#">
  <meta charset="utf-8">
  <meta name="referrer" content="no-referrer" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>Nginx - Boogiepop Doesn&#39;t Laugh</title>
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    <link rel='manifest' href='/manifest.json'>
  

  
  
  
  <meta property="og:title" content="Nginx - Boogiepop Doesn&#39;t Laugh" />
  
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="http://example.com/2023/03/02/Nginx/index.html" />
  
  <meta property="og:image" content="/favicon.png" />
  
  <meta property="og:article:published_time" content="2023-03-02T10:23:28.000Z" />
  
  <meta property="og:article:author" content="Boogipop" />
  
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
<link rel="stylesheet" href="/css/giscus.css">

  
  
<link rel="stylesheet" href="/css/rainbow-banner.css">

  
  
  
<link rel="stylesheet" href="/css/toc.css">

  
  
    
<link rel="stylesheet" href="/css/giscus.css">

  
  
  
  
<link rel="stylesheet" href="/css/post.css">

  
  
  
  
  

  
<meta name="generator" content="Hexo 6.3.0"></head>
    <body
        data-color-scheme="auto"
        data-uppercase-categories="true"
        
        data-rainbow-banner="true"
        data-rainbow-banner-shown="auto"
        data-rainbow-banner-month="6"
        data-rainbow-banner-colors="#e50000,#ff8d00,#ffee00,#008121,#004cff,#760188"
        
        data-config-root="/"
        
        data-toc="true"
        data-toc-max-depth="2"
        
        
    >
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">Blog</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">Home</a>
            
            
            <a class="nav-item" href="/archives">Archives</a>
            
            
            
            <a class="nav-item" href="/friends">Friends</a>
            
            
            
            <a class="nav-item" href="/about">About</a>
            
            
            
            <a class="nav-item" href="/categories">Categories</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/MrWillCom" target="_blank" aria-label="GitHub">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-codepen nav-item-icon" href="https://codepen.io/mrwillcom" target="_blank" aria-label="CodePen">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-patreon nav-item-icon" href="https://www.patreon.com/MrWillCom" target="_blank" aria-label="Patreon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-mastodon nav-item-icon" href="https://noc.social/@MrWillCom" target="_blank" aria-label="Mastodon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-discord nav-item-icon" href="https://discord.gg/UKuFDjcfY8" target="_blank" aria-label="Discord">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-search nav-item-icon" href="/search" target="_blank" aria-label="Search">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        
<article class="post">
    <div class="meta">
        
        <div class="categories text-uppercase">
        
            <a href="/categories/Development/">Development</a>
        
        </div>
        

        
        <div class="date" id="date">
            <span>March</span>
            <span>2,</span>
            <span>2023</span>
        </div>
        

        <h2 class="title">Nginx</h2>
    </div>

    <div class="divider"></div>

    <div class="content">
        <h2 id="正向代理和反向代理介绍"><a href="#正向代理和反向代理介绍" class="headerlink" title="正向代理和反向代理介绍"></a>正向代理和反向代理介绍</h2><h3 id="正向代理"><a href="#正向代理" class="headerlink" title="正向代理"></a>正向代理</h3><p>在客户端配置代理服务器，通过代理服务器进行互联网访问，就像我们用的VPN梯子，当我们想要去访问一个国外网站，用国内的ip是访问不到的，这时候就需要一个代理服务器牵线搭桥<br>图解：<br>    <img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662358685051-9be6bd6e-2dd8-4db4-8185-dfae5c2ea5fe.png#averageHue=%23f7fbf7&clientId=u087b59de-a5e7-4&from=paste&height=202&id=u0a7ad773&name=image.png&originHeight=252&originWidth=599&originalType=binary&ratio=1&rotation=0&showTitle=false&size=35909&status=done&style=none&taskId=ue8286285-9e79-497c-8e6f-cf5f5856165&title=&width=479.2" alt="image.png"></p>
<h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h3><p>上面的是给客户端用代理服务器，达到访问记录不是客户端的真实ip，反向代理指的是给服务端配置代理服务器，让客户端不知道服务器的真实ip地址<br>图解：<img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662359800541-67dd5edb-9624-4914-82e2-0af58688affe.png#averageHue=%23f5faf6&clientId=u087b59de-a5e7-4&from=paste&height=207&id=u40f5f19f&name=image.png&originHeight=259&originWidth=891&originalType=binary&ratio=1&rotation=0&showTitle=false&size=46016&status=done&style=none&taskId=ua5b03800-b555-44bf-a007-1c51ee779b6&title=&width=712.8" alt="image.png"><br>这边反向代理服务器和我们的服务端tomcat可以视为一个整体，因为客户端对代理无感知，客户端不需要任何配置就可以访问，只需要将请求发送到反向代理服务器去选择目标服务器的数据，然后返还给客户端</p>
<p>举个例子，反向代理服务器就是服务员，服务端就是厨师，你要什么服务员就给你拿什么</p>
<h2 id="负载均衡和动静分离介绍"><a href="#负载均衡和动静分离介绍" class="headerlink" title="负载均衡和动静分离介绍"></a>负载均衡和动静分离介绍</h2><ul>
<li>基本的发送请求和响应方式：</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662452149371-ea906add-c515-4cac-b532-8f0f08464920.png#averageHue=%23f4f8f5&clientId=u7d0867ad-e216-4&from=paste&height=198&id=u6d7c85ac&name=image.png&originHeight=248&originWidth=890&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22281&status=done&style=none&taskId=uec095656-4a77-4695-9665-8597de6478c&title=&width=712" alt="image.png"><br>这种架构方式对于<strong>早期的系统相对单一，并发请求数量较少</strong>的时候是比较适合的，但现在科技飞速发展，并发数越来越高，用这样的系统可能会导致<strong>服务器瘫痪</strong>，这时候我们可以提高CPU的性能，但这个不能起太大的作用，不是根本性的。</p>
<h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><ul>
<li>图解：</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662452651313-33b5d3d7-0932-491f-b008-222dde689aaa.png#averageHue=%23f5f9f5&clientId=u7d0867ad-e216-4&from=paste&height=492&id=u0836d047&name=image.png&originHeight=615&originWidth=1574&originalType=binary&ratio=1&rotation=0&showTitle=false&size=112423&status=done&style=none&taskId=uc5c4f123-147a-4e41-ade2-089bbf79f3d&title=&width=1259.2" alt="image.png"><br>客户端向服务端发送15个请求，负载均衡模式就不会集中发送往一个服务端，先通过反向代理服务器，然后分配到不同的服务端</p>
<h3 id="动静分离"><a href="#动静分离" class="headerlink" title="动静分离"></a>动静分离</h3><ul>
<li>图解:</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662453491514-74081853-2920-43b2-951a-fea587715caf.png#averageHue=%23f7fbf8&clientId=u7d0867ad-e216-4&from=paste&height=474&id=u8c410e83&name=image.png&originHeight=593&originWidth=1591&originalType=binary&ratio=1&rotation=0&showTitle=false&size=70413&status=done&style=none&taskId=u1453cca2-b17c-4e3e-bd8b-9af35a5f9ec&title=&width=1272.8" alt="image.png"><br>首先我们的服务端要先设置几台服务器，一些只存放<strong>静态资源，如js,html,css</strong>，一些服务器存放<strong>动态资源，如jsp，servlet</strong><br>当客户端发送静态请求时，反向代理服务器就把请求送到静态服务器，发送动态请求就送到动态服务器，达到动静分离</p>
<h2 id="Linux下Nginx安装"><a href="#Linux下Nginx安装" class="headerlink" title="Linux下Nginx安装"></a>Linux下Nginx安装</h2><h3 id="step1-安装pcre依赖"><a href="#step1-安装pcre依赖" class="headerlink" title="step1.安装pcre依赖"></a>step1.安装pcre依赖</h3><p>按顺序输入一下指令：</p>
<ul>
<li>下载安装包</li>
</ul>
<p><code>wget [https://sourceforge.net/projects/pcre/files/pcre/8.37/pcre-8.37.tar.gz](https://sourceforge.net/projects/pcre/files/pcre/8.37/pcre-8.37.tar.gz)</code></p>
<ul>
<li>解压</li>
</ul>
<p><code>tar -xvf pcre-8.37.tar.gz</code></p>
<ul>
<li>安装</li>
</ul>
<p>首先进入文件夹<code>cd pcre-8.37</code><br>再运行<code>./configure</code>进行安装<br>最后运行<code>make &amp;&amp; make install</code>编译</p>
<ul>
<li>验证</li>
</ul>
<p>输入<code>pcre-config --version</code>查看版本，若出现8.37说明安装成功</p>
<h3 id="step2-安装其他的依赖"><a href="#step2-安装其他的依赖" class="headerlink" title="step2.安装其他的依赖"></a>step2.安装其他的依赖</h3><p><code>yum -y install make zlib zlib-devel gcc-c++ libtool openssl openssl-devel</code><br>你以为以上的指令有用吗，不屁用没有，真的，别踩坑，kali虚拟机系统不能这样安装，不能的不能的</p>
<p><strong>正确方法：</strong></p>
<ul>
<li>安装zlib-devel依赖：</li>
</ul>
<p>在ubuntu软件源里zlib和zlib-devel叫做zlib1g zlib1g.dev名字和错误提示中的名字不一致<br><code>sudo apt-get install zlib1g.dev</code></p>
<ul>
<li>安装openssl-devel依赖：</li>
</ul>
<p><code> sudo apt-get install openssl</code><br><code>sudo apt-get install libssl-dev</code></p>
<ul>
<li>安装gcc和g++依赖：</li>
</ul>
<p><code>sudo apt-get install gcc</code><br><code>sudo apt-get install g++</code></p>
<h3 id="step3-安装nginx"><a href="#step3-安装nginx" class="headerlink" title="step3.安装nginx"></a>step3.安装nginx</h3><p>下载官网：<a target="_blank" rel="noopener" href="http://nginx.org/en/download.html">http://nginx.org/en/download.html</a><br>我下载的是nginx-1.20.2.tar.gz<br>先压缩： <code>tar -xvf nginx-1.20.2.tar.gz</code><br>再进入解压目录执行:<code>./configure</code><br>再进行编译:<code>make &amp;&amp; make install</code></p>
<h3 id="nginx的位置"><a href="#nginx的位置" class="headerlink" title="nginx的位置"></a>nginx的位置</h3><p>安装完成后，我们可以<code>cd /usr/local/nginx/sbi/</code>找到nginx的可执行文件</p>
<h3 id="启动nginx"><a href="#启动nginx" class="headerlink" title="启动nginx"></a>启动nginx</h3><p>在上面说的目录下<code>./nginx</code><br>然后<code>ps -ef|grep nginx</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662459809217-184e865d-cb39-4bdd-9879-0dc112b355b4.png#averageHue=%232b2d34&clientId=u7d0867ad-e216-4&from=paste&height=142&id=ua3d1d904&name=image.png&originHeight=177&originWidth=690&originalType=binary&ratio=1&rotation=0&showTitle=false&size=51045&status=done&style=none&taskId=u6f7456d1-255a-4418-8b05-4505bb0363d&title=&width=552" alt="image.png"><br>可以看到已经成功运行</p>
<h3 id="查看我们的端口设置"><a href="#查看我们的端口设置" class="headerlink" title="查看我们的端口设置"></a>查看我们的端口设置</h3><p>先进入<code>cd /usr/local/nginx/conf</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662460169154-9ca60e9d-1740-4fcc-8eea-69f858a361ae.png#averageHue=%232c2e35&clientId=u01dcbe27-c941-4&from=paste&height=122&id=ud9751eec&name=image.png&originHeight=153&originWidth=632&originalType=binary&ratio=1&rotation=0&showTitle=false&size=40530&status=done&style=none&taskId=uda0cf64a-af27-4d58-ab6a-9b88c5091a3&title=&width=505.6" alt="image.png"><br>里面有一个nginx.conf文件，我们查看一下:<br><code>vim nginx.conf</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662460214656-478a277e-1a3e-4af4-a754-337bafb2d0d2.png#clientId=u01dcbe27-c941-4&from=paste&height=258&id=u2e2553b3&name=image.png&originHeight=322&originWidth=568&originalType=binary&ratio=1&rotation=0&showTitle=false&size=51794&status=done&style=none&taskId=ud1f164ab-767d-4b31-a98f-75e9da5f185&title=&width=454.4" alt="image.png"><br>有一个listen，就是我们的默认端口80<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662460287734-44a2e1c7-a1be-431e-b78f-85e07c18656d.png#clientId=u01dcbe27-c941-4&from=paste&height=388&id=u76fe1fe8&name=image.png&originHeight=485&originWidth=1186&originalType=binary&ratio=1&rotation=0&showTitle=false&size=39627&status=done&style=none&taskId=uc8b418df-3e22-414f-8c58-435921a2ba7&title=&width=948.8" alt="image.png"><br>主机访问成功</p>
<h3 id="防火墙的有关指令"><a href="#防火墙的有关指令" class="headerlink" title="防火墙的有关指令"></a>防火墙的有关指令</h3><p>查看开放的端口号<code>firewall-cmd --list-all</code><br>设置开放的端口号：<br><code>firewall-cmd --add-service=http -permanent</code><br><code>sudo firewall-cmd --add-port=80/tcp --permanent</code>	新增一个端口</p>
<p>检查防火墙状态<code>systemctl status firewalld</code><br>如果我们的结果如下：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662472023743-a3387f75-3837-40c3-b2d2-eb95a51548a2.png#clientId=u01dcbe27-c941-4&from=paste&height=104&id=u104f4a66&name=image.png&originHeight=130&originWidth=448&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28342&status=done&style=none&taskId=u6252e496-2bbe-486f-a1f3-4fe30370838&title=&width=358.4" alt="image.png"><br>active&#x3D;dead说明是关闭状态</p>
<p>开启防火墙：<code>systemctl start firewalld</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662472061405-67a0f253-d497-4bb9-8be6-7061b69ae31f.png#clientId=u01dcbe27-c941-4&from=paste&height=302&id=u5b608109&name=image.png&originHeight=377&originWidth=695&originalType=binary&ratio=1&rotation=0&showTitle=false&size=150775&status=done&style=none&taskId=ue438f44b-5a8c-4d3b-86a0-6def3273e13&title=&width=556" alt="image.png">状态变为runnning，说明成功开启</p>
<p>关闭防火墙：<code>systemctl stop firewalld</code></p>
<p>重新加载防火墙：<code>firewall-cmd --reload</code></p>
<p>开启防火墙之后输入<code>sudo firewall-cmd --add-port=80/tcp --permanent</code>新增一个80端口，检查一下<img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662472129095-564fa114-f34e-41e4-8a3d-3ef9c26b08c7.png#clientId=u01dcbe27-c941-4&from=paste&height=290&id=u5d9f4ed6&name=image.png&originHeight=363&originWidth=554&originalType=binary&ratio=1&rotation=0&showTitle=false&size=112214&status=done&style=none&taskId=u1dd96917-523c-46b1-9df2-13de0a099e0&title=&width=443.2" alt="image.png">这里我是开放了80和8001端口</p>
<h2 id="Nginx常用的命令"><a href="#Nginx常用的命令" class="headerlink" title="Nginx常用的命令"></a>Nginx常用的命令</h2><p>首先要进入nginx目录才能执行命令<br><code>cd /usr/local/nginx/sbin/</code></p>
<ul>
<li>列出版本号</li>
</ul>
<p><code>./nginx -v</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662557696098-f3714e30-2607-479d-8765-1f87e89249db.png#clientId=uf445bca2-d953-4&from=paste&height=127&id=ucb518ee6&name=image.png&originHeight=159&originWidth=387&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32134&status=done&style=none&taskId=u3101cc1d-2755-4808-9b10-caa39e98019&title=&width=309.6" alt="image.png"></p>
<ul>
<li><p>启动nginx<br><code>./nginx</code></p>
<p>   <img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662557726568-280e73d9-cdf0-482b-b023-b3ab9f8891ee.png#clientId=uf445bca2-d953-4&from=paste&height=68&id=u5a9103b5&name=image.png&originHeight=85&originWidth=654&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25886&status=done&style=none&taskId=u10fccbea-d3e5-4b26-b979-cd2086ce0a3&title=&width=523.2" alt="image.png"></p>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662557749888-ee228e16-1072-4c42-8b95-96f7978f49af.png#clientId=uf445bca2-d953-4&from=paste&height=157&id=u52928986&name=image.png&originHeight=196&originWidth=667&originalType=binary&ratio=1&rotation=0&showTitle=false&size=57057&status=done&style=none&taskId=ub8b4b37c-6219-4f64-9831-c6b42913936&title=&width=533.6" alt="image.png"></p>
<ul>
<li>关闭nginx</li>
</ul>
<p><code>./nginx -s stop</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662557767355-e58f9b4a-69fc-4d4f-b913-d13d98e41b5a.png#clientId=uf445bca2-d953-4&from=paste&height=147&id=u6aa53053&name=image.png&originHeight=184&originWidth=703&originalType=binary&ratio=1&rotation=0&showTitle=false&size=48294&status=done&style=none&taskId=u337fba8b-45c1-4651-81a6-a26015f53a3&title=&width=562.4" alt="image.png"></p>
<ul>
<li>重新加载nginx<br><code>./ nginx -s reload</code></li>
</ul>
<h2 id="Nginx的配置文件"><a href="#Nginx的配置文件" class="headerlink" title="Nginx的配置文件"></a>Nginx的配置文件</h2><p>首先进入文件夹<code>cd /usr/local/nginx/conf</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662557895537-aa35f89c-e113-43d4-893f-1cd7d4d26d92.png#clientId=uf445bca2-d953-4&from=paste&height=124&id=u66b9c0d7&name=image.png&originHeight=155&originWidth=602&originalType=binary&ratio=1&rotation=0&showTitle=false&size=47759&status=done&style=none&taskId=u09912700-0e93-4405-a997-5166f95ea15&title=&width=481.6" alt="image.png"><br>其中nginx.conf是配置文件<br>nginx配置文件有三部分组成：</p>
<h3 id="第一部分：全局快"><a href="#第一部分：全局快" class="headerlink" title="第一部分：全局快"></a>第一部分：全局快</h3><p>从配置文件开始到events块之间的内容，主要会设置一些影响nginx服务器整体运行的配置指令，主要包括运行nginx服务器的用户（组），允许生成的worker process数目，进程pid存放路径，日志存放路径和类型以及配置文件的引入等。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662558293604-01ecf7e4-1974-4830-a8fd-3e2fe1a40e7b.png#clientId=uf445bca2-d953-4&from=paste&height=211&id=u5ccc3290&name=image.png&originHeight=264&originWidth=483&originalType=binary&ratio=1&rotation=0&showTitle=false&size=46068&status=done&style=none&taskId=u920713e1-340a-4c86-b4ab-fabd9f268a6&title=&width=386.4" alt="image.png"><br>到events结束就是整个全局块，worker_processes就表示nginx并发处理的值</p>
<h3 id="第二部分：events块"><a href="#第二部分：events块" class="headerlink" title="第二部分：events块"></a>第二部分：events块</h3><p>events涉及的指令主要影响nginx服务器和用户的网络连接<br>比如：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662558422395-b1fb877a-0402-4c32-9f4a-659512ee13ca.png#clientId=uf445bca2-d953-4&from=paste&height=94&id=u7c4ae869&name=image.png&originHeight=118&originWidth=486&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15993&status=done&style=none&taskId=u7fccf8cb-0386-46f4-b48f-4b7f2265d87&title=&width=388.8" alt="image.png"><br>表示nginx支持的最大连接数是1024</p>
<h3 id="第三部分：http块"><a href="#第三部分：http块" class="headerlink" title="第三部分：http块"></a>第三部分：http块</h3><p>这是nginx服务器配置最频繁的部分，代理，缓存和日志文件等绝大多数功能和第三方模块都在这</p>
<p>http也可以包括http全局块和server块</p>
<h4 id="http全局块"><a href="#http全局块" class="headerlink" title="http全局块"></a>http全局块</h4><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662558670519-59cba902-b26c-4398-9fe6-5261ab070f94.png#clientId=uf445bca2-d953-4&from=paste&height=272&id=u67e1bdb5&name=image.png&originHeight=340&originWidth=702&originalType=binary&ratio=1&rotation=0&showTitle=false&size=70821&status=done&style=none&taskId=u96cb71e2-6ebc-4b2a-9e59-27ab8d816f1&title=&width=561.6" alt="image.png"></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">  <span class="attribute">include</span>       mime.types;</span><br><span class="line">  <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">  <span class="comment">#log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">  <span class="comment">#                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">  <span class="comment">#                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#access_log  logs/access.log  main;</span></span><br><span class="line"></span><br><span class="line">  <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">  <span class="comment">#tcp_nopush     on;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">  <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">#gzip  on;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h4 id="server块"><a href="#server块" class="headerlink" title="server块"></a>server块</h4><p>和虚拟主机有密切关系<br>server也分2个部分</p>
<h5 id="全局server"><a href="#全局server" class="headerlink" title="全局server"></a>全局server</h5><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662558817959-d7b831be-8a9f-48a2-9a69-bd72edaf1e00.png#clientId=uf445bca2-d953-4&from=paste&height=136&id=u3f994dc5&name=image.png&originHeight=170&originWidth=537&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29213&status=done&style=none&taskId=u2485fc07-9b90-4e6a-93dc-6db2c885260&title=&width=429.6" alt="image.png"></p>
<h5 id="location块"><a href="#location块" class="headerlink" title="location块"></a>location块</h5><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662558837216-68a27a2e-2d70-4550-a6ea-d4eb53daefa1.png#clientId=uf445bca2-d953-4&from=paste&height=221&id=ubdbd7668&name=image.png&originHeight=276&originWidth=599&originalType=binary&ratio=1&rotation=0&showTitle=false&size=51239&status=done&style=none&taskId=ub226a518-589e-48a1-b57a-eb747611f89&title=&width=479.2" alt="image.png"></p>
<h2 id="反向代理-1"><a href="#反向代理-1" class="headerlink" title="反向代理"></a>反向代理</h2><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><ul>
<li><strong>安装tomcat，使用默认端口8080</strong></li>
</ul>
<p>软件下载地址：</p>
<p><strong>软件安装：</strong><br><code>tar -xvf tar -xvf apache-tomcat-8.5.82.tar.gz </code><br><code>cd apache-tomcat-8.5.82 </code><br><code>./startup.sh</code>运行<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662642742987-49dde848-9ab3-4edf-b82f-cfb2a6b16ae6.png#clientId=u48a2fc82-e1e5-4&from=paste&height=194&id=u20cd13ad&name=image.png&originHeight=242&originWidth=727&originalType=binary&ratio=1&rotation=0&showTitle=false&size=85066&status=done&style=none&taskId=u64decb67-5193-47c6-bb1f-3ec9512ec70&title=&width=581.6" alt="image.png"><br><strong>配置java环境变量：</strong><br>首先<code>vim /etc/profile</code><br>export JAVA_HOME&#x3D;&#x2F;opt&#x2F;jdk1.8.0_191<br>export JRE_HOME&#x3D;${JAVA_HOME}&#x2F;jre<br>export CLASSPATH&#x3D;.:${JAVA_HOME}&#x2F;lib:${JRE_HOME}&#x2F;lib:$CLASSPATH<br>export JAVA_PATH&#x3D;${JAVA_HOME}&#x2F;bin:${JRE_HOME}&#x2F;bin<br>export PATH&#x3D;$PATH:${JAVA_PATH}<br><strong>配置tomcat环境变量：</strong><br><code>vim /etc/profile</code><br>export CATALINA_HOME&#x3D;&#x2F;opt&#x2F;apache-tomcat-8.5.82</p>
<p>创建对外访问端口：<br><code>firewall-cmd --add-port=8080/tcp --permanent</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662642839051-9a0e5081-1221-4bb6-a2b9-c51385d20f62.png#clientId=u48a2fc82-e1e5-4&from=paste&height=120&id=u4b196fbf&name=image.png&originHeight=150&originWidth=478&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29280&status=done&style=none&taskId=u4a5986a6-1260-4bba-8236-0b253b2b620&title=&width=382.4" alt="image.png"></p>
<p><strong>再重启防火墙：</strong><br><code>firewalld-cmd --reload</code></p>
<p><strong>查看已开放端口：</strong><br><code>firewall-cmd --list-all</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662643005287-b85364aa-414b-4b75-9618-e863ccb9baf1.png#clientId=u48a2fc82-e1e5-4&from=paste&height=239&id=u050285ff&name=image.png&originHeight=299&originWidth=388&originalType=binary&ratio=1&rotation=0&showTitle=false&size=37434&status=done&style=none&taskId=u1aca422c-acd6-4ef6-85a4-e79511d46a3&title=&width=310.4" alt="image.png"><br>可以看到有3个端口<br><strong>最后在主机访问我们的虚拟机端口：（默认8080）</strong><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662643970400-72ea5e96-05e5-4087-825d-a98ffa8e8b0f.png#clientId=u48a2fc82-e1e5-4&from=paste&height=563&id=u8d2eb5c7&name=image.png&originHeight=704&originWidth=1560&originalType=binary&ratio=1&rotation=0&showTitle=false&size=161879&status=done&style=none&taskId=ud72dfb32-6568-4faa-b77f-764a66ac721&title=&width=1248" alt="image.png"></p>
<ul>
<li>**访问过程的分析：<br>**<img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662644174690-7a941fd8-c906-4483-b5e1-a5e388023bf6.png#clientId=u48a2fc82-e1e5-4&from=paste&height=353&id=u90e6b51d&name=image.png&originHeight=441&originWidth=1510&originalType=binary&ratio=1&rotation=0&showTitle=false&size=65264&status=done&style=none&taskId=u9c9007d7-3c94-42f3-a02a-0b91ab1177e&title=&width=1208" alt="image.png"></li>
</ul>
<h2 id="反向代理实例一"><a href="#反向代理实例一" class="headerlink" title="反向代理实例一"></a>反向代理实例一</h2><p>这边第一步是做一个dns修改，感觉没什么必要。。假域名</p>
<h3 id="nginx进行请求转发配置"><a href="#nginx进行请求转发配置" class="headerlink" title="nginx进行请求转发配置"></a>nginx进行请求转发配置</h3><p>进入&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf中<br>去编辑nginx.conf文件<br>按照如下操作修改：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662645402200-8adeb060-b58c-460e-a885-3b6e769ee9b6.png#averageHue=%231f272f&clientId=u48a2fc82-e1e5-4&from=paste&height=311&id=uf8f52ca1&name=image.png&originHeight=389&originWidth=630&originalType=binary&ratio=1&rotation=0&showTitle=false&size=86351&status=done&style=none&taskId=udc53df8e-ffb7-4eed-b550-20e994073b8&title=&width=504" alt="image.png"></p>
<p>结尾有个；</p>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>先去&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin去运行nginx：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662645620175-bebcdca4-e225-4276-af41-d133e48f6b87.png#averageHue=%231d2027&clientId=u48a2fc82-e1e5-4&from=paste&height=168&id=u4885f8c0&name=image.png&originHeight=210&originWidth=500&originalType=binary&ratio=1&rotation=0&showTitle=false&size=31662&status=done&style=none&taskId=uccedf031-d92f-4c6d-9e2d-98985880975&title=&width=400" alt="image.png"><br>最后访问192.168.200.130：80就可以进入tomcat<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662645697015-a28b3c69-a507-420d-901d-f75b5b1789a6.png#averageHue=%238ec69f&clientId=u48a2fc82-e1e5-4&from=paste&height=329&id=u0dd381ba&name=image.png&originHeight=411&originWidth=1586&originalType=binary&ratio=1&rotation=0&showTitle=false&size=110264&status=done&style=none&taskId=ufa4a7bd7-ba05-43f7-babd-12b4f4ae90c&title=&width=1268.8" alt="image.png"></p>
<h2 id="反向代理实例二"><a href="#反向代理实例二" class="headerlink" title="反向代理实例二"></a>反向代理实例二</h2><p>实现效果：使用nginx反向代理，根据访问的路径不同跳转到不同端口的服务中<br>nginx监听端口为9001<br>访问<a target="_blank" rel="noopener" href="http://127.0.0.1:9001/edu%E8%B7%B3%E8%BD%AC%E5%88%B0127.0.0.1:8080">http://127.0.0.1:9001/edu跳转到127.0.0.1:8080</a><br>访问<a target="_blank" rel="noopener" href="http://127.0.0.1:9001/vod%E8%B7%B3%E8%BD%AC%E5%88%B0127.0.0.1:8081">http://127.0.0.1:9001/vod跳转到127.0.0.1:8081</a></p>
<ul>
<li>第一步</li>
</ul>
<p> 准备2个tomcat的服务器，一个是8080端口，一个是8081端口<br>在&#x2F;opt内新建2个文件夹一个tomcat8080，一个8081<br>先关闭原有的tomcat，有两种方法<br>一种是直接ps -ef |grep tomcat，找到PID，最后kill 掉<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662707490243-fe9bf813-ebfe-44ee-a437-259d9ee95099.png#averageHue=%23232d32&clientId=udf297e36-a211-4&from=paste&height=70&id=ud7c1182a&name=image.png&originHeight=87&originWidth=465&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19376&status=done&style=none&taskId=uf61ac3d4-0f1e-417e-be56-5d2465c6193&title=&width=372" alt="image.png"><br>另一种是进入tomcat的bin文件夹中，然后.&#x2F;shutdown.sh<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662707508547-7df59b07-59e3-462d-b6d6-2567d325bbb2.png#averageHue=%2322282f&clientId=udf297e36-a211-4&from=paste&height=64&id=ucf5d73a3&name=image.png&originHeight=80&originWidth=415&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16629&status=done&style=none&taskId=u4c855ed5-020c-4b2b-8c75-00a27c5d711&title=&width=332" alt="image.png"><br>最后把apache-tomcat的文件夹复制2份到tomcat8080和tomcat8081<br>再和之前一样重新安装一遍，别忘了配置环境变量。。。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662708659170-8b137ed8-28e5-4428-989f-f297670d23e3.png#averageHue=%2325333a&clientId=udf297e36-a211-4&from=paste&height=184&id=udbd43206&name=image.png&originHeight=230&originWidth=587&originalType=binary&ratio=1&rotation=0&showTitle=false&size=67536&status=done&style=none&taskId=ue50e7e70-5fba-402a-98b1-1aea4f97f5e&title=&width=469.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662708042632-670152b0-106d-49fa-8ddc-4825a3770a8f.png#averageHue=%2326363b&clientId=udf297e36-a211-4&from=paste&height=149&id=u4887003e&name=image.png&originHeight=186&originWidth=391&originalType=binary&ratio=1&rotation=0&showTitle=false&size=31027&status=done&style=none&taskId=uc12b77d1-1998-43e9-8d34-9c1c5fa656a&title=&width=312.8" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662708142797-c7b31f60-191b-44f7-a008-ed2d81c93b0c.png#averageHue=%232c3539&clientId=udf297e36-a211-4&from=paste&height=158&id=ubafaae6d&name=image.png&originHeight=198&originWidth=571&originalType=binary&ratio=1&rotation=0&showTitle=false&size=65957&status=done&style=none&taskId=uac4775eb-8fd3-4f6e-9ddc-5fd185058c9&title=&width=456.8" alt="image.png"><br>以上是8080的<br>现在我们要改一下8081的：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662708288047-472d8ac8-838e-414f-a455-da225602a8c2.png#averageHue=%232b3439&clientId=udf297e36-a211-4&from=paste&height=169&id=u56dc0b20&name=image.png&originHeight=211&originWidth=708&originalType=binary&ratio=1&rotation=0&showTitle=false&size=70405&status=done&style=none&taskId=u5b373d49-067d-4f99-8529-d42086a390a&title=&width=566.4" alt="image.png"><br>这里要进入conf&#x2F;server.xml去修改文件：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662708338352-8eb8975d-f042-469f-bb16-0e931d3748d7.png#averageHue=%231f3641&clientId=udf297e36-a211-4&from=paste&height=69&id=ude4c4f73&name=image.png&originHeight=86&originWidth=438&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28190&status=done&style=none&taskId=u28f8ec18-41ee-4eea-ac1a-a8e4ced3e2e&title=&width=350.4" alt="image.png"><br>8005改成8015<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662708361658-9f798a40-cff2-4d32-9c6d-6840795d52ce.png#averageHue=%23203137&clientId=udf297e36-a211-4&from=paste&height=83&id=u12d6aa19&name=image.png&originHeight=104&originWidth=478&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24137&status=done&style=none&taskId=ucbc28d27-af49-44b5-b547-1ab8ee9c109&title=&width=382.4" alt="image.png"><br>8080改成8081<br>保存即可，这都是为了防止冲突</p>
<p>然后重启一下tomcat8081，再访问：（别忘了防火墙新增端口）<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662708597786-fecda209-ceb7-44f5-a0b9-4c95a5742ad6.png#averageHue=%23d2ecc5&clientId=udf297e36-a211-4&from=paste&height=385&id=u108ba108&name=image.png&originHeight=481&originWidth=1392&originalType=binary&ratio=1&rotation=0&showTitle=false&size=111623&status=done&style=none&taskId=u6dbdba0a-e9f7-41bf-a40f-0d9ca80ed5c&title=&width=1113.6" alt="image.png"></p>
<ul>
<li>第二步</li>
</ul>
<p>在8080的apache-tomcat中的webapps目录下新建一个文件夹叫做edu：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662709080498-69edecea-c4e9-4883-b50a-cae518e9de2f.png#averageHue=%23242a31&clientId=udf297e36-a211-4&from=paste&height=203&id=u9c9bed0e&name=image.png&originHeight=254&originWidth=609&originalType=binary&ratio=1&rotation=0&showTitle=false&size=62226&status=done&style=none&taskId=u65005be4-68be-41b7-b964-72afbf04101&title=&width=487.2" alt="image.png"><br>在8081的apache-tomcat中的webapps目录下新建一个文件夹叫做vod：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662709127583-e91ffe15-7665-4f91-bf28-fb3bfacab2a0.png#averageHue=%232b3c41&clientId=udf297e36-a211-4&from=paste&height=257&id=u1433a78c&name=image.png&originHeight=321&originWidth=780&originalType=binary&ratio=1&rotation=0&showTitle=false&size=83132&status=done&style=none&taskId=u1bd46f70-2142-4176-8957-727c2ba3655&title=&width=624" alt="image.png"><br>由于我们访问192.168.200.130，当前页面的路劲就是webapps下，我们向vod和edu文件夹下分别防止2个相同的txt文件，里面分别写8080和8081</p>
<p>这里还会出现404问题，向content.xml文件中content下面加上一段话：<br><code>&lt;Loader delegate=&quot;true&quot;/&gt;</code><br>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_40496191/article/details/107812969?ops_request_misc=&request_id=&biz_id=102&utm_term=linux%E4%B8%8B%E9%83%A8%E7%BD%B2tomcat&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-107812969.142%5Ev47%5Epc_rank_34_default_2,201%5Ev3%5Econtrol_1">https://blog.csdn.net/weixin_40496191&#x2F;article&#x2F;details&#x2F;107812969?ops_request_misc&#x3D;&amp;request_id&#x3D;&amp;biz_id&#x3D;102&amp;utm_term&#x3D;linux%E4%B8%8B%E9%83%A8%E7%BD%B2tomcat&amp;utm_medium&#x3D;distribute.pc_search_result.none-task-blog-2<del>all</del>sobaiduweb~default-1-107812969.142^v47^pc_rank_34_default_2,201^v3^control_1</a></p>
<p>然后分别访问可以看到：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662712977396-e913a908-8e8d-4ce7-90a5-29759e98047c.png#averageHue=%23d4b690&clientId=udf297e36-a211-4&from=paste&height=131&id=ud803a193&name=image.png&originHeight=164&originWidth=644&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11585&status=done&style=none&taskId=ub6bd0574-6b1d-4841-aa51-c39c5549e65&title=&width=515.2" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662712981744-03b4ff6d-c26a-40c4-8b59-a1954c68a884.png#averageHue=%23d6c1ac&clientId=udf297e36-a211-4&from=paste&height=95&id=uab421d05&name=image.png&originHeight=119&originWidth=615&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7771&status=done&style=none&taskId=ue5b0b50b-54ac-45ab-bfc1-13798dd8ae4&title=&width=492" alt="image.png"><br>完成简单的部署</p>
<p>之后在nginx的conf文件夹下的nginx.conf中添加这几段：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662713710023-0f652689-3e03-4dce-baad-d3bd92d0a61a.png#averageHue=%23959696&clientId=udf297e36-a211-4&from=paste&height=178&id=u4d260b8a&name=image.png&originHeight=223&originWidth=490&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25710&status=done&style=none&taskId=uf5891b08-7da9-42aa-aa65-d4d24ecf1c3&title=&width=392" alt="image.png"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">       listen       <span class="number">9001</span>;</span><br><span class="line">      server_name  <span class="number">192.168</span>.<span class="number">200.130</span>;</span><br><span class="line"></span><br><span class="line">        location ~ /edu/ &#123;</span><br><span class="line">        proxy_pass http:<span class="comment">//127.0.0.1:8080;</span></span><br><span class="line">        &#125;</span><br><span class="line">        location ~ /vod/ &#123;</span><br><span class="line">        proxy_pass http:<span class="comment">//127.0.0.1:8081;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662714068852-ddc58809-3f8c-4316-989b-1284dea59dce.png#averageHue=%23eee1cb&clientId=udf297e36-a211-4&from=paste&height=138&id=u0c53114f&name=image.png&originHeight=173&originWidth=750&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11424&status=done&style=none&taskId=u74e0afbd-b883-40d9-9eca-b5966c4d260&title=&width=600" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662714088533-0181b85a-eb94-4d2a-9730-ffb90f265807.png#averageHue=%23dae7d1&clientId=udf297e36-a211-4&from=paste&height=126&id=u8f074ee5&name=image.png&originHeight=157&originWidth=793&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22854&status=done&style=none&taskId=u1db9eadb-e386-480f-ae4a-a0c1a5e9ce7&title=&width=634.4" alt="image.png"></p>
<ul>
<li>location指令讲解：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location ~ /edu/ &#123;</span><br><span class="line">proxy_pass http://127.0.0.1:8080;</span><br><span class="line">&#125;</span><br><span class="line">location ~ /vod/ &#123;</span><br><span class="line">proxy_pass http://127.0.0.1:8081;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662714135122-3956cbca-eb09-4e27-956b-6c3cda581f80.png#averageHue=%23f7faf7&clientId=udf297e36-a211-4&from=paste&height=422&id=u445d0ae1&name=image.png&originHeight=527&originWidth=1341&originalType=binary&ratio=1&rotation=0&showTitle=false&size=437747&status=done&style=none&taskId=uf2d2cb19-9b63-4c94-98f7-86507aa9892&title=&width=1072.8" alt="image.png"></li>
</ul>
<h2 id="负载均衡-1"><a href="#负载均衡-1" class="headerlink" title="负载均衡"></a>负载均衡</h2><p>前提准备：<br>在8080和8081端口下的tomcat都创建edu，里面随便放2个用来识别的文件<br>我里面放了一个hello.html，8080里的内容是输出8080,8081的内容是输出8081</p>
<p>修改nginx.conf:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662716520921-c151ce09-9d4a-402e-b761-84ee4c88be99.png#averageHue=%238b8c8d&clientId=udf297e36-a211-4&from=paste&height=313&id=u485ab02d&name=image.png&originHeight=391&originWidth=601&originalType=binary&ratio=1&rotation=0&showTitle=false&size=49708&status=done&style=none&taskId=u90941004-fdcb-4acd-a563-14822fcc989&title=&width=480.8" alt="image.png"></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> myserver&#123;</span><br><span class="line">  <span class="attribute">server</span> 	<span class="number">192.168.200.130:8080</span>;</span><br><span class="line">  <span class="attribute">server</span> 	<span class="number">192.168.200.130:8081</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">  <span class="attribute">server_name</span>  <span class="number">192.168.200.130</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span>	http://myserver;</span><br><span class="line">    <span class="attribute">root</span>   html;</span><br><span class="line">    <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>重启nginx，访问一下192.168.200.130&#x2F;edu&#x2F;hello.html<br><strong>注意事项：这里面的</strong><code>**myserver**</code><strong>要和下面的proxy_pass对应起来，不一定取myserver，随便都可以，只要对应即可！</strong><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662716584699-8ae31386-f13e-4094-91a3-cb22fd83186a.png#averageHue=%23e1c298&clientId=udf297e36-a211-4&from=paste&height=144&id=u9452eef3&name=image.png&originHeight=180&originWidth=589&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11329&status=done&style=none&taskId=ufbebea7f-27e6-42c9-98fa-b00b9bb0dd6&title=&width=471.2" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662716589823-2f53495d-07f7-40bb-8d53-7d770bd3c547.png#averageHue=%23fcfbfb&clientId=udf297e36-a211-4&from=paste&height=198&id=ud0243fd5&name=image.png&originHeight=247&originWidth=704&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10455&status=done&style=none&taskId=u103910cc-9f25-4361-a592-4c33bb16387&title=&width=563.2" alt="image.png"><br>可以看到结果一个是8080一个是8081，这就是负载均衡，去两个端口的判断依据就是轮询，如下</p>
<h3 id="负载均衡的几种策略"><a href="#负载均衡的几种策略" class="headerlink" title="负载均衡的几种策略"></a>负载均衡的几种策略</h3><ul>
<li><p>轮询：<br>每个请求按<code>**时间顺序逐一**</code>分配到不同的后端服务器，如果后端服务器down掉，能自动剔除</p>
</li>
<li><p>weight（权重）：</p>
</li>
</ul>
<p>指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。例如：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662717023476-cbad1b2f-4742-4d7d-89a8-7473b2005e96.png#averageHue=%23f6f9f6&clientId=udf297e36-a211-4&from=paste&height=78&id=ua82d6d7b&name=image.png&originHeight=97&originWidth=699&originalType=binary&ratio=1&rotation=0&showTitle=false&size=69869&status=done&style=none&taskId=u96d6cb31-9f6e-4fa1-a764-02038c525cf&title=&width=559.2" alt="image.png"><br>也就是去8081的比率比去8080的多一倍</p>
<ul>
<li>session：</li>
</ul>
<p>每个请求按照ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。例如：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662717274946-c58c3d77-f62f-417b-860b-e0f23fa6dfc4.png#averageHue=%23eeede8&clientId=udf297e36-a211-4&from=paste&height=223&id=ub7107c24&name=image.png&originHeight=279&originWidth=1022&originalType=binary&ratio=1&rotation=0&showTitle=false&size=133872&status=done&style=none&taskId=u0b12d681-314a-455f-aefa-4ad9805048c&title=&width=817.6" alt="image.png"></p>
<ul>
<li>fair（第三方）：</li>
</ul>
<p>按照后端服务器的响应时间来分配请求，响应时间短的优先分配<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662717352633-029078ac-7ac6-429a-9498-9fa655d8117c.png#averageHue=%23f4f4f0&clientId=udf297e36-a211-4&from=paste&height=232&id=ue348f694&name=image.png&originHeight=290&originWidth=1057&originalType=binary&ratio=1&rotation=0&showTitle=false&size=125762&status=done&style=none&taskId=ueda1991e-3cfa-454e-a5fc-0d3acfa17e9&title=&width=845.6" alt="image.png"></p>
<h2 id="动静分离-1"><a href="#动静分离-1" class="headerlink" title="动静分离"></a>动静分离</h2><p>动静分离是把动态请求和静态请求分开</p>
<ul>
<li>动态请求</li>
</ul>
<p>如向数据库中请求数据</p>
<ul>
<li>静态请求</li>
</ul>
<p>如访问一张图片，一个html页面<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662794238032-74691ad5-241d-4e55-b215-539c1b09c728.png#averageHue=%23f7fcf8&clientId=u7fffd67a-964e-4&from=paste&height=498&id=u1b184dc0&name=image.png&originHeight=623&originWidth=1311&originalType=binary&ratio=1&rotation=0&showTitle=false&size=157543&status=done&style=none&taskId=uad990baf-f4f5-4dc0-b688-0ea37ec06b2&title=&width=1048.8" alt="image.png"></p>
<h3 id="准备工作-1"><a href="#准备工作-1" class="headerlink" title="准备工作"></a>准备工作</h3><ol>
<li>在linux系统中准备一个静态的资源</li>
</ol>
<p>创建一个data文件夹，里面放创建2个文件夹，www和img分别存放不同静态文件<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662795674910-c9b7b90a-ad1e-4d1d-b87d-92d9bcbe8ffa.png#averageHue=%232b4749&clientId=u7fffd67a-964e-4&from=paste&height=297&id=u26b67c11&name=image.png&originHeight=371&originWidth=860&originalType=binary&ratio=1&rotation=0&showTitle=false&size=70554&status=done&style=none&taskId=u553be651-87f5-4067-a0fa-66246ee9a61&title=&width=688" alt="image.png"></p>
<h3 id="进行配置"><a href="#进行配置" class="headerlink" title="进行配置"></a>进行配置</h3><p>把nginx.conf为以下：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662797849747-df7b98ab-ed4a-47a6-b592-520666751eb5.png#averageHue=%238c8d8d&clientId=u7fffd67a-964e-4&from=paste&height=274&id=u8ffc6f3a&name=image.png&originHeight=343&originWidth=551&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24436&status=done&style=none&taskId=u53e8c509-2938-471d-ba65-174e8a64a20&title=&width=440.8" alt="image.png"><br>解释一下：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> /www &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">root</span>   /data/;</span><br><span class="line">  <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">location</span> /img &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">root</span>   /data/;</span><br><span class="line">  <span class="attribute">autoindex</span> <span class="literal">on</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中<code>location /www</code>和<code>root /data/</code>代表着什么？<br>实际上就是当你如果你URL上的请求是URL+&#x2F;www，nginx就会帮你跳转到<br><code>/data/www</code><br>普遍一点的模式就是：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span><span class="regexp"> ^~</span> /t/ &#123;</span><br><span class="line">     <span class="attribute">root</span> /www/root/html/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果一个请求的URI是&#x2F;t&#x2F;a.html时，web服务器将会返回服务器上的&#x2F;www&#x2F;root&#x2F;html&#x2F;t&#x2F;a.html的文件。</p>
<p>其中root可以换成alias：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span><span class="regexp"> ^~</span> /t/ &#123;</span><br><span class="line"> <span class="attribute">alias</span> /www/root/html/new_t/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果一个请求的URI是&#x2F;t&#x2F;a.html时，web服务器将会返回服务器上的&#x2F;www&#x2F;root&#x2F;html&#x2F;new_t&#x2F;a.html的文件。</p>
<p>举个例子，以上例子alias的内容是<code>/data/html/img/;</code><br>location后的内容是<code> ^~ /a/</code><br>那么假如URL+&#x2F;a&#x2F;1.png<br>web服务器会跳转到<code>/data/html/img/1.png</code>和上面的有一点不同<br>下面演示一下：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662798892860-be6bc27a-e1ce-497d-8de3-054666a6adee.png#averageHue=%23959696&clientId=u7fffd67a-964e-4&from=paste&height=98&id=u27a9497b&name=image.png&originHeight=122&originWidth=294&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6523&status=done&style=none&taskId=uaab30b50-0f0a-45e2-b7e6-5c8fa30a296&title=&width=235.2" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662798906330-81d53f2d-2415-4ef6-ae1a-bdf76892c609.png#averageHue=%23b1b7b1&clientId=u7fffd67a-964e-4&from=paste&height=245&id=u99a934a9&name=image.png&originHeight=306&originWidth=966&originalType=binary&ratio=1&rotation=0&showTitle=false&size=72306&status=done&style=none&taskId=ufd77c8f4-0f7d-4e0c-b8d4-99653bb3dba&title=&width=772.8" alt="image.png"><br>符合我们的解释</p>
<p>以上就是动静分离的简单演示拉，还是很实用的感觉！<br>这里不得不说一下视频里的弹幕都是一些没脑子的人真的我草，我一开始不知道root和alias的区别，看弹幕一堆nt说什么root是根目录，我开弹幕的原因是觉得会有人给出解释，而不是看到一群傻子在这里乱说话。实践是检验真理唯一标准</p>
<h2 id="高可用模式"><a href="#高可用模式" class="headerlink" title="高可用模式"></a>高可用模式</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662889019453-18e793f0-fbbc-44b0-8b7d-db8cbad341bd.png#averageHue=%23f5f9f5&clientId=ua1e2dcc8-8fd4-4&from=paste&height=449&id=ubb7d0578&name=image.png&originHeight=561&originWidth=1729&originalType=binary&ratio=1&rotation=0&showTitle=false&size=279964&status=done&style=none&taskId=u65f24b3e-21d2-4681-978e-ce6d8f57dce&title=&width=1383.2" alt="image.png"><br>（1）:需要2台nginx服务器<br>（2）：需要keepalive<br>（3）：需要虚拟ip</p>
<p>先开两个虚拟机吧，克隆一个</p>
<ul>
<li>如何安装keepalived</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43938497/article/details/109227139">https://blog.csdn.net/weixin_43938497&#x2F;article&#x2F;details&#x2F;109227139</a></p>
<h3 id="更改配置文件"><a href="#更改配置文件" class="headerlink" title="更改配置文件"></a>更改配置文件</h3><p>配置文件的位置在&#x2F;usr&#x2F;local&#x2F;keepalived-2.0.20&#x2F;keepalived&#x2F;etc&#x2F;keepalived&#x2F;keepalived.conf</p>
<p>首先先把keepalived.conf文件拷贝一分下来放到windows操作，配置更改为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">notification_email &#123;</span><br><span class="line">#admin@demo.com			# 此处填写你的邮箱</span><br><span class="line">&#125;</span><br><span class="line">#notification_email_from admin@demo.com</span><br><span class="line">#smtp_server 127.0.0.1</span><br><span class="line">#smtp_connect_timeout 30</span><br><span class="line">router_id LVS_DEVEL		# 这里有些说两台机器要一致，有些说不能一样，我是保持一样，也成功了，后面可以详细了解，有了解的也可以说一下</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script chk_nginx &#123;</span><br><span class="line"></span><br><span class="line">script &quot;/etc/keepalived/check_nginx.sh&quot;  # 此处是keepalived检查服务时要执行的脚本</span><br><span class="line"></span><br><span class="line">interval 2		#这里是间隔执行脚本的时间，间隔两秒执行一次</span><br><span class="line">weight -20		# 权重，健康检查脚本执行后如果返回非0则会在priority上减去20</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">state BACKUP				# 设置主备MASTER为主，BACKUP为备</span><br><span class="line">interface eth0				#VIP要挂的网卡</span><br><span class="line">virtual_router_id 51		#虚拟路由标识，主备服务器上这里必须保持一致</span><br><span class="line">priority 100				#定义优先级，数字越大优先级越高，主服务器上的值应该为最大，当改值小于备服务器时，备服务器将抢占VIP</span><br><span class="line">advert_int 1				#主备服务器之间检查的时间间隔，1秒；主备必须一致</span><br><span class="line">authentication &#123;			#设置验证类型和密码，主备必须一致</span><br><span class="line">auth_type PASS</span><br><span class="line">auth_pass 1111</span><br><span class="line">&#125;</span><br><span class="line">virtual_ipaddress &#123;</span><br><span class="line">192.168.200.50			#设置虚拟IP地址，可以设置多个IP地址每行一个</span><br><span class="line">&#125;</span><br><span class="line">track_script &#123;</span><br><span class="line">chk_nginx				#检查脚本，就是我们上边定义的vrrp_script</span><br><span class="line">&#125;</span><br><span class="line">#notify_master &quot;/etc/keepalived/master.sh&quot; 	#当前节点成为master时，执行脚本</span><br><span class="line">#notify_backup &quot;&quot; 							#当前节点成为backup时，执行脚本</span><br><span class="line">#notify_fault &quot;&quot;							#当前节点出现故障时，执行脚本</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>我草给我整吐了，全是centos演示不照顾一下debian的我搞你妈，下面是一些坑：</p>
<ul>
<li><p>xshell和XFTP不能连接问题</p>
</li>
<li><p>Debian默认不让root连接问题</p>
</li>
</ul>
<p>然后在&#x2F;etc&#x2F;keepalived&#x2F;目录下创建一个check_nginx.sh文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">	# 该脚本为检查NGINX服务的脚本，也可以根据自己的需求修改</span><br><span class="line">A=`ps -C nginx --no-header | wc -l`</span><br><span class="line">if [ $A -eq 0 ];then</span><br><span class="line"></span><br><span class="line">	/usr/local/nginx/sbin/nginx</span><br><span class="line">	sleep 2</span><br><span class="line">	if [ `ps -C nginx --no-header | wc -l` -eq 0 ];then</span><br><span class="line">		killall keepalived</span><br><span class="line">	fi</span><br><span class="line">fi</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>接下来运行一下keepalive和nginx<br>由于我们是源码安装keepalived的不能用systemctl去启动，只能手动去&#x2F;usr&#x2F;local&#x2F;sbin&#x2F;keepalived去开启<br>接着在主机去访问虚拟ip：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662902789838-871a3615-b611-4b9b-93fc-14e7f8b8f447.png#averageHue=%23faf9f8&clientId=ua1e2dcc8-8fd4-4&from=paste&height=323&id=uccf31a15&name=image.png&originHeight=404&originWidth=1136&originalType=binary&ratio=1&rotation=0&showTitle=false&size=42439&status=done&style=none&taskId=u8ae20c7d-d1a8-411a-aab7-a3ac5b78fcc&title=&width=908.8" alt="image.png"><br>成功访问了<br>接着我们停掉主机的nginx和keepalived，再访问一下看看：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662902883050-f99c5327-bcfe-4574-b918-a5afe537193c.png#averageHue=%23f9f8f7&clientId=ua1e2dcc8-8fd4-4&from=paste&height=311&id=ue9bfae3d&name=image.png&originHeight=389&originWidth=1124&originalType=binary&ratio=1&rotation=0&showTitle=false&size=41069&status=done&style=none&taskId=ud217c9e6-25c6-4d0f-8240-d926bc74d50&title=&width=899.2" alt="image.png"><br>仍然可以，高可用模式成功</p>
<h3 id="配置文件讲解"><a href="#配置文件讲解" class="headerlink" title="配置文件讲解"></a>配置文件讲解</h3><ul>
<li>router_id:服务器的名字</li>
</ul>
<p>vim&#x2F;etc&#x2F;host可以更改服务器名字<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662903488880-91e8aeba-848d-495e-87a5-1bab17a65169.png#averageHue=%2344413c&clientId=ua1e2dcc8-8fd4-4&from=paste&height=50&id=u276ea192&name=image.png&originHeight=63&originWidth=250&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14394&status=done&style=none&taskId=ua5fcc6e6-cfcc-4463-990e-24a1593cf37&title=&width=200" alt="image.png"></p>
<ul>
<li>检测脚本配置<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">vrrp_script chk_nginx &#123;</span><br><span class="line"></span><br><span class="line">script &quot;/etc/keepalived/check_nginx.sh&quot;  # 此处是keepalived检查服务时要执行的脚本</span><br><span class="line"></span><br><span class="line">interval 2		#这里是间隔执行脚本的时间，间隔两秒执行一次</span><br><span class="line">weight -20		# 权重，健康检查脚本执行后如果返回非0则会在priority上减去20</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">state BACKUP				# 设置主备MASTER为主，BACKUP为备</span><br><span class="line">interface eth0				#VIP要挂的网卡</span><br><span class="line">virtual_router_id 51		#虚拟路由标识，主备服务器上这里必须保持一致</span><br><span class="line">priority 100				#定义优先级，数字越大优先级越高，主服务器上的值应该为最大，当改值小于备服务器时，备服务器将抢占VIP</span><br><span class="line">advert_int 1				#主备服务器之间检查的时间间隔，1秒；主备必须一致</span><br><span class="line">authentication &#123;			#设置验证类型和密码，主备必须一致</span><br><span class="line">auth_type PASS</span><br><span class="line">auth_pass 1111</span><br><span class="line">&#125;</span><br><span class="line">virtual_ipaddress &#123;</span><br><span class="line">192.168.200.50			#设置虚拟IP地址，可以设置多个IP地址每行一个</span><br><span class="line">&#125;</span><br><span class="line">track_script &#123;</span><br><span class="line">chk_nginx				#检查脚本，就是我们上边定义的vrrp_script</span><br><span class="line">&#125;</span><br><span class="line">#notify_master &quot;/etc/keepalived/master.sh&quot; 	#当前节点成为master时，执行脚本</span><br><span class="line">#notify_backup &quot;&quot; 							#当前节点成为backup时，执行脚本</span><br><span class="line">#notify_fault &quot;&quot;							#当前节点出现故障时，执行脚本</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="nginx的原理解析"><a href="#nginx的原理解析" class="headerlink" title="nginx的原理解析"></a>nginx的原理解析</h2><ol>
<li>master和workder</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662903784711-e52460e3-1f31-4575-9f66-570453d13020.png#averageHue=%23293339&clientId=ua1e2dcc8-8fd4-4&from=paste&height=150&id=u828e7de5&name=image.png&originHeight=187&originWidth=774&originalType=binary&ratio=1&rotation=0&showTitle=false&size=56978&status=done&style=none&taskId=ud4fe1e0f-4974-41b3-b31f-0bb8e7cef11&title=&width=619.2" alt="image.png"><br>master相当于管理员，worker相当于普通用户<br><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662903855702-fb444c1e-83e6-46ee-94da-6857005651a0.png#averageHue=%23edf1e8&clientId=ua1e2dcc8-8fd4-4&from=paste&height=550&id=ud4be63a7&name=image.png&originHeight=688&originWidth=1237&originalType=binary&ratio=1&rotation=0&showTitle=false&size=200898&status=done&style=none&taskId=uc0636acb-5fdb-4674-b76e-7c8d49b4426&title=&width=989.6" alt="image.png"></p>
<ol start="2">
<li>worker是如何工作的</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/32634994/1662903874853-5105cb69-7fdc-4bd3-a543-94c52271a618.png#averageHue=%23f4faf6&clientId=ua1e2dcc8-8fd4-4&from=paste&height=473&id=u3a37e21c&name=image.png&originHeight=591&originWidth=1243&originalType=binary&ratio=1&rotation=0&showTitle=false&size=318571&status=done&style=none&taskId=u70c25021-616f-4e4d-bd44-a134945074d&title=&width=994.4" alt="image.png"><br>不同的worker通过争抢的方式来处理</p>
<ol start="3">
<li>一个master多个worker的好处</li>
</ol>
<p>（1） 可以使用.&#x2F;nginx -s reload 热部署<br>（2） 每个worker是独立进程，如果其中一个worker倒了，其他继续争抢，不造成中断</p>
<ol start="4">
<li>设置多少个worker合适</li>
</ol>
<p>nginx同redis类似，采用io多线路复用机制，使得性能最佳<br>当worker数和cpu数相同是最合适的</p>
<p>结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束结束</p>

    </div>

    
    <div class="about">
        <h1>About this Post</h1>
        <div class="details">
            <p>This post is written by Boogipop, licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a>.</p>
        </div>
        
        <p class="tags">
            
            <i class="icon"></i>
            <a href="/tags/开发/" class="tag">#开发</a>
        </p>
        
    </div>
    

    <div class="container post-prev-next">
        
        <a href="/2023/03/02/Node.js/" class="next">
            <div>
                <div class="text">
                    <p class="label">Next</p>
                    <h3 class="title">Node.Js</h3>
                </div>
            </div>
        </a>
        
        
        <a href="/2023/03/02/Docker%20Learning/" class="prev">
            <div>
                <div class="text">
                    <p class="label">Previous</p>
                    <h3 class="title">Docker学习</>
                </div>
            </div>
        </a>
        
    </div>

    
        
        
        <script src="https://giscus.app/client.js" data-repo="Boogipop/Boogipop.github.io" data-repo-id="R_kgDOIFi78g" data-category="Announcements" data-category-id="DIC_kwDOIFi78s4Cav9f" data-mapping="pathname" data-strict="1" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" crossorigin="anonymous" async></script>
        
    
</article>

        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h2 class="title">Blog</h2>
                
                <a href="/" class="item">Blog</a>
                
                <a href="/archives" class="item">Archives</a>
                
                <a href="/tags" class="item">Tags</a>
                
                <a href="/categories" class="item">Categories</a>
                
                <a href="/search" class="item">Search</a>
                
                <a href="/friends" class="item">Friends</a>
                
                <a href="/about" class="item">About</a>
                
                <a href="/atom.xml" class="item">RSS</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Projects</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/rsa-cli" class="item">RSA CLI</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/hexo-theme-cupertino" class="item">Hexo Theme Cupertino</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/a-calendar" class="item">A Calendar</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/auto-mirroring-bucket" class="item">Auto Mirroring Bucket</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Me</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom" class="item">GitHub</a>
                
                <a target="_blank" rel="noopener" href="https://codepen.io/mrwillcom" class="item">CodePen</a>
                
                <a target="_blank" rel="noopener" href="https://www.patreon.com/MrWillCom" class="item">Patreon</a>
                
                <a target="_blank" rel="noopener" href="https://noc.social/@MrWillCom" class="item">Mastodon</a>
                
                <a target="_blank" rel="noopener" href="https://discord.gg/UKuFDjcfY8" class="item">Discord</a>
                
                <a href="mailto:mr.will.com@outlook.com" class="item">Email</a>
                
            </div>
            
        </div>
        <span>&copy; 2024 Boogipop<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> </span>
        
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
    </div>
</footer>


        
<script src="/js/main.js"></script>

        
        
        

        
        <script src="https://unpkg.com/scrollreveal"></script>
		
        <script>
            window.addEventListener('load', () => {
                ScrollReveal({ delay: 250, reset: true, easing: 'cubic-bezier(0, 0, 0, 1)' })
                ScrollReveal().reveal('.post-list-item .cover-img img')
                ScrollReveal().reveal('.post-list-item, .card, .content p img, .content .block-large img', { distance: '60px', origin: 'bottom', duration: 800 })
            })
        </script>
        
    </body>
</html>